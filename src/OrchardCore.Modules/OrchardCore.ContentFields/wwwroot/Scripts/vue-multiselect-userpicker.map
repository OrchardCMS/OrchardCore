{"version":3,"sources":["<anon>"],"sourcesContent":["function debounceUserPicker(func, wait, immediate) {\n    var timeout;\n    return function () {\n        var context = this, args = arguments;\n        var later = function () {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n        };\n        var callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(context, args);\n    };\n};\nfunction initVueMultiselectUserPicker(element) {\n    // only run script if element exists\n    if (element) {\n        var elementId = element.id;\n        var selectedUsers = JSON.parse(element.dataset.selectedUsers || \"[]\");\n        var searchUrl = element.dataset.searchUrl;\n        var multiple = JSON.parse(element.dataset.multiple);\n        var debouncedSearch = debounceUserPicker(function (vm, query) {\n            vm.isLoading = true;\n            var searchFullUrl = searchUrl;\n            if (query) {\n                searchFullUrl += '&query=' + query;\n            }\n            fetch(searchFullUrl).then(function (res) {\n                res.json().then(function (json) {\n                    vm.options = json;\n                    vm.isLoading = false;\n                })\n            });\n        }, 250);\n        var vueMultiselect = Vue.component('vue-multiselect', window.VueMultiselect.default);\n        var vm = new Vue({\n            el: '#' + elementId,\n            components: { 'vue-multiselect': vueMultiselect },\n            data: {\n                value: null,\n                arrayOfUsers: selectedUsers,\n                options: [],\n            },\n            computed: {\n                selectedIds: function () {\n                    return this.arrayOfUsers.map(function (x) { return x.id }).join(',');\n                },\n                isDisabled: function () {\n                    return this.arrayOfUsers.length > 0 && !multiple;\n                }\n            },\n            watch: {\n                selectedIds: function () {\n                    // We add a delay to allow for the <input> to get the actual value\t\n                    // before the form is submitted\t\n                    setTimeout(function () { document.dispatchEvent(new Event('contentpreview:render')) }, 100);\n                }\n            },\n            created: function () {\n                var self = this;\n                self.asyncFind();\n            },\n            mounted: function () {\n                // Store a reference to the div containing the search box used to select users\n                // so we can hide/show it later (in onSelect and remove). We use the \"mounted\"\n                // lifecycle method rather than \"created\" so we know the component has been attached \n                // to the DOM and we can therefore travese the DOM to find the desired div.\n                this.searchBoxContainer = this.$el.lastChild;\n                // If we're loading an existing content item, we may already have a user picker\n                // configured to only allow a single user and that user has already been selected.\n                // In this case, we need to hide the search box now and not wait for onSelect or remove.\n                this.searchBoxContainer.style.display = multiple || this.arrayOfUsers.length === 0 ? \"block\" : \"none\";\n            },\n            methods: {\n                asyncFind: function (query) {\n                    var self = this;\n                    debouncedSearch(self, query);\n                },\n                onSelect: function (selectedOption, id) {\n                    var self = this;\n                    for (i = 0; i < self.arrayOfUsers.length; i++) {\n                        if (self.arrayOfUsers[i].id === selectedOption.id) {\n                            return;\n                        }\n                    }\n                    self.arrayOfUsers.push(selectedOption);\n                    // We don't want to show the search box if we are only allowing a single user \n                    // and a user has already been selected. We don't need that search box again \n                    // unless and until we delete the currently selected user. So here we \n                    // set the display mode accordingly. We always show the select list if allowing \n                    // multiple users and do not show it if we're only allowing a single user \n                    // and we've just selected that one user.\n                    this.searchBoxContainer.style.display = multiple ? \"block\" : \"none\";\n                },\n                remove: function (user) {\n                    this.arrayOfUsers.splice(this.arrayOfUsers.indexOf(user), 1);\n                    // After removing a selected user, we always want to show the search box \n                    // since (1) if we are allowing multiple users to be selected, we always \n                    // want to show it, and (2) if we are only allowing a single user to be \n                    // selected, and we've just removed that user, we now need to show the \n                    // search box so we are able to add a new one.\n                    this.searchBoxContainer.style.display = \"block\";\n                }\n            }\n        })\n        \n        /*Hook for other scripts that might want to have access to the view model*/\n        var event = new CustomEvent(\"vue-multiselect-userpicker-created\", { detail: { vm: vm } });\n        document.querySelector(\"body\").dispatchEvent(event);\n    }\n}\n"],"names":["debounceUserPicker","func","wait","immediate","timeout","context","args","arguments","callNow","clearTimeout","setTimeout","apply","initVueMultiselectUserPicker","element","elementId","id","selectedUsers","JSON","parse","dataset","searchUrl","multiple","debouncedSearch","vm","query","isLoading","searchFullUrl","fetch","then","res","json","options","vueMultiselect","Vue","component","window","VueMultiselect","default","event","CustomEvent","detail","el","components","data","value","arrayOfUsers","computed","selectedIds","map","x","join","isDisabled","length","watch","document","dispatchEvent","Event","created","self","asyncFind","mounted","searchBoxContainer","$el","lastChild","style","display","methods","onSelect","selectedOption","i","push","remove","user","splice","indexOf","querySelector"],"mappings":"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"}
