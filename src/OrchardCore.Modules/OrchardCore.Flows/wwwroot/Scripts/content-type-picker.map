{"version":3,"sources":["<anon>"],"sourcesContent":["var contentTypePickerApp;\nvar contentTypePickerInitialized;\nvar sharedContentTypePickerModal;\n\nfunction initializeContentTypePickerApplication(pathBase) {\n    if (contentTypePickerInitialized) {\n        return;\n    }\n\n    // Check if the Vue app element exists in the DOM\n    var appElement = document.getElementById(\"contentTypePickerApp\");\n    if (!appElement) {\n        // Element not found - don't set initialized flag so it can be retried\n        return;\n    }\n\n    contentTypePickerInitialized = true;\n\n    contentTypePickerApp = new Vue({\n        el: \"#contentTypePickerApp\",\n        data: {\n            contentTypes: [],\n            categories: [],\n            searchFilter: \"\",\n            selectedCategory: \"All\",\n            pathBase: pathBase || \"\",\n            currentConfig: null,\n            hasError: false,\n        },\n        computed: {\n            filteredContentTypes: function () {\n                var self = this;\n                return this.contentTypes.filter(function (contentType) {\n                    // Filter by category\n                    // Items without a category are only shown when \"All\" is selected\n                    if (self.selectedCategory !== \"All\") {\n                        if (!contentType.category || contentType.category !== self.selectedCategory) {\n                            return false;\n                        }\n                    }\n                    // Filter by search term\n                    if (self.searchFilter) {\n                        var searchLower = self.searchFilter.toLowerCase();\n                        var nameMatch = contentType.displayName.toLowerCase().indexOf(searchLower) >= 0;\n                        var descMatch = contentType.description && contentType.description.toLowerCase().indexOf(searchLower) >= 0;\n                        return nameMatch || descMatch;\n                    }\n                    return true;\n                });\n            },\n        },\n        methods: {\n            configure: function (options) {\n                this.currentConfig = options;\n                this.contentTypes = options.contentTypes || [];\n\n                // Build unique categories list\n                var categorySet = {};\n                this.contentTypes.forEach(function (contentType) {\n                    if (contentType.category) {\n                        categorySet[contentType.category] = true;\n                    }\n                });\n                this.categories = [\"All\"].concat(Object.keys(categorySet).sort());\n\n                // Reset filters and error state\n                this.searchFilter = \"\";\n                this.selectedCategory = \"All\";\n                this.hasError = false;\n            },\n            selectCategory: function (category) {\n                this.selectedCategory = category;\n            },\n            selectContentType: function (contentType) {\n                if (this.currentConfig && this.currentConfig.onContentTypeSelected) {\n                    this.currentConfig.onContentTypeSelected(contentType, this.currentConfig);\n                }\n            },\n            getThumbnailUrl: function (contentType) {\n                if (contentType.thumbnail) {\n                    // Handle tilde paths\n                    if (contentType.thumbnail.startsWith(\"~/\")) {\n                        return this.pathBase + contentType.thumbnail.substring(1);\n                    }\n                    return contentType.thumbnail;\n                }\n                return null;\n            },\n        },\n    });\n\n    // Set up shared modal\n    var modalElement = document.getElementById(\"contentTypePickerModal\");\n    if (modalElement) {\n        sharedContentTypePickerModal = new bootstrap.Modal(modalElement);\n\n        // Blur focused element before modal hides to prevent aria-hidden warning\n        modalElement.addEventListener(\"hide.bs.modal\", function () {\n            if (document.activeElement && modalElement.contains(document.activeElement)) {\n                document.activeElement.blur();\n            }\n        });\n\n        // Reset state when modal is hidden\n        modalElement.addEventListener(\"hidden.bs.modal\", function () {\n            if (contentTypePickerApp) {\n                contentTypePickerApp.searchFilter = \"\";\n                contentTypePickerApp.selectedCategory = \"All\";\n                contentTypePickerApp.currentConfig = null;\n                contentTypePickerApp.hasError = false;\n            }\n        });\n    }\n}\n\n// Remove any duplicate modals that may have been injected via AJAX\nfunction removeDuplicateModals() {\n    var modals = document.querySelectorAll(\"#contentTypePickerModal\");\n    for (var i = 1; i < modals.length; i++) {\n        modals[i].remove();\n    }\n}\n\n// Show the shared modal with configuration\nfunction showContentTypePicker(config) {\n    // Remove any duplicate modals first\n    removeDuplicateModals();\n\n    // Try to initialize if not already done (handles late DOM injection)\n    if (!contentTypePickerInitialized) {\n        initializeContentTypePickerApplication(config.pathBase || \"\");\n    }\n\n    if (contentTypePickerApp && sharedContentTypePickerModal) {\n        contentTypePickerApp.configure(config);\n\n        // Update modal title if provided\n        if (config.modalTitle) {\n            var titleElement = document.getElementById(\"contentTypePickerModalLabel\");\n\n            if (titleElement) {\n                titleElement.textContent = config.modalTitle;\n            }\n        }\n\n        sharedContentTypePickerModal.show();\n    }\n}\n\n// Hide the shared modal\nfunction hideContentTypePicker() {\n    if (sharedContentTypePickerModal) {\n        // Blur any focused element to prevent aria-hidden warning\n        if (document.activeElement) {\n            document.activeElement.blur();\n        }\n        sharedContentTypePickerModal.hide();\n    }\n}\n\n// Direct widget creation via AJAX\nfunction contentTypePickerSelectContentType(contentType, config) {\n    var targetId = config.targetId;\n    var htmlFieldPrefix = config.htmlFieldPrefix;\n    var $target = $(\"#\" + targetId);\n    var createEditorUrl = $target.data(\"buildeditorurl\");\n\n    // Calculate next prefix index\n    var indexes = $target\n        .closest(\"form\")\n        .find(\"input[name*='Prefixes']\")\n        .filter(function (i, e) {\n            return $(e).val().substring(0, $(e).val().lastIndexOf(\"-\")) === htmlFieldPrefix;\n        })\n        .map(function (i, e) {\n            return (\n                parseInt(\n                    $(e)\n                        .val()\n                        .substring($(e).val().lastIndexOf(\"-\") + 1),\n                ) || 0\n            );\n        });\n\n    var index = indexes.length ? Math.max(...indexes) + 1 : 0;\n    var prefix = htmlFieldPrefix + \"-\" + index.toString();\n\n    // Build URL with proper encoding\n    var params = new URLSearchParams({\n        id: contentType.name,\n        prefix: prefix,\n        prefixesName: config.prefixesName,\n        contentTypesName: config.contentTypesName,\n        contentItemsName: config.contentItemsName,\n        targetId: targetId,\n        flowmetadata: config.flowmetadata || false,\n        parentContentType: config.parentContentType,\n        partName: config.partName,\n    });\n\n    // Add optional cardCollectionType\n    if (config.cardCollectionType) {\n        params.append(\"cardCollectionType\", config.cardCollectionType);\n    }\n\n    $.ajax({\n        url: createEditorUrl + \"?\" + params.toString(),\n    }).done(function (data) {\n        var result = JSON.parse(data);\n\n        // Insert before element if specified, otherwise append to target\n        if (config.insertBefore) {\n            $(result.Content).insertBefore(config.insertBefore);\n        } else {\n            $target.append(result.Content);\n        }\n\n        // Execute scripts\n        $(result.Scripts)\n            .filter(\"script\")\n            .each(function () {\n                $.globalEval(this.text || this.textContent || this.innerHTML || \"\");\n            });\n\n        hideContentTypePicker();\n    }).fail(function () {\n        if (contentTypePickerApp) {\n            contentTypePickerApp.hasError = true;\n        }\n    });\n}\n"],"names":["contentTypePickerApp","contentTypePickerInitialized","sharedContentTypePickerModal","initializeContentTypePickerApplication","pathBase","document","getElementById","Vue","el","data","contentTypes","categories","searchFilter","selectedCategory","currentConfig","hasError","computed","filteredContentTypes","self","filter","contentType","category","searchLower","toLowerCase","nameMatch","displayName","indexOf","descMatch","description","methods","configure","options","categorySet","forEach","concat","Object","keys","sort","selectCategory","selectContentType","onContentTypeSelected","getThumbnailUrl","thumbnail","startsWith","substring","modalElement","bootstrap","Modal","addEventListener","activeElement","contains","blur","removeDuplicateModals","modals","querySelectorAll","i","length","remove","showContentTypePicker","config","modalTitle","titleElement","textContent","show","hideContentTypePicker","hide","contentTypePickerSelectContentType","targetId","htmlFieldPrefix","$target","$","createEditorUrl","indexes","closest","find","e","val","lastIndexOf","map","parseInt","prefix","index","Math","max","toString","params","URLSearchParams","id","name","prefixesName","contentTypesName","contentItemsName","flowmetadata","parentContentType","partName","cardCollectionType","append","ajax","url","done","result","JSON","parse","insertBefore","Content","Scripts","each","globalEval","text","innerHTML","fail"],"mappings":"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"}
