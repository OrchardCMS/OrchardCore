var widgetDragItem,lastContainer,widgetItemSourceId,widgetItemDestId;document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(event){if(event.target.matches(".add-widget")){var type=event.target.dataset.widgetType,targetId=event.target.dataset.targetId,htmlFieldPrefix=event.target.dataset.htmlFieldPrefix,createEditorUrl=document.getElementById(targetId).dataset.buildeditorurl,prefixesName=event.target.dataset.prefixesName,flowmetadata=event.target.dataset.flowmetadata,parentContentType=event.target.dataset.parentContentType,partName=event.target.dataset.partName,indexes=Array.from(document.querySelectorAll(`#${targetId}`).closest("form").querySelectorAll("input[name*='Prefixes']")).filter(t=>t.value.substring(0,t.value.lastIndexOf("-"))===htmlFieldPrefix).map(t=>parseInt(t.value.substring(t.value.lastIndexOf("-")+1))||0),index=indexes.length?Math.max(...indexes)+1:0,prefix=htmlFieldPrefix+"-"+index.toString(),contentTypesName=event.target.dataset.contenttypesName,contentItemsName=event.target.dataset.contentitemsName;fetch(`${createEditorUrl}?id=${type}&prefix=${prefix}&prefixesName=${prefixesName}&contentTypesName=${contentTypesName}&contentItemsName=${contentItemsName}&targetId=${targetId}&flowmetadata=${flowmetadata}&parentContentType=${parentContentType}&partName=${partName}`).then(t=>t.json()).then(data=>{document.getElementById(targetId).insertAdjacentHTML("beforeend",data.Content);var dom=new DOMParser().parseFromString(data.Scripts,"text/html");Array.from(dom.querySelectorAll("script")).forEach(script=>{eval(script.textContent||script.innerHTML)})})}if(event.target.matches(".insert-widget")){var type=event.target.dataset.widgetType,target=event.target.closest(".widget-template"),targetId=event.target.dataset.targetId,htmlFieldPrefix=event.target.dataset.htmlFieldPrefix,createEditorUrl=document.getElementById(targetId).dataset.buildeditorurl,flowmetadata=event.target.dataset.flowmetadata,prefixesName=event.target.dataset.prefixesName,parentContentType=event.target.dataset.parentContentType,partName=event.target.dataset.partName,indexes=Array.from(document.querySelectorAll(`#${targetId}`).closest("form").querySelectorAll("input[name*='Prefixes']")).filter(t=>t.value.substring(0,t.value.lastIndexOf("-"))===htmlFieldPrefix).map(t=>parseInt(t.value.substring(t.value.lastIndexOf("-")+1))||0),index=indexes.length?Math.max(...indexes)+1:0,prefix=htmlFieldPrefix+"-"+index.toString(),contentTypesName=event.target.dataset.contenttypesName,contentItemsName=event.target.dataset.contentitemsName;fetch(`${createEditorUrl}?id=${type}&prefix=${prefix}&prefixesName=${prefixesName}&contentTypesName=${contentTypesName}&contentItemsName=${contentItemsName}&targetId=${targetId}&flowmetadata=${flowmetadata}&parentContentType=${parentContentType}&partName=${partName}`).then(t=>t.json()).then(data=>{target.insertAdjacentHTML("beforebegin",data.Content);var dom=new DOMParser().parseFromString(data.Scripts,"text/html");Array.from(dom.querySelectorAll("script")).forEach(script=>{eval(script.textContent||script.innerHTML)})})}if(event.target.matches(".widget-delete")){var $this=event.target;confirmDialog({...$this.dataset,callback:function(t){t&&($this.closest(".widget-template").remove(),document.dispatchEvent(new Event("contentpreview:render")))}})}event.target.matches(".widget-editor-btn-toggle")&&event.target.closest(".widget-editor").classList.toggle("collapsed")}),document.addEventListener("change",function(t){if(t.target.matches(".widget-editor-footer label, .widget-editor-header label")){var e=t.target.closest(".widget-template"),a=t.target.querySelector("input:first-child");if(a&&a.id.includes("Size")){var r=a.value;e.className.split(" ").forEach(t=>{t.startsWith("col-md-")&&e.classList.remove(t)});var n=Math.round(r/100*12);e.classList.add("col-md-"+n),t.target.closest(".dropdown-menu").previousElementSibling.textContent=r+"%"}else if(a&&a.id.includes("Alignment")){var d=t.target.querySelector("svg").outerHTML;t.target.closest(".dropdown-menu").previousElementSibling.innerHTML=d}Array.from(t.target.parentNode.querySelectorAll(".dropdown-item")).forEach(t=>t.classList.remove("active")),t.target.classList.toggle("active"),document.dispatchEvent(new Event("contentpreview:render"))}}),document.addEventListener("keyup",function(t){if(t.target.matches(".widget-editor-body .form-group input.content-caption-text")){var e=t.target.closest(".widget-editor").querySelector(".widget-editor-header:first-child .widget-editor-header-text"),a=e.dataset.contentTypeDisplayText;e.textContent=t.target.value+" "+a}})});