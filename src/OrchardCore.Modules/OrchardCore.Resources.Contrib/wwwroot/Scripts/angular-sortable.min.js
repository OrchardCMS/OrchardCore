angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,o){return{require:"?ngModel",link:function(n,i,l,a){function r(e,t){return t&&"function"==typeof t?function(o,n){e(o,n),t(o,n)}:e}function s(e,t){var o=e.sortable("option","helper");return"clone"===o||"function"==typeof o&&t.item.sortable.isCustomHelperUsed()}function u(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function d(e,t){t.item.sortable._destroy()}var c,m={},f={"ui-floating":void 0},b={receive:null,remove:null,start:null,stop:null,update:null},p={helper:null};return angular.extend(m,f,e,n.$eval(l.uiSortable)),angular.element.fn&&angular.element.fn.jquery?(a?(n.$watch(l.ngModel+".length",function(){t(function(){i.data("ui-sortable")&&i.sortable("refresh")},0,!1)}),b.start=function(e,t){if("auto"===m["ui-floating"]){var o=t.item.siblings();angular.element(e.target).data("ui-sortable").floating=u(o)}t.item.sortable={model:a.$modelValue[t.item.index()],index:t.item.index(),source:t.item.parent(),sourceModel:a.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(e,o){t.item.sortable[o]=void 0})}}},b.activate=function(){c=i.contents();var e=i.sortable("option","placeholder");if(e&&e.element&&"function"==typeof e.element){var t=e.element();t=angular.element(t);var o=i.find('[class="'+t.attr("class")+'"]');c=c.not(o)}},b.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=t.item.index();var o=t.item.parent();t.item.sortable.droptarget=o;var l=o.attr("ng-model")||o.attr("data-ng-model");t.item.sortable.droptargetModel=o.scope().$eval(l),i.sortable("cancel")}s(i,t)&&!t.item.sortable.received&&"parent"===i.sortable("option","appendTo")&&(c=c.not(c.last())),c.appendTo(i),t.item.sortable.received&&(c=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&n.$apply(function(){a.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},b.stop=function(e,t){!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()?n.$apply(function(){a.$modelValue.splice(t.item.sortable.dropindex,0,a.$modelValue.splice(t.item.sortable.index,1)[0])}):"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()||s(i,t)||c.appendTo(i),c=null},b.receive=function(e,t){t.item.sortable.received=!0},b.remove=function(e,t){"dropindex"in t.item.sortable||(i.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||n.$apply(function(){t.item.sortable.moved=a.$modelValue.splice(t.item.sortable.index,1)[0]})},p.helper=function(e){return e&&"function"==typeof e?function(t,o){var n=e(t,o);return o.sortable._isCustomHelperUsed=o!==n,n}:e},n.$watch(l.uiSortable,function(e){i.data("ui-sortable")&&angular.forEach(e,function(e,t){return t in f?("ui-floating"!==t||e!==!1&&e!==!0||(i.data("ui-sortable").floating=e),void(m[t]=e)):(b[t]?("stop"===t&&(e=r(e,function(){n.$apply()}),e=r(e,d)),e=r(b[t],e)):p[t]&&(e=p[t](e)),m[t]=e,void i.sortable("option",t,e))})},!0),angular.forEach(b,function(e,t){m[t]=r(e,m[t]),"stop"===t&&(m[t]=r(m[t],d))})):o.info("ui.sortable: ngModel not provided!",i),void i.sortable(m)):void o.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);