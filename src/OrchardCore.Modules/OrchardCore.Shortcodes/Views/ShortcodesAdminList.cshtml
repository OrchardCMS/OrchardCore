@model ShortcodeTemplateIndexViewModel

@{
    int startIndex = (Model.Pager.Page - 1) * (Model.Pager.PageSize) + 1;
    int endIndex = startIndex + Model.ShortcodeTemplates.Count - 1;
}

<script asp-name="bootstrap-select" at="Foot"></script>

<!-- Hidden submit button do not remove -->
<input type="submit" name="submit.Filter" id="submitFilter" class="visually-hidden" />
<input type="submit" name="submit.BulkAction" class="visually-hidden" />
@Html.HiddenFor(o => o.Options.BulkAction)

<div class="card text-bg-theme mb-3 position-sticky action-bar">
    <div class="card-body">
        <div class="row gx-3">
            <div class="col">
                @await DisplayAsync(Model.Header.Search)
            </div>
            <div class="col-auto">
                @await DisplayAsync(Model.Header.Create)
            </div>
        </div>
    </div>
</div>
<ul class="list-group with-checkbox">
    @if (Model.ShortcodeTemplates.Count > 0)
    {
        <li class="list-group-item text-bg-theme">
            <div class="row gx-3">
                <div class="col">
                    @await DisplayAsync(Model.Header.Summary)
                </div>
                <div class="col col-md-auto text-end">
                    @await DisplayAsync(Model.Header.Actions)
                </div>
            </div>
        </li>
        @foreach (var entry in Model.ShortcodeTemplates)
        {
            <li class="list-group-item">
                <div class="form-check float-start">
                    <input type="checkbox" class="form-check-input" value="@entry.Name" name="itemIds" id="itemIds-@entry.Name">
                    <label class="form-check-label" for="itemIds-@entry.Name">&nbsp;</label>
                </div>
                <div class="w-100">
                    <div class="float-end">
                        <a asp-action="Edit" asp-route-name="@entry.Name" class="btn btn-primary btn-sm">@T["Edit"]</a>
                        <a asp-action="Delete" asp-route-name="@entry.Name" class="btn btn-danger btn-sm"
                            data-url-af="RemoveUrl UnsafeUrl">@T["Delete"]</a>
                    </div>
                    <a asp-action="Edit" asp-route-name="@entry.Name">@entry.Name</a>
                    @if (!string.IsNullOrWhiteSpace(entry.ShortcodeTemplate.Hint))
                    {
                        <span class="hint dashed">@entry.ShortcodeTemplate.Hint</span>
                    }
                </div>
            </li>
        }
    }
    else
    {
        <li class="list-group-item">
            <div class="alert alert-info mb-0" role="alert">
                @T["<strong>Nothing here!</strong> There are no shortcodes for the moment."]
                <a class="seedoc"
                    href="@(OrchardCore.Admin.Constants.DocsUrl)reference/modules/Shortcodes/#example-shortcode-templates"
                    target="_blank">@T["See documentation"]</a>
            </div>
        </li>
    }
</ul>

@await DisplayAsync(Model.Pager)

<script at="Foot" depends-on="jQuery">
    $(function () {
        var actions = $("#actions");
        var items = $("#items");
        var filters = $(".filter");
        var selectAllCtrl = $("#select-all");
        var selectedItems = $("#selected-items");
        var itemsCheckboxes = $(":checkbox[name='itemIds']");

        @* This applies to all filter selectpickers on page. Add .nosubmit to not submit *@
            $('.selectpicker:not(.nosubmit)').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
                $("[name='submit.Filter']").click();
            });

        $(".dropdown-menu .dropdown-item").filter(function () {
            return $(this).data("action");
        }).on("click", function () {
            if ($(":checkbox[name='itemIds']:checked").length > 1) {
                var $this = $(this);
                confirmDialog({
                    ...$this.data(), callback: function (r) {
                        if (r) {
                            $("[name='Options.BulkAction']").val($this.data("action"));
                            $("[name='submit.BulkAction']").click();
                        }
                    }
                });
            }
        });
        function displayActionsOrFilters() {
            if ($(":checkbox[name='itemIds']:checked").length > 1) {
                actions.show();
                filters.hide();
                selectedItems.show();
                items.hide();
            }
            else {
                actions.hide();
                filters.show();
                selectedItems.hide();
                items.show();
            }
        }

        selectAllCtrl.click(function () {
            itemsCheckboxes.not(this).prop("checked", this.checked);
            selectedItems.text($(":checkbox[name='itemIds']:checked").length + ' @T["selected"]');
            displayActionsOrFilters();
        });

        itemsCheckboxes.on("click", function () {
            var itemsCount = $(":checkbox[name='itemIds']").length;
            var selectedItemsCount = $(":checkbox[name='itemIds']:checked").length;

            selectAllCtrl.prop("checked", selectedItemsCount == itemsCount);
            selectAllCtrl.prop("indeterminate", selectedItemsCount > 0 && selectedItemsCount < itemsCount);

            selectedItems.text(selectedItemsCount + ' @T["selected"]');
            displayActionsOrFilters();
        });
    })
</script>
