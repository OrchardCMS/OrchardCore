function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}!function(t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module))?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}((function(t){"use strict";var e,r,n,o,i={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},s=t.Pos,a=t.cmpPos;function u(t){return"[object Array]"==Object.prototype.toString.call(t)}function f(t){return"string"==typeof t?t:t.text}function l(t,e){return u(e)&&(e={columns:e}),e.text||(e.text=t),e}function c(t){return e[t.toUpperCase()]}function p(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function d(t,e){var r=t.length,n=f(e).substr(0,r);return t.toUpperCase()===n.toUpperCase()}function g(t,e,r,n){if(u(r))for(var o=0;o<r.length;o++)d(e,r[o])&&t.push(n(r[o]));else for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];d(e,s=s&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(n(s))}}function y(t){"."==t.charAt(0)&&(t=t.substr(1));for(var e=t.split(o+o),r=0;r<e.length;r++)e[r]=e[r].replace(new RegExp(o,"g"),"");return e.join(o)}function h(t){for(var e=f(t).split("."),r=0;r<e.length;r++)e[r]=o+e[r].replace(new RegExp(o,"g"),o+o)+o;var n=e.join(".");return"string"==typeof t?n:((t=p(t)).text=n,t)}function v(t,e){for(var r=t.split(/\s+/),n=0;n<r.length;n++)r[n]&&e(r[n].replace(/[`,;]/g,""))}function m(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),u="",f="",l=[],p={start:s(0,0),end:s(e.lastLine(),e.getLineHandle(e.lastLine()).length)},d=n.indexOf(i.QUERY_DIV);-1!=d;)l.push(r.posFromIndex(d)),d=n.indexOf(i.QUERY_DIV,d+1);l.unshift(s(0,0)),l.push(s(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var g=null,y=e.getCursor(),h=0;h<l.length;h++){if((null==g||a(y,g)>0)&&a(y,l[h])<=0){p={start:g,end:l[h]};break}g=l[h]}if(p.start){var m=r.getRange(p.start,p.end,!1);for(h=0;h<m.length;h++){if(v(m[h],(function(t){var e=t.toUpperCase();e===o&&c(u)&&(f=u),e!==i.ALIAS_KEYWORD&&(u=t)})),f)break}}return f}t.registerHelper("hint","sql",(function(i,a){e=function(t){var e={};if(u(t))for(var r=t.length-1;r>=0;r--){var n=t[r];e[f(n).toUpperCase()]=l(f(n),n)}else if(t)for(var o in t)e[o.toUpperCase()]=l(o,t[o]);return e}(a&&a.tables);var d=a&&a.defaultTable,v=a&&a.disableKeywords;r=d&&c(d),n=function(e){var r=e.doc.modeOption;return"sql"===r&&(r="text/x-sql"),t.resolveMode(r).keywords}(i),o=function(e){var r=e.doc.modeOption;return"sql"===r&&(r="text/x-sql"),t.resolveMode(r).identifierQuote||"`"}(i),d&&!r&&(r=m(d,i)),(r=r||[]).columns&&(r=r.columns);var x,b,C,A=i.getCursor(),q=[],U=i.getTokenAt(A);if(U.end>A.ch&&(U.end=A.ch,U.string=U.string.slice(0,A.ch-U.start)),U.string.match(/^[.`"'\w@][\w$#]*$/g)?(C=U.string,x=U.start,b=U.end):(x=b=A.ch,C=""),"."==C.charAt(0)||C.charAt(0)==o)x=function(t,n,i,a){for(var u=!1,f=[],l=n.start,d=!0;d;)d="."==n.string.charAt(0),u=u||n.string.charAt(0)==o,l=n.start,f.unshift(y(n.string)),"."==(n=a.getTokenAt(s(t.line,n.start))).string&&(d=!0,n=a.getTokenAt(s(t.line,n.start)));var v=f.join(".");g(i,v,e,(function(t){return u?h(t):t})),g(i,v,r,(function(t){return u?h(t):t})),v=f.pop();var x=f.join("."),b=!1,C=x;if(!c(x)){var A=x;(x=m(x,a))!==A&&(b=!0)}var q=c(x);return q&&q.columns&&(q=q.columns),q&&g(i,v,q,(function(t){var e=x;return 1==b&&(e=C),"string"==typeof t?t=e+"."+t:(t=p(t)).text=e+"."+t.text,u?h(t):t})),l}(A,U,q,i);else{var _=function(t,e){return"object"===_typeof(t)?t.className=e:t={text:t,className:e},t};g(q,C,r,(function(t){return _(t,"CodeMirror-hint-table CodeMirror-hint-default-table")})),g(q,C,e,(function(t){return _(t,"CodeMirror-hint-table")})),v||g(q,C,n,(function(t){return _(t.toUpperCase(),"CodeMirror-hint-keyword")}))}return{list:q,from:s(A.line,x),to:s(A.line,b)}}))}));
