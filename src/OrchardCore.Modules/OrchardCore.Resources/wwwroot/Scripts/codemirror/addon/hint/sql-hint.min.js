!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){"use strict";var e,r,n,o,i={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},s=t.Pos,a=t.cmpPos;function l(t){return"[object Array]"==Object.prototype.toString.call(t)}function u(t){return"string"==typeof t?t:t.text}function f(t,e){return l(e)&&(e={columns:e}),e.text||(e.text=t),e}function c(t){return e[t.toUpperCase()]}function p(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function d(t,e){var r=t.length,n=u(e).substr(0,r);return t.toUpperCase()===n.toUpperCase()}function g(t,e,r,n){if(l(r))for(var o=0;o<r.length;o++)d(e,r[o])&&t.push(n(r[o]));else for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];d(e,s=s&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(n(s))}}function h(t){for(var e=u(t).split("."),r=0;r<e.length;r++)e[r]=o+e[r].replace(RegExp(o,"g"),o+o)+o;var n=e.join(".");return"string"==typeof t?n:((t=p(t)).text=n,t)}function v(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),l="",u="",f=[],p={start:s(0,0),end:s(e.lastLine(),e.getLineHandle(e.lastLine()).length)},d=n.indexOf(i.QUERY_DIV);-1!=d;)f.push(r.posFromIndex(d)),d=n.indexOf(i.QUERY_DIV,d+1);f.unshift(s(0,0)),f.push(s(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var g=null,h=e.getCursor(),v=0;v<f.length;v++){if((null==g||a(h,g)>0)&&0>=a(h,f[v])){p={start:g,end:f[v]};break}g=f[v]}if(p.start)for(var x=r.getRange(p.start,p.end,!1),v=0;v<x.length&&(!function(t,e){for(var r=t.split(/\s+/),n=0;n<r.length;n++)r[n]&&e(r[n].replace(/[`,;]/g,""))}(x[v],function(t){var e=t.toUpperCase();e===o&&c(l)&&(u=l),e!==i.ALIAS_KEYWORD&&(l=t)}),!u);v++);return u}t.registerHelper("hint","sql",function(i,a){e=function(t){var e={};if(l(t))for(var r=t.length-1;r>=0;r--){var n=t[r];e[u(n).toUpperCase()]=f(u(n),n)}else if(t)for(var o in t)e[o.toUpperCase()]=f(o,t[o]);return e}(a&&a.tables);var d=a&&a.defaultTable,x=a&&a.disableKeywords;r=d&&c(d),"sql"===(m=i.doc.modeOption)&&(m="text/x-sql"),n=t.resolveMode(m).keywords,"sql"===(y=i.doc.modeOption)&&(y="text/x-sql"),o=t.resolveMode(y).identifierQuote||"`",d&&!r&&(r=v(d,i)),(r=r||[]).columns&&(r=r.columns);var m,y,b,C,A,q=i.getCursor(),U=[],j=i.getTokenAt(q);if(j.end>q.ch&&(j.end=q.ch,j.string=j.string.slice(0,q.ch-j.start)),j.string.match(/^[.`"'\w@][\w$#]*$/g)?(A=j.string,b=j.start,C=j.end):(b=C=q.ch,A=""),"."==A.charAt(0)||A.charAt(0)==o)b=function(t,n,i,a){for(var l=!1,u=[],f=n.start,d=!0;d;)d="."==n.string.charAt(0),l=l||n.string.charAt(0)==o,f=n.start,u.unshift(function(t){"."==t.charAt(0)&&(t=t.substr(1));for(var e=t.split(o+o),r=0;r<e.length;r++)e[r]=e[r].replace(RegExp(o,"g"),"");return e.join(o)}(n.string)),"."==(n=a.getTokenAt(s(t.line,n.start))).string&&(d=!0,n=a.getTokenAt(s(t.line,n.start)));var x=u.join(".");g(i,x,e,function(t){return l?h(t):t}),g(i,x,r,function(t){return l?h(t):t}),x=u.pop();var m=u.join("."),y=!1,b=m;if(!c(m)){var C=m;(m=v(m,a))!==C&&(y=!0)}var A=c(m);return A&&A.columns&&(A=A.columns),A&&g(i,x,A,function(t){var e=m;return!0==y&&(e=b),"string"==typeof t?t=e+"."+t:(t=p(t)).text=e+"."+t.text,l?h(t):t}),f}(q,j,U,i);else{var O=function(t,e){return"object"==typeof t?t.className=e:t={text:t,className:e},t};g(U,A,r,function(t){return O(t,"CodeMirror-hint-table CodeMirror-hint-default-table")}),g(U,A,e,function(t){return O(t,"CodeMirror-hint-table")}),x||g(U,A,n,function(t){return O(t.toUpperCase(),"CodeMirror-hint-keyword")})}return{list:U,from:s(q.line,b),to:s(q.line,C)}})});
