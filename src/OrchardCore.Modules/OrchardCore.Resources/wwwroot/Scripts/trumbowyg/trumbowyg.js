/**
 * Trumbowyg v2.31.0 - A lightweight WYSIWYG editor
 * Trumbowyg core file
 * ------------------------
 * @link https://alex-d.github.io/Trumbowyg/
 * @license MIT
 * @author Alexandre Demode (Alex-D)
 *         Twitter : @AlexandreDemode
 *         Website : alex-d.fr
 */jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",_self:"Same tab (default)",_blank:"New tab",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,svgAbsoluteUseHref:!1,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,hideButtonTexts:null,prefix:"trumbowyg-",tagClasses:{},semantic:!0,semanticKeepAttributes:!1,resetCss:!1,removeformatPasted:!1,tabToIndent:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},changeActiveDropdownIcon:!1,inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1,linkTargets:["_self","_blank"],svgPath:null},writable:!1,enumerable:!0,configurable:!1}),function(t,e,n,i){"use strict";var a="tbwconfirm",o="tbwcancel";i.fn.trumbowyg=function(t,e){var n="trumbowyg";if(t===Object(t)||!t)return this.each(function(){i(this).data(n)||i(this).data(n,new s(this,t))});if(1===this.length)try{var a=i(this).data(n);switch(t){case"execCmd":return a.execCmd(e.cmd,e.param,e.forceCss,e.skipTrumbowyg);case"openModal":return a.openModal(e.title,e.content);case"closeModal":return a.closeModal();case"openModalInsert":return a.openModalInsert(e.title,e.fields,e.callback);case"saveRange":return a.saveRange();case"getRange":return a.range;case"getRangeText":return a.getRangeText();case"restoreRange":return a.restoreRange();case"enable":return a.setDisabled(!1);case"disable":return a.setDisabled(!0);case"toggle":return a.toggle();case"destroy":return a.destroy();case"empty":return a.empty();case"html":return a.html(e)}}catch(t){}return!1};var s=function(a,o){var s=this,r="trumbowyg-icons",l=i.trumbowyg;s.doc=a.ownerDocument||n,s.$ta=i(a),s.$c=i(a),null!=(o=o||{}).lang||null!=l.langs[o.lang]?s.lang=i.extend(!0,{},l.langs.en,l.langs[o.lang]):s.lang=l.langs.en,s.hideButtonTexts=null!=l.hideButtonTexts?l.hideButtonTexts:o.hideButtonTexts;var d=null!=l.svgPath?l.svgPath:o.svgPath;if(s.hasSvg=!1!==d,!1!==d&&(l.svgAbsoluteUseHref||0===i("#"+r,s.doc).length)){if(null==d&&i("script[src]").each(function(t,e){var n=e.src,i=n.match("trumbowyg(.min)?.js");null!=i&&(d=n.substring(0,n.indexOf(i[0]))+"ui/icons.svg")}),null==d)console.warn("You must define svgPath: https://goo.gl/CfTY9U");else if(!l.svgAbsoluteUseHref){var c=s.doc.createElement("div");c.style.width="0",c.style.height="0",c.style.overflow="hidden",c.style.visibility="hidden",c.id=r,s.doc.body.insertBefore(c,s.doc.body.childNodes[0]),fetch(d,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(t=>{t.text().then(t=>{c.innerHTML=t})})}}var u=s.doc.querySelector("base")?e.location.href.replace(e.location.hash,""):"";s.svgPath=l.svgAbsoluteUseHref?d:u;var h=s.lang.header,g=function(){return(e.chrome||e.Intl&&Intl.v8BreakIterator)&&"CSS"in e};s.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable"},undo:{isSupported:g,key:"Z"},redo:{isSupported:g,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:h+" 1"},h2:{fn:"formatBlock",title:h+" 2"},h3:{fn:"formatBlock",title:h+" 3"},h4:{fn:"formatBlock",title:h+" 4"},h5:{fn:"formatBlock",title:h+" 5"},h6:{fn:"formatBlock",title:h+" 6"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},s.o=i.extend(!0,{},l.defaultOptions,o),s.o.hasOwnProperty("imgDblClickHandler")||(s.o.imgDblClickHandler=s.getDefaultImgDblClickHandler()),s.urlPrefix=s.setupUrlPrefix(),s.disabled=s.o.disabled||"TEXTAREA"===a.nodeName&&a.disabled,o.btns?s.o.btns=o.btns:s.o.semantic||(s.o.btns[3]=["bold","italic","underline","strikethrough"]),i.each(s.o.btnsDef,function(t,e){s.addBtnDef(t,e)}),s.eventNamespace="trumbowyg-event",s.keys=[],s.tagToButton={},s.tagHandlers=[],s.pasteHandlers=[].concat(s.o.pasteHandlers),s.isIE=-1!==t.userAgent.indexOf("MSIE")||-1!==t.appVersion.indexOf("Trident/"),s.isMac=-1!==t.platform.toUpperCase().indexOf("MAC"),s.init()};s.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var t=this;t.height=t.$ta.outerHeight()-39,t.initPlugins();try{t.doc.execCommand("enableObjectResizing",!1,!1),t.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(t){}t.buildEditor(),t.buildBtnPane(),t.fixedBtnPaneEvents(),t.buildOverlay(),setTimeout(function(){t.disabled&&t.setDisabled(!0),t.$c.trigger("tbwinit")})},addBtnDef:function(t,e){this.btnsDef[t]=i.extend(e,this.btnsDef[t]||{})},setupUrlPrefix:function(){var t=this.o.urlProtocol;return t?"string"!=typeof t?"https://":t.replace("://","")+"://":void 0},buildEditor:function(){var t=this,n=t.o.prefix,a="";t.$box=i("<div/>",{class:n+"box "+n+"editor-visible "+n+t.o.lang+" trumbowyg"}),t.$edBox=i("<div/>",{class:n+"editor-box"}),t.isTextarea=t.$ta.is("textarea"),t.isTextarea?(a=t.$ta.val(),t.$ed=i("<div/>").appendTo(t.$edBox),t.$box.insertAfter(t.$ta).append(t.$edBox,t.$ta)):(t.$ed=t.$ta,a=t.$ed.html(),t.$ta=i("<textarea/>",{name:t.$ta.attr("id"),height:t.height}).val(a),t.$box.insertAfter(t.$ed).append(t.$ta,t.$edBox),t.$edBox.append(t.$ed),t.syncCode()),t.$ta.addClass(n+"textarea").attr("tabindex",-1),t.$ed.addClass(n+"editor").attr({contenteditable:!0,dir:t.lang._dir||"ltr"}).html(a),t.o.tabindex&&t.$ed.attr("tabindex",t.o.tabindex),t.$c.is("[placeholder]")&&t.$ed.attr("placeholder",t.$c.attr("placeholder")),t.$c.is("[spellcheck]")&&t.$ed.attr("spellcheck",t.$c.attr("spellcheck")),t.o.resetCss&&t.$ed.addClass(n+"reset-css"),t.semanticCode(),t.applyTagClasses(),t.o.autogrowOnEnter&&t.$ed.addClass(n+"autogrow-on-enter");var o,s=!1,r=!1;t.$ed.on("dblclick","img",t.o.imgDblClickHandler).on("keydown",function(e){var n=e.which;if((8===n||13===n||46===n)&&t.toggleSpan(!0),(e.ctrlKey||e.metaKey)&&!e.altKey){s=!0;var i=t.keys[String.fromCharCode(e.which).toUpperCase()];try{return t.execCmd(i.fn,i.param),!1}catch(t){}}else if(t.o.tabToIndent&&"Tab"===e.key)try{return e.shiftKey?t.execCmd("outdent",!0,null):t.execCmd("indent",!0,null),!1}catch(t){}}).on("compositionstart compositionupdate",function(){r=!0}).on("keyup compositionend",function(e){if("compositionend"===e.type)r=!1;else if(r)return;var n=e.which;if(!(n>=37)||!(n<=40)){if((8===n||13===n||46===n)&&t.toggleSpan(),(e.ctrlKey||e.metaKey)&&(89===n||90===n))t.semanticCode(!1,!0),t.$c.trigger("tbwchange");else if(s||16===n||17===n)void 0===e.which&&t.semanticCode(!1,!1,!0);else{var i=!t.isIE||"compositionend"===e.type;t.semanticCode(!1,i&&13===n),t.$c.trigger("tbwchange")}setTimeout(function(){s=!1},50)}}).on("input",function(e){var n=e.originalEvent;"object"==typeof n&&("insertReplacementText"===n.inputType||"insertText"===n.inputType&&null===n.data)&&t.$c.trigger("tbwchange")}).on("mouseup keydown keyup",function(e){(e.ctrlKey||e.metaKey)&&!e.altKey||setTimeout(function(){s=!1},50),clearTimeout(o),o=setTimeout(function(){t.updateButtonPaneStatus()},50)}).on("focus blur",function(e){"blur"===e.type&&t.clearButtonPaneStatus(),t.$c.trigger("tbw"+e.type),t.o.autogrowOnEnter&&!t.autogrowOnEnterDontClose&&("focus"===e.type?(t.autogrowOnEnterWasFocused=!0,t.autogrowEditorOnEnter()):t.o.autogrow||(t.$edBox.css({height:t.$edBox.css("min-height")}),t.$c.trigger("tbwresize")))}).on("keyup focus",function(){t.$ta.val().match(/<.*>/)||t.$ed.html().match(/<.*>/)||setTimeout(function(){var e=t.isIE?"<p>":"p";t.doc.execCommand("formatBlock",!1,e),t.syncCode()},0)}).on("cut drop",function(){setTimeout(function(){t.semanticCode(!1,!0),t.$c.trigger("tbwchange")},0)}).on("paste",function(n){if(t.o.removeformatPasted){n.preventDefault(),e.getSelection&&e.getSelection().deleteFromDocument&&e.getSelection().deleteFromDocument();try{var a=e.clipboardData.getData("Text");try{t.doc.selection.createRange().pasteHTML(a)}catch(e){t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(a))}t.$c.trigger("tbwchange",n)}catch(e){t.execCmd("insertText",(n.originalEvent||n).clipboardData.getData("text/plain"))}}i.each(t.pasteHandlers,function(t,e){e(n)}),setTimeout(function(){t.semanticCode(!1,!0),t.$c.trigger("tbwpaste",n),t.$c.trigger("tbwchange")},0)}),t.$ta.on("keyup",function(){t.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){t.$c.trigger("tbwchange")},0)}),i(t.doc.body).on("keydown."+t.eventNamespace,function(e){if(27===e.which&&i("."+n+"modal-box").length>=1)return t.closeModal(),!1})},autogrowEditorOnEnter:function(){var t=this;t.$ed.removeClass("autogrow-on-enter");var e=t.$ed[0].clientHeight;t.$edBox.height("auto");var n=t.$ed[0].scrollHeight;t.$ed.addClass("autogrow-on-enter"),e!==n&&(t.$edBox.height(e),setTimeout(function(){t.$edBox.css({height:n}),t.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var t=this,e=t.o.prefix,n=t.$btnPane=i("<div/>",{class:e+"button-pane"});i.each(t.o.btns,function(a,o){Array.isArray(o)||(o=[o]);var s=i("<div/>",{class:e+"button-group "+(o.indexOf("fullscreen")>=0?e+"right":"")});i.each(o,function(e,n){try{t.isSupportedBtn(n)&&s.append(t.buildBtn(n))}catch(t){}}),s.html().trim().length>0&&n.append(s)}),t.$box.prepend(n)},buildBtn:function(t){var e=this,n=e.o.prefix,a=e.btnsDef[t],o=a.dropdown,s=null==a.hasIcon||a.hasIcon,r=e.lang[t]||t,l=i("<button/>",{type:"button",class:n+t+"-button "+(a.class||"")+(s?"":" "+n+"textual-button"),html:e.hasSvg&&s?'<svg><use xlink:href="'+e.svgPath+"#"+n+(a.ico||t).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':e.hideButtonTexts?"":a.text||a.title||e.lang[t]||t,title:(a.title||a.text||r)+(a.key?" ("+(e.isMac?"Cmd":"Ctrl")+" + "+a.key+")":""),tabindex:-1,mousedown:function(){return(!o||i("."+t+"-"+n+"dropdown",e.$box).is(":hidden"))&&i("body",e.doc).trigger("mousedown"),(!(e.$btnPane.hasClass(n+"disable")||e.$box.hasClass(n+"disabled"))||!!i(this).hasClass(n+"active")||!!i(this).hasClass(n+"not-disable"))&&(e.execCmd(!!o&&"dropdown"||a.fn||t,a.param||t,a.forceCss),!1)}});if(o){l.addClass(n+"open-dropdown");var d=n+"dropdown",c={class:d+"-"+t+" "+d+" "+n+"fixed-top "+(a.dropdownClass||"")};c["data-"+d]=t;var u=i("<div/>",c);i.each(o,function(t,n){e.btnsDef[n]&&e.isSupportedBtn(n)&&u.append(e.buildSubBtn(n))}),e.$box.append(u.hide())}else a.key&&(e.keys[a.key]={fn:a.fn||t,param:a.param||t});return o||(e.tagToButton[(a.tag||t).toLowerCase()]=t),l},buildSubBtn:function(t){var e=this,n=e.o.prefix,a=e.btnsDef[t],o=null==a.hasIcon||a.hasIcon;return a.key&&(e.keys[a.key]={fn:a.fn||t,param:a.param||t}),e.tagToButton[(a.tag||t).toLowerCase()]=t,i("<button/>",{type:"button",class:n+t+"-dropdown-button "+(a.class||"")+(a.ico?" "+n+a.ico+"-button":""),html:e.hasSvg&&o?'<svg><use xlink:href="'+e.svgPath+"#"+n+(a.ico||t).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(a.text||a.title||e.lang[t]||t):a.text||a.title||e.lang[t]||t,title:a.key?"("+(e.isMac?"Cmd":"Ctrl")+" + "+a.key+")":null,style:a.style||null,mousedown:function(){return i("body",e.doc).trigger("mousedown"),e.execCmd(a.fn||t,a.param||t,a.forceCss),!1}})},isSupportedBtn:function(t){try{return this.btnsDef[t].isSupported()}catch(t){}return!0},buildOverlay:function(){return this.$overlay=i("<div/>",{class:this.o.prefix+"overlay"}).appendTo(this.$box),this.$overlay},showOverlay:function(){i(e).trigger("scroll"),this.$overlay.fadeIn(200),this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50),this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var t=this,n=t.o.fixedFullWidth,a=t.$box;t.o.fixedBtnPane&&(t.isFixed=!1,i(e).on("scroll."+t.eventNamespace+" resize."+t.eventNamespace,function(){if(a){t.syncCode();var o=i(e).scrollTop(),s=a.offset().top+1,r=t.$btnPane,l=r.outerHeight()-2;o-s>0&&o-s-t.height<0?(t.isFixed||(t.isFixed=!0,r.css({position:"fixed",top:0,left:n?0:"auto",zIndex:7}),t.$box.css({paddingTop:r.height()})),r.css({width:n?"100%":a.width()-1}),i("."+t.o.prefix+"fixed-top",a).css({position:n?"fixed":"absolute",top:n?l:l+(o-s),zIndex:15})):t.isFixed&&(t.isFixed=!1,r.removeAttr("style"),t.$box.css({paddingTop:0}),i("."+t.o.prefix+"fixed-top",a).css({position:"absolute",top:l}))}}))},setDisabled:function(t){var e=this.o.prefix;this.disabled=t,t?this.$ta.attr("disabled",!0):this.$ta.removeAttr("disabled"),this.$box.toggleClass(e+"disabled",t),this.$ed.attr("contenteditable",!t)},destroy:function(){var t=this.o.prefix;this.isTextarea?this.$box.after(this.$ta.css({height:""}).val(this.html()).removeClass(t+"textarea").show()):this.$box.after(this.$edBox.css({height:""}).removeClass(t+"editor").removeAttr("contenteditable").removeAttr("dir").html(this.html()).show()),this.$ed.off("dblclick","img"),this.destroyPlugins(),this.$box.remove(),this.$c.removeData("trumbowyg"),i("body").removeClass(t+"body-fullscreen"),this.$c.trigger("tbwclose"),i(e).off("scroll."+this.eventNamespace+" resize."+this.eventNamespace),i(this.doc.body).off("keydown."+this.eventNamespace)},empty:function(){this.doc.execCommand("insertHTML",!1,""),this.$ta.val(""),this.syncCode(!0)},toggle:function(){var t=this,e=t.o.prefix;t.o.autogrowOnEnter&&(t.autogrowOnEnterDontClose=!t.$box.hasClass(e+"editor-hidden")),t.semanticCode(!1,!0),t.$c.trigger("tbwchange"),setTimeout(function(){t.doc.activeElement.blur(),t.$box.toggleClass(e+"editor-hidden "+e+"editor-visible"),t.$btnPane.toggleClass(e+"disable"),i("."+e+"viewHTML-button",t.$btnPane).toggleClass(e+"active"),t.$box.hasClass(e+"editor-visible")?t.$ta.attr("tabindex",-1):t.$ta.removeAttr("tabindex"),t.o.autogrowOnEnter&&!t.autogrowOnEnterDontClose&&t.autogrowEditorOnEnter()},0)},toggleSpan:function(t){this.$ed.find("span").each(function(){!0===t?i(this).attr("data-tbw-flag",!0):i(this).attr("data-tbw-flag")?i(this).removeAttr("data-tbw-flag"):i(this).contents().unwrap()})},dropdown:function(t){var n=this,a=i("body",n.doc),o=n.o.prefix,s=i("[data-"+o+"dropdown="+t+"]",n.$box),r=i("."+o+t+"-button",n.$btnPane),l=s.is(":hidden");if(a.trigger("mousedown"),l){var d=r.offset().left;r.addClass(o+"active"),s.css({position:"absolute",top:r.offset().top-n.$btnPane.offset().top+r.outerHeight(),left:n.o.fixedFullWidth&&n.isFixed?d:d-n.$btnPane.offset().left}).show(),i(e).trigger("scroll"),a.on("mousedown."+n.eventNamespace,function(t){s.is(t.target)||(i("."+o+"dropdown",n.$box).hide(),i("."+o+"active",n.$btnPane).removeClass(o+"active"),a.off("mousedown."+n.eventNamespace))})}},html:function(t){return null!=t?(this.$ta.val(t),this.syncCode(!0),this.$c.trigger("tbwchange"),this):this.$ta.val()},syncTextarea:function(){this.$ta.val(this.$ed.text().trim().length>0||this.$ed.find(this.o.tagsToKeep.join(",")).length>0?this.$ed.html():"")},syncCode:function(t){if(!t&&this.$ed.is(":visible"))this.syncTextarea();else{var e=i("<div>").html(this.$ta.val()),n=i("<div>").append(e);i(this.o.tagsToRemove.join(","),n).remove(),this.$ed.html(n.contents().html())}if(this.o.autogrow&&(this.height=this.$edBox.height(),this.height!==this.$ta.css("height")&&(this.$ta.css({height:this.height}),this.$c.trigger("tbwresize"))),this.o.autogrowOnEnter){this.$edBox.height("auto");var a=this.autogrowOnEnterWasFocused?this.$edBox[0].scrollHeight:this.$edBox.css("min-height");a!==this.$ta.css("height")&&(this.$edBox.css({height:a}),this.$c.trigger("tbwresize"))}},semanticCode:function(t,e,n){this.saveRange(),this.syncCode(t);var a=!0;if(this.range&&this.range.collapsed&&(a=!1),this.o.semantic){if(this.semanticTag("b",this.o.semanticKeepAttributes),this.semanticTag("i",this.o.semanticKeepAttributes),this.semanticTag("s",this.o.semanticKeepAttributes),this.semanticTag("strike",this.o.semanticKeepAttributes),e){var o=this.o.inlineElementsSelector,s=":not("+o+")";this.$ed.contents().filter(function(){return 3===this.nodeType&&this.nodeValue.trim().length>0}).wrap("<span data-tbw/>");var r=function(t){if(0!==t.length){var e=t.nextUntil(s).addBack().wrapAll("<p/>").parent(),n=e.nextAll(o).first();e.next("br").remove(),r(n)}};r(this.$ed.children(o).first()),this.semanticTag("div",!0),i("[data-tbw]",this.$ed).contents().unwrap(),this.$ed.find("p:empty").remove()}!n&&a&&this.restoreRange(),this.syncTextarea()}},semanticTag:function(t,e,n){var a,o=this,s=t;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(t))a=this.o.semantic[t];else{if(!(!0===this.o.semantic&&this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(t)))return;a=this.DEFAULT_SEMANTIC_MAP[t]}n&&(t=a,a=s),i(t,this.$ed).each(function(){var t=!1,n=i(this);if(0===n.contents().length)return!1;o.range&&o.range.startContainer.parentNode===this&&(t=!0);var s=i("<"+a+"/>");s.insertBefore(n),e&&i.each(n.prop("attributes"),function(){s.attr(this.name,this.value)}),s.html(n.html()),n.remove(),!0===t&&(o.range.selectNodeContents(s.get(0)),o.range.collapse(!1))})},createLink:function(){for(var t,e,n,a=this,o=a.doc.getSelection(),s=o.getRangeAt(0),r=o.focusNode,l=new XMLSerializer().serializeToString(s.cloneContents())||s+"",d=a.o.linkTargets[0];0>["A","DIV"].indexOf(r.nodeName);)r=r.parentNode;if(r&&"A"===r.nodeName){var c=i(r);l=c.text(),t=c.attr("href"),a.o.minimalLinks||(e=c.attr("title"),n=c.attr("target")||d);var u=a.doc.createRange();u.selectNode(r),o.removeAllRanges(),o.addRange(u)}a.saveRange();var h={url:{label:a.lang.linkUrl||"URL",required:!0,value:t},text:{label:a.lang.text,value:l}};if(!a.o.minimalLinks){var g=a.o.linkTargets.reduce(function(t,e){return t[e]=a.lang[e],t},{});i.extend(h,{title:{label:a.lang.title,value:e},target:{label:a.lang.target,value:n,options:g}})}a.openModalInsert(a.lang.createLink,h,function(t){var e=a.prependUrlPrefix(t.url);if(!e.length)return!1;var n=i(['<a href="',e,'">',t.text||t.url,"</a>"].join(""));return t.title&&n.attr("title",t.title),(t.target||d)&&n.attr("target",t.target||d),a.range.deleteContents(),a.range.insertNode(n[0]),a.syncCode(),a.$c.trigger("tbwchange"),!0})},prependUrlPrefix:function(t){return this.urlPrefix?/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(t)?t:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?"mailto:"+t:this.urlPrefix+t:t},unlink:function(){var t=this.doc.getSelection(),e=t.focusNode;if(t.isCollapsed){for(;0>["A","DIV"].indexOf(e.nodeName);)e=e.parentNode;if(e&&"A"===e.nodeName){var n=this.doc.createRange();n.selectNode(e),t.removeAllRanges(),t.addRange(n)}}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var t=this;t.saveRange();var e={url:{label:"URL",required:!0},alt:{label:t.lang.description,value:t.getRangeText()}};t.o.imageWidthModalEdit&&(e.width={}),t.openModalInsert(t.lang.insertImage,e,function(e){t.execCmd("insertImage",e.url,!1,!0);var n=i('img[src="'+e.url+'"]:not([alt])',t.$box);return n.attr("alt",e.alt),t.o.imageWidthModalEdit&&n.attr({width:e.width}),t.syncCode(),t.$c.trigger("tbwchange"),!0})},fullscreen:function(){var t,n=this.o.prefix,a=n+"fullscreen",o=a+"-placeholder",s=this.$box.outerHeight();this.$box.toggleClass(a),(t=this.$box.hasClass(a))?this.$box.before(i("<div/>",{class:o}).css({height:s})):i("."+o).remove(),i("body").toggleClass(n+"body-fullscreen",t),i(e).trigger("scroll"),this.$c.trigger("tbw"+(t?"open":"close")+"fullscreen")},applyTagClasses:function(){for(let t of Object.keys(this.o.tagClasses))i(t,this.$ed).addClass(this.o.tagClasses[t]);this.syncCode()},execCmd:function(t,e,n,i){i=!!i||"","dropdown"!==t&&this.$ed.focus(),"strikethrough"===t&&this.o.semantic&&this.semanticTag("strike",this.o.semanticKeepAttributes,!0);try{this.doc.execCommand("styleWithCSS",!1,n||!1)}catch(t){}try{this[t+i](e)}catch(n){try{t(e)}catch(n){"insertHorizontalRule"===t?e=void 0:"formatBlock"===t&&this.isIE&&(e="<"+e+">"),this.doc.execCommand(t,!1,e),this.syncCode(),this.semanticCode(!1,!0)}"dropdown"!==t&&(this.updateButtonPaneStatus(),this.$c.trigger("tbwchange"))}try{this.applyTagClasses()}catch(t){}},openModal:function(t,n,s){var r,l=this,d=l.o.prefix;if(s=!1!==s,i("."+d+"modal-box",l.$box).length>0)return!1;l.o.autogrowOnEnter&&(l.autogrowOnEnterDontClose=!0),l.saveRange(),l.showOverlay(),l.$btnPane.addClass(d+"disable");var c=i("<div/>",{class:d+"modal "+d+"fixed-top"}).css({top:l.$box.offset().top+l.$btnPane.height(),zIndex:99999}).appendTo(i(l.doc.body)),u=d+"dark";0!==l.$c.parents("."+u).length&&c.addClass(u),l.$overlay.one("click",function(){return c.trigger(o),!1}),r=s?i("<form/>",{action:"",html:n}).on("submit",function(){return c.trigger(a),!1}).on("reset",function(){return c.trigger(o),!1}).on("submit reset",function(){l.o.autogrowOnEnter&&(l.autogrowOnEnterDontClose=!1)}):n;var h=i("<div/>",{class:d+"modal-box",html:r}).css({top:"-"+l.$btnPane.outerHeight(),opacity:0,paddingBottom:s?null:"5%"}).appendTo(c).animate({top:0,opacity:1},100);return t&&i("<span/>",{text:t,class:d+"modal-title"}).prependTo(h),s&&(i(":input:first",h).focus(),l.buildModalBtn("submit",h),l.buildModalBtn("reset",h),c.height(h.outerHeight()+10)),i(e).trigger("scroll"),l.$c.trigger("tbwmodalopen"),c},buildModalBtn:function(t,e){var n=this.o.prefix;return i("<button/>",{class:n+"modal-button "+n+"modal-"+t,type:t,text:this.lang[t]||t}).appendTo(i("form",e))},closeModal:function(){var t=this,e=t.o.prefix;if(t.$btnPane.hasClass(e+"disable")){t.$btnPane.removeClass(e+"disable"),t.$overlay.off();var n=i("."+e+"modal-box",i(t.doc.body));n.animate({top:"-"+n.height()},100,function(){n.parent().remove(),t.hideOverlay(),t.$c.trigger("tbwmodalclose")}),t.restoreRange()}},openModalInsert:function(t,e,n){var s=this,r=s.o.prefix,l=s.lang,d="",c=r+"form-"+Date.now()+"-";return i.each(e,function(t,e){var n=e.label||t,a=e.name||t,o=e.attributes||{},s=c+t,u=Object.keys(o).map(function(t){return t+'="'+o[t]+'"'}).join(" ");if("function"==typeof e.type){e.name||(e.name=a),d+=e.type(e,s,r,l);return}d+='<div class="'+r+'input-row">',d+='<div class="'+r+'input-infos"><label for="'+s+'"><span>'+(l[n]?l[n]:n)+"</span></label></div>",d+='<div class="'+r+'input-html">',i.isPlainObject(e.options)?(d+='<select id="'+s+'" name="'+a+'">',d+=Object.keys(e.options).map(t=>'<option value="'+t+'" '+(t===e.value?"selected":"")+">"+e.options[t]+"</option>").join(""),d+="</select>"):(d+='<input id="'+s+'" type="'+(e.type||"text")+'" name="'+a+'" '+u,d+=("checkbox"===e.type&&e.value?' checked="checked"':"")+' value="'+(e.value||"").replace(/"/g,"&quot;")+'">'),d+="</div></div>"}),s.openModal(t,d).on(a,function(){var t=i("form",i(this)),o=!0,r={};i.each(e,function(e,n){var a=n.name||e,l=i(':input[name="'+a+'"]',t);switch(l[0].type.toLowerCase()){case"checkbox":r[a]=l.is(":checked");break;case"radio":r[a]=l.filter(":checked").val();break;default:r[a]=l.val().trim()}n.required&&""===r[a]?(o=!1,s.addErrorOnModalField(l,s.lang.required)):n.pattern&&!n.pattern.test(r[a])&&(o=!1,s.addErrorOnModalField(l,n.patternError))}),o&&(s.restoreRange(),n(r,e)&&(s.syncCode(),s.$c.trigger("tbwchange"),s.closeModal(),i(this).off(a)))}).one(o,function(){i(this).off(a),s.closeModal()})},addErrorOnModalField:function(t,e){var n=this.o.prefix,a=n+"msg-error",o=t.closest("."+n+"input-row");t.one("change keyup",function(){o.removeClass(n+"input-error")}),o.find("."+a).remove(),o.addClass(n+"input-error").find("."+n+"input-infos label").append(i("<span/>",{class:a,text:e}))},getDefaultImgDblClickHandler:function(){var t=this;return function(){var e=i(this),n=e.attr("src"),a="(Base64)";0===n.indexOf("data:image")&&(n=a);var o={url:{label:"URL",value:n,required:!0},alt:{label:t.lang.description,value:e.attr("alt")}};return t.o.imageWidthModalEdit&&(o.width={value:e.attr("width")?e.attr("width"):""}),t.openModalInsert(t.lang.insertImage,o,function(n){return n.url!==a&&e.attr({src:n.url}),e.attr({alt:n.alt}),t.o.imageWidthModalEdit&&(parseInt(n.width)>0?e.attr({width:n.width}):e.removeAttr("width")),!0}),!1}},saveRange:function(){var t=this.doc.getSelection();if(this.range=null,t&&t.rangeCount){var e,n=this.range=t.getRangeAt(0),i=this.doc.createRange();i.selectNodeContents(this.$ed[0]),i.setEnd(n.startContainer,n.startOffset),e=(i+"").length,this.metaRange={start:e,end:e+(n+"").length}}},restoreRange:function(){var t,e=this.metaRange,n=this.range,i=this.doc.getSelection();if(n){if(e&&e.start!==e.end){var a,o=0,s=[this.$ed[0]],r=!1,l=!1;for(t=this.doc.createRange();!l&&(a=s.pop());)if(3===a.nodeType){var d=o+a.length;!r&&e.start>=o&&e.start<=d&&(t.setStart(a,e.start-o),r=!0),r&&e.end>=o&&e.end<=d&&(t.setEnd(a,e.end-o),l=!0),o=d}else for(var c=a.childNodes,u=c.length;u>0;)u-=1,s.push(c[u])}try{i.removeAllRanges()}catch(t){}i.addRange(t||n)}},getRangeText:function(){return this.range+""},clearButtonPaneStatus:function(){var t=this.o.prefix,e=t+"original-icon";i("."+t+"active-button",this.$btnPane).removeClass(t+"active-button "+t+"active"),i("."+e,this.$btnPane).each(function(){i(this).find("svg use").attr("xlink:href",i(this).data(e))})},updateButtonPaneStatus:function(){var t=this,e=t.o.prefix,n=e+"active-button "+e+"active",a=e+"original-icon",o=t.getTagsRecursive(t.doc.getSelection().anchorNode);t.clearButtonPaneStatus(),i.each(o,function(o,s){var r=t.tagToButton[s.toLowerCase()],l=i("."+e+r+"-button",t.$btnPane);if(l.length>0)l.addClass(n);else try{var d=(l=i("."+e+"dropdown ."+e+r+"-dropdown-button",t.$box)).find("svg use"),c=l.parent().data(e+"dropdown"),u=i("."+e+c+"-button",t.$box),h=u.find("svg use");u.addClass(n),t.o.changeActiveDropdownIcon&&d.length>0&&(u.addClass(a).data(a,h.attr("xlink:href")),h.attr("xlink:href",d.attr("xlink:href")))}catch(t){}})},getTagsRecursive:function(t,e){var n=this;if(e=e||(t&&t.tagName?[t.tagName]:[]),!t||!t.parentNode)return e;t.nodeType!==Node.ELEMENT_NODE&&(t=t.parentNode);var a=t.tagName;return"DIV"===a?e:("P"===a&&""!==t.style.textAlign&&e.push(t.style.textAlign),i.each(n.tagHandlers,function(i,a){e=e.concat(a(t,n))}),e.push(a),n.getTagsRecursive(t.parentNode,e).filter(function(t){return null!=t}))},initPlugins:function(){var t=this;t.loadedPlugins=[],i.each(i.trumbowyg.plugins,function(e,n){(!n.shouldInit||n.shouldInit(t))&&(n.init(t),n.tagHandler&&t.tagHandlers.push(n.tagHandler),t.loadedPlugins.push(n))})},destroyPlugins:function(){var t=this;i.each(this.loadedPlugins,function(e,n){n.destroy&&n.destroy(t)})}}}(navigator,window,document,jQuery);
//# sourceMappingURL=trumbowyg.map