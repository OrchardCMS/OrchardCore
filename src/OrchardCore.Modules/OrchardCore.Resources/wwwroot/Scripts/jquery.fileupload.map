{"version":3,"sources":["<anon>"],"sourcesContent":["/*\n * jQuery File Upload Plugin\n * https://github.com/blueimp/jQuery-File-Upload\n *\n * Copyright 2010, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n */\n\n/* global define, require */\n/* eslint-disable new-cap */\n\n(function (factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // Register as an anonymous AMD module:\n    define(['jquery', 'jquery-ui/ui/widget'], factory);\n  } else if (typeof exports === 'object') {\n    // Node/CommonJS:\n    factory(require('jquery'), require('./vendor/jquery.ui.widget'));\n  } else {\n    // Browser globals:\n    factory(window.jQuery);\n  }\n})(function ($) {\n  'use strict';\n\n  // Detect file input support, based on\n  // https://viljamis.com/2012/file-upload-support-on-mobile/\n  $.support.fileInput = !(\n    new RegExp(\n      // Handle devices which give false positives for the feature detection:\n      '(Android (1\\\\.[0156]|2\\\\.[01]))' +\n        '|(Windows Phone (OS 7|8\\\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)' +\n        '|(w(eb)?OSBrowser)|(webOS)' +\n        '|(Kindle/(1\\\\.0|2\\\\.[05]|3\\\\.0))'\n    ).test(window.navigator.userAgent) ||\n    // Feature detection for all other devices:\n    $('<input type=\"file\"/>').prop('disabled')\n  );\n\n  // The FileReader API is not actually used, but works as feature detection,\n  // as some Safari versions (5?) support XHR file uploads via the FormData API,\n  // but not non-multipart XHR file uploads.\n  // window.XMLHttpRequestUpload is not available on IE10, so we check for\n  // window.ProgressEvent instead to detect XHR2 file upload capability:\n  $.support.xhrFileUpload = !!(window.ProgressEvent && window.FileReader);\n  $.support.xhrFormDataFileUpload = !!window.FormData;\n\n  // Detect support for Blob slicing (required for chunked uploads):\n  $.support.blobSlice =\n    window.Blob &&\n    (Blob.prototype.slice ||\n      Blob.prototype.webkitSlice ||\n      Blob.prototype.mozSlice);\n\n  /**\n   * Helper function to create drag handlers for dragover/dragenter/dragleave\n   *\n   * @param {string} type Event type\n   * @returns {Function} Drag handler\n   */\n  function getDragHandler(type) {\n    var isDragOver = type === 'dragover';\n    return function (e) {\n      e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;\n      var dataTransfer = e.dataTransfer;\n      if (\n        dataTransfer &&\n        $.inArray('Files', dataTransfer.types) !== -1 &&\n        this._trigger(type, $.Event(type, { delegatedEvent: e })) !== false\n      ) {\n        e.preventDefault();\n        if (isDragOver) {\n          dataTransfer.dropEffect = 'copy';\n        }\n      }\n    };\n  }\n\n  // The fileupload widget listens for change events on file input fields defined\n  // via fileInput setting and paste or drop events of the given dropZone.\n  // In addition to the default jQuery Widget methods, the fileupload widget\n  // exposes the \"add\" and \"send\" methods, to add or directly send files using\n  // the fileupload API.\n  // By default, files added via file input selection, paste, drag & drop or\n  // \"add\" method are uploaded immediately, but it is possible to override\n  // the \"add\" callback option to queue file uploads.\n  $.widget('blueimp.fileupload', {\n    options: {\n      // The drop target element(s), by the default the complete document.\n      // Set to null to disable drag & drop support:\n      dropZone: $(document),\n      // The paste target element(s), by the default undefined.\n      // Set to a DOM node or jQuery object to enable file pasting:\n      pasteZone: undefined,\n      // The file input field(s), that are listened to for change events.\n      // If undefined, it is set to the file input fields inside\n      // of the widget element on plugin initialization.\n      // Set to null to disable the change listener.\n      fileInput: undefined,\n      // By default, the file input field is replaced with a clone after\n      // each input field change event. This is required for iframe transport\n      // queues and allows change events to be fired for the same file\n      // selection, but can be disabled by setting the following option to false:\n      replaceFileInput: true,\n      // The parameter name for the file form data (the request argument name).\n      // If undefined or empty, the name property of the file input field is\n      // used, or \"files[]\" if the file input name property is also empty,\n      // can be a string or an array of strings:\n      paramName: undefined,\n      // By default, each file of a selection is uploaded using an individual\n      // request for XHR type uploads. Set to false to upload file\n      // selections in one request each:\n      singleFileUploads: true,\n      // To limit the number of files uploaded with one XHR request,\n      // set the following option to an integer greater than 0:\n      limitMultiFileUploads: undefined,\n      // The following option limits the number of files uploaded with one\n      // XHR request to keep the request size under or equal to the defined\n      // limit in bytes:\n      limitMultiFileUploadSize: undefined,\n      // Multipart file uploads add a number of bytes to each uploaded file,\n      // therefore the following option adds an overhead for each file used\n      // in the limitMultiFileUploadSize configuration:\n      limitMultiFileUploadSizeOverhead: 512,\n      // Set the following option to true to issue all file upload requests\n      // in a sequential order:\n      sequentialUploads: false,\n      // To limit the number of concurrent uploads,\n      // set the following option to an integer greater than 0:\n      limitConcurrentUploads: undefined,\n      // Set the following option to true to force iframe transport uploads:\n      forceIframeTransport: false,\n      // Set the following option to the location of a redirect url on the\n      // origin server, for cross-domain iframe transport uploads:\n      redirect: undefined,\n      // The parameter name for the redirect url, sent as part of the form\n      // data and set to 'redirect' if this option is empty:\n      redirectParamName: undefined,\n      // Set the following option to the location of a postMessage window,\n      // to enable postMessage transport uploads:\n      postMessage: undefined,\n      // By default, XHR file uploads are sent as multipart/form-data.\n      // The iframe transport is always using multipart/form-data.\n      // Set to false to enable non-multipart XHR uploads:\n      multipart: true,\n      // To upload large files in smaller chunks, set the following option\n      // to a preferred maximum chunk size. If set to 0, null or undefined,\n      // or the browser does not support the required Blob API, files will\n      // be uploaded as a whole.\n      maxChunkSize: undefined,\n      // When a non-multipart upload or a chunked multipart upload has been\n      // aborted, this option can be used to resume the upload by setting\n      // it to the size of the already uploaded bytes. This option is most\n      // useful when modifying the options object inside of the \"add\" or\n      // \"send\" callbacks, as the options are cloned for each file upload.\n      uploadedBytes: undefined,\n      // By default, failed (abort or error) file uploads are removed from the\n      // global progress calculation. Set the following option to false to\n      // prevent recalculating the global progress data:\n      recalculateProgress: true,\n      // Interval in milliseconds to calculate and trigger progress events:\n      progressInterval: 100,\n      // Interval in milliseconds to calculate progress bitrate:\n      bitrateInterval: 500,\n      // By default, uploads are started automatically when adding files:\n      autoUpload: true,\n      // By default, duplicate file names are expected to be handled on\n      // the server-side. If this is not possible (e.g. when uploading\n      // files directly to Amazon S3), the following option can be set to\n      // an empty object or an object mapping existing filenames, e.g.:\n      // { \"image.jpg\": true, \"image (1).jpg\": true }\n      // If it is set, all files will be uploaded with unique filenames,\n      // adding increasing number suffixes if necessary, e.g.:\n      // \"image (2).jpg\"\n      uniqueFilenames: undefined,\n\n      // Error and info messages:\n      messages: {\n        uploadedBytes: 'Uploaded bytes exceed file size'\n      },\n\n      // Translation function, gets the message key to be translated\n      // and an object with context specific data as arguments:\n      i18n: function (message, context) {\n        // eslint-disable-next-line no-param-reassign\n        message = this.messages[message] || message.toString();\n        if (context) {\n          $.each(context, function (key, value) {\n            // eslint-disable-next-line no-param-reassign\n            message = message.replace('{' + key + '}', value);\n          });\n        }\n        return message;\n      },\n\n      // Additional form data to be sent along with the file uploads can be set\n      // using this option, which accepts an array of objects with name and\n      // value properties, a function returning such an array, a FormData\n      // object (for XHR file uploads), or a simple object.\n      // The form of the first fileInput is given as parameter to the function:\n      formData: function (form) {\n        return form.serializeArray();\n      },\n\n      // The add callback is invoked as soon as files are added to the fileupload\n      // widget (via file input selection, drag & drop, paste or add API call).\n      // If the singleFileUploads option is enabled, this callback will be\n      // called once for each file in the selection for XHR file uploads, else\n      // once for each file selection.\n      //\n      // The upload starts when the submit method is invoked on the data parameter.\n      // The data object contains a files property holding the added files\n      // and allows you to override plugin options as well as define ajax settings.\n      //\n      // Listeners for this callback can also be bound the following way:\n      // .on('fileuploadadd', func);\n      //\n      // data.submit() returns a Promise object and allows to attach additional\n      // handlers using jQuery's Deferred callbacks:\n      // data.submit().done(func).fail(func).always(func);\n      add: function (e, data) {\n        if (e.isDefaultPrevented()) {\n          return false;\n        }\n        if (\n          data.autoUpload ||\n          (data.autoUpload !== false &&\n            $(this).fileupload('option', 'autoUpload'))\n        ) {\n          data.process().done(function () {\n            data.submit();\n          });\n        }\n      },\n\n      // Other callbacks:\n\n      // Callback for the submit event of each file upload:\n      // submit: function (e, data) {}, // .on('fileuploadsubmit', func);\n\n      // Callback for the start of each file upload request:\n      // send: function (e, data) {}, // .on('fileuploadsend', func);\n\n      // Callback for successful uploads:\n      // done: function (e, data) {}, // .on('fileuploaddone', func);\n\n      // Callback for failed (abort or error) uploads:\n      // fail: function (e, data) {}, // .on('fileuploadfail', func);\n\n      // Callback for completed (success, abort or error) requests:\n      // always: function (e, data) {}, // .on('fileuploadalways', func);\n\n      // Callback for upload progress events:\n      // progress: function (e, data) {}, // .on('fileuploadprogress', func);\n\n      // Callback for global upload progress events:\n      // progressall: function (e, data) {}, // .on('fileuploadprogressall', func);\n\n      // Callback for uploads start, equivalent to the global ajaxStart event:\n      // start: function (e) {}, // .on('fileuploadstart', func);\n\n      // Callback for uploads stop, equivalent to the global ajaxStop event:\n      // stop: function (e) {}, // .on('fileuploadstop', func);\n\n      // Callback for change events of the fileInput(s):\n      // change: function (e, data) {}, // .on('fileuploadchange', func);\n\n      // Callback for paste events to the pasteZone(s):\n      // paste: function (e, data) {}, // .on('fileuploadpaste', func);\n\n      // Callback for drop events of the dropZone(s):\n      // drop: function (e, data) {}, // .on('fileuploaddrop', func);\n\n      // Callback for dragover events of the dropZone(s):\n      // dragover: function (e) {}, // .on('fileuploaddragover', func);\n\n      // Callback before the start of each chunk upload request (before form data initialization):\n      // chunkbeforesend: function (e, data) {}, // .on('fileuploadchunkbeforesend', func);\n\n      // Callback for the start of each chunk upload request:\n      // chunksend: function (e, data) {}, // .on('fileuploadchunksend', func);\n\n      // Callback for successful chunk uploads:\n      // chunkdone: function (e, data) {}, // .on('fileuploadchunkdone', func);\n\n      // Callback for failed (abort or error) chunk uploads:\n      // chunkfail: function (e, data) {}, // .on('fileuploadchunkfail', func);\n\n      // Callback for completed (success, abort or error) chunk upload requests:\n      // chunkalways: function (e, data) {}, // .on('fileuploadchunkalways', func);\n\n      // The plugin options are used as settings object for the ajax calls.\n      // The following are jQuery ajax settings required for the file uploads:\n      processData: false,\n      contentType: false,\n      cache: false,\n      timeout: 0\n    },\n\n    // jQuery versions before 1.8 require promise.pipe if the return value is\n    // used, as promise.then in older versions has a different behavior, see:\n    // https://blog.jquery.com/2012/08/09/jquery-1-8-released/\n    // https://bugs.jquery.com/ticket/11010\n    // https://github.com/blueimp/jQuery-File-Upload/pull/3435\n    _promisePipe: (function () {\n      var parts = $.fn.jquery.split('.');\n      return Number(parts[0]) > 1 || Number(parts[1]) > 7 ? 'then' : 'pipe';\n    })(),\n\n    // A list of options that require reinitializing event listeners and/or\n    // special initialization code:\n    _specialOptions: [\n      'fileInput',\n      'dropZone',\n      'pasteZone',\n      'multipart',\n      'forceIframeTransport'\n    ],\n\n    _blobSlice:\n      $.support.blobSlice &&\n      function () {\n        var slice = this.slice || this.webkitSlice || this.mozSlice;\n        return slice.apply(this, arguments);\n      },\n\n    _BitrateTimer: function () {\n      this.timestamp = Date.now ? Date.now() : new Date().getTime();\n      this.loaded = 0;\n      this.bitrate = 0;\n      this.getBitrate = function (now, loaded, interval) {\n        var timeDiff = now - this.timestamp;\n        if (!this.bitrate || !interval || timeDiff > interval) {\n          this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;\n          this.loaded = loaded;\n          this.timestamp = now;\n        }\n        return this.bitrate;\n      };\n    },\n\n    _isXHRUpload: function (options) {\n      return (\n        !options.forceIframeTransport &&\n        ((!options.multipart && $.support.xhrFileUpload) ||\n          $.support.xhrFormDataFileUpload)\n      );\n    },\n\n    _getFormData: function (options) {\n      var formData;\n      if ($.type(options.formData) === 'function') {\n        return options.formData(options.form);\n      }\n      if ($.isArray(options.formData)) {\n        return options.formData;\n      }\n      if ($.type(options.formData) === 'object') {\n        formData = [];\n        $.each(options.formData, function (name, value) {\n          formData.push({ name: name, value: value });\n        });\n        return formData;\n      }\n      return [];\n    },\n\n    _getTotal: function (files) {\n      var total = 0;\n      $.each(files, function (index, file) {\n        total += file.size || 1;\n      });\n      return total;\n    },\n\n    _initProgressObject: function (obj) {\n      var progress = {\n        loaded: 0,\n        total: 0,\n        bitrate: 0\n      };\n      if (obj._progress) {\n        $.extend(obj._progress, progress);\n      } else {\n        obj._progress = progress;\n      }\n    },\n\n    _initResponseObject: function (obj) {\n      var prop;\n      if (obj._response) {\n        for (prop in obj._response) {\n          if (Object.prototype.hasOwnProperty.call(obj._response, prop)) {\n            delete obj._response[prop];\n          }\n        }\n      } else {\n        obj._response = {};\n      }\n    },\n\n    _onProgress: function (e, data) {\n      if (e.lengthComputable) {\n        var now = Date.now ? Date.now() : new Date().getTime(),\n          loaded;\n        if (\n          data._time &&\n          data.progressInterval &&\n          now - data._time < data.progressInterval &&\n          e.loaded !== e.total\n        ) {\n          return;\n        }\n        data._time = now;\n        loaded =\n          Math.floor(\n            (e.loaded / e.total) * (data.chunkSize || data._progress.total)\n          ) + (data.uploadedBytes || 0);\n        // Add the difference from the previously loaded state\n        // to the global loaded counter:\n        this._progress.loaded += loaded - data._progress.loaded;\n        this._progress.bitrate = this._bitrateTimer.getBitrate(\n          now,\n          this._progress.loaded,\n          data.bitrateInterval\n        );\n        data._progress.loaded = data.loaded = loaded;\n        data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(\n          now,\n          loaded,\n          data.bitrateInterval\n        );\n        // Trigger a custom progress event with a total data property set\n        // to the file size(s) of the current upload and a loaded data\n        // property calculated accordingly:\n        this._trigger(\n          'progress',\n          $.Event('progress', { delegatedEvent: e }),\n          data\n        );\n        // Trigger a global progress event for all current file uploads,\n        // including ajax calls queued for sequential file uploads:\n        this._trigger(\n          'progressall',\n          $.Event('progressall', { delegatedEvent: e }),\n          this._progress\n        );\n      }\n    },\n\n    _initProgressListener: function (options) {\n      var that = this,\n        xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();\n      // Access to the native XHR object is required to add event listeners\n      // for the upload progress event:\n      if (xhr.upload) {\n        $(xhr.upload).on('progress', function (e) {\n          var oe = e.originalEvent;\n          // Make sure the progress event properties get copied over:\n          e.lengthComputable = oe.lengthComputable;\n          e.loaded = oe.loaded;\n          e.total = oe.total;\n          that._onProgress(e, options);\n        });\n        options.xhr = function () {\n          return xhr;\n        };\n      }\n    },\n\n    _deinitProgressListener: function (options) {\n      var xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();\n      if (xhr.upload) {\n        $(xhr.upload).off('progress');\n      }\n    },\n\n    _isInstanceOf: function (type, obj) {\n      // Cross-frame instanceof check\n      return Object.prototype.toString.call(obj) === '[object ' + type + ']';\n    },\n\n    _getUniqueFilename: function (name, map) {\n      // eslint-disable-next-line no-param-reassign\n      name = String(name);\n      if (map[name]) {\n        // eslint-disable-next-line no-param-reassign\n        name = name.replace(\n          /(?: \\(([\\d]+)\\))?(\\.[^.]+)?$/,\n          function (_, p1, p2) {\n            var index = p1 ? Number(p1) + 1 : 1;\n            var ext = p2 || '';\n            return ' (' + index + ')' + ext;\n          }\n        );\n        return this._getUniqueFilename(name, map);\n      }\n      map[name] = true;\n      return name;\n    },\n\n    _initXHRData: function (options) {\n      var that = this,\n        formData,\n        file = options.files[0],\n        // Ignore non-multipart setting if not supported:\n        multipart = options.multipart || !$.support.xhrFileUpload,\n        paramName =\n          $.type(options.paramName) === 'array'\n            ? options.paramName[0]\n            : options.paramName;\n      options.headers = $.extend({}, options.headers);\n      if (options.contentRange) {\n        options.headers['Content-Range'] = options.contentRange;\n      }\n      if (!multipart || options.blob || !this._isInstanceOf('File', file)) {\n        options.headers['Content-Disposition'] =\n          'attachment; filename=\"' +\n          encodeURI(file.uploadName || file.name) +\n          '\"';\n      }\n      if (!multipart) {\n        options.contentType = file.type || 'application/octet-stream';\n        options.data = options.blob || file;\n      } else if ($.support.xhrFormDataFileUpload) {\n        if (options.postMessage) {\n          // window.postMessage does not allow sending FormData\n          // objects, so we just add the File/Blob objects to\n          // the formData array and let the postMessage window\n          // create the FormData object out of this array:\n          formData = this._getFormData(options);\n          if (options.blob) {\n            formData.push({\n              name: paramName,\n              value: options.blob\n            });\n          } else {\n            $.each(options.files, function (index, file) {\n              formData.push({\n                name:\n                  ($.type(options.paramName) === 'array' &&\n                    options.paramName[index]) ||\n                  paramName,\n                value: file\n              });\n            });\n          }\n        } else {\n          if (that._isInstanceOf('FormData', options.formData)) {\n            formData = options.formData;\n          } else {\n            formData = new FormData();\n            $.each(this._getFormData(options), function (index, field) {\n              formData.append(field.name, field.value);\n            });\n          }\n          if (options.blob) {\n            formData.append(\n              paramName,\n              options.blob,\n              file.uploadName || file.name\n            );\n          } else {\n            $.each(options.files, function (index, file) {\n              // This check allows the tests to run with\n              // dummy objects:\n              if (\n                that._isInstanceOf('File', file) ||\n                that._isInstanceOf('Blob', file)\n              ) {\n                var fileName = file.uploadName || file.name;\n                if (options.uniqueFilenames) {\n                  fileName = that._getUniqueFilename(\n                    fileName,\n                    options.uniqueFilenames\n                  );\n                }\n                formData.append(\n                  ($.type(options.paramName) === 'array' &&\n                    options.paramName[index]) ||\n                    paramName,\n                  file,\n                  fileName\n                );\n              }\n            });\n          }\n        }\n        options.data = formData;\n      }\n      // Blob reference is not needed anymore, free memory:\n      options.blob = null;\n    },\n\n    _initIframeSettings: function (options) {\n      var targetHost = $('<a></a>').prop('href', options.url).prop('host');\n      // Setting the dataType to iframe enables the iframe transport:\n      options.dataType = 'iframe ' + (options.dataType || '');\n      // The iframe transport accepts a serialized array as form data:\n      options.formData = this._getFormData(options);\n      // Add redirect url to form data on cross-domain uploads:\n      if (options.redirect && targetHost && targetHost !== location.host) {\n        options.formData.push({\n          name: options.redirectParamName || 'redirect',\n          value: options.redirect\n        });\n      }\n    },\n\n    _initDataSettings: function (options) {\n      if (this._isXHRUpload(options)) {\n        if (!this._chunkedUpload(options, true)) {\n          if (!options.data) {\n            this._initXHRData(options);\n          }\n          this._initProgressListener(options);\n        }\n        if (options.postMessage) {\n          // Setting the dataType to postmessage enables the\n          // postMessage transport:\n          options.dataType = 'postmessage ' + (options.dataType || '');\n        }\n      } else {\n        this._initIframeSettings(options);\n      }\n    },\n\n    _getParamName: function (options) {\n      var fileInput = $(options.fileInput),\n        paramName = options.paramName;\n      if (!paramName) {\n        paramName = [];\n        fileInput.each(function () {\n          var input = $(this),\n            name = input.prop('name') || 'files[]',\n            i = (input.prop('files') || [1]).length;\n          while (i) {\n            paramName.push(name);\n            i -= 1;\n          }\n        });\n        if (!paramName.length) {\n          paramName = [fileInput.prop('name') || 'files[]'];\n        }\n      } else if (!$.isArray(paramName)) {\n        paramName = [paramName];\n      }\n      return paramName;\n    },\n\n    _initFormSettings: function (options) {\n      // Retrieve missing options from the input field and the\n      // associated form, if available:\n      if (!options.form || !options.form.length) {\n        options.form = $(options.fileInput.prop('form'));\n        // If the given file input doesn't have an associated form,\n        // use the default widget file input's form:\n        if (!options.form.length) {\n          options.form = $(this.options.fileInput.prop('form'));\n        }\n      }\n      options.paramName = this._getParamName(options);\n      if (!options.url) {\n        options.url = options.form.prop('action') || location.href;\n      }\n      // The HTTP request method must be \"POST\" or \"PUT\":\n      options.type = (\n        options.type ||\n        ($.type(options.form.prop('method')) === 'string' &&\n          options.form.prop('method')) ||\n        ''\n      ).toUpperCase();\n      if (\n        options.type !== 'POST' &&\n        options.type !== 'PUT' &&\n        options.type !== 'PATCH'\n      ) {\n        options.type = 'POST';\n      }\n      if (!options.formAcceptCharset) {\n        options.formAcceptCharset = options.form.attr('accept-charset');\n      }\n    },\n\n    _getAJAXSettings: function (data) {\n      var options = $.extend({}, this.options, data);\n      this._initFormSettings(options);\n      this._initDataSettings(options);\n      return options;\n    },\n\n    // jQuery 1.6 doesn't provide .state(),\n    // while jQuery 1.8+ removed .isRejected() and .isResolved():\n    _getDeferredState: function (deferred) {\n      if (deferred.state) {\n        return deferred.state();\n      }\n      if (deferred.isResolved()) {\n        return 'resolved';\n      }\n      if (deferred.isRejected()) {\n        return 'rejected';\n      }\n      return 'pending';\n    },\n\n    // Maps jqXHR callbacks to the equivalent\n    // methods of the given Promise object:\n    _enhancePromise: function (promise) {\n      promise.success = promise.done;\n      promise.error = promise.fail;\n      promise.complete = promise.always;\n      return promise;\n    },\n\n    // Creates and returns a Promise object enhanced with\n    // the jqXHR methods abort, success, error and complete:\n    _getXHRPromise: function (resolveOrReject, context, args) {\n      var dfd = $.Deferred(),\n        promise = dfd.promise();\n      // eslint-disable-next-line no-param-reassign\n      context = context || this.options.context || promise;\n      if (resolveOrReject === true) {\n        dfd.resolveWith(context, args);\n      } else if (resolveOrReject === false) {\n        dfd.rejectWith(context, args);\n      }\n      promise.abort = dfd.promise;\n      return this._enhancePromise(promise);\n    },\n\n    // Adds convenience methods to the data callback argument:\n    _addConvenienceMethods: function (e, data) {\n      var that = this,\n        getPromise = function (args) {\n          return $.Deferred().resolveWith(that, args).promise();\n        };\n      data.process = function (resolveFunc, rejectFunc) {\n        if (resolveFunc || rejectFunc) {\n          data._processQueue = this._processQueue = (this._processQueue ||\n            getPromise([this]))\n            [that._promisePipe](function () {\n              if (data.errorThrown) {\n                return $.Deferred().rejectWith(that, [data]).promise();\n              }\n              return getPromise(arguments);\n            })\n            [that._promisePipe](resolveFunc, rejectFunc);\n        }\n        return this._processQueue || getPromise([this]);\n      };\n      data.submit = function () {\n        if (this.state() !== 'pending') {\n          data.jqXHR = this.jqXHR =\n            that._trigger(\n              'submit',\n              $.Event('submit', { delegatedEvent: e }),\n              this\n            ) !== false && that._onSend(e, this);\n        }\n        return this.jqXHR || that._getXHRPromise();\n      };\n      data.abort = function () {\n        if (this.jqXHR) {\n          return this.jqXHR.abort();\n        }\n        this.errorThrown = 'abort';\n        that._trigger('fail', null, this);\n        return that._getXHRPromise(false);\n      };\n      data.state = function () {\n        if (this.jqXHR) {\n          return that._getDeferredState(this.jqXHR);\n        }\n        if (this._processQueue) {\n          return that._getDeferredState(this._processQueue);\n        }\n      };\n      data.processing = function () {\n        return (\n          !this.jqXHR &&\n          this._processQueue &&\n          that._getDeferredState(this._processQueue) === 'pending'\n        );\n      };\n      data.progress = function () {\n        return this._progress;\n      };\n      data.response = function () {\n        return this._response;\n      };\n    },\n\n    // Parses the Range header from the server response\n    // and returns the uploaded bytes:\n    _getUploadedBytes: function (jqXHR) {\n      var range = jqXHR.getResponseHeader('Range'),\n        parts = range && range.split('-'),\n        upperBytesPos = parts && parts.length > 1 && parseInt(parts[1], 10);\n      return upperBytesPos && upperBytesPos + 1;\n    },\n\n    // Uploads a file in multiple, sequential requests\n    // by splitting the file up in multiple blob chunks.\n    // If the second parameter is true, only tests if the file\n    // should be uploaded in chunks, but does not invoke any\n    // upload requests:\n    _chunkedUpload: function (options, testOnly) {\n      options.uploadedBytes = options.uploadedBytes || 0;\n      var that = this,\n        file = options.files[0],\n        fs = file.size,\n        ub = options.uploadedBytes,\n        mcs = options.maxChunkSize || fs,\n        slice = this._blobSlice,\n        dfd = $.Deferred(),\n        promise = dfd.promise(),\n        jqXHR,\n        upload;\n      if (\n        !(\n          this._isXHRUpload(options) &&\n          slice &&\n          (ub || ($.type(mcs) === 'function' ? mcs(options) : mcs) < fs)\n        ) ||\n        options.data\n      ) {\n        return false;\n      }\n      if (testOnly) {\n        return true;\n      }\n      if (ub >= fs) {\n        file.error = options.i18n('uploadedBytes');\n        return this._getXHRPromise(false, options.context, [\n          null,\n          'error',\n          file.error\n        ]);\n      }\n      // The chunk upload method:\n      upload = function () {\n        // Clone the options object for each chunk upload:\n        var o = $.extend({}, options),\n          currentLoaded = o._progress.loaded;\n        o.blob = slice.call(\n          file,\n          ub,\n          ub + ($.type(mcs) === 'function' ? mcs(o) : mcs),\n          file.type\n        );\n        // Store the current chunk size, as the blob itself\n        // will be dereferenced after data processing:\n        o.chunkSize = o.blob.size;\n        // Expose the chunk bytes position range:\n        o.contentRange =\n          'bytes ' + ub + '-' + (ub + o.chunkSize - 1) + '/' + fs;\n        // Trigger chunkbeforesend to allow form data to be updated for this chunk\n        that._trigger('chunkbeforesend', null, o);\n        // Process the upload data (the blob and potential form data):\n        that._initXHRData(o);\n        // Add progress listeners for this chunk upload:\n        that._initProgressListener(o);\n        jqXHR = (\n          (that._trigger('chunksend', null, o) !== false && $.ajax(o)) ||\n          that._getXHRPromise(false, o.context)\n        )\n          .done(function (result, textStatus, jqXHR) {\n            ub = that._getUploadedBytes(jqXHR) || ub + o.chunkSize;\n            // Create a progress event if no final progress event\n            // with loaded equaling total has been triggered\n            // for this chunk:\n            if (currentLoaded + o.chunkSize - o._progress.loaded) {\n              that._onProgress(\n                $.Event('progress', {\n                  lengthComputable: true,\n                  loaded: ub - o.uploadedBytes,\n                  total: ub - o.uploadedBytes\n                }),\n                o\n              );\n            }\n            options.uploadedBytes = o.uploadedBytes = ub;\n            o.result = result;\n            o.textStatus = textStatus;\n            o.jqXHR = jqXHR;\n            that._trigger('chunkdone', null, o);\n            that._trigger('chunkalways', null, o);\n            if (ub < fs) {\n              // File upload not yet complete,\n              // continue with the next chunk:\n              upload();\n            } else {\n              dfd.resolveWith(o.context, [result, textStatus, jqXHR]);\n            }\n          })\n          .fail(function (jqXHR, textStatus, errorThrown) {\n            o.jqXHR = jqXHR;\n            o.textStatus = textStatus;\n            o.errorThrown = errorThrown;\n            that._trigger('chunkfail', null, o);\n            that._trigger('chunkalways', null, o);\n            dfd.rejectWith(o.context, [jqXHR, textStatus, errorThrown]);\n          })\n          .always(function () {\n            that._deinitProgressListener(o);\n          });\n      };\n      this._enhancePromise(promise);\n      promise.abort = function () {\n        return jqXHR.abort();\n      };\n      upload();\n      return promise;\n    },\n\n    _beforeSend: function (e, data) {\n      if (this._active === 0) {\n        // the start callback is triggered when an upload starts\n        // and no other uploads are currently running,\n        // equivalent to the global ajaxStart event:\n        this._trigger('start');\n        // Set timer for global bitrate progress calculation:\n        this._bitrateTimer = new this._BitrateTimer();\n        // Reset the global progress values:\n        this._progress.loaded = this._progress.total = 0;\n        this._progress.bitrate = 0;\n      }\n      // Make sure the container objects for the .response() and\n      // .progress() methods on the data object are available\n      // and reset to their initial state:\n      this._initResponseObject(data);\n      this._initProgressObject(data);\n      data._progress.loaded = data.loaded = data.uploadedBytes || 0;\n      data._progress.total = data.total = this._getTotal(data.files) || 1;\n      data._progress.bitrate = data.bitrate = 0;\n      this._active += 1;\n      // Initialize the global progress values:\n      this._progress.loaded += data.loaded;\n      this._progress.total += data.total;\n    },\n\n    _onDone: function (result, textStatus, jqXHR, options) {\n      var total = options._progress.total,\n        response = options._response;\n      if (options._progress.loaded < total) {\n        // Create a progress event if no final progress event\n        // with loaded equaling total has been triggered:\n        this._onProgress(\n          $.Event('progress', {\n            lengthComputable: true,\n            loaded: total,\n            total: total\n          }),\n          options\n        );\n      }\n      response.result = options.result = result;\n      response.textStatus = options.textStatus = textStatus;\n      response.jqXHR = options.jqXHR = jqXHR;\n      this._trigger('done', null, options);\n    },\n\n    _onFail: function (jqXHR, textStatus, errorThrown, options) {\n      var response = options._response;\n      if (options.recalculateProgress) {\n        // Remove the failed (error or abort) file upload from\n        // the global progress calculation:\n        this._progress.loaded -= options._progress.loaded;\n        this._progress.total -= options._progress.total;\n      }\n      response.jqXHR = options.jqXHR = jqXHR;\n      response.textStatus = options.textStatus = textStatus;\n      response.errorThrown = options.errorThrown = errorThrown;\n      this._trigger('fail', null, options);\n    },\n\n    _onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {\n      // jqXHRorResult, textStatus and jqXHRorError are added to the\n      // options object via done and fail callbacks\n      this._trigger('always', null, options);\n    },\n\n    _onSend: function (e, data) {\n      if (!data.submit) {\n        this._addConvenienceMethods(e, data);\n      }\n      var that = this,\n        jqXHR,\n        aborted,\n        slot,\n        pipe,\n        options = that._getAJAXSettings(data),\n        send = function () {\n          that._sending += 1;\n          // Set timer for bitrate progress calculation:\n          options._bitrateTimer = new that._BitrateTimer();\n          jqXHR =\n            jqXHR ||\n            (\n              ((aborted ||\n                that._trigger(\n                  'send',\n                  $.Event('send', { delegatedEvent: e }),\n                  options\n                ) === false) &&\n                that._getXHRPromise(false, options.context, aborted)) ||\n              that._chunkedUpload(options) ||\n              $.ajax(options)\n            )\n              .done(function (result, textStatus, jqXHR) {\n                that._onDone(result, textStatus, jqXHR, options);\n              })\n              .fail(function (jqXHR, textStatus, errorThrown) {\n                that._onFail(jqXHR, textStatus, errorThrown, options);\n              })\n              .always(function (jqXHRorResult, textStatus, jqXHRorError) {\n                that._deinitProgressListener(options);\n                that._onAlways(\n                  jqXHRorResult,\n                  textStatus,\n                  jqXHRorError,\n                  options\n                );\n                that._sending -= 1;\n                that._active -= 1;\n                if (\n                  options.limitConcurrentUploads &&\n                  options.limitConcurrentUploads > that._sending\n                ) {\n                  // Start the next queued upload,\n                  // that has not been aborted:\n                  var nextSlot = that._slots.shift();\n                  while (nextSlot) {\n                    if (that._getDeferredState(nextSlot) === 'pending') {\n                      nextSlot.resolve();\n                      break;\n                    }\n                    nextSlot = that._slots.shift();\n                  }\n                }\n                if (that._active === 0) {\n                  // The stop callback is triggered when all uploads have\n                  // been completed, equivalent to the global ajaxStop event:\n                  that._trigger('stop');\n                }\n              });\n          return jqXHR;\n        };\n      this._beforeSend(e, options);\n      if (\n        this.options.sequentialUploads ||\n        (this.options.limitConcurrentUploads &&\n          this.options.limitConcurrentUploads <= this._sending)\n      ) {\n        if (this.options.limitConcurrentUploads > 1) {\n          slot = $.Deferred();\n          this._slots.push(slot);\n          pipe = slot[that._promisePipe](send);\n        } else {\n          this._sequence = this._sequence[that._promisePipe](send, send);\n          pipe = this._sequence;\n        }\n        // Return the piped Promise object, enhanced with an abort method,\n        // which is delegated to the jqXHR object of the current upload,\n        // and jqXHR callbacks mapped to the equivalent Promise methods:\n        pipe.abort = function () {\n          aborted = [undefined, 'abort', 'abort'];\n          if (!jqXHR) {\n            if (slot) {\n              slot.rejectWith(options.context, aborted);\n            }\n            return send();\n          }\n          return jqXHR.abort();\n        };\n        return this._enhancePromise(pipe);\n      }\n      return send();\n    },\n\n    _onAdd: function (e, data) {\n      var that = this,\n        result = true,\n        options = $.extend({}, this.options, data),\n        files = data.files,\n        filesLength = files.length,\n        limit = options.limitMultiFileUploads,\n        limitSize = options.limitMultiFileUploadSize,\n        overhead = options.limitMultiFileUploadSizeOverhead,\n        batchSize = 0,\n        paramName = this._getParamName(options),\n        paramNameSet,\n        paramNameSlice,\n        fileSet,\n        i,\n        j = 0;\n      if (!filesLength) {\n        return false;\n      }\n      if (limitSize && files[0].size === undefined) {\n        limitSize = undefined;\n      }\n      if (\n        !(options.singleFileUploads || limit || limitSize) ||\n        !this._isXHRUpload(options)\n      ) {\n        fileSet = [files];\n        paramNameSet = [paramName];\n      } else if (!(options.singleFileUploads || limitSize) && limit) {\n        fileSet = [];\n        paramNameSet = [];\n        for (i = 0; i < filesLength; i += limit) {\n          fileSet.push(files.slice(i, i + limit));\n          paramNameSlice = paramName.slice(i, i + limit);\n          if (!paramNameSlice.length) {\n            paramNameSlice = paramName;\n          }\n          paramNameSet.push(paramNameSlice);\n        }\n      } else if (!options.singleFileUploads && limitSize) {\n        fileSet = [];\n        paramNameSet = [];\n        for (i = 0; i < filesLength; i = i + 1) {\n          batchSize += files[i].size + overhead;\n          if (\n            i + 1 === filesLength ||\n            batchSize + files[i + 1].size + overhead > limitSize ||\n            (limit && i + 1 - j >= limit)\n          ) {\n            fileSet.push(files.slice(j, i + 1));\n            paramNameSlice = paramName.slice(j, i + 1);\n            if (!paramNameSlice.length) {\n              paramNameSlice = paramName;\n            }\n            paramNameSet.push(paramNameSlice);\n            j = i + 1;\n            batchSize = 0;\n          }\n        }\n      } else {\n        paramNameSet = paramName;\n      }\n      data.originalFiles = files;\n      $.each(fileSet || files, function (index, element) {\n        var newData = $.extend({}, data);\n        newData.files = fileSet ? element : [element];\n        newData.paramName = paramNameSet[index];\n        that._initResponseObject(newData);\n        that._initProgressObject(newData);\n        that._addConvenienceMethods(e, newData);\n        result = that._trigger(\n          'add',\n          $.Event('add', { delegatedEvent: e }),\n          newData\n        );\n        return result;\n      });\n      return result;\n    },\n\n    _replaceFileInput: function (data) {\n      var input = data.fileInput,\n        inputClone = input.clone(true),\n        restoreFocus = input.is(document.activeElement);\n      // Add a reference for the new cloned file input to the data argument:\n      data.fileInputClone = inputClone;\n      $('<form></form>').append(inputClone)[0].reset();\n      // Detaching allows to insert the fileInput on another form\n      // without losing the file input value:\n      input.after(inputClone).detach();\n      // If the fileInput had focus before it was detached,\n      // restore focus to the inputClone.\n      if (restoreFocus) {\n        inputClone.trigger('focus');\n      }\n      // Avoid memory leaks with the detached file input:\n      $.cleanData(input.off('remove'));\n      // Replace the original file input element in the fileInput\n      // elements set with the clone, which has been copied including\n      // event handlers:\n      this.options.fileInput = this.options.fileInput.map(function (i, el) {\n        if (el === input[0]) {\n          return inputClone[0];\n        }\n        return el;\n      });\n      // If the widget has been initialized on the file input itself,\n      // override this.element with the file input clone:\n      if (input[0] === this.element[0]) {\n        this.element = inputClone;\n      }\n    },\n\n    _handleFileTreeEntry: function (entry, path) {\n      var that = this,\n        dfd = $.Deferred(),\n        entries = [],\n        dirReader,\n        errorHandler = function (e) {\n          if (e && !e.entry) {\n            e.entry = entry;\n          }\n          // Since $.when returns immediately if one\n          // Deferred is rejected, we use resolve instead.\n          // This allows valid files and invalid items\n          // to be returned together in one set:\n          dfd.resolve([e]);\n        },\n        successHandler = function (entries) {\n          that\n            ._handleFileTreeEntries(entries, path + entry.name + '/')\n            .done(function (files) {\n              dfd.resolve(files);\n            })\n            .fail(errorHandler);\n        },\n        readEntries = function () {\n          dirReader.readEntries(function (results) {\n            if (!results.length) {\n              successHandler(entries);\n            } else {\n              entries = entries.concat(results);\n              readEntries();\n            }\n          }, errorHandler);\n        };\n      // eslint-disable-next-line no-param-reassign\n      path = path || '';\n      if (entry.isFile) {\n        if (entry._file) {\n          // Workaround for Chrome bug #149735\n          entry._file.relativePath = path;\n          dfd.resolve(entry._file);\n        } else {\n          entry.file(function (file) {\n            file.relativePath = path;\n            dfd.resolve(file);\n          }, errorHandler);\n        }\n      } else if (entry.isDirectory) {\n        dirReader = entry.createReader();\n        readEntries();\n      } else {\n        // Return an empty list for file system items\n        // other than files or directories:\n        dfd.resolve([]);\n      }\n      return dfd.promise();\n    },\n\n    _handleFileTreeEntries: function (entries, path) {\n      var that = this;\n      return $.when\n        .apply(\n          $,\n          $.map(entries, function (entry) {\n            return that._handleFileTreeEntry(entry, path);\n          })\n        )\n        [this._promisePipe](function () {\n          return Array.prototype.concat.apply([], arguments);\n        });\n    },\n\n    _getDroppedFiles: function (dataTransfer) {\n      // eslint-disable-next-line no-param-reassign\n      dataTransfer = dataTransfer || {};\n      var items = dataTransfer.items;\n      if (\n        items &&\n        items.length &&\n        (items[0].webkitGetAsEntry || items[0].getAsEntry)\n      ) {\n        return this._handleFileTreeEntries(\n          $.map(items, function (item) {\n            var entry;\n            if (item.webkitGetAsEntry) {\n              entry = item.webkitGetAsEntry();\n              if (entry) {\n                // Workaround for Chrome bug #149735:\n                entry._file = item.getAsFile();\n              }\n              return entry;\n            }\n            return item.getAsEntry();\n          })\n        );\n      }\n      return $.Deferred().resolve($.makeArray(dataTransfer.files)).promise();\n    },\n\n    _getSingleFileInputFiles: function (fileInput) {\n      // eslint-disable-next-line no-param-reassign\n      fileInput = $(fileInput);\n      var entries = fileInput.prop('entries'),\n        files,\n        value;\n      if (entries && entries.length) {\n        return this._handleFileTreeEntries(entries);\n      }\n      files = $.makeArray(fileInput.prop('files'));\n      if (!files.length) {\n        value = fileInput.prop('value');\n        if (!value) {\n          return $.Deferred().resolve([]).promise();\n        }\n        // If the files property is not available, the browser does not\n        // support the File API and we add a pseudo File object with\n        // the input value as name with path information removed:\n        files = [{ name: value.replace(/^.*\\\\/, '') }];\n      } else if (files[0].name === undefined && files[0].fileName) {\n        // File normalization for Safari 4 and Firefox 3:\n        $.each(files, function (index, file) {\n          file.name = file.fileName;\n          file.size = file.fileSize;\n        });\n      }\n      return $.Deferred().resolve(files).promise();\n    },\n\n    _getFileInputFiles: function (fileInput) {\n      if (!(fileInput instanceof $) || fileInput.length === 1) {\n        return this._getSingleFileInputFiles(fileInput);\n      }\n      return $.when\n        .apply($, $.map(fileInput, this._getSingleFileInputFiles))\n        [this._promisePipe](function () {\n          return Array.prototype.concat.apply([], arguments);\n        });\n    },\n\n    _onChange: function (e) {\n      var that = this,\n        data = {\n          fileInput: $(e.target),\n          form: $(e.target.form)\n        };\n      this._getFileInputFiles(data.fileInput).always(function (files) {\n        data.files = files;\n        if (that.options.replaceFileInput) {\n          that._replaceFileInput(data);\n        }\n        if (\n          that._trigger(\n            'change',\n            $.Event('change', { delegatedEvent: e }),\n            data\n          ) !== false\n        ) {\n          that._onAdd(e, data);\n        }\n      });\n    },\n\n    _onPaste: function (e) {\n      var items =\n          e.originalEvent &&\n          e.originalEvent.clipboardData &&\n          e.originalEvent.clipboardData.items,\n        data = { files: [] };\n      if (items && items.length) {\n        $.each(items, function (index, item) {\n          var file = item.getAsFile && item.getAsFile();\n          if (file) {\n            data.files.push(file);\n          }\n        });\n        if (\n          this._trigger(\n            'paste',\n            $.Event('paste', { delegatedEvent: e }),\n            data\n          ) !== false\n        ) {\n          this._onAdd(e, data);\n        }\n      }\n    },\n\n    _onDrop: function (e) {\n      e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;\n      var that = this,\n        dataTransfer = e.dataTransfer,\n        data = {};\n      if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\n        e.preventDefault();\n        this._getDroppedFiles(dataTransfer).always(function (files) {\n          data.files = files;\n          if (\n            that._trigger(\n              'drop',\n              $.Event('drop', { delegatedEvent: e }),\n              data\n            ) !== false\n          ) {\n            that._onAdd(e, data);\n          }\n        });\n      }\n    },\n\n    _onDragOver: getDragHandler('dragover'),\n\n    _onDragEnter: getDragHandler('dragenter'),\n\n    _onDragLeave: getDragHandler('dragleave'),\n\n    _initEventHandlers: function () {\n      if (this._isXHRUpload(this.options)) {\n        this._on(this.options.dropZone, {\n          dragover: this._onDragOver,\n          drop: this._onDrop,\n          // event.preventDefault() on dragenter is required for IE10+:\n          dragenter: this._onDragEnter,\n          // dragleave is not required, but added for completeness:\n          dragleave: this._onDragLeave\n        });\n        this._on(this.options.pasteZone, {\n          paste: this._onPaste\n        });\n      }\n      if ($.support.fileInput) {\n        this._on(this.options.fileInput, {\n          change: this._onChange\n        });\n      }\n    },\n\n    _destroyEventHandlers: function () {\n      this._off(this.options.dropZone, 'dragenter dragleave dragover drop');\n      this._off(this.options.pasteZone, 'paste');\n      this._off(this.options.fileInput, 'change');\n    },\n\n    _destroy: function () {\n      this._destroyEventHandlers();\n    },\n\n    _setOption: function (key, value) {\n      var reinit = $.inArray(key, this._specialOptions) !== -1;\n      if (reinit) {\n        this._destroyEventHandlers();\n      }\n      this._super(key, value);\n      if (reinit) {\n        this._initSpecialOptions();\n        this._initEventHandlers();\n      }\n    },\n\n    _initSpecialOptions: function () {\n      var options = this.options;\n      if (options.fileInput === undefined) {\n        options.fileInput = this.element.is('input[type=\"file\"]')\n          ? this.element\n          : this.element.find('input[type=\"file\"]');\n      } else if (!(options.fileInput instanceof $)) {\n        options.fileInput = $(options.fileInput);\n      }\n      if (!(options.dropZone instanceof $)) {\n        options.dropZone = $(options.dropZone);\n      }\n      if (!(options.pasteZone instanceof $)) {\n        options.pasteZone = $(options.pasteZone);\n      }\n    },\n\n    _getRegExp: function (str) {\n      var parts = str.split('/'),\n        modifiers = parts.pop();\n      parts.shift();\n      return new RegExp(parts.join('/'), modifiers);\n    },\n\n    _isRegExpOption: function (key, value) {\n      return (\n        key !== 'url' &&\n        $.type(value) === 'string' &&\n        /^\\/.*\\/[igm]{0,3}$/.test(value)\n      );\n    },\n\n    _initDataAttributes: function () {\n      var that = this,\n        options = this.options,\n        data = this.element.data();\n      // Initialize options set via HTML5 data-attributes:\n      $.each(this.element[0].attributes, function (index, attr) {\n        var key = attr.name.toLowerCase(),\n          value;\n        if (/^data-/.test(key)) {\n          // Convert hyphen-ated key to camelCase:\n          key = key.slice(5).replace(/-[a-z]/g, function (str) {\n            return str.charAt(1).toUpperCase();\n          });\n          value = data[key];\n          if (that._isRegExpOption(key, value)) {\n            value = that._getRegExp(value);\n          }\n          options[key] = value;\n        }\n      });\n    },\n\n    _create: function () {\n      this._initDataAttributes();\n      this._initSpecialOptions();\n      this._slots = [];\n      this._sequence = this._getXHRPromise(true);\n      this._sending = this._active = 0;\n      this._initProgressObject(this);\n      this._initEventHandlers();\n    },\n\n    // This method is exposed to the widget API and allows to query\n    // the number of active uploads:\n    active: function () {\n      return this._active;\n    },\n\n    // This method is exposed to the widget API and allows to query\n    // the widget upload progress.\n    // It returns an object with loaded, total and bitrate properties\n    // for the running uploads:\n    progress: function () {\n      return this._progress;\n    },\n\n    // This method is exposed to the widget API and allows adding files\n    // using the fileupload API. The data parameter accepts an object which\n    // must have a files property and can contain additional options:\n    // .fileupload('add', {files: filesList});\n    add: function (data) {\n      var that = this;\n      if (!data || this.options.disabled) {\n        return;\n      }\n      if (data.fileInput && !data.files) {\n        this._getFileInputFiles(data.fileInput).always(function (files) {\n          data.files = files;\n          that._onAdd(null, data);\n        });\n      } else {\n        data.files = $.makeArray(data.files);\n        this._onAdd(null, data);\n      }\n    },\n\n    // This method is exposed to the widget API and allows sending files\n    // using the fileupload API. The data parameter accepts an object which\n    // must have a files or fileInput property and can contain additional options:\n    // .fileupload('send', {files: filesList});\n    // The method returns a Promise object for the file upload call.\n    send: function (data) {\n      if (data && !this.options.disabled) {\n        if (data.fileInput && !data.files) {\n          var that = this,\n            dfd = $.Deferred(),\n            promise = dfd.promise(),\n            jqXHR,\n            aborted;\n          promise.abort = function () {\n            aborted = true;\n            if (jqXHR) {\n              return jqXHR.abort();\n            }\n            dfd.reject(null, 'abort', 'abort');\n            return promise;\n          };\n          this._getFileInputFiles(data.fileInput).always(function (files) {\n            if (aborted) {\n              return;\n            }\n            if (!files.length) {\n              dfd.reject();\n              return;\n            }\n            data.files = files;\n            jqXHR = that._onSend(null, data);\n            jqXHR.then(\n              function (result, textStatus, jqXHR) {\n                dfd.resolve(result, textStatus, jqXHR);\n              },\n              function (jqXHR, textStatus, errorThrown) {\n                dfd.reject(jqXHR, textStatus, errorThrown);\n              }\n            );\n          });\n          return this._enhancePromise(promise);\n        }\n        data.files = $.makeArray(data.files);\n        if (data.files.length) {\n          return this._onSend(null, data);\n        }\n      }\n      return this._getXHRPromise(false, data && data.context);\n    }\n  });\n});\n"],"names":["factory","define","amd","exports","require","window","jQuery","$","parts","getDragHandler","type","isDragOver","e","dataTransfer","originalEvent","inArray","types","_trigger","Event","delegatedEvent","preventDefault","dropEffect","support","fileInput","RegExp","test","navigator","userAgent","prop","xhrFileUpload","ProgressEvent","FileReader","xhrFormDataFileUpload","FormData","blobSlice","Blob","prototype","slice","webkitSlice","mozSlice","widget","options","dropZone","document","pasteZone","undefined","replaceFileInput","paramName","singleFileUploads","limitMultiFileUploads","limitMultiFileUploadSize","limitMultiFileUploadSizeOverhead","sequentialUploads","limitConcurrentUploads","forceIframeTransport","redirect","redirectParamName","postMessage","multipart","maxChunkSize","uploadedBytes","recalculateProgress","progressInterval","bitrateInterval","autoUpload","uniqueFilenames","messages","i18n","message","context","toString","each","key","value","replace","formData","form","serializeArray","add","data","isDefaultPrevented","fileupload","process","done","submit","processData","contentType","cache","timeout","_promisePipe","Number","fn","jquery","split","_specialOptions","_blobSlice","apply","arguments","_BitrateTimer","timestamp","Date","now","getTime","loaded","bitrate","getBitrate","interval","timeDiff","_isXHRUpload","_getFormData","isArray","name","push","_getTotal","files","total","index","file","size","_initProgressObject","obj","progress","_progress","extend","_initResponseObject","_response","Object","hasOwnProperty","call","_onProgress","lengthComputable","_time","Math","floor","chunkSize","_bitrateTimer","_initProgressListener","that","xhr","ajaxSettings","upload","on","oe","_deinitProgressListener","off","_isInstanceOf","_getUniqueFilename","map","String","_","p1","p2","_initXHRData","headers","contentRange","blob","encodeURI","uploadName","field","append","fileName","_initIframeSettings","targetHost","url","dataType","location","host","_initDataSettings","_chunkedUpload","_getParamName","input","i","length","_initFormSettings","href","toUpperCase","formAcceptCharset","attr","_getAJAXSettings","_getDeferredState","deferred","state","isResolved","isRejected","_enhancePromise","promise","success","error","fail","complete","always","_getXHRPromise","resolveOrReject","args","dfd","Deferred","resolveWith","rejectWith","abort","_addConvenienceMethods","getPromise","resolveFunc","rejectFunc","_processQueue","errorThrown","jqXHR","_onSend","processing","response","_getUploadedBytes","range","getResponseHeader","upperBytesPos","parseInt","testOnly","fs","ub","mcs","o","currentLoaded","ajax","result","textStatus","_beforeSend","_active","_onDone","_onFail","_onAlways","jqXHRorResult","jqXHRorError","aborted","slot","pipe","send","_sending","nextSlot","_slots","shift","resolve","_sequence","_onAdd","paramNameSet","paramNameSlice","fileSet","filesLength","limit","limitSize","overhead","batchSize","j","originalFiles","element","newData","_replaceFileInput","inputClone","clone","restoreFocus","is","activeElement","fileInputClone","reset","after","detach","trigger","cleanData","el","_handleFileTreeEntry","entry","path","dirReader","entries","errorHandler","successHandler","_handleFileTreeEntries","readEntries","results","concat","isFile","_file","relativePath","isDirectory","createReader","when","Array","_getDroppedFiles","items","webkitGetAsEntry","getAsEntry","item","getAsFile","makeArray","_getSingleFileInputFiles","fileSize","_getFileInputFiles","_onChange","target","_onPaste","clipboardData","_onDrop","_onDragOver","_onDragEnter","_onDragLeave","_initEventHandlers","_on","dragover","drop","dragenter","dragleave","paste","change","_destroyEventHandlers","_off","_destroy","_setOption","reinit","_super","_initSpecialOptions","find","_getRegExp","str","modifiers","pop","join","_isRegExpOption","_initDataAttributes","attributes","toLowerCase","charAt","_create","active","disabled","reject","then"],"mappings":"CAcA,AAAC,SAAUA,CAAO,EAChB,YACI,AAAkB,CAAA,YAAlB,OAAOC,QAAyBA,OAAOC,GAAG,CAE5CD,OAAO,CAAC,SAAU,sBAAsB,CAAED,GACjC,AAAmB,UAAnB,OAAOG,QAEhBH,EAAQI,QAAQ,UAAWA,QAAQ,8BAGnCJ,EAAQK,OAAOC,MAAM,CAEzB,EAAG,SAAUC,CAAC,EACZ,iBA0RQC,EArPR,SAASC,EAAeC,CAAI,EAC1B,IAAIC,EAAaD,AAAS,aAATA,EACjB,OAAO,SAAUE,CAAC,EAChBA,EAAEC,YAAY,CAAGD,EAAEE,aAAa,EAAIF,EAAEE,aAAa,CAACD,YAAY,CAChE,IAAIA,EAAeD,EAAEC,YAAY,CAE/BA,GACAN,AAA2C,KAA3CA,EAAEQ,OAAO,CAAC,QAASF,EAAaG,KAAK,GACrC,AAA8D,CAAA,IAA9D,IAAI,CAACC,QAAQ,CAACP,EAAMH,EAAEW,KAAK,CAACR,EAAM,CAAES,eAAgBP,CAAE,MAEtDA,EAAEQ,cAAc,GACZT,GACFE,CAAAA,EAAaQ,UAAU,CAAG,MAAK,EAGrC,CACF,CAjDAd,EAAEe,OAAO,CAACC,SAAS,CAAG,CACpB,CAAA,AAAIC,OAEF,uJAIAC,IAAI,CAACpB,OAAOqB,SAAS,CAACC,SAAS,GAEjCpB,EAAE,wBAAwBqB,IAAI,CAAC,WAAU,EAQ3CrB,EAAEe,OAAO,CAACO,aAAa,CAAG,CAAC,CAAExB,CAAAA,OAAOyB,aAAa,EAAIzB,OAAO0B,UAAU,AAAD,EACrExB,EAAEe,OAAO,CAACU,qBAAqB,CAAG,CAAC,CAAC3B,OAAO4B,QAAQ,CAGnD1B,EAAEe,OAAO,CAACY,SAAS,CACjB7B,OAAO8B,IAAI,EACVA,CAAAA,KAAKC,SAAS,CAACC,KAAK,EACnBF,KAAKC,SAAS,CAACE,WAAW,EAC1BH,KAAKC,SAAS,CAACG,QAAQ,AAAD,EAkC1BhC,EAAEiC,MAAM,CAAC,qBAAsB,CAC7BC,QAAS,CAGPC,SAAUnC,EAAEoC,UAGZC,UAAWC,KAAAA,EAKXtB,UAAWsB,KAAAA,EAKXC,iBAAkB,CAAA,EAKlBC,UAAWF,KAAAA,EAIXG,kBAAmB,CAAA,EAGnBC,sBAAuBJ,KAAAA,EAIvBK,yBAA0BL,KAAAA,EAI1BM,iCAAkC,IAGlCC,kBAAmB,CAAA,EAGnBC,uBAAwBR,KAAAA,EAExBS,qBAAsB,CAAA,EAGtBC,SAAUV,KAAAA,EAGVW,kBAAmBX,KAAAA,EAGnBY,YAAaZ,KAAAA,EAIba,UAAW,CAAA,EAKXC,aAAcd,KAAAA,EAMde,cAAef,KAAAA,EAIfgB,oBAAqB,CAAA,EAErBC,iBAAkB,IAElBC,gBAAiB,IAEjBC,WAAY,CAAA,EASZC,gBAAiBpB,KAAAA,EAGjBqB,SAAU,CACRN,cAAe,iCACjB,EAIAO,KAAM,SAAUC,CAAO,CAAEC,CAAO,EAS9B,OAPAD,EAAU,IAAI,CAACF,QAAQ,CAACE,EAAQ,EAAIA,EAAQE,QAAQ,GAChDD,GACF9D,EAAEgE,IAAI,CAACF,EAAS,SAAUG,CAAG,CAAEC,CAAK,EAElCL,EAAUA,EAAQM,OAAO,CAAC,IAAMF,EAAM,IAAKC,EAC7C,GAEKL,CACT,EAOAO,SAAU,SAAUC,CAAI,EACtB,OAAOA,EAAKC,cAAc,EAC5B,EAkBAC,IAAK,SAAUlE,CAAC,CAAEmE,CAAI,EACpB,GAAInE,EAAEoE,kBAAkB,GACtB,MAAO,CAAA,EAGPD,CAAAA,EAAKf,UAAU,EACde,AAAoB,CAAA,IAApBA,EAAKf,UAAU,EACdzD,EAAE,IAAI,EAAE0E,UAAU,CAAC,SAAU,aAAa,GAE5CF,EAAKG,OAAO,GAAGC,IAAI,CAAC,WAClBJ,EAAKK,MAAM,EACb,EAEJ,EA4DAC,YAAa,CAAA,EACbC,YAAa,CAAA,EACbC,MAAO,CAAA,EACPC,QAAS,CACX,EAOAC,aAESC,OAAOlF,CADVA,EAAQD,EAAEoF,EAAE,CAACC,MAAM,CAACC,KAAK,CAAC,KACX,CAAC,EAAE,EAAI,GAAKH,OAAOlF,CAAK,CAAC,EAAE,EAAI,EAAI,OAAS,OAKjEsF,gBAAiB,CACf,YACA,WACA,YACA,YACA,uBACD,CAEDC,WACExF,EAAEe,OAAO,CAACY,SAAS,EACnB,WAEE,MAAOG,AADK,CAAA,IAAI,CAACA,KAAK,EAAI,IAAI,CAACC,WAAW,EAAI,IAAI,CAACC,QAAQ,AAAD,EAC7CyD,KAAK,CAAC,IAAI,CAAEC,UAC3B,EAEFC,cAAe,WACb,IAAI,CAACC,SAAS,CAAGC,KAAKC,GAAG,CAAGD,KAAKC,GAAG,GAAK,IAAID,OAAOE,OAAO,GAC3D,IAAI,CAACC,MAAM,CAAG,EACd,IAAI,CAACC,OAAO,CAAG,EACf,IAAI,CAACC,UAAU,CAAG,SAAUJ,CAAG,CAAEE,CAAM,CAAEG,CAAQ,EAC/C,IAAIC,EAAWN,EAAM,IAAI,CAACF,SAAS,CAMnC,OALK,IAAI,CAACK,OAAO,EAAKE,IAAYC,CAAAA,EAAWD,CAAO,IAClD,IAAI,CAACF,OAAO,CAAG,AAACD,CAAAA,EAAS,IAAI,CAACA,MAAM,AAAD,EAAM,CAAA,IAAOI,CAAO,EAAK,EAC5D,IAAI,CAACJ,MAAM,CAAGA,EACd,IAAI,CAACJ,SAAS,CAAGE,GAEZ,IAAI,CAACG,OAAO,AACrB,CACF,EAEAI,aAAc,SAAUnE,CAAO,EAC7B,MACE,CAACA,EAAQa,oBAAoB,EAC5B,CAAA,AAAC,CAACb,EAAQiB,SAAS,EAAInD,EAAEe,OAAO,CAACO,aAAa,EAC7CtB,EAAEe,OAAO,CAACU,qBAAqB,AAAD,CAEpC,EAEA6E,aAAc,SAAUpE,CAAO,EAC7B,IAAIkC,QACJ,AAAIpE,AAA6B,aAA7BA,EAAEG,IAAI,CAAC+B,EAAQkC,QAAQ,EAClBlC,EAAQkC,QAAQ,CAAClC,EAAQmC,IAAI,EAElCrE,EAAEuG,OAAO,CAACrE,EAAQkC,QAAQ,EACrBlC,EAAQkC,QAAQ,CAErBpE,AAA6B,WAA7BA,EAAEG,IAAI,CAAC+B,EAAQkC,QAAQ,GACzBA,EAAW,EAAE,CACbpE,EAAEgE,IAAI,CAAC9B,EAAQkC,QAAQ,CAAE,SAAUoC,CAAI,CAAEtC,CAAK,EAC5CE,EAASqC,IAAI,CAAC,CAAED,KAAMA,EAAMtC,MAAOA,CAAM,EAC3C,GACOE,GAEF,EAAE,AACX,EAEAsC,UAAW,SAAUC,CAAK,EACxB,IAAIC,EAAQ,EAIZ,OAHA5G,EAAEgE,IAAI,CAAC2C,EAAO,SAAUE,CAAK,CAAEC,CAAI,EACjCF,GAASE,EAAKC,IAAI,EAAI,CACxB,GACOH,CACT,EAEAI,oBAAqB,SAAUC,CAAG,EAChC,IAAIC,EAAW,CACblB,OAAQ,EACRY,MAAO,EACPX,QAAS,CACX,CACIgB,CAAAA,EAAIE,SAAS,CACfnH,EAAEoH,MAAM,CAACH,EAAIE,SAAS,CAAED,GAExBD,EAAIE,SAAS,CAAGD,CAEpB,EAEAG,oBAAqB,SAAUJ,CAAG,EAChC,IAAI5F,EACJ,GAAI4F,EAAIK,SAAS,CACf,IAAKjG,KAAQ4F,EAAIK,SAAS,CACpBC,OAAO1F,SAAS,CAAC2F,cAAc,CAACC,IAAI,CAACR,EAAIK,SAAS,CAAEjG,IACtD,OAAO4F,EAAIK,SAAS,CAACjG,EAAK,MAI9B4F,EAAIK,SAAS,CAAG,CAAC,CAErB,EAEAI,YAAa,SAAUrH,CAAC,CAAEmE,CAAI,EAC5B,GAAInE,EAAEsH,gBAAgB,CAAE,CACtB,IACE3B,EADEF,EAAMD,KAAKC,GAAG,CAAGD,KAAKC,GAAG,GAAK,IAAID,OAAOE,OAAO,GAGlDvB,CAAAA,CAAAA,EAAKoD,KAAK,GACVpD,EAAKjB,gBAAgB,GACrBuC,CAAAA,EAAMtB,EAAKoD,KAAK,CAAGpD,EAAKjB,gBAAgB,AAAD,GACvClD,EAAE2F,MAAM,GAAK3F,EAAEuG,KAAK,AAAD,IAIrBpC,EAAKoD,KAAK,CAAG9B,EACbE,EACE6B,KAAKC,KAAK,CACR,AAACzH,EAAE2F,MAAM,CAAG3F,EAAEuG,KAAK,CAAKpC,CAAAA,EAAKuD,SAAS,EAAIvD,EAAK2C,SAAS,CAACP,KAAK,AAAD,GAC1DpC,CAAAA,EAAKnB,aAAa,EAAI,CAAA,EAG7B,IAAI,CAAC8D,SAAS,CAACnB,MAAM,EAAIA,EAASxB,EAAK2C,SAAS,CAACnB,MAAM,CACvD,IAAI,CAACmB,SAAS,CAAClB,OAAO,CAAG,IAAI,CAAC+B,aAAa,CAAC9B,UAAU,CACpDJ,EACA,IAAI,CAACqB,SAAS,CAACnB,MAAM,CACrBxB,EAAKhB,eAAe,EAEtBgB,EAAK2C,SAAS,CAACnB,MAAM,CAAGxB,EAAKwB,MAAM,CAAGA,EACtCxB,EAAK2C,SAAS,CAAClB,OAAO,CAAGzB,EAAKyB,OAAO,CAAGzB,EAAKwD,aAAa,CAAC9B,UAAU,CACnEJ,EACAE,EACAxB,EAAKhB,eAAe,EAKtB,IAAI,CAAC9C,QAAQ,CACX,WACAV,EAAEW,KAAK,CAAC,WAAY,CAAEC,eAAgBP,CAAE,GACxCmE,GAIF,IAAI,CAAC9D,QAAQ,CACX,cACAV,EAAEW,KAAK,CAAC,cAAe,CAAEC,eAAgBP,CAAE,GAC3C,IAAI,CAAC8G,SAAS,EAElB,CACF,EAEAc,sBAAuB,SAAU/F,CAAO,EACtC,IAAIgG,EAAO,IAAI,CACbC,EAAMjG,EAAQiG,GAAG,CAAGjG,EAAQiG,GAAG,GAAKnI,EAAEoI,YAAY,CAACD,GAAG,EAGpDA,CAAAA,EAAIE,MAAM,GACZrI,EAAEmI,EAAIE,MAAM,EAAEC,EAAE,CAAC,WAAY,SAAUjI,CAAC,EACtC,IAAIkI,EAAKlI,EAAEE,aAAa,AAExBF,CAAAA,EAAEsH,gBAAgB,CAAGY,EAAGZ,gBAAgB,CACxCtH,EAAE2F,MAAM,CAAGuC,EAAGvC,MAAM,CACpB3F,EAAEuG,KAAK,CAAG2B,EAAG3B,KAAK,CAClBsB,EAAKR,WAAW,CAACrH,EAAG6B,EACtB,GACAA,EAAQiG,GAAG,CAAG,WACZ,OAAOA,CACT,EAEJ,EAEAK,wBAAyB,SAAUtG,CAAO,EACxC,IAAIiG,EAAMjG,EAAQiG,GAAG,CAAGjG,EAAQiG,GAAG,GAAKnI,EAAEoI,YAAY,CAACD,GAAG,EACtDA,CAAAA,EAAIE,MAAM,EACZrI,EAAEmI,EAAIE,MAAM,EAAEI,GAAG,CAAC,WAEtB,EAEAC,cAAe,SAAUvI,CAAI,CAAE8G,CAAG,EAEhC,OAAOM,OAAO1F,SAAS,CAACkC,QAAQ,CAAC0D,IAAI,CAACR,KAAS,WAAa9G,EAAO,GACrE,EAEAwI,mBAAoB,SAAUnC,CAAI,CAAEoC,CAAG,SAGrC,AAAIA,CAAG,CADPpC,EAAOqC,OAAOrC,GACD,EAEXA,EAAOA,EAAKrC,OAAO,CACjB,+BACA,SAAU2E,CAAC,CAAEC,CAAE,CAAEC,CAAE,EAGjB,MAAO,KAFKD,CAAAA,EAAK5D,OAAO4D,GAAM,EAAI,CAAA,EAEZ,IADZC,CAAAA,GAAM,EAAC,CAEnB,GAEK,IAAI,CAACL,kBAAkB,CAACnC,EAAMoC,KAEvCA,CAAG,CAACpC,EAAK,CAAG,CAAA,EACLA,EACT,EAEAyC,aAAc,SAAU/G,CAAO,EAC7B,IACEkC,EADE8D,EAAO,IAAI,CAEbpB,EAAO5E,EAAQyE,KAAK,CAAC,EAAE,CAEvBxD,EAAYjB,EAAQiB,SAAS,EAAI,CAACnD,EAAEe,OAAO,CAACO,aAAa,CACzDkB,EACExC,AAA8B,UAA9BA,EAAEG,IAAI,CAAC+B,EAAQM,SAAS,EACpBN,EAAQM,SAAS,CAAC,EAAE,CACpBN,EAAQM,SAAS,AACzBN,CAAAA,EAAQgH,OAAO,CAAGlJ,EAAEoH,MAAM,CAAC,CAAC,EAAGlF,EAAQgH,OAAO,EAC1ChH,EAAQiH,YAAY,EACtBjH,CAAAA,EAAQgH,OAAO,CAAC,gBAAgB,CAAGhH,EAAQiH,YAAY,AAAD,EAEnDhG,IAAajB,EAAQkH,IAAI,EAAK,IAAI,CAACV,aAAa,CAAC,OAAQ5B,IAC5D5E,CAAAA,EAAQgH,OAAO,CAAC,sBAAsB,CACpC,yBACAG,UAAUvC,EAAKwC,UAAU,EAAIxC,EAAKN,IAAI,EACtC,GAAE,EAEDrD,EAGMnD,EAAEe,OAAO,CAACU,qBAAqB,GACpCS,EAAQgB,WAAW,EAKrBkB,EAAW,IAAI,CAACkC,YAAY,CAACpE,GACzBA,EAAQkH,IAAI,CACdhF,EAASqC,IAAI,CAAC,CACZD,KAAMhE,EACN0B,MAAOhC,EAAQkH,IAAI,AACrB,GAEApJ,EAAEgE,IAAI,CAAC9B,EAAQyE,KAAK,CAAE,SAAUE,CAAK,CAAEC,CAAI,EACzC1C,EAASqC,IAAI,CAAC,CACZD,KACE,AAA+B,UAA9BxG,EAAEG,IAAI,CAAC+B,EAAQM,SAAS,GACvBN,EAAQM,SAAS,CAACqE,EAAM,EAC1BrE,EACF0B,MAAO4C,CACT,EACF,KAGEoB,EAAKQ,aAAa,CAAC,WAAYxG,EAAQkC,QAAQ,EACjDA,EAAWlC,EAAQkC,QAAQ,EAE3BA,EAAW,IAAI1C,SACf1B,EAAEgE,IAAI,CAAC,IAAI,CAACsC,YAAY,CAACpE,GAAU,SAAU2E,CAAK,CAAE0C,CAAK,EACvDnF,EAASoF,MAAM,CAACD,EAAM/C,IAAI,CAAE+C,EAAMrF,KAAK,CACzC,IAEEhC,EAAQkH,IAAI,CACdhF,EAASoF,MAAM,CACbhH,EACAN,EAAQkH,IAAI,CACZtC,EAAKwC,UAAU,EAAIxC,EAAKN,IAAI,EAG9BxG,EAAEgE,IAAI,CAAC9B,EAAQyE,KAAK,CAAE,SAAUE,CAAK,CAAEC,CAAI,EAGzC,GACEoB,EAAKQ,aAAa,CAAC,OAAQ5B,IAC3BoB,EAAKQ,aAAa,CAAC,OAAQ5B,GAC3B,CACA,IAAI2C,EAAW3C,EAAKwC,UAAU,EAAIxC,EAAKN,IAAI,AACvCtE,CAAAA,EAAQwB,eAAe,EACzB+F,CAAAA,EAAWvB,EAAKS,kBAAkB,CAChCc,EACAvH,EAAQwB,eAAe,CACzB,EAEFU,EAASoF,MAAM,CACb,AAA+B,UAA9BxJ,EAAEG,IAAI,CAAC+B,EAAQM,SAAS,GACvBN,EAAQM,SAAS,CAACqE,EAAM,EACxBrE,EACFsE,EACA2C,EAEJ,CACF,IAGJvH,EAAQsC,IAAI,CAAGJ,IAlEflC,EAAQ6C,WAAW,CAAG+B,EAAK3G,IAAI,EAAI,2BACnC+B,EAAQsC,IAAI,CAAGtC,EAAQkH,IAAI,EAAItC,GAoEjC5E,EAAQkH,IAAI,CAAG,IACjB,EAEAM,oBAAqB,SAAUxH,CAAO,EACpC,IAAIyH,EAAa3J,EAAE,WAAWqB,IAAI,CAAC,OAAQa,EAAQ0H,GAAG,EAAEvI,IAAI,CAAC,OAE7Da,CAAAA,EAAQ2H,QAAQ,CAAG,UAAa3H,CAAAA,EAAQ2H,QAAQ,EAAI,EAAC,EAErD3H,EAAQkC,QAAQ,CAAG,IAAI,CAACkC,YAAY,CAACpE,GAEjCA,EAAQc,QAAQ,EAAI2G,GAAcA,IAAeG,SAASC,IAAI,EAChE7H,EAAQkC,QAAQ,CAACqC,IAAI,CAAC,CACpBD,KAAMtE,EAAQe,iBAAiB,EAAI,WACnCiB,MAAOhC,EAAQc,QAAQ,AACzB,EAEJ,EAEAgH,kBAAmB,SAAU9H,CAAO,EAC9B,IAAI,CAACmE,YAAY,CAACnE,IACf,IAAI,CAAC+H,cAAc,CAAC/H,EAAS,CAAA,KAC3BA,EAAQsC,IAAI,EACf,IAAI,CAACyE,YAAY,CAAC/G,GAEpB,IAAI,CAAC+F,qBAAqB,CAAC/F,IAEzBA,EAAQgB,WAAW,EAGrBhB,CAAAA,EAAQ2H,QAAQ,CAAG,eAAkB3H,CAAAA,EAAQ2H,QAAQ,EAAI,EAAC,CAAC,GAG7D,IAAI,CAACH,mBAAmB,CAACxH,EAE7B,EAEAgI,cAAe,SAAUhI,CAAO,EAC9B,IAAIlB,EAAYhB,EAAEkC,EAAQlB,SAAS,EACjCwB,EAAYN,EAAQM,SAAS,CAkB/B,OAjBKA,EAcOxC,EAAEuG,OAAO,CAAC/D,IACpBA,CAAAA,EAAY,CAACA,EAAU,AAAD,GAdtBA,EAAY,EAAE,CACdxB,EAAUgD,IAAI,CAAC,WAIb,IAHA,IAAImG,EAAQnK,EAAE,IAAI,EAChBwG,EAAO2D,EAAM9I,IAAI,CAAC,SAAW,UAC7B+I,EAAI,AAACD,CAAAA,EAAM9I,IAAI,CAAC,UAAY,CAAC,EAAE,AAAD,EAAGgJ,MAAM,CAClCD,GACL5H,EAAUiE,IAAI,CAACD,GACf4D,GAAK,CAET,GACK5H,EAAU6H,MAAM,EACnB7H,CAAAA,EAAY,CAACxB,EAAUK,IAAI,CAAC,SAAW,UAAU,AAAD,GAK7CmB,CACT,EAEA8H,kBAAmB,SAAUpI,CAAO,EAG7BA,EAAQmC,IAAI,EAAKnC,EAAQmC,IAAI,CAACgG,MAAM,GACvCnI,EAAQmC,IAAI,CAAGrE,EAAEkC,EAAQlB,SAAS,CAACK,IAAI,CAAC,SAGnCa,EAAQmC,IAAI,CAACgG,MAAM,EACtBnI,CAAAA,EAAQmC,IAAI,CAAGrE,EAAE,IAAI,CAACkC,OAAO,CAAClB,SAAS,CAACK,IAAI,CAAC,QAAO,GAGxDa,EAAQM,SAAS,CAAG,IAAI,CAAC0H,aAAa,CAAChI,GAClCA,EAAQ0H,GAAG,EACd1H,CAAAA,EAAQ0H,GAAG,CAAG1H,EAAQmC,IAAI,CAAChD,IAAI,CAAC,WAAayI,SAASS,IAAI,AAAD,EAG3DrI,EAAQ/B,IAAI,CAAG,AACb+B,CAAAA,EAAQ/B,IAAI,EACXH,AAAwC,WAAxCA,EAAEG,IAAI,CAAC+B,EAAQmC,IAAI,CAAChD,IAAI,CAAC,YACxBa,EAAQmC,IAAI,CAAChD,IAAI,CAAC,WACpB,EAAC,EACDmJ,WAAW,GAEM,SAAjBtI,EAAQ/B,IAAI,EACZ+B,AAAiB,QAAjBA,EAAQ/B,IAAI,EACZ+B,AAAiB,UAAjBA,EAAQ/B,IAAI,EAEZ+B,CAAAA,EAAQ/B,IAAI,CAAG,MAAK,EAEjB+B,EAAQuI,iBAAiB,EAC5BvI,CAAAA,EAAQuI,iBAAiB,CAAGvI,EAAQmC,IAAI,CAACqG,IAAI,CAAC,iBAAgB,CAElE,EAEAC,iBAAkB,SAAUnG,CAAI,EAC9B,IAAItC,EAAUlC,EAAEoH,MAAM,CAAC,CAAC,EAAG,IAAI,CAAClF,OAAO,CAAEsC,GAGzC,OAFA,IAAI,CAAC8F,iBAAiB,CAACpI,GACvB,IAAI,CAAC8H,iBAAiB,CAAC9H,GAChBA,CACT,EAIA0I,kBAAmB,SAAUC,CAAQ,SACnC,AAAIA,EAASC,KAAK,CACTD,EAASC,KAAK,GAEnBD,EAASE,UAAU,GACd,WAELF,EAASG,UAAU,GACd,WAEF,SACT,EAIAC,gBAAiB,SAAUC,CAAO,EAIhC,OAHAA,EAAQC,OAAO,CAAGD,EAAQtG,IAAI,CAC9BsG,EAAQE,KAAK,CAAGF,EAAQG,IAAI,CAC5BH,EAAQI,QAAQ,CAAGJ,EAAQK,MAAM,CAC1BL,CACT,EAIAM,eAAgB,SAAUC,CAAe,CAAE3H,CAAO,CAAE4H,CAAI,EACtD,IAAIC,EAAM3L,EAAE4L,QAAQ,GAClBV,EAAUS,EAAIT,OAAO,GASvB,OAPApH,EAAUA,GAAW,IAAI,CAAC5B,OAAO,CAAC4B,OAAO,EAAIoH,EACzCO,AAAoB,CAAA,IAApBA,EACFE,EAAIE,WAAW,CAAC/H,EAAS4H,GACI,CAAA,IAApBD,GACTE,EAAIG,UAAU,CAAChI,EAAS4H,GAE1BR,EAAQa,KAAK,CAAGJ,EAAIT,OAAO,CACpB,IAAI,CAACD,eAAe,CAACC,EAC9B,EAGAc,uBAAwB,SAAU3L,CAAC,CAAEmE,CAAI,EACvC,IAAI0D,EAAO,IAAI,CACb+D,EAAa,SAAUP,CAAI,EACzB,OAAO1L,EAAE4L,QAAQ,GAAGC,WAAW,CAAC3D,EAAMwD,GAAMR,OAAO,EACrD,CACF1G,CAAAA,EAAKG,OAAO,CAAG,SAAUuH,CAAW,CAAEC,CAAU,EAY9C,MAXID,CAAAA,GAAeC,CAAS,GAC1B3H,CAAAA,EAAK4H,aAAa,CAAG,IAAI,CAACA,aAAa,CAAG,AAAC,CAAA,IAAI,CAACA,aAAa,EAC3DH,EAAW,CAAC,IAAI,CAAC,CAAA,CACjB,CAAC/D,EAAKhD,YAAY,CAAC,CAAC,kBAClB,AAAIV,EAAK6H,WAAW,CACXrM,EAAE4L,QAAQ,GAAGE,UAAU,CAAC5D,EAAM,CAAC1D,EAAK,EAAE0G,OAAO,GAE/Ce,EAAWvG,UACpB,EACA,CAACwC,EAAKhD,YAAY,CAAC,CAACgH,EAAaC,EAAU,EAExC,IAAI,CAACC,aAAa,EAAIH,EAAW,CAAC,IAAI,CAAC,CAChD,EACAzH,EAAKK,MAAM,CAAG,WASZ,MARqB,YAAjB,IAAI,CAACiG,KAAK,IACZtG,CAAAA,EAAK8H,KAAK,CAAG,IAAI,CAACA,KAAK,CACrBpE,AAIM,CAAA,IAJNA,EAAKxH,QAAQ,CACX,SACAV,EAAEW,KAAK,CAAC,SAAU,CAAEC,eAAgBP,CAAE,GACtC,IAAI,GACS6H,EAAKqE,OAAO,CAAClM,EAAG,IAAI,CAAA,EAEhC,IAAI,CAACiM,KAAK,EAAIpE,EAAKsD,cAAc,EAC1C,EACAhH,EAAKuH,KAAK,CAAG,kBACX,AAAI,IAAI,CAACO,KAAK,CACL,IAAI,CAACA,KAAK,CAACP,KAAK,IAEzB,IAAI,CAACM,WAAW,CAAG,QACnBnE,EAAKxH,QAAQ,CAAC,OAAQ,KAAM,IAAI,EACzBwH,EAAKsD,cAAc,CAAC,CAAA,GAC7B,EACAhH,EAAKsG,KAAK,CAAG,kBACX,AAAI,IAAI,CAACwB,KAAK,CACLpE,EAAK0C,iBAAiB,CAAC,IAAI,CAAC0B,KAAK,EAEtC,IAAI,CAACF,aAAa,CACblE,EAAK0C,iBAAiB,CAAC,IAAI,CAACwB,aAAa,QAEpD,EACA5H,EAAKgI,UAAU,CAAG,WAChB,MACE,CAAC,IAAI,CAACF,KAAK,EACX,IAAI,CAACF,aAAa,EAClBlE,AAA+C,YAA/CA,EAAK0C,iBAAiB,CAAC,IAAI,CAACwB,aAAa,CAE7C,EACA5H,EAAK0C,QAAQ,CAAG,WACd,OAAO,IAAI,CAACC,SAAS,AACvB,EACA3C,EAAKiI,QAAQ,CAAG,WACd,OAAO,IAAI,CAACnF,SAAS,AACvB,CACF,EAIAoF,kBAAmB,SAAUJ,CAAK,EAChC,IAAIK,EAAQL,EAAMM,iBAAiB,CAAC,SAClC3M,EAAQ0M,GAASA,EAAMrH,KAAK,CAAC,KAC7BuH,EAAgB5M,GAASA,EAAMoK,MAAM,CAAG,GAAKyC,SAAS7M,CAAK,CAAC,EAAE,CAAE,IAClE,OAAO4M,GAAiBA,EAAgB,CAC1C,EAOA5C,eAAgB,SAAU/H,CAAO,CAAE6K,CAAQ,EACzC7K,EAAQmB,aAAa,CAAGnB,EAAQmB,aAAa,EAAI,EACjD,IAQEiJ,EACAjE,EATEH,EAAO,IAAI,CACbpB,EAAO5E,EAAQyE,KAAK,CAAC,EAAE,CACvBqG,EAAKlG,EAAKC,IAAI,CACdkG,EAAK/K,EAAQmB,aAAa,CAC1B6J,EAAMhL,EAAQkB,YAAY,EAAI4J,EAC9BlL,EAAQ,IAAI,CAAC0D,UAAU,CACvBmG,EAAM3L,EAAE4L,QAAQ,GAChBV,EAAUS,EAAIT,OAAO,SAGvB,CACE,CACE,CAAA,IAAI,CAAC7E,YAAY,CAACnE,IAClBJ,GACCmL,CAAAA,GAAM,AAACjN,CAAAA,AAAgB,aAAhBA,EAAEG,IAAI,CAAC+M,GAAsBA,EAAIhL,GAAWgL,CAAE,EAAKF,CAAC,CAAC,IAE/D9K,EAAQsC,IAAI,KAIVuI,IAGAE,GAAMD,GACRlG,EAAKsE,KAAK,CAAGlJ,EAAQ0B,IAAI,CAAC,iBACnB,IAAI,CAAC4H,cAAc,CAAC,CAAA,EAAOtJ,EAAQ4B,OAAO,CAAE,CACjD,KACA,QACAgD,EAAKsE,KAAK,CACX,IAGH/C,EAAS,WAEP,IAAI8E,EAAInN,EAAEoH,MAAM,CAAC,CAAC,EAAGlF,GACnBkL,EAAgBD,EAAEhG,SAAS,CAACnB,MAAM,AACpCmH,CAAAA,EAAE/D,IAAI,CAAGtH,EAAM2F,IAAI,CACjBX,EACAmG,EACAA,EAAMjN,CAAAA,AAAgB,aAAhBA,EAAEG,IAAI,CAAC+M,GAAsBA,EAAIC,GAAKD,CAAE,EAC9CpG,EAAK3G,IAAI,EAIXgN,EAAEpF,SAAS,CAAGoF,EAAE/D,IAAI,CAACrC,IAAI,CAEzBoG,EAAEhE,YAAY,CACZ,SAAW8D,EAAK,IAAOA,CAAAA,EAAKE,EAAEpF,SAAS,CAAG,CAAA,EAAK,IAAMiF,EAEvD9E,EAAKxH,QAAQ,CAAC,kBAAmB,KAAMyM,GAEvCjF,EAAKe,YAAY,CAACkE,GAElBjF,EAAKD,qBAAqB,CAACkF,GAC3Bb,EAAQ,AACN,CAAA,AAAyC,CAAA,IAAxCpE,EAAKxH,QAAQ,CAAC,YAAa,KAAMyM,IAAgBnN,EAAEqN,IAAI,CAACF,IACzDjF,EAAKsD,cAAc,CAAC,CAAA,EAAO2B,EAAErJ,OAAO,CAAA,EAEnCc,IAAI,CAAC,SAAU0I,CAAM,CAAEC,CAAU,CAAEjB,CAAK,EACvCW,EAAK/E,EAAKwE,iBAAiB,CAACJ,IAAUW,EAAKE,EAAEpF,SAAS,CAIlDqF,EAAgBD,EAAEpF,SAAS,CAAGoF,EAAEhG,SAAS,CAACnB,MAAM,EAClDkC,EAAKR,WAAW,CACd1H,EAAEW,KAAK,CAAC,WAAY,CAClBgH,iBAAkB,CAAA,EAClB3B,OAAQiH,EAAKE,EAAE9J,aAAa,CAC5BuD,MAAOqG,EAAKE,EAAE9J,aAAa,AAC7B,GACA8J,GAGJjL,EAAQmB,aAAa,CAAG8J,EAAE9J,aAAa,CAAG4J,EAC1CE,EAAEG,MAAM,CAAGA,EACXH,EAAEI,UAAU,CAAGA,EACfJ,EAAEb,KAAK,CAAGA,EACVpE,EAAKxH,QAAQ,CAAC,YAAa,KAAMyM,GACjCjF,EAAKxH,QAAQ,CAAC,cAAe,KAAMyM,GAC/BF,EAAKD,EAGP3E,IAEAsD,EAAIE,WAAW,CAACsB,EAAErJ,OAAO,CAAE,CAACwJ,EAAQC,EAAYjB,EAAM,CAE1D,GACCjB,IAAI,CAAC,SAAUiB,CAAK,CAAEiB,CAAU,CAAElB,CAAW,EAC5Cc,EAAEb,KAAK,CAAGA,EACVa,EAAEI,UAAU,CAAGA,EACfJ,EAAEd,WAAW,CAAGA,EAChBnE,EAAKxH,QAAQ,CAAC,YAAa,KAAMyM,GACjCjF,EAAKxH,QAAQ,CAAC,cAAe,KAAMyM,GACnCxB,EAAIG,UAAU,CAACqB,EAAErJ,OAAO,CAAE,CAACwI,EAAOiB,EAAYlB,EAAY,CAC5D,GACCd,MAAM,CAAC,WACNrD,EAAKM,uBAAuB,CAAC2E,EAC/B,EACJ,EACA,IAAI,CAAClC,eAAe,CAACC,GACrBA,EAAQa,KAAK,CAAG,WACd,OAAOO,EAAMP,KAAK,EACpB,EACA1D,IACO6C,IACT,EAEAsC,YAAa,SAAUnN,CAAC,CAAEmE,CAAI,EACP,IAAjB,IAAI,CAACiJ,OAAO,GAId,IAAI,CAAC/M,QAAQ,CAAC,SAEd,IAAI,CAACsH,aAAa,CAAG,IAAI,IAAI,CAACrC,aAAa,CAE3C,IAAI,CAACwB,SAAS,CAACnB,MAAM,CAAG,IAAI,CAACmB,SAAS,CAACP,KAAK,CAAG,EAC/C,IAAI,CAACO,SAAS,CAAClB,OAAO,CAAG,GAK3B,IAAI,CAACoB,mBAAmB,CAAC7C,GACzB,IAAI,CAACwC,mBAAmB,CAACxC,GACzBA,EAAK2C,SAAS,CAACnB,MAAM,CAAGxB,EAAKwB,MAAM,CAAGxB,EAAKnB,aAAa,EAAI,EAC5DmB,EAAK2C,SAAS,CAACP,KAAK,CAAGpC,EAAKoC,KAAK,CAAG,IAAI,CAACF,SAAS,CAAClC,EAAKmC,KAAK,GAAK,EAClEnC,EAAK2C,SAAS,CAAClB,OAAO,CAAGzB,EAAKyB,OAAO,CAAG,EACxC,IAAI,CAACwH,OAAO,EAAI,EAEhB,IAAI,CAACtG,SAAS,CAACnB,MAAM,EAAIxB,EAAKwB,MAAM,CACpC,IAAI,CAACmB,SAAS,CAACP,KAAK,EAAIpC,EAAKoC,KAAK,AACpC,EAEA8G,QAAS,SAAUJ,CAAM,CAAEC,CAAU,CAAEjB,CAAK,CAAEpK,CAAO,EACnD,IAAI0E,EAAQ1E,EAAQiF,SAAS,CAACP,KAAK,CACjC6F,EAAWvK,EAAQoF,SAAS,AAC1BpF,CAAAA,EAAQiF,SAAS,CAACnB,MAAM,CAAGY,GAG7B,IAAI,CAACc,WAAW,CACd1H,EAAEW,KAAK,CAAC,WAAY,CAClBgH,iBAAkB,CAAA,EAClB3B,OAAQY,EACRA,MAAOA,CACT,GACA1E,GAGJuK,EAASa,MAAM,CAAGpL,EAAQoL,MAAM,CAAGA,EACnCb,EAASc,UAAU,CAAGrL,EAAQqL,UAAU,CAAGA,EAC3Cd,EAASH,KAAK,CAAGpK,EAAQoK,KAAK,CAAGA,EACjC,IAAI,CAAC5L,QAAQ,CAAC,OAAQ,KAAMwB,EAC9B,EAEAyL,QAAS,SAAUrB,CAAK,CAAEiB,CAAU,CAAElB,CAAW,CAAEnK,CAAO,EACxD,IAAIuK,EAAWvK,EAAQoF,SAAS,AAC5BpF,CAAAA,EAAQoB,mBAAmB,GAG7B,IAAI,CAAC6D,SAAS,CAACnB,MAAM,EAAI9D,EAAQiF,SAAS,CAACnB,MAAM,CACjD,IAAI,CAACmB,SAAS,CAACP,KAAK,EAAI1E,EAAQiF,SAAS,CAACP,KAAK,EAEjD6F,EAASH,KAAK,CAAGpK,EAAQoK,KAAK,CAAGA,EACjCG,EAASc,UAAU,CAAGrL,EAAQqL,UAAU,CAAGA,EAC3Cd,EAASJ,WAAW,CAAGnK,EAAQmK,WAAW,CAAGA,EAC7C,IAAI,CAAC3L,QAAQ,CAAC,OAAQ,KAAMwB,EAC9B,EAEA0L,UAAW,SAAUC,CAAa,CAAEN,CAAU,CAAEO,CAAY,CAAE5L,CAAO,EAGnE,IAAI,CAACxB,QAAQ,CAAC,SAAU,KAAMwB,EAChC,EAEAqK,QAAS,SAAUlM,CAAC,CAAEmE,CAAI,EACnBA,EAAKK,MAAM,EACd,IAAI,CAACmH,sBAAsB,CAAC3L,EAAGmE,GAEjC,IACE8H,EACAyB,EACAC,EACAC,EAJE/F,EAAO,IAAI,CAKbhG,EAAUgG,EAAKyC,gBAAgB,CAACnG,GAChC0J,EAAO,WAsDL,OArDAhG,EAAKiG,QAAQ,EAAI,EAEjBjM,EAAQ8F,aAAa,CAAG,IAAIE,EAAKvC,aAAa,CAC9C2G,EACEA,GACA,AACE,CAAA,AAAEyB,CAAAA,GACA7F,AAIM,CAAA,IAJNA,EAAKxH,QAAQ,CACX,OACAV,EAAEW,KAAK,CAAC,OAAQ,CAAEC,eAAgBP,CAAE,GACpC6B,EACQ,GACVgG,EAAKsD,cAAc,CAAC,CAAA,EAAOtJ,EAAQ4B,OAAO,CAAEiK,IAC9C7F,EAAK+B,cAAc,CAAC/H,IACpBlC,EAAEqN,IAAI,CAACnL,EAAO,EAEb0C,IAAI,CAAC,SAAU0I,CAAM,CAAEC,CAAU,CAAEjB,CAAK,EACvCpE,EAAKwF,OAAO,CAACJ,EAAQC,EAAYjB,EAAOpK,EAC1C,GACCmJ,IAAI,CAAC,SAAUiB,CAAK,CAAEiB,CAAU,CAAElB,CAAW,EAC5CnE,EAAKyF,OAAO,CAACrB,EAAOiB,EAAYlB,EAAanK,EAC/C,GACCqJ,MAAM,CAAC,SAAUsC,CAAa,CAAEN,CAAU,CAAEO,CAAY,EAUvD,GATA5F,EAAKM,uBAAuB,CAACtG,GAC7BgG,EAAK0F,SAAS,CACZC,EACAN,EACAO,EACA5L,GAEFgG,EAAKiG,QAAQ,EAAI,EACjBjG,EAAKuF,OAAO,EAAI,EAEdvL,EAAQY,sBAAsB,EAC9BZ,EAAQY,sBAAsB,CAAGoF,EAAKiG,QAAQ,CAK9C,IADA,IAAIC,EAAWlG,EAAKmG,MAAM,CAACC,KAAK,GACzBF,GAAU,CACf,GAAIlG,AAAqC,YAArCA,EAAK0C,iBAAiB,CAACwD,GAAyB,CAClDA,EAASG,OAAO,GAChB,KACF,CACAH,EAAWlG,EAAKmG,MAAM,CAACC,KAAK,EAC9B,CAEmB,IAAjBpG,EAAKuF,OAAO,EAGdvF,EAAKxH,QAAQ,CAAC,OAElB,EAEN,QAEF,CADA,IAAI,CAAC8M,WAAW,CAACnN,EAAG6B,GAElB,IAAI,CAACA,OAAO,CAACW,iBAAiB,EAC7B,IAAI,CAACX,OAAO,CAACY,sBAAsB,EAClC,IAAI,CAACZ,OAAO,CAACY,sBAAsB,EAAI,IAAI,CAACqL,QAAQ,GAElD,IAAI,CAACjM,OAAO,CAACY,sBAAsB,CAAG,GACxCkL,EAAOhO,EAAE4L,QAAQ,GACjB,IAAI,CAACyC,MAAM,CAAC5H,IAAI,CAACuH,GACjBC,EAAOD,CAAI,CAAC9F,EAAKhD,YAAY,CAAC,CAACgJ,KAE/B,IAAI,CAACM,SAAS,CAAG,IAAI,CAACA,SAAS,CAACtG,EAAKhD,YAAY,CAAC,CAACgJ,EAAMA,GACzDD,EAAO,IAAI,CAACO,SAAS,EAKvBP,EAAKlC,KAAK,CAAG,iBAEX,CADAgC,EAAU,CAACzL,KAAAA,EAAW,QAAS,QAAQ,CAClCgK,GAMEA,EAAMP,KAAK,IALZiC,GACFA,EAAKlC,UAAU,CAAC5J,EAAQ4B,OAAO,CAAEiK,GAE5BG,IAGX,EACO,IAAI,CAACjD,eAAe,CAACgD,IAEvBC,GACT,EAEAO,OAAQ,SAAUpO,CAAC,CAAEmE,CAAI,EACvB,IAUEkK,EACAC,EACAC,EACAxE,EAbElC,EAAO,IAAI,CACboF,EAAS,CAAA,EACTpL,EAAUlC,EAAEoH,MAAM,CAAC,CAAC,EAAG,IAAI,CAAClF,OAAO,CAAEsC,GACrCmC,EAAQnC,EAAKmC,KAAK,CAClBkI,EAAclI,EAAM0D,MAAM,CAC1ByE,EAAQ5M,EAAQQ,qBAAqB,CACrCqM,EAAY7M,EAAQS,wBAAwB,CAC5CqM,EAAW9M,EAAQU,gCAAgC,CACnDqM,EAAY,EACZzM,EAAY,IAAI,CAAC0H,aAAa,CAAChI,GAK/BgN,EAAI,EACN,GAAI,CAACL,EACH,MAAO,CAAA,EAKT,GAHIE,GAAapI,AAAkBrE,KAAAA,IAAlBqE,CAAK,CAAC,EAAE,CAACI,IAAI,EAC5BgI,CAAAA,EAAYzM,KAAAA,CAAQ,EAGpB,AAAEJ,CAAAA,EAAQO,iBAAiB,EAAIqM,GAASC,CAAQ,GAC/C,IAAI,CAAC1I,YAAY,CAACnE,IAId,GAAI,CAAEA,CAAAA,EAAQO,iBAAiB,EAAIsM,CAAQ,GAAMD,EAGtD,IAAK1E,EAAI,EAFTwE,EAAU,EAAE,CACZF,EAAe,EAAE,CACLtE,EAAIyE,EAAazE,GAAK0E,EAChCF,EAAQnI,IAAI,CAACE,EAAM7E,KAAK,CAACsI,EAAGA,EAAI0E,IAE3BH,AADLA,CAAAA,EAAiBnM,EAAUV,KAAK,CAACsI,EAAGA,EAAI0E,EAAK,EACzBzE,MAAM,EACxBsE,CAAAA,EAAiBnM,CAAQ,EAE3BkM,EAAajI,IAAI,CAACkI,QAEf,GAAI,CAACzM,EAAQO,iBAAiB,EAAIsM,EAGvC,IAAK3E,EAAI,EAFTwE,EAAU,EAAE,CACZF,EAAe,EAAE,CACLtE,EAAIyE,EAAazE,GAAQ,EACnC6E,GAAatI,CAAK,CAACyD,EAAE,CAACrD,IAAI,CAAGiI,EAE3B5E,CAAAA,EAAI,IAAMyE,GACVI,EAAYtI,CAAK,CAACyD,EAAI,EAAE,CAACrD,IAAI,CAAGiI,EAAWD,GAC1CD,GAAS1E,EAAI,EAAI8E,GAAKJ,CAAK,IAE5BF,EAAQnI,IAAI,CAACE,EAAM7E,KAAK,CAACoN,EAAG9E,EAAI,IAE3BuE,AADLA,CAAAA,EAAiBnM,EAAUV,KAAK,CAACoN,EAAG9E,EAAI,EAAC,EACrBC,MAAM,EACxBsE,CAAAA,EAAiBnM,CAAQ,EAE3BkM,EAAajI,IAAI,CAACkI,GAClBO,EAAI9E,EAAI,EACR6E,EAAY,QAIhBP,EAAelM,OAlCfoM,EAAU,CAACjI,EAAM,CACjB+H,EAAe,CAAClM,EAAU,CAkD5B,OAfAgC,EAAK2K,aAAa,CAAGxI,EACrB3G,EAAEgE,IAAI,CAAC4K,GAAWjI,EAAO,SAAUE,CAAK,CAAEuI,CAAO,EAC/C,IAAIC,EAAUrP,EAAEoH,MAAM,CAAC,CAAC,EAAG5C,GAW3B,OAVA6K,EAAQ1I,KAAK,CAAGiI,EAAUQ,EAAU,CAACA,EAAQ,CAC7CC,EAAQ7M,SAAS,CAAGkM,CAAY,CAAC7H,EAAM,CACvCqB,EAAKb,mBAAmB,CAACgI,GACzBnH,EAAKlB,mBAAmB,CAACqI,GACzBnH,EAAK8D,sBAAsB,CAAC3L,EAAGgP,GAC/B/B,EAASpF,EAAKxH,QAAQ,CACpB,MACAV,EAAEW,KAAK,CAAC,MAAO,CAAEC,eAAgBP,CAAE,GACnCgP,EAGJ,GACO/B,CACT,EAEAgC,kBAAmB,SAAU9K,CAAI,EAC/B,IAAI2F,EAAQ3F,EAAKxD,SAAS,CACxBuO,EAAapF,EAAMqF,KAAK,CAAC,CAAA,GACzBC,EAAetF,EAAMuF,EAAE,CAACtN,SAASuN,aAAa,CAEhDnL,CAAAA,EAAKoL,cAAc,CAAGL,EACtBvP,EAAE,iBAAiBwJ,MAAM,CAAC+F,EAAW,CAAC,EAAE,CAACM,KAAK,GAG9C1F,EAAM2F,KAAK,CAACP,GAAYQ,MAAM,GAG1BN,GACFF,EAAWS,OAAO,CAAC,SAGrBhQ,EAAEiQ,SAAS,CAAC9F,EAAM1B,GAAG,CAAC,WAItB,IAAI,CAACvG,OAAO,CAAClB,SAAS,CAAG,IAAI,CAACkB,OAAO,CAAClB,SAAS,CAAC4H,GAAG,CAAC,SAAUwB,CAAC,CAAE8F,CAAE,SACjE,AAAIA,IAAO/F,CAAK,CAAC,EAAE,CACVoF,CAAU,CAAC,EAAE,CAEfW,CACT,GAGI/F,CAAK,CAAC,EAAE,GAAK,IAAI,CAACiF,OAAO,CAAC,EAAE,EAC9B,CAAA,IAAI,CAACA,OAAO,CAAGG,CAAS,CAE5B,EAEAY,qBAAsB,SAAUC,CAAK,CAAEC,CAAI,EACzC,IAGEC,EAHEpI,EAAO,IAAI,CACbyD,EAAM3L,EAAE4L,QAAQ,GAChB2E,EAAU,EAAE,CAEZC,EAAe,SAAUnQ,CAAC,EACpBA,GAAK,CAACA,EAAE+P,KAAK,EACf/P,CAAAA,EAAE+P,KAAK,CAAGA,CAAI,EAMhBzE,EAAI4C,OAAO,CAAC,CAAClO,EAAE,CACjB,EACAoQ,EAAiB,SAAUF,CAAO,EAChCrI,EACGwI,sBAAsB,CAACH,EAASF,EAAOD,EAAM5J,IAAI,CAAG,KACpD5B,IAAI,CAAC,SAAU+B,CAAK,EACnBgF,EAAI4C,OAAO,CAAC5H,EACd,GACC0E,IAAI,CAACmF,EACV,EACAG,EAAc,WACZL,EAAUK,WAAW,CAAC,SAAUC,CAAO,EAChCA,EAAQvG,MAAM,EAGjBkG,EAAUA,EAAQM,MAAM,CAACD,GACzBD,KAHAF,EAAeF,EAKnB,EAAGC,EACL,EAsBF,OApBAH,EAAOA,GAAQ,GACXD,EAAMU,MAAM,CACVV,EAAMW,KAAK,EAEbX,EAAMW,KAAK,CAACC,YAAY,CAAGX,EAC3B1E,EAAI4C,OAAO,CAAC6B,EAAMW,KAAK,GAEvBX,EAAMtJ,IAAI,CAAC,SAAUA,CAAI,EACvBA,EAAKkK,YAAY,CAAGX,EACpB1E,EAAI4C,OAAO,CAACzH,EACd,EAAG0J,GAEIJ,EAAMa,WAAW,EAC1BX,EAAYF,EAAMc,YAAY,GAC9BP,KAIAhF,EAAI4C,OAAO,CAAC,EAAE,EAET5C,EAAIT,OAAO,EACpB,EAEAwF,uBAAwB,SAAUH,CAAO,CAAEF,CAAI,EAC7C,IAAInI,EAAO,IAAI,CACf,OAAOlI,EAAEmR,IAAI,CACV1L,KAAK,CACJzF,EACAA,EAAE4I,GAAG,CAAC2H,EAAS,SAAUH,CAAK,EAC5B,OAAOlI,EAAKiI,oBAAoB,CAACC,EAAOC,EAC1C,GAEF,CAAC,IAAI,CAACnL,YAAY,CAAC,CAAC,WAClB,OAAOkM,MAAMvP,SAAS,CAACgP,MAAM,CAACpL,KAAK,CAAC,EAAE,CAAEC,UAC1C,EACJ,EAEA2L,iBAAkB,SAAU/Q,CAAY,EAGtC,IAAIgR,EAAQhR,AADZA,CAAAA,EAAeA,GAAgB,CAAC,CAAA,EACPgR,KAAK,QAC9B,AACEA,GACAA,EAAMjH,MAAM,EACXiH,CAAAA,CAAK,CAAC,EAAE,CAACC,gBAAgB,EAAID,CAAK,CAAC,EAAE,CAACE,UAAU,AAAD,EAEzC,IAAI,CAACd,sBAAsB,CAChC1Q,EAAE4I,GAAG,CAAC0I,EAAO,SAAUG,CAAI,EACzB,IAAIrB,SACJ,AAAIqB,EAAKF,gBAAgB,EACvBnB,CAAAA,EAAQqB,EAAKF,gBAAgB,EAAC,GAG5BnB,CAAAA,EAAMW,KAAK,CAAGU,EAAKC,SAAS,EAAC,EAExBtB,GAEFqB,EAAKD,UAAU,EACxB,IAGGxR,EAAE4L,QAAQ,GAAG2C,OAAO,CAACvO,EAAE2R,SAAS,CAACrR,EAAaqG,KAAK,GAAGuE,OAAO,EACtE,EAEA0G,yBAA0B,SAAU5Q,CAAS,EAG3C,IACE2F,EACAzC,EAFEqM,EAAUvP,AADdA,CAAAA,EAAYhB,EAAEgB,EAAS,EACCK,IAAI,CAAC,WAG7B,GAAIkP,GAAWA,EAAQlG,MAAM,CAC3B,OAAO,IAAI,CAACqG,sBAAsB,CAACH,GAGrC,GAAK5J,AADLA,CAAAA,EAAQ3G,EAAE2R,SAAS,CAAC3Q,EAAUK,IAAI,CAAC,SAAQ,EAChCgJ,MAAM,CASY/H,KAAAA,IAAlBqE,CAAK,CAAC,EAAE,CAACH,IAAI,EAAkBG,CAAK,CAAC,EAAE,CAAC8C,QAAQ,EAEzDzJ,EAAEgE,IAAI,CAAC2C,EAAO,SAAUE,CAAK,CAAEC,CAAI,EACjCA,EAAKN,IAAI,CAAGM,EAAK2C,QAAQ,CACzB3C,EAAKC,IAAI,CAAGD,EAAK+K,QAAQ,AAC3B,OAdiB,CAEjB,GAAI,CADJ3N,CAAAA,EAAQlD,EAAUK,IAAI,CAAC,QAAO,EAE5B,OAAOrB,EAAE4L,QAAQ,GAAG2C,OAAO,CAAC,EAAE,EAAErD,OAAO,GAKzCvE,EAAQ,CAAC,CAAEH,KAAMtC,EAAMC,OAAO,CAAC,QAAS,GAAI,EAAE,AAChD,CAOA,OAAOnE,EAAE4L,QAAQ,GAAG2C,OAAO,CAAC5H,GAAOuE,OAAO,EAC5C,EAEA4G,mBAAoB,SAAU9Q,CAAS,SACrC,AAAI,AAAEA,aAAqBhB,GAAMgB,AAAqB,IAArBA,EAAUqJ,MAAM,CAG1CrK,EAAEmR,IAAI,CACV1L,KAAK,CAACzF,EAAGA,EAAE4I,GAAG,CAAC5H,EAAW,IAAI,CAAC4Q,wBAAwB,EACxD,CAAC,IAAI,CAAC1M,YAAY,CAAC,CAAC,WAClB,OAAOkM,MAAMvP,SAAS,CAACgP,MAAM,CAACpL,KAAK,CAAC,EAAE,CAAEC,UAC1C,GANO,IAAI,CAACkM,wBAAwB,CAAC5Q,EAOzC,EAEA+Q,UAAW,SAAU1R,CAAC,EACpB,IAAI6H,EAAO,IAAI,CACb1D,EAAO,CACLxD,UAAWhB,EAAEK,EAAE2R,MAAM,EACrB3N,KAAMrE,EAAEK,EAAE2R,MAAM,CAAC3N,IAAI,CACvB,EACF,IAAI,CAACyN,kBAAkB,CAACtN,EAAKxD,SAAS,EAAEuK,MAAM,CAAC,SAAU5E,CAAK,EAC5DnC,EAAKmC,KAAK,CAAGA,EACTuB,EAAKhG,OAAO,CAACK,gBAAgB,EAC/B2F,EAAKoH,iBAAiB,CAAC9K,GAOjB,CAAA,IAJN0D,EAAKxH,QAAQ,CACX,SACAV,EAAEW,KAAK,CAAC,SAAU,CAAEC,eAAgBP,CAAE,GACtCmE,IAGF0D,EAAKuG,MAAM,CAACpO,EAAGmE,EAEnB,EACF,EAEAyN,SAAU,SAAU5R,CAAC,EACnB,IAAIiR,EACAjR,EAAEE,aAAa,EACfF,EAAEE,aAAa,CAAC2R,aAAa,EAC7B7R,EAAEE,aAAa,CAAC2R,aAAa,CAACZ,KAAK,CACrC9M,EAAO,CAAEmC,MAAO,EAAE,AAAC,EACjB2K,GAASA,EAAMjH,MAAM,GACvBrK,EAAEgE,IAAI,CAACsN,EAAO,SAAUzK,CAAK,CAAE4K,CAAI,EACjC,IAAI3K,EAAO2K,EAAKC,SAAS,EAAID,EAAKC,SAAS,GACvC5K,GACFtC,EAAKmC,KAAK,CAACF,IAAI,CAACK,EAEpB,GAMQ,CAAA,IAJN,IAAI,CAACpG,QAAQ,CACX,QACAV,EAAEW,KAAK,CAAC,QAAS,CAAEC,eAAgBP,CAAE,GACrCmE,IAGF,IAAI,CAACiK,MAAM,CAACpO,EAAGmE,GAGrB,EAEA2N,QAAS,SAAU9R,CAAC,EAClBA,EAAEC,YAAY,CAAGD,EAAEE,aAAa,EAAIF,EAAEE,aAAa,CAACD,YAAY,CAChE,IAAI4H,EAAO,IAAI,CACb5H,EAAeD,EAAEC,YAAY,CAC7BkE,EAAO,CAAC,EACNlE,GAAgBA,EAAaqG,KAAK,EAAIrG,EAAaqG,KAAK,CAAC0D,MAAM,GACjEhK,EAAEQ,cAAc,GAChB,IAAI,CAACwQ,gBAAgB,CAAC/Q,GAAciL,MAAM,CAAC,SAAU5E,CAAK,EACxDnC,EAAKmC,KAAK,CAAGA,EAML,CAAA,IAJNuB,EAAKxH,QAAQ,CACX,OACAV,EAAEW,KAAK,CAAC,OAAQ,CAAEC,eAAgBP,CAAE,GACpCmE,IAGF0D,EAAKuG,MAAM,CAACpO,EAAGmE,EAEnB,GAEJ,EAEA4N,YAAalS,EAAe,YAE5BmS,aAAcnS,EAAe,aAE7BoS,aAAcpS,EAAe,aAE7BqS,mBAAoB,WACd,IAAI,CAAClM,YAAY,CAAC,IAAI,CAACnE,OAAO,IAChC,IAAI,CAACsQ,GAAG,CAAC,IAAI,CAACtQ,OAAO,CAACC,QAAQ,CAAE,CAC9BsQ,SAAU,IAAI,CAACL,WAAW,CAC1BM,KAAM,IAAI,CAACP,OAAO,CAElBQ,UAAW,IAAI,CAACN,YAAY,CAE5BO,UAAW,IAAI,CAACN,YAAY,AAC9B,GACA,IAAI,CAACE,GAAG,CAAC,IAAI,CAACtQ,OAAO,CAACG,SAAS,CAAE,CAC/BwQ,MAAO,IAAI,CAACZ,QAAQ,AACtB,IAEEjS,EAAEe,OAAO,CAACC,SAAS,EACrB,IAAI,CAACwR,GAAG,CAAC,IAAI,CAACtQ,OAAO,CAAClB,SAAS,CAAE,CAC/B8R,OAAQ,IAAI,CAACf,SAAS,AACxB,EAEJ,EAEAgB,sBAAuB,WACrB,IAAI,CAACC,IAAI,CAAC,IAAI,CAAC9Q,OAAO,CAACC,QAAQ,CAAE,qCACjC,IAAI,CAAC6Q,IAAI,CAAC,IAAI,CAAC9Q,OAAO,CAACG,SAAS,CAAE,SAClC,IAAI,CAAC2Q,IAAI,CAAC,IAAI,CAAC9Q,OAAO,CAAClB,SAAS,CAAE,SACpC,EAEAiS,SAAU,WACR,IAAI,CAACF,qBAAqB,EAC5B,EAEAG,WAAY,SAAUjP,CAAG,CAAEC,CAAK,EAC9B,IAAIiP,EAASnT,AAAyC,KAAzCA,EAAEQ,OAAO,CAACyD,EAAK,IAAI,CAACsB,eAAe,EAC5C4N,GACF,IAAI,CAACJ,qBAAqB,GAE5B,IAAI,CAACK,MAAM,CAACnP,EAAKC,GACbiP,IACF,IAAI,CAACE,mBAAmB,GACxB,IAAI,CAACd,kBAAkB,GAE3B,EAEAc,oBAAqB,WACnB,IAAInR,EAAU,IAAI,CAACA,OAAO,AACtBA,AAAsBI,MAAAA,IAAtBJ,EAAQlB,SAAS,CACnBkB,EAAQlB,SAAS,CAAG,IAAI,CAACoO,OAAO,CAACM,EAAE,CAAC,sBAChC,IAAI,CAACN,OAAO,CACZ,IAAI,CAACA,OAAO,CAACkE,IAAI,CAAC,sBACXpR,EAAQlB,SAAS,YAAYhB,GACxCkC,CAAAA,EAAQlB,SAAS,CAAGhB,EAAEkC,EAAQlB,SAAS,CAAA,EAEnCkB,EAAQC,QAAQ,YAAYnC,GAChCkC,CAAAA,EAAQC,QAAQ,CAAGnC,EAAEkC,EAAQC,QAAQ,CAAA,EAEjCD,EAAQG,SAAS,YAAYrC,GACjCkC,CAAAA,EAAQG,SAAS,CAAGrC,EAAEkC,EAAQG,SAAS,CAAA,CAE3C,EAEAkR,WAAY,SAAUC,CAAG,EACvB,IAAIvT,EAAQuT,EAAIlO,KAAK,CAAC,KACpBmO,EAAYxT,EAAMyT,GAAG,GAEvB,OADAzT,EAAMqO,KAAK,GACJ,IAAIrN,OAAOhB,EAAM0T,IAAI,CAAC,KAAMF,EACrC,EAEAG,gBAAiB,SAAU3P,CAAG,CAAEC,CAAK,EACnC,MACED,AAAQ,QAARA,GACAjE,AAAkB,WAAlBA,EAAEG,IAAI,CAAC+D,IACP,qBAAqBhD,IAAI,CAACgD,EAE9B,EAEA2P,oBAAqB,WACnB,IAAI3L,EAAO,IAAI,CACbhG,EAAU,IAAI,CAACA,OAAO,CACtBsC,EAAO,IAAI,CAAC4K,OAAO,CAAC5K,IAAI,GAE1BxE,EAAEgE,IAAI,CAAC,IAAI,CAACoL,OAAO,CAAC,EAAE,CAAC0E,UAAU,CAAE,SAAUjN,CAAK,CAAE6D,CAAI,EACtD,IACExG,EADED,EAAMyG,EAAKlE,IAAI,CAACuN,WAAW,GAE3B,SAAS7S,IAAI,CAAC+C,KAKhBC,EAAQM,CAAI,CAHZP,EAAMA,EAAInC,KAAK,CAAC,GAAGqC,OAAO,CAAC,UAAW,SAAUqP,CAAG,EACjD,OAAOA,EAAIQ,MAAM,CAAC,GAAGxJ,WAAW,EAClC,GACiB,CACbtC,EAAK0L,eAAe,CAAC3P,EAAKC,IAC5BA,CAAAA,EAAQgE,EAAKqL,UAAU,CAACrP,EAAK,EAE/BhC,CAAO,CAAC+B,EAAI,CAAGC,EAEnB,EACF,EAEA+P,QAAS,WACP,IAAI,CAACJ,mBAAmB,GACxB,IAAI,CAACR,mBAAmB,GACxB,IAAI,CAAChF,MAAM,CAAG,EAAE,CAChB,IAAI,CAACG,SAAS,CAAG,IAAI,CAAChD,cAAc,CAAC,CAAA,GACrC,IAAI,CAAC2C,QAAQ,CAAG,IAAI,CAACV,OAAO,CAAG,EAC/B,IAAI,CAACzG,mBAAmB,CAAC,IAAI,EAC7B,IAAI,CAACuL,kBAAkB,EACzB,EAIA2B,OAAQ,WACN,OAAO,IAAI,CAACzG,OAAO,AACrB,EAMAvG,SAAU,WACR,OAAO,IAAI,CAACC,SAAS,AACvB,EAMA5C,IAAK,SAAUC,CAAI,EACjB,IAAI0D,EAAO,IAAI,CACV1D,IAAQ,IAAI,CAACtC,OAAO,CAACiS,QAAQ,GAG9B3P,EAAKxD,SAAS,EAAI,CAACwD,EAAKmC,KAAK,CAC/B,IAAI,CAACmL,kBAAkB,CAACtN,EAAKxD,SAAS,EAAEuK,MAAM,CAAC,SAAU5E,CAAK,EAC5DnC,EAAKmC,KAAK,CAAGA,EACbuB,EAAKuG,MAAM,CAAC,KAAMjK,EACpB,IAEAA,EAAKmC,KAAK,CAAG3G,EAAE2R,SAAS,CAACnN,EAAKmC,KAAK,EACnC,IAAI,CAAC8H,MAAM,CAAC,KAAMjK,IAEtB,EAOA0J,KAAM,SAAU1J,CAAI,EAClB,GAAIA,GAAQ,CAAC,IAAI,CAACtC,OAAO,CAACiS,QAAQ,CAAE,CAClC,GAAI3P,EAAKxD,SAAS,EAAI,CAACwD,EAAKmC,KAAK,CAAE,CACjC,IAGE2F,EACAyB,EAJE7F,EAAO,IAAI,CACbyD,EAAM3L,EAAE4L,QAAQ,GAChBV,EAAUS,EAAIT,OAAO,GA8BvB,OA3BAA,EAAQa,KAAK,CAAG,iBAEd,CADAgC,EAAU,CAAA,EACNzB,GACKA,EAAMP,KAAK,IAEpBJ,EAAIyI,MAAM,CAAC,KAAM,QAAS,SACnBlJ,EACT,EACA,IAAI,CAAC4G,kBAAkB,CAACtN,EAAKxD,SAAS,EAAEuK,MAAM,CAAC,SAAU5E,CAAK,EAC5D,IAAIoH,GAGJ,GAAI,CAACpH,EAAM0D,MAAM,CAAE,CACjBsB,EAAIyI,MAAM,GACV,MACF,CACA5P,EAAKmC,KAAK,CAAGA,EAEb2F,AADAA,CAAAA,EAAQpE,EAAKqE,OAAO,CAAC,KAAM/H,EAAI,EACzB6P,IAAI,CACR,SAAU/G,CAAM,CAAEC,CAAU,CAAEjB,CAAK,EACjCX,EAAI4C,OAAO,CAACjB,EAAQC,EAAYjB,EAClC,EACA,SAAUA,CAAK,CAAEiB,CAAU,CAAElB,CAAW,EACtCV,EAAIyI,MAAM,CAAC9H,EAAOiB,EAAYlB,EAChC,GAEJ,GACO,IAAI,CAACpB,eAAe,CAACC,EAC9B,CAEA,GADA1G,EAAKmC,KAAK,CAAG3G,EAAE2R,SAAS,CAACnN,EAAKmC,KAAK,EAC/BnC,EAAKmC,KAAK,CAAC0D,MAAM,CACnB,OAAO,IAAI,CAACkC,OAAO,CAAC,KAAM/H,EAE9B,CACA,OAAO,IAAI,CAACgH,cAAc,CAAC,CAAA,EAAOhH,GAAQA,EAAKV,OAAO,CACxD,CACF,EACF"}
