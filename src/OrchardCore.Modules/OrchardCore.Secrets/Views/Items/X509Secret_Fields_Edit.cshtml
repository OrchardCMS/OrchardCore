@model OrchardCore.Secrets.ViewModels.X509SecretViewModel

<div class="mb-3">
    <label class="form-label">@T["Select Certificate"]</label>
    
    @if (Model.AvailableCertificates.Count == 0)
    {
        <div class="alert alert-warning">
            @T["No certificates with private keys were found in the certificate stores."]
        </div>
    }
    else
    {
        <table class="table table-sm table-hover">
            <thead>
                <tr>
                    <th></th>
                    <th>@T["Subject"]</th>
                    <th>@T["Issuer"]</th>
                    <th>@T["Valid From"]</th>
                    <th>@T["Valid To"]</th>
                    <th>@T["Location"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var cert in Model.AvailableCertificates)
                {
                    var isSelected = string.Equals(cert.Thumbprint, Model.Thumbprint, StringComparison.OrdinalIgnoreCase);
                    var isExpired = cert.NotAfter < DateTime.UtcNow;
                    var rowClass = isExpired ? "table-danger" : (isSelected ? "table-primary" : "");
                    
                    <tr class="@rowClass">
                        <td>
                            <input type="radio" 
                                   name="@Html.NameFor(m => m.Thumbprint)" 
                                   value="@cert.Thumbprint"
                                   checked="@isSelected"
                                   class="form-check-input" />
                            <input type="hidden" name="@Html.NameFor(m => m.StoreLocation)" value="@cert.StoreLocation" />
                            <input type="hidden" name="@Html.NameFor(m => m.StoreName)" value="@cert.StoreName" />
                        </td>
                        <td>
                            @cert.Subject
                            @if (!string.IsNullOrEmpty(cert.FriendlyName))
                            {
                                <br /><small class="text-muted">@cert.FriendlyName</small>
                            }
                        </td>
                        <td>@cert.Issuer</td>
                        <td>@cert.NotBefore.ToShortDateString()</td>
                        <td>
                            @cert.NotAfter.ToShortDateString()
                            @if (isExpired)
                            {
                                <span class="badge text-bg-danger">@T["Expired"]</span>
                            }
                        </td>
                        <td>
                            <small>@cert.StoreLocation / @cert.StoreName</small>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <span class="hint">@T["Select a certificate from the available certificates in the system certificate stores."]</span>
    }
</div>
