function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var initialized,mediaApp;!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var n="dragover"===t;return function(i){i.dataTransfer=i.originalEvent&&i.originalEvent.dataTransfer;var a=i.dataTransfer;a&&-1!==e.inArray("Files",a.types)&&!1!==this._trigger(t,e.Event(t,{delegatedEvent:i}))&&(i.preventDefault(),n&&(a.dropEffect="copy"))}}var n;e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file"/>').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,uniqueFilenames:void 0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||!1!==n.autoUpload&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_promisePipe:(n=e.fn.jquery.split("."),Number(n[0])>1||Number(n[1])>7?"then":"pipe"),_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)Object.prototype.hasOwnProperty.call(e._response,t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var i,a=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&a-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=a,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(a,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(a,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&(e(i.upload).on("progress",function(e){var i=e.originalEvent;e.lengthComputable=i.lengthComputable,e.loaded=i.loaded,e.total=i.total,n._onProgress(e,t)}),t.xhr=function(){return i})},_deinitProgressListener:function(t){var n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&e(n.upload).off("progress")},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_getUniqueFilename:function(e,t){return t[e=String(e)]?(e=e.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,function(e,t,n){return" ("+(t?Number(t)+1:1)+")"+(n||"")}),this._getUniqueFilename(e,t)):(t[e]=!0,e)},_initXHRData:function(t){var n,i=this,a=t.files[0],r=t.multipart||!e.support.xhrFileUpload,o="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",a)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(a.uploadName||a.name)+'"'),r?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:o,value:t.blob}):e.each(t.files,function(i,a){n.push({name:"array"===e.type(t.paramName)&&t.paramName[i]||o,value:a})})):(i._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(o,t.blob,a.uploadName||a.name):e.each(t.files,function(a,r){if(i._isInstanceOf("File",r)||i._isInstanceOf("Blob",r)){var s=r.uploadName||r.name;t.uniqueFilenames&&(s=i._getUniqueFilename(s,t.uniqueFilenames)),n.append("array"===e.type(t.paramName)&&t.paramName[a]||o,r,s)}})),t.data=n):(t.contentType=a.type||"application/octet-stream",t.data=t.blob||a),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),i=t.paramName;return i?e.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",a=(t.prop("files")||[1]).length;a;)i.push(n),a-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,i){var a=e.Deferred(),r=a.promise();return n=n||this.options.context||r,!0===t?a.resolveWith(n,i):!1===t&&a.rejectWith(n,i),r.abort=a.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,n){var i=this,a=function(t){return e.Deferred().resolveWith(i,t).promise()};n.process=function(t,r){return(t||r)&&(n._processQueue=this._processQueue=(this._processQueue||a([this]))[i._promisePipe](function(){return n.errorThrown?e.Deferred().rejectWith(i,[n]).promise():a(arguments)})[i._promisePipe](t,r)),this._processQueue||a([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=!1!==i._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)&&i._onSend(t,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),i=n&&n.length>1&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var i,a,r=this,o=t.files[0],s=o.size,l=t.uploadedBytes,d=t.maxChunkSize||s,c=this._blobSlice,u=e.Deferred(),m=u.promise();return!(!(this._isXHRUpload(t)&&c&&(l||("function"===e.type(d)?d(t):d)<s))||t.data)&&(!!n||(l>=s?(o.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",o.error])):(a=function(){var n=e.extend({},t),m=n._progress.loaded;n.blob=c.call(o,l,l+("function"===e.type(d)?d(n):d),o.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+s,r._trigger("chunkbeforesend",null,n),r._initXHRData(n),r._initProgressListener(n),i=(!1!==r._trigger("chunksend",null,n)&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,o,d){l=r._getUploadedBytes(d)||l+n.chunkSize,m+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=l,n.result=i,n.textStatus=o,n.jqXHR=d,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),l<s?a():u.resolveWith(n.context,[i,o,d])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),u.rejectWith(n.context,[e,t,i])}).always(function(){r._deinitProgressListener(n)})},this._enhancePromise(m),m.abort=function(){return i.abort()},a(),m)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,i,a){var r=a._progress.total,o=a._response;a._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),a),o.result=a.result=t,o.textStatus=a.textStatus=n,o.jqXHR=a.jqXHR=i,this._trigger("done",null,a)},_onFail:function(e,t,n,i){var a=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),a.jqXHR=i.jqXHR=e,a.textStatus=i.textStatus=t,a.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(e,t,n,i){this._trigger("always",null,i)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var i,a,r,o,s=this,l=s._getAJAXSettings(n),d=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,i=i||((a||!1===s._trigger("send",e.Event("send",{delegatedEvent:t}),l))&&s._getXHRPromise(!1,l.context,a)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,n){s._onDone(e,t,n,l)}).fail(function(e,t,n){s._onFail(e,t,n,l)}).always(function(e,t,n){if(s._deinitProgressListener(l),s._onAlways(e,t,n,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var i=s._slots.shift();i;){if("pending"===s._getDeferredState(i)){i.resolve();break}i=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),o=r[s._promisePipe](d)):(this._sequence=this._sequence[s._promisePipe](d,d),o=this._sequence),o.abort=function(){return a=[void 0,"abort","abort"],i?i.abort():(r&&r.rejectWith(l.context,a),d())},this._enhancePromise(o)):d()},_onAdd:function(t,n){var i,a,r,o,s=this,l=!0,d=e.extend({},this.options,n),c=n.files,u=c.length,m=d.limitMultiFileUploads,f=d.limitMultiFileUploadSize,p=d.limitMultiFileUploadSizeOverhead,h=0,g=this._getParamName(d),v=0;if(!u)return!1;if(f&&void 0===c[0].size&&(f=void 0),(d.singleFileUploads||m||f)&&this._isXHRUpload(d))if(d.singleFileUploads||f||!m)if(!d.singleFileUploads&&f)for(r=[],i=[],o=0;o<u;o+=1)h+=c[o].size+p,(o+1===u||h+c[o+1].size+p>f||m&&o+1-v>=m)&&(r.push(c.slice(v,o+1)),(a=g.slice(v,o+1)).length||(a=g),i.push(a),v=o+1,h=0);else i=g;else for(r=[],i=[],o=0;o<u;o+=m)r.push(c.slice(o,o+m)),(a=g.slice(o,o+m)).length||(a=g),i.push(a);else r=[c],i=[g];return n.originalFiles=c,e.each(r||c,function(a,o){var d=e.extend({},n);return d.files=r?o:[o],d.paramName=i[a],s._initResponseObject(d),s._initProgressObject(d),s._addConvenienceMethods(t,d),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),d)}),l},_replaceFileInput:function(t){var n=t.fileInput,i=n.clone(!0),a=n.is(document.activeElement);t.fileInputClone=i,e("<form></form>").append(i)[0].reset(),n.after(i).detach(),a&&i.trigger("focus"),e.cleanData(n.off("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?i[0]:t}),n[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,n){var i,a=this,r=e.Deferred(),o=[],s=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},l=function(){i.readEntries(function(e){e.length?(o=o.concat(e),l()):function(e){a._handleFileTreeEntries(e,n+t.name+"/").done(function(e){r.resolve(e)}).fail(s)}(o)},s)};return n=n||"",t.isFile?t._file?(t._file.relativePath=n,r.resolve(t._file)):t.file(function(e){e.relativePath=n,r.resolve(e)},s):t.isDirectory?(i=t.createReader(),l()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,n){var i=this;return e.when.apply(e,e.map(t,function(e){return i._handleFileTreeEntry(e,n)}))[this._promisePipe](function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){var n=(t=t||{}).items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){var n,i,a=(t=e(t)).prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);if((n=e.makeArray(t.prop("files"))).length)void 0===n[0].name&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=t.prop("value")))return e.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles))[this._promisePipe](function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,i={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(a){i.files=a,n.options.replaceFileInput&&n._replaceFileInput(i),!1!==n._trigger("change",e.Event("change",{delegatedEvent:t}),i)&&n._onAdd(t,i)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,i={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:t}),i)&&this._onAdd(t,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,i=t.dataTransfer,a={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){a.files=i,!1!==n._trigger("drop",e.Event("drop",{delegatedEvent:t}),a)&&n._onAdd(t,a)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,n){var i=-1!==e.inArray(t,this._specialOptions);i&&this._destroyEventHandlers(),this._super(t,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return"url"!==t&&"string"===e.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,i=this.element.data();e.each(this.element[0].attributes,function(e,a){var r,o=a.name.toLowerCase();/^data-/.test(o)&&(o=o.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),r=i[o],t._isRegExpOption(o,r)&&(r=t._getRegExp(r)),n[o]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,a=this,r=e.Deferred(),o=r.promise();return o.abort=function(){return i=!0,n?n.abort():(r.reject(null,"abort","abort"),o)},this._getFileInputFiles(t.fileInput).always(function(e){i||(e.length?(t.files=e,(n=a._onSend(null,t)).then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})):r.reject())}),this._enhancePromise(o)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery")):e(window.jQuery)}(function(e){"use strict";var t=0,n=e,i="parseJSON";"JSON"in window&&"parse"in JSON&&(n=JSON,i="parse"),e.ajaxTransport("iframe",function(n){if(n.async){var i,a,r,o=n.initialIframeSrc||"javascript:false;";return{send:function(s,l){(i=e('<form style="display:none;"></form>')).attr("accept-charset",n.formAcceptCharset),r=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+r+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+r+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+r+"_method=PATCH",n.type="POST"),a=e('<iframe src="'+o+'" name="iframe-transport-'+(t+=1)+'"></iframe>').on("load",function(){var t,r=e.isArray(n.paramName)?n.paramName:[n.paramName];a.off("load").on("load",function(){var t;try{if(!(t=a.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}l(200,"success",{iframe:t}),e('<iframe src="'+o+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",a.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",r[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),window.setTimeout(function(){i.submit(),t&&t.length&&n.fileInput.each(function(n,i){var a=e(t[n]);e(i).prop("name",a.prop("name")).attr("form",a.attr("form")),a.replaceWith(i)})},0)}),i.append(a).appendTo(document.body)},abort:function(){a&&a.off("load").prop("src",o),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&n[i](e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})});var EventBus=function(){return _createClass(function e(){_classCallCheck(this,e),this.events={}},[{key:"$on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"$emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.events[e]&&this.events[e].forEach(function(e){return e.apply(void 0,n)})}},{key:"$off",value:function(e,t){this.events[e]&&(t?this.events[e]=this.events[e].filter(function(e){return e!==t}):delete this.events[e])}}])}(),bus=new EventBus;function initializeMediaApplication(e,t,n){initialized||(initialized=!0,t||console.error("mediaApplicationUrl variable is not defined"),$.ajax({url:t,method:"GET",success:function(t){$(".ta-content").append(t),$(document).trigger("mediaapplication:ready");var i={name:$("#t-mediaLibrary").text(),path:"",folder:"",isDirectory:!0,canCreateFolder:"true"===$("#allowNewRootFolders").val()},a=Vue.createApp({data:function(){return{selectedFolder:{},mediaItems:[],selectedMedias:[],errors:[],dragDropThumbnail:new Image,smallThumbs:!1,gridView:!1,mediaFilter:"",sortBy:"",sortAsc:!0,itemsInPage:[]}},created:function(){var e=this;e.dragDropThumbnail.src=(n||"")+"/OrchardCore.Media/Images/drag-thumbnail.png",bus.$on("folderSelected",function(t){e.selectedFolder=t}),bus.$on("folderDeleted",function(){e.selectRoot()}),bus.$on("folderAdded",function(t){e.selectedFolder=t,t.selected=!0}),bus.$on("mediaListMoved",function(t){e.loadFolder(e.selectedFolder),t&&e.errors.push(t)}),bus.$on("mediaRenamed",function(t,n,i,a){var r=e.mediaItems.filter(function(e){return e.mediaPath===i})[0];r.mediaPath=n,r.name=t,r.url=a}),bus.$on("createFolderRequested",function(t){e.createFolder()}),bus.$on("deleteFolderRequested",function(t){e.deleteFolder()}),bus.$on("sortChangeRequested",function(t){e.changeSort(t)}),bus.$on("mediaToggleRequested",function(t){e.toggleSelectionOfMedia(t)}),bus.$on("renameMediaRequested",function(t){e.renameMedia(t)}),bus.$on("deleteMediaRequested",function(t){e.deleteMediaItem(t)}),bus.$on("mediaDragStartRequested",function(t,n){e.handleDragStart(t,n)}),bus.$on("pagerEvent",function(t){e.itemsInPage=t,e.selectedMedias=[]}),localStorage.getItem("mediaApplicationPrefs")?e.currentPrefs=JSON.parse(localStorage.getItem("mediaApplicationPrefs")):e.selectedFolder=i},computed:{isHome:function(){return this.selectedFolder==i},parents:function(){var e=[];for(parentFolder=this.selectedFolder;parentFolder&&""!=parentFolder.path;)e.unshift(parentFolder),parentFolder=parentFolder.parent;return e},root:function(){return i},filteredMediaItems:function(){var e=this;e.selectedMedias=[];var t=e.mediaItems.filter(function(t){return t.name.toLowerCase().indexOf(e.mediaFilter.toLowerCase())>-1});switch(e.sortBy){case"size":t.sort(function(t,n){return e.sortAsc?t.size-n.size:n.size-t.size});break;case"mime":t.sort(function(t,n){return e.sortAsc?t.mime.toLowerCase().localeCompare(n.mime.toLowerCase()):n.mime.toLowerCase().localeCompare(t.mime.toLowerCase())});break;case"lastModify":t.sort(function(t,n){return e.sortAsc?t.lastModify-n.lastModify:n.lastModify-t.lastModify});break;default:t.sort(function(t,n){return e.sortAsc?t.name.toLowerCase().localeCompare(n.name.toLowerCase()):n.name.toLowerCase().localeCompare(t.name.toLowerCase())})}return t},hiddenCount:function(){return this.mediaItems.length-this.filteredMediaItems.length},thumbSize:function(){return this.smallThumbs?100:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs,selectedFolder:this.selectedFolder,gridView:this.gridView}},set:function(e){e&&(this.smallThumbs=e.smallThumbs,this.selectedFolder=e.selectedFolder,this.gridView=e.gridView)}}},watch:{currentPrefs:function(e){localStorage.setItem("mediaApplicationPrefs",JSON.stringify(e))},selectedFolder:function(e){this.mediaFilter="",this.selectedFolder=e,this.loadFolder(e)}},mounted:function(){this.$refs.rootFolder.toggle()},methods:{uploadUrl:function(){if(!this.selectedFolder)return null;var e=$("#uploadFiles").val(),t=$("#allowedExtensions").val();return t&&""!==t&&(e=e+(-1==e.indexOf("?")?"?":"&")+"extensions="+encodeURIComponent(t)),e+(-1==e.indexOf("?")?"?":"&")+"path="+encodeURIComponent(this.selectedFolder.path)},selectRoot:function(){this.selectedFolder=this.root},loadFolder:function(e){this.errors=[],this.selectedMedias=[];var t=this,n=$("#getMediaItemsUrl").val(),i=$("#allowedExtensions").val();i&&""!==i&&(n=n+(-1==n.indexOf("?")?"?":"&")+"extensions="+encodeURIComponent(i)),console.log(e.path),$.ajax({url:n+(-1==n.indexOf("?")?"?":"&")+"path="+encodeURIComponent(e.path),method:"GET",success:function(e){e.forEach(function(e){e.open=!1}),t.mediaItems=e,t.selectedMedias=[],t.sortBy="",t.sortAsc=!0},error:function(n){console.log("error loading folder:"+e.path),t.selectRoot()}})},refresh:function(){var e=this;e.selectedFolder&&e.loadFolder(e.selectedFolder)},selectAll:function(){this.selectedMedias=[];for(var e=0;e<this.filteredMediaItems.length;e++)this.selectedMedias.push(this.filteredMediaItems[e])},unSelectAll:function(){this.selectedMedias=[]},invertSelection:function(){for(var e=[],t=0;t<this.filteredMediaItems.length;t++)0==this.isMediaSelected(this.filteredMediaItems[t])&&e.push(this.filteredMediaItems[t]);this.selectedMedias=e},toggleSelectionOfMedia:function(e){1==this.isMediaSelected(e)?this.selectedMedias.splice(this.selectedMedias.indexOf(e),1):this.selectedMedias.push(e)},isMediaSelected:function(e){return this.selectedMedias.some(function(t,n,i){return t.url.toLowerCase()===e.url.toLowerCase()})},deleteFolder:function(){var e=this.selectedFolder;e!=this.root.model&&confirmDialog(_objectSpread(_objectSpread({},$("#deleteFolder").data()),{},{callback:function(t){t&&$.ajax({url:$("#deleteFolderUrl").val()+"?path="+encodeURIComponent(e.path),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(t){bus.$emit("deleteFolder",e)},error:function(e){console.error(e.responseText)}})}}))},createFolder:function(){$("#createFolderModal-errors").empty(),bootstrap.Modal.getOrCreateInstance($("#createFolderModal")).show(),$("#createFolderModal .modal-body input").val("").focus()},renameMedia:function(e){$("#renameMediaModal-errors").empty(),bootstrap.Modal.getOrCreateInstance($("#renameMediaModal")).show(),$("#old-item-name").val(e.name),$("#renameMediaModal .modal-body input").val(e.name).focus()},selectAndDeleteMedia:function(e){this.deleteMedia()},deleteMediaList:function(){var e=this.selectedMedias,t=this;e.length<1||confirmDialog(_objectSpread(_objectSpread({},$("#deleteMedia").data()),{},{callback:function(n){if(n){for(var i=[],a=0;a<e.length;a++)i.push(e[a].mediaPath);$.ajax({url:$("#deleteMediaListUrl").val(),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),paths:i},success:function(e){for(var n=0;n<t.selectedMedias.length;n++){var i=t.mediaItems&&t.mediaItems.indexOf(t.selectedMedias[n]);i>-1&&(t.mediaItems.splice(i,1),bus.$emit("mediaDeleted",t.selectedMedias[n]))}t.selectedMedias=[]},error:function(e){console.error(e.responseText)}})}}}))},deleteMediaItem:function(e){var t=this;e&&confirmDialog(_objectSpread(_objectSpread({},$("#deleteMedia").data()),{},{callback:function(n){n&&$.ajax({url:$("#deleteMediaUrl").val()+"?path="+encodeURIComponent(e.mediaPath),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(n){var i=t.mediaItems&&t.mediaItems.indexOf(e);i>-1&&(t.mediaItems.splice(i,1),bus.$emit("mediaDeleted",e))},error:function(e){console.error(e.responseText)}})}}))},handleDragStart:function(e,t){var n=[];this.selectedMedias.forEach(function(e){n.push(e.name)}),0==this.isMediaSelected(e)&&(n.push(e.name),this.selectedMedias.push(e)),t.dataTransfer.setData("mediaNames",JSON.stringify(n)),t.dataTransfer.setData("sourceFolder",this.selectedFolder.path),t.dataTransfer.setDragImage(this.dragDropThumbnail,10,10),t.dataTransfer.effectAllowed="move"},handleScrollWhileDrag:function(e){e.clientY<150&&window.scrollBy(0,-10),e.clientY>window.innerHeight-100&&window.scrollBy(0,10)},changeSort:function(e){this.sortBy==e?this.sortAsc=!this.sortAsc:(this.sortAsc=!0,this.sortBy=e)}}});a.component("folder",folderComponent),a.component("media-items-grid",mediaItemsGridComponent),a.component("media-items-table",mediaItemsTableComponent),a.component("pager",pagerComponent),a.component("sortIndicator",sortIndicatorComponent),a.component("upload",uploadComponent),a.component("uploadList",uploadListComponent),mediaApp=a.mount("#mediaApp"),$("#create-folder-name").keydown(function(e){if("Enter"==e.key)return $("#modalFooterOk").click(),!1}),$("#modalFooterOk").on("click",function(e){var t=$("#create-folder-name").val();""!==t&&$.ajax({url:$("#createFolderUrl").val()+"?path="+encodeURIComponent(mediaApp.selectedFolder.path)+"&name="+encodeURIComponent(t),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){bus.$emit("addFolder",mediaApp.selectedFolder,e),bootstrap.Modal.getOrCreateInstance($("#createFolderModal")).hide()},error:function(e){$("#createFolderModal-errors").empty();var t=JSON.parse(e.responseText).value;$('<div class="alert alert-danger" role="alert"></div>').text(t).appendTo($("#createFolderModal-errors"))}})}),$("#renameMediaModalFooterOk").on("click",function(e){var t=$("#new-item-name").val(),n=$("#old-item-name").val();if(""!==t){var i=mediaApp.selectedFolder.path+"/";"/"===i&&(i="");var a=i+t,r=i+n;if(a.toLowerCase()!==r.toLowerCase())$.ajax({url:$("#renameMediaUrl").val()+"?oldPath="+encodeURIComponent(r)+"&newPath="+encodeURIComponent(a),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){bootstrap.Modal.getOrCreateInstance($("#renameMediaModal")).hide(),bus.$emit("mediaRenamed",t,a,r,e.newUrl)},error:function(e){$("#renameMediaModal-errors").empty();var t=JSON.parse(e.responseText).value;$('<div class="alert alert-danger" role="alert"></div>').text(t).appendTo($("#renameMediaModal-errors"))}});else bootstrap.Modal.getOrCreateInstance($("#renameMediaModal")).hide()}}),$(document).trigger("mediaApp:ready"),e&&setTimeout(function(){document.getElementById("mediaApp").classList.remove("d-none")},100)},error:function(e){console.error(e.responseText)}}))}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}$(document).on("mediaApp:ready",function(){var e=randomUUID();$("#fileupload").fileupload({dropZone:$("#mediaApp"),limitConcurrentUploads:20,dataType:"json",url:$("#uploadFiles").val(),maxChunkSize:Number($("#maxUploadChunkSize").val()||0),formData:function(){var t=$("input[name=__RequestVerificationToken]").val();return[{name:"path",value:mediaApp.selectedFolder.path},{name:"__RequestVerificationToken",value:t},{name:"__chunkedFileUploadId",value:e}]},done:function(e,t){$.each(t.result.files,function(e,t){t.error||mediaApp.mediaItems.push(t)})}}).on("fileuploadchunkbeforesend",function(e,t){var n=t.files[0];t.blob=new File([t.blob],n.name,{type:n.type,lastModified:n.lastModified})})}),$(document).bind("dragover",function(e){var t=e.originalEvent.dataTransfer;if(t.types&&(t.types.indexOf?-1!=t.types.indexOf("Files"):t.types.contains("Files"))){var n=$("#customdropzone"),i=window.dropZoneTimeout;i?clearTimeout(i):n.addClass("in");$(e.target).closest(n);window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,n.removeClass("in")},100)}});var folderComponent={template:'\n        <li :class="{selected: isSelected}" \n                v-on:dragleave.prevent = "handleDragLeave($event);" \n                v-on:dragover.prevent.stop="handleDragOver($event);" \n                v-on:drop.prevent.stop = "moveMediaToFolder(model, $event)" >\n            <div :class="{folderhovered: isHovered , treeroot: level == 1}" >\n                <a href="javascript:;" :style="{ padding'.concat("ltr"==document.dir?"Left":"Right",':padding + \'px\' }" v-on:click="select"  draggable="false" class="folder-menu-item">\n                  <span v-on:click.stop="toggle" class="expand" :class="{opened: open, closed: !open, empty: empty}"><i v-if="open" class="fa-solid fa-chevron-').concat("ltr"==document.dir?"right":"left",'"></i></span> \n                  <div class="folder-name ms-2">{{model.name}}</div>\n                    <div class="btn-group folder-actions" >\n                            <a v-cloak href="javascript:;" class="btn btn-sm" v-on:click="createFolder" v-if="canCreateFolder && (isSelected || isRoot)"><i class="fa-solid fa-plus" aria-hidden="true"></i></a>\n                            <a v-cloak href="javascript:;" class="btn btn-sm" v-on:click="deleteFolder" v-if="canDeleteFolder && isSelected && !isRoot"><i class="fa-solid fa-trash" aria-hidden="true"></i></a>\n                    </div>\n                </a>\n            </div>\n            <ol v-show="open">\n                <folder v-for="folder in children"\n                        :key="folder.path"\n                        :model="folder"\n                        :selected-in-media-app="selectedInMediaApp"\n                        :level="level + 1">\n                </folder>\n            </ol>\n        </li>\n        '),props:{model:Object,selectedInMediaApp:Object,level:Number},data:function(){return{open:!1,children:null,parent:null,isHovered:!1,padding:0}},computed:{empty:function(){return!this.children||0==this.children.length},isSelected:function(){return this.selectedInMediaApp.name==this.model.name&&this.selectedInMediaApp.path==this.model.path},isRoot:function(){return""===this.model.path},canCreateFolder:function(){return void 0===this.model.canCreateFolder||this.model.canCreateFolder},canDeleteFolder:function(){return void 0===this.model.canDeleteFolder||this.model.canDeleteFolder}},mounted:function(){0==this.isRoot&&this.isAncestorOfSelectedFolder()&&this.toggle(),this.padding=this.level<3?16:16+8*this.level},created:function(){var e=this;bus.$on("deleteFolder",function(t){if(e.children){var n=e.children&&e.children.indexOf(t);n>-1&&(e.children.splice(n,1),bus.$emit("folderDeleted"))}}),bus.$on("addFolder",function(t,n){e.model==t&&(null!==e.children&&e.children.push(n),n.parent=e.model,bus.$emit("folderAdded",n))})},methods:{isAncestorOfSelectedFolder:function(){for(parentFolder=mediaApp.selectedFolder;parentFolder;){if(parentFolder.path==this.model.path)return!0;parentFolder=parentFolder.parent}return!1},toggle:function(){this.open=!this.open,this.open&&!this.children&&this.loadChildren()},select:function(){bus.$emit("folderSelected",this.model),this.loadChildren()},createFolder:function(){bus.$emit("createFolderRequested")},deleteFolder:function(){bus.$emit("deleteFolderRequested")},loadChildren:function(){var e=this;0==this.open&&(this.open=!0),$.ajax({url:$("#getFoldersUrl").val()+"?path="+encodeURIComponent(e.model.path),method:"GET",success:function(t){e.children=t,e.children.forEach(function(t){t.parent=e.model})},error:function(e){emtpy=!1,console.error(e.responseText)}})},handleDragOver:function(e){this.isHovered=!0},handleDragLeave:function(e){this.isHovered=!1},moveMediaToFolder:function(e,t){this.isHovered=!1;var n=JSON.parse(t.dataTransfer.getData("mediaNames"));if(!(n.length<1)){var i=t.dataTransfer.getData("sourceFolder"),a=e.path;""===i&&(i="root"),""===a&&(a="root"),i!==a?confirmDialog(_objectSpread(_objectSpread({},$("#moveMedia").data()),{},{callback:function(e){e&&$.ajax({url:$("#moveMediaListUrl").val(),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),mediaNames:n,sourceFolder:i,targetFolder:a},success:function(){bus.$emit("mediaListMoved")},error:function(e){console.error(e.responseText),bus.$emit("mediaListMoved",e.responseText)}})}})):alert($("#sameFolderMessage").val())}}}},faIcons={image:"fa-regular fa-image",pdf:"fa-regular fa-file-pdf",word:"fa-regular fa-file-word",powerpoint:"fa-regular fa-file-powerpoint",excel:"fa-regular fa-file-excel",csv:"fa-regular fa-file",audio:"fa-regular fa-file-audio",video:"fa-regular fa-file-video",archive:"fa-regular fa-file-zipper",code:"fa-regular fa-file-code",text:"fa-regular fa-file-lines",file:"fa-regular fa-file"},faThumbnails={gif:faIcons.image,jpeg:faIcons.image,jpg:faIcons.image,png:faIcons.image,pdf:faIcons.pdf,doc:faIcons.word,docx:faIcons.word,ppt:faIcons.powerpoint,pptx:faIcons.powerpoint,xls:faIcons.excel,xlsx:faIcons.excel,csv:faIcons.csv,aac:faIcons.audio,mp3:faIcons.audio,ogg:faIcons.audio,avi:faIcons.video,flv:faIcons.video,mkv:faIcons.video,mp4:faIcons.video,webm:faIcons.video,gz:faIcons.archive,zip:faIcons.archive,css:faIcons.code,html:faIcons.code,js:faIcons.code,txt:faIcons.text};function getClassNameForExtension(e){return faThumbnails[e.toLowerCase()]||faIcons.file}function getExtensionForFilename(e){return e.slice((e.lastIndexOf(".")-1>>>0)+2)}function getClassNameForFilename(e){return getClassNameForExtension(getExtensionForFilename(e))}var mediaItemsGridComponent={template:'\n        <ol class="row media-items-grid">\n                <li v-for="media in filteredMediaItems"\n                    :key="media.name" \n                    class="media-item media-container-main-list-item card p-0"\n                    :style="{width: thumbSize + 2 + \'px\'}"\n                    :class="{selected: isMediaSelected(media)}"\n                    v-on:click.stop="toggleSelectionOfMedia(media)"\n                    draggable="true" v-on:dragstart="dragStart(media, $event)">\n                    <div class="thumb-container" :style="{height: thumbSize +\'px\'}">\n                        <img v-if="media.mime.startsWith(\'image\')"\n                                :src="buildMediaUrl(media.url, thumbSize)"\n                                :data-mime="media.mime"\n                                :style="{maxHeight: thumbSize +\'px\', maxWidth: thumbSize +\'px\'}" />\n                        <i v-else :class="getfontAwesomeClassNameForFileName(media.name, \'fa-5x\')" :data-mime="media.mime"></i>\n                    </div>\n                <div class="media-container-main-item-title card-body">\n                        <a href="javascript:;" class="btn btn-light btn-sm float-end inline-media-button edit-button" v-on:click.stop="renameMedia(media)"><i class="fa-solid fa-pen-to-square" aria-hidden="true"></i></a>\n                        <a href="javascript:;" class="btn btn-light btn-sm float-end inline-media-button delete-button" v-on:click.stop="deleteMedia(media)"><i class="fa-solid fa-trash" aria-hidden="true"></i></a>\n                        <a :href="media.url" target="_blank" class="btn btn-light btn-sm float-end inline-media-button view-button""><i class="fa-solid fa-download" aria-hidden="true"></i></a>\n                        <span class="media-filename card-text small" :title="media.name">{{ media.name }}</span>\n                    </div>\n                 </li>\n        </ol>\n        ',data:function(){return{T:{}}},props:{filteredMediaItems:Array,selectedMedias:Array,thumbSize:Number},created:function(){this.T.editButton=$("#t-edit-button").val(),this.T.deleteButton=$("#t-delete-button").val()},methods:{isMediaSelected:function(e){return this.selectedMedias.some(function(t,n,i){return t.url.toLowerCase()===e.url.toLowerCase()})},buildMediaUrl:function(e,t){return e+(-1==e.indexOf("?")?"?":"&")+"width="+t+"&height="+t},toggleSelectionOfMedia:function(e){bus.$emit("mediaToggleRequested",e)},renameMedia:function(e){bus.$emit("renameMediaRequested",e)},deleteMedia:function(e){bus.$emit("deleteMediaRequested",e)},dragStart:function(e,t){bus.$emit("mediaDragStartRequested",e,t)},getfontAwesomeClassNameForFileName:function(e,t){return getClassNameForFilename(e)+" "+t}}},mediaItemsTableComponent={template:'\n        <table class="table media-items-table m-0">\n            <thead>\n                <tr class="header-row">\n                    <th scope="col" class="thumbnail-column">{{ T.imageHeader }}</th>\n                    <th scope="col" v-on:click="changeSort(\'name\')">\n                       {{ T.nameHeader }}\n                         <sort-indicator colname="name" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator>\n                    </th>\n                    <th scope="col" v-on:click="changeSort(\'lastModify\')"> \n                       {{ T.lastModifyHeader }} \n                         <sort-indicator colname="lastModify" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator> \n                    </th> \n                    <th scope="col" v-on:click="changeSort(\'size\')">\n                        <span class="optional-col">\n                            {{ T.sizeHeader }}\n                         <sort-indicator colname="size" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator>\n                        </span>\n                    </th>\n                    <th scope="col" v-on:click="changeSort(\'mime\')">\n                        <span class="optional-col">\n                           {{ T.typeHeader }}\n                         <sort-indicator colname="mime" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator>\n                        </span>\n                    </th>\n                </tr>\n            </thead>\n            <tbody>\n                    <tr v-for="media in filteredMediaItems"\n                          class="media-item"\n                          :class="{selected: isMediaSelected(media)}"\n                          v-on:click.stop="toggleSelectionOfMedia(media)"\n                          draggable="true" v-on:dragstart="dragStart(media, $event)"\n                          :key="media.name">\n                             <td class="thumbnail-column">\n                                <div class="img-wrapper">\n                                    <img v-if="media.mime.startsWith(\'image\')" draggable="false" :src="buildMediaUrl(media.url, thumbSize)" />\n                                    <i v-else :class="getfontAwesomeClassNameForFileName(media.name, \'fa-4x\')" :data-mime="media.mime"></i>\n                                </div>\n                            </td>\n                            <td>\n                                <div class="media-name-cell">\n                                   <span class="break-word"> {{ media.name }} </span>\n                                    <div class="buttons-container">\n                                        <a href="javascript:;" class="btn btn-link btn-sm me-1 edit-button" v-on:click.stop="renameMedia(media)"> {{ T.editButton }} </a >\n                                        <a href="javascript:;" class="btn btn-link btn-sm delete-button" v-on:click.stop="deleteMedia(media)"> {{ T.deleteButton }} </a>\n                                        <a :href="media.url" target="_blank" class="btn btn-link btn-sm view-button"> {{ T.viewButton }} </a>\n                                    </div>\n                                </div>\n                            </td>\n                            <td>\n                                <div class="text-col"> {{ printDateTime(media.lastModify) }} </div>\n                            </td>\n                            <td>\n                                <div class="text-col optional-col"> {{ isNaN(media.size)? 0 : Math.round(media.size / 1024) }} KB</div>\n                            </td>\n                            <td>\n                                <div class="text-col optional-col">{{ media.mime }}</div>\n                            </td>\n                   </tr>\n            </tbody>\n        </table>\n        ',data:function(){return{T:{}}},props:{sortBy:String,sortAsc:Boolean,filteredMediaItems:Array,selectedMedias:Array,thumbSize:Number},created:function(){var e=this;e.T.imageHeader=$("#t-image-header").val(),e.T.nameHeader=$("#t-name-header").val(),e.T.lastModifyHeader=$("#t-lastModify-header").val(),e.T.sizeHeader=$("#t-size-header").val(),e.T.typeHeader=$("#t-type-header").val(),e.T.editButton=$("#t-edit-button").val(),e.T.deleteButton=$("#t-delete-button").val(),e.T.viewButton=$("#t-view-button").val()},methods:{isMediaSelected:function(e){return this.selectedMedias.some(function(t,n,i){return t.url.toLowerCase()===e.url.toLowerCase()})},buildMediaUrl:function(e,t){return e+(-1==e.indexOf("?")?"?":"&")+"width="+t+"&height="+t},changeSort:function(e){bus.$emit("sortChangeRequested",e)},toggleSelectionOfMedia:function(e){bus.$emit("mediaToggleRequested",e)},renameMedia:function(e){bus.$emit("renameMediaRequested",e)},deleteMedia:function(e){bus.$emit("deleteMediaRequested",e)},dragStart:function(e,t){bus.$emit("mediaDragStartRequested",e,t)},printDateTime:function(e){return new Date(e).toLocaleString()},getfontAwesomeClassNameForFileName:function(e,t){return getClassNameForFilename(e)+" "+t}}},pagerComponent={template:'\n    <div>\n        <nav id="media-pager" class="d-flex justify-content-center" aria-label="Pagination Navigation" role="navigation" :data-computed-trigger="itemsInCurrentPage.length">\n            <ul class="pagination pagination-sm m-0">\n                <li class="page-item media-first-button" :class="{disabled : !canDoFirst}">\n                    <a class="page-link" href="#" :tabindex="canDoFirst ? 0 : -1" v-on:click="goFirst">{{ T.pagerFirstButton }}</a>\n                </li>\n                <li class="page-item" :class="{disabled : !canDoPrev}">\n                    <a class="page-link" href="#" :tabindex="canDoPrev ? 0 : -1" v-on:click="previous">{{ T.pagerPreviousButton }}</a>\n                </li>\n                <li v-if="link !== -1" class="page-item page-number"  :class="{active : current == link - 1}" v-for="link in pageLinks">\n                    <a class="page-link" href="#" v-on:click="goTo(link - 1)" :aria-label="\'Goto Page\' + link">\n                        {{link}}\n                        <span v-if="current == link -1" class="visually-hidden">(current)</span>\n                    </a>\n                </li>\n                <li class="page-item" :class="{disabled : !canDoNext}">\n                    <a class="page-link" href="#" :tabindex="canDoNext ? 0 : -1" v-on:click="next">{{ T.pagerNextButton }}</a>\n                </li>\n                <li class="page-item media-last-button" :class="{disabled : !canDoLast}">\n                    <a class="page-link" href="#" :tabindex="canDoLast ? 0 : -1" v-on:click="goLast">{{ T.pagerLastButton }}</a>\n                </li>\n                <li class="page-item ms-4 page-size-info">\n                    <div style="display: flex;">\n                        <span class="page-link disabled text-muted page-size-label">{{ T.pagerPageSizeLabel }}</span>\n                        <select id="pageSizeSelect" class="page-link" v-model="pageSize">\n                            <option v-for="option in pageSizeOptions" v-bind:value="option">\n                                {{option}}\n                            </option>\n                        </select>\n                    </div>\n                </li>\n            </ul>\n        </nav>\n        <nav class="d-flex justify-content-center">\n            <ul class="pagination pagination-sm m-0 mt-2">\n                <li class="page-item ms-4 page-info">\n                    <span class="page-link disabled text-muted ">{{ T.pagerPageLabel }} {{current + 1}}/{{totalPages}}</span>\n                </li>\n                <li class="page-item ms-4 total-info">\n                    <span class="page-link disabled text-muted "> {{ T.pagerTotalLabel }} {{total}}</span>\n                </li>\n            </ul>\n        </nav>\n        </div>\n        ',props:{sourceItems:Array},data:function(){return{pageSize:10,pageSizeOptions:[10,30,50,100],current:0,T:{}}},created:function(){var e=this;e.T.pagerFirstButton=$("#t-pager-first-button").val(),e.T.pagerPreviousButton=$("#t-pager-previous-button").val(),e.T.pagerNextButton=$("#t-pager-next-button").val(),e.T.pagerLastButton=$("#t-pager-last-button").val(),e.T.pagerPageSizeLabel=$("#t-pager-page-size-label").val(),e.T.pagerPageLabel=$("#t-pager-page-label").val(),e.T.pagerTotalLabel=$("#t-pager-total-label").val()},methods:{next:function(){this.current=this.current+1},previous:function(){this.current=this.current-1},goFirst:function(){this.current=0},goLast:function(){this.current=this.totalPages-1},goTo:function(e){this.current=e}},computed:{total:function(){return this.sourceItems?this.sourceItems.length:0},totalPages:function(){var e=Math.ceil(this.total/this.pageSize);return e>0?e:1},isLastPage:function(){return this.current+1>=this.totalPages},isFirstPage:function(){return 0===this.current},canDoNext:function(){return!this.isLastPage},canDoPrev:function(){return!this.isFirstPage},canDoFirst:function(){return!this.isFirstPage},canDoLast:function(){return!this.isLastPage},itemsInCurrentPage:function(){var e=this.pageSize*this.current,t=e+this.pageSize,n=this.sourceItems.slice(e,t);return bus.$emit("pagerEvent",n),n},pageLinks:function(){var e=[];e.push(this.current+1);var t=this.current>0?this.current:-1;e.unshift(t);var n=this.current>1?this.current-1:-1;e.unshift(n);var i=this.totalPages-this.current>1?this.current+2:-1;e.push(i);var a=this.totalPages-this.current>2?this.current+3:-1;return e.push(a),e}},watch:{sourceItems:function(){this.current=0},pageSize:function(){this.current=0}}},sortIndicatorComponent={template:'\n        <div v-show="isActive" class="sort-indicator">\n            <span v-show="asc"><i class="small fa fa-chevron-up"></i></span>\n            <span v-show="!asc"><i class="small fa fa-chevron-down"></i></span>\n        </div>\n        ',props:{colname:String,selectedcolname:String,asc:Boolean},computed:{isActive:function(){return this.colname.toLowerCase()==this.selectedcolname.toLowerCase()}}};function initializeAttachedMediaField(e,t,n,i,a,r,o,s,l){var d,c=$(document.getElementById($(e).data("for"))).data("init"),u=$(e),m=u.attr("id"),f=Vue.createApp({data:function(){return{mediaItems:[],selectedMedia:null,smallThumbs:!1,idPrefix:m,initialized:!1,allowMediaText:r,backupMediaText:"",allowAnchors:o,backupAnchor:null,mediaTextmodal:null,anchoringModal:null}},created:function(){this.currentPrefs=JSON.parse(localStorage.getItem("mediaFieldPrefs"))},computed:{paths:{get:function(){var e=[];return this.initialized?(this.mediaItems.forEach(function(t){"not-found"!==t.mediaPath&&e.push({path:t.mediaPath,isRemoved:t.isRemoved,isNew:t.isNew,mediaText:t.mediaText,anchor:t.anchor,attachedFileName:t.attachedFileName})}),JSON.stringify(e)):JSON.stringify(c)},set:function(e){var t=this,n=e||[],a=$.Deferred(),r=[],o=0;n.forEach(function(e,n){r.push({name:" "+e.path,mime:"",mediaPath:"",anchor:e.anchor,attachedFileName:e.attachedFileName}),promise=$.when(a).done(function(){$.ajax({url:i+"?path="+encodeURIComponent(e.path),method:"GET",success:function(i){i.vuekey=i.name+n.toString(),i.mediaText=e.mediaText,i.anchor=e.anchor,i.attachedFileName=e.attachedFileName,r.splice(n,1,i),r.length===++o&&(r.forEach(function(e){t.mediaItems.push(e)}),t.initialized=!0)},error:function(i){console.log(JSON.stringify(i)),r.splice(n,1,{name:e.path,mime:"",mediaPath:"not-found",mediaText:"",anchor:{x:.5,y:.5},attachedFileName:e.attachedFileName}),r.length===++o&&(r.forEach(function(e){t.mediaItems.push(e)}),t.initialized=!0)}})})}),a.resolve()}},fileSize:function(){return Math.round(this.selectedMedia.size/1024)},canAddMedia:function(){for(var e=[],t=0;t<this.mediaItems.length;t++)this.mediaItems[t].isRemoved||e.push(this.mediaItems[t]);return 0===e.length||e.length>0&&a},thumbSize:function(){return this.smallThumbs?120:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs}},set:function(e){e&&(this.smallThumbs=e.smallThumbs)}}},mounted:function(){var e=this;e.paths=c,e.$on("selectAndDeleteMediaRequested",function(t){e.selectAndDeleteMedia(t)}),e.$on("selectMediaRequested",function(t){e.selectMedia(t)});var i="#"+t,r=u.attr("id"),o=randomUUID();$(i).fileupload({limitConcurrentUploads:20,dropZone:$("#"+r),dataType:"json",url:n,maxChunkSize:l,add:function(t,n){var i,a=n.files.length;for(i=0;i<a;i++)n.files[i].uploadName=e.getUniqueId()+n.files[i].name,n.files[i].attachedFileName=n.files[i].name;n.submit()},formData:function(){var e=$("input[name=__RequestVerificationToken]").val();return[{name:"path",value:s},{name:"__RequestVerificationToken",value:e},{name:"__chunkedFileUploadId",value:o}]},done:function(e,t){var n=[],i="";if(t.result.files.length>0)for(var r=0;r<t.result.files.length;r++)t.result.files[r].isNew=!0,void 0===t.result.files[r].error||null===t.result.files[r].error?(t.result.files[r].attachedFileName=t.files[r].attachedFileName,n.push(t.result.files[r])):i+=t.result.files[r].error+"\n";""===i?(console.log(n),n.length>1&&!1===a?(alert($("#onlyOneItemMessage").val()),d.mediaItems.push(n[0]),d.initialized=!0):(d.mediaItems=d.mediaItems.concat(n),d.initialized=!0)):alert(i)},error:function(e,t,n){console.log("Error on upload."),console.log(e),console.log(t),console.log(n)}}).on("fileuploadchunkbeforesend",function(e,t){var n=t.files[0];t.blob=new File([t.blob],n.name,{type:n.type,lastModified:n.lastModified})})},methods:{selectMedia:function(e){this.selectedMedia=e},getUniqueId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},removeSelected:function(e){if(this.selectedMedia){var t=this.mediaItems&&this.mediaItems.indexOf(this.selectedMedia);t>-1&&(this.mediaItems[t].isRemoved=!0,this.mediaItems.splice(t,1))}else 1===this.mediaItems.length&&(this.mediaItems[t].isRemoved=!0,this.mediaItems.splice(0,1));this.selectedMedia=null},showMediaTextModal:function(e){this.mediaTextModal=new bootstrap.Modal(this.$refs.mediaTextModal),this.mediaTextModal.show(),this.backupMediaText=this.selectedMedia.mediaText},cancelMediaTextModal:function(e){this.mediaTextModal.hide(),this.selectedMedia.mediaText=this.backupMediaText},showAnchorModal:function(e){this.anchoringModal=new bootstrap.Modal(this.$refs.anchoringModal),this.anchoringModal.show(),this.selectedMedia.anchor={x:this.selectedMedia.anchor.x,y:this.selectedMedia.anchor.y},this.backupAnchor=this.selectedMedia.anchor},cancelAnchoringModal:function(e){this.anchoringModal.hide(),this.selectedMedia.anchor=this.backupAnchor},resetAnchor:function(e){this.selectedMedia.anchor={x:.5,y:.5}},onAnchorDrop:function(e){var t=this.$refs.anchorImage;this.selectedMedia.anchor={x:e.offsetX/t.clientWidth,y:e.offsetY/t.clientHeight}},anchorLeft:function(){if(this.$refs.anchorImage&&this.$refs.modalBody&&this.selectedMedia){var e=(this.$refs.modalBody.clientWidth-this.$refs.anchorImage.clientWidth)/2,t=this.selectedMedia.anchor.x*this.$refs.anchorImage.clientWidth+e;return t<17?t=17:t-=8,t+"px"}return"0"},anchorTop:function(){if(this.$refs.anchorImage&&this.selectedMedia){var e=this.selectedMedia.anchor.y*this.$refs.anchorImage.clientHeight;return e<15?e=15:e+=5,e+"px"}return"0"},setAnchor:function(e){var t=this.$refs.anchorImage;this.selectedMedia.anchor={x:e.offsetX/t.clientWidth,y:e.offsetY/t.clientHeight}},addMediaFiles:function(e){e.length>1&&!1===a?(alert($("#onlyOneItemMessage").val()),d.mediaItems.push(e[0]),d.initialized=!0):(d.mediaItems=d.mediaItems.concat(e),d.initialized=!0)},selectAndDeleteMedia:function(e){var t=this;t.selectedMedia=e,setTimeout(function(){t.removeSelected()},100)}},watch:{mediaItems:{deep:!0,handler:function(){setTimeout(function(){$(document).trigger("contentpreview:render")},100)}},currentPrefs:function(e){localStorage.setItem("mediaFieldPrefs",JSON.stringify(e))}}});f.component("mediaFieldThumbsContainer",mediaFieldThumbsContainerComponent),f.component("mediaFieldGalleryContainer",mediaFieldGalleryContainerComponent),f.component("mediaFieldGalleryListItem",mediaFieldGalleryListItemComponent),f.component("mediaFieldGalleryCardItem",mediaFieldGalleryCardItemComponent),d=f.mount(u.get(0)),mediaFieldApps.push(d)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,s=[],l=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){d=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(d)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var MEDIA_FIELD_GALLERY="mediaFieldGallery_",mediaFieldGalleryListItemComponent={template:'\n        <li class="list-group-item d-flex p-0 overflow-hidden align-items-center" v-if="!media.isRemoved" :class="media.mediaPath==\'not-found\' ? \'text-danger\' : \'\'">\n            <div class="media-preview flex-shrink-0">\n                <img\n                    v-if="media.mime.startsWith(\'image\')"\n                    :src="buildMediaUrl(media.url, media.anchor)"\n                    :data-mime="media.mime"\n                    class="w-100 object-fit-scale"\n                />\n                <i v-else-if="media.mediaPath==\'not-found\'" :title="media.name" class="fa-solid fa-triangle-exclamation"></i>\n                <i v-else :class="$parent.getfontAwesomeClassNameForFileName(media.name, \'fa-4x card-text\')" :data-mime="media.mime"></i>\n            </div>\n            <div class="me-auto flex-shrink-1">\n                <span v-if="media.mediaPath==\'not-found\'" class="media-filename card-text small">{{ $parent.T.mediaNotFound }} - {{ $parent.T.discardWarning }}</span>\n                <span v-else class="media-filename card-text small" :title="media.name">{{ media.name }}</span>\n            </div>\n            <div class="media-field-gallery-list-actions flex-shrink-0">\n                <a\n                    v-show="allowMediaText && media.mediaPath!==\'not-found\'"\n                    class="btn btn-light btn-sm inline-media-button view-button"\n                    v-on:click.prevent.stop="$parent.showMediaTextModal(media)"\n                    href="javascript:;"\n                    title="Edit media text"\n                >\n                    <span v-show="!media.mediaText">\n                        <i class="far fa-comment"></i>\n                    </span>\n                    <span v-show="media.mediaText">\n                        <i class="fa-solid fa-comment"></i>\n                    </span>\n                </a>\n                <a\n                    href="javascript:;"\n                    v-show="allowAnchors && media.mime.startsWith(\'image\') && media.mediaPath!==\'not-found\'"\n                    v-on:click="$parent.showAnchorModal(media)"\n                    class="btn btn-light btn-sm inline-media-button view-button"\n                    title="Set anchor"\n                >\n                    <i class="fa-solid fa-crosshairs" aria-hidden="true"></i>\n                </a>\n                <a\n                    :href="media.url"\n                    target="_blank"\n                    v-show="media.mediaPath!==\'not-found\'"\n                    class="btn btn-light btn-sm inline-media-button view-button"\n                    title="View media"\n                >\n                    <i class="fa-solid fa-download" aria-hidden="true"></i>\n                </a>\n                <a\n                    href="javascript:;"\n                    class="btn btn-light btn-sm inline-media-button view-button"\n                    v-on:click.stop="$parent.selectAndDeleteMedia(media)"\n                    title="Remove media"\n                >\n                    <i class="fa-solid fa-trash" aria-hidden="true"></i>\n                </a>\n            </div>\n        </li>\n    ',props:{media:Object,canAddMedia:Boolean,allowMediaText:Boolean,allowAnchors:Boolean,cols:Number},methods:{fileSize:function(e){return Math.round(e/1024)},buildMediaUrl:function(e){return e+(-1==e.indexOf("?")?"?":"&")+"width=32&height=32"}}},mediaFieldGalleryCardItemComponent={template:'\n        <li class="media-field-gallery-item" v-if="!media.isRemoved">\n            <div class="card ratio ratio-1x1 overflow-hidden" :class="media.mediaPath==\'not-found\' ? \'text-danger border-danger\' : \'\'">\n                <div class="d-flex flex-column h-100">\n                    <div class="flex-grow-1 media-preview d-flex justify-content-center align-items-center">\n                        <div class="update-media" v-if="!$parent.allowMultiple" v-on:click="$parent.showMediaModal">\n                            + Media Library\n                        </div>\n                        <div class="image-wrapper" v-if="media.mime.startsWith(\'image\')">\n                            <img\n                                :src="buildMediaUrl(media.url)"\n                                :data-mime="media.mime"\n                                class="w-100 h-100 object-fit-scale"\n                            />\n                        </div>\n                        <div v-else-if="media.mediaPath==\'not-found\'" class="d-flex flex-column justify-content-center align-items-center h-100 bg-body file-icon not-found" :title="media.name">\n                            <i class="fa-solid fa-triangle-exclamation fa-2x card-text\'"></i>\n                            <span class="card-text small pt-2" :title="media.name">{{ $parent.T.mediaNotFound }}</span>\n                            <span class="card-text small pt-2 px-2 text-center" :title="media.name">{{ $parent.T.discardWarning }}</span>\n                        </div>\n                        <div v-else class="d-flex flex-column justify-content-center align-items-center h-100 bg-body file-icon">\n                            <i :class="$parent.getfontAwesomeClassNameForFileName(media.name, \'fa-4x card-text\')" :data-mime="media.mime"></i>\n                            <span class="media-filename card-text small pt-2" :title="media.name">{{ media.name }}</span>\n                        </div>\n                    </div>\n\n                    <div class="media-field-gallery-card-actions flex-shrink-0">\n                        <a\n                            v-show="allowMediaText && media.mediaPath!==\'not-found\'"\n                            class="btn btn-light btn-sm inline-media-button view-button"\n                            v-on:click.prevent.stop="$parent.showMediaTextModal(media)"\n                            href="javascript:;"\n                            title="Edit media text"\n                        >\n                            <span v-show="!media.mediaText">\n                                <i class="far fa-comment"></i>\n                            </span>\n                            <span v-show="media.mediaText">\n                                <i class="fa-solid fa-comment"></i>\n                            </span>\n                        </a>\n                        <a\n                            href="javascript:;"\n                            v-show="allowAnchors && media.mime.startsWith(\'image\') && media.mediaPath!==\'not-found\'"\n                            v-on:click="$parent.showAnchorModal(media)"\n                            class="btn btn-light btn-sm inline-media-button view-button"\n                            title="Set anchor"\n                        >\n                            <i class="fa-solid fa-crosshairs" aria-hidden="true"></i>\n                        </a>\n                        <a\n                            :href="media.url"\n                            target="_blank"\n                            v-show="media.mediaPath!==\'not-found\'"\n                            class="btn btn-light btn-sm inline-media-button view-button"\n                            title="View media"\n                        >\n                            <i class="fa-solid fa-download" aria-hidden="true"></i>\n                        </a>\n                        <a\n                            href="javascript:;"\n                            class="btn btn-light btn-sm inline-media-button view-button"\n                            v-on:click.stop="$parent.selectAndDeleteMedia(media)"\n                            title="Remove media"\n                        >\n                            <i class="fa-solid fa-trash" aria-hidden="true"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </li>\n    ',props:{media:Object,canAddMedia:Boolean,allowAnchors:Boolean,allowMediaText:Boolean},methods:{fileSize:function(e){return Math.round(e/1024)},buildMediaUrl:function(e){return e+(-1==e.indexOf("?")?"?":"&")+"width=240&height=240"}}},mediaFieldGalleryContainerComponent={template:'\n        <div class="media-field-gallery" :id="idPrefix + \'_mediaContainerMain\'" v-cloak>\n            <div v-if="allowMultiple" class="pb-2" v-cloak>\n                <div class="me-auto">\n                    <a\n                        type="button"\n                        class="btn btn-sm btn-primary"\n                        href="javascript:;"\n                        v-show="$parent.canAddMedia"\n                        v-on:click="$parent.showModal"\n                    >\n                        <i class="fa-solid fa-plus" aria-hidden="true"></i>\n                        Media Library\n                    </a>\n                    <a\n                        type="button"\n                        class="btn btn-sm btn-secondary draft me-2"\n                        :class="selectedItemCount == 0 ? \'disabled\' : \'\'"\n                        :disabled="selectedItemCount == 0"\n                        href="javascript:;"\n                        v-on:click="deselectAll"\n                    >\n                        Deselect All\n                    </a>\n\n                    <div class="btn-group">\n                        <button type="button" class="btn btn-sm" :class="!gridView ? \'text-primary\': \'\'" v-on:click="gridView = false;">\n                            <span title="Gridview"></span>\n                            <i class="fa-solid fa-th-list"></i>\n                        </button>\n                        <button type="button" class="btn btn-sm" :class="gridView ? \'text-primary\': \'\'" v-on:click="gridView = true;">\n                            <span title="List"></span>\n                            <i class="fa-solid fa-th-large"></i>\n                        </button>\n                        <button type="button" class="btn btn-sm" :class="size == \'sm\' ? \'text-primary\': \'\'" v-on:click="size = \'sm\';" v-show="gridView">\n                            <span title="Small Thumbs"></span>\n                            <i class="fa-solid fa-compress"></i>\n                        </button>\n                        <button type="button" class="btn btn-sm" :class="size == \'lg\' ? \'text-primary\': \'\'" v-on:click="size = \'lg\';" v-show="gridView">\n                            <span title="Large Thumbs"></span>\n                            <i class="fa-solid fa-expand"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <ol ref="mediaContainer" v-if="!gridView" :class="\'media-field-gallery-list list-group list-unstyled size-\' + size">\n                <media-field-gallery-list-item\n                    v-for= "media in mediaItemsNoDuplicates"\n                    :key="media.vuekey ?? media.name"\n                    :media="media"\n                    :canAddMedia="$parent.canAddMedia"\n                    :allowMediaText="$parent.allowMediaText"\n                    :allowAnchors="$parent.allowAnchors"\n                    :size="size"\n                />\n\n                <li v-if="!mediaItems || mediaItems.length < 1" class="list-group-item text-center hint media-field-gallery-choose-btn" v-on:click="showMediaModal">\n                    + Media Library\n                </li>\n            </ol>\n\n            <ol ref="mediaContainer" v-if="gridView" :class="\'media-field-gallery-cards list-unstyled size-\' + size">\n                <media-field-gallery-card-item\n                    v-for= "media in mediaItemsNoDuplicates"\n                    :key="media.vuekey ?? media.name"\n                    :media="media"\n                    :canAddMedia="$parent.canAddMedia"\n                    :allowMediaText="$parent.allowMediaText"\n                    :allowAnchors="$parent.allowAnchors"\n                    :size="size"\n                />\n\n                <li class="add-media-card" v-if="allowMultiple || mediaItems.length < 1" v-on:click="showMediaModal">\n                    <div class="card media-field-gallery-choose-btn text-center overflow-hidden">\n                        <div class="ratio ratio-1x1 text-center">\n                            <div class="hint d-flex align-items-center justify-content-center w-100">+ Media Library</div>\n                        </div>\n                    </div>\n                </li>\n            </ol>\n        </div>\n    ',data:function(){return{T:{},sortableInstance:null,multiSelectedItems:[],selectedItemCount:0,gridView:!0,size:"lg"}},props:{mediaItems:Array,selectedMedia:Object,idPrefix:String,modalId:String,allowMultiple:Boolean},created:function(){var e=this;e.T.mediaNotFound=$("#t-media-not-found").val(),e.T.discardWarning=$("#t-discard-warning").val(),e.T.noImages=$("#t-no-images").val()},mounted:function(){this.getLocalStorageState(),this.initSortable()},beforeDestroy:function(){this.sortableInstance&&this.sortableInstance.destroy()},watch:{mediaItems:{handler:function(){var e=this;this.sortableInstance&&this.sortableInstance.destroy(),this.$nextTick(function(){e.initSortable(),!e.allowMultiple&&e.mediaItems.length>1&&e.$emit("updated",[e.mediaItems[e.mediaItems.length-1]])})},deep:!0},size:{handler:function(){this.setLocalStorageState()}},gridView:{handler:function(){this.setLocalStorageState()}}},computed:{mediaItemsNoDuplicates:function(){return this.removeDuplicates(this.mediaItems)}},methods:{getLocalStorageState:function(){if(localStorage.getItem(MEDIA_FIELD_GALLERY+this.idPrefix))try{var e,t=JSON.parse(localStorage.getItem(MEDIA_FIELD_GALLERY+this.idPrefix));this.size=t.size||"lg",this.gridView=!this.allowMultiple||null!==(e=t.gridView)&&void 0!==e&&e}catch(e){localStorage.removeItem(MEDIA_FIELD_GALLERY+this.idPrefix)}},setLocalStorageState:function(){var e=JSON.stringify({size:this.size,gridView:this.gridView});localStorage.setItem(MEDIA_FIELD_GALLERY+this.idPrefix,e)},initSortable:function(){var e=this;if(this.allowMultiple&&this.$refs.mediaContainer&&this.mediaItemsNoDuplicates.length>0){var t=this;this.sortableInstance=Sortable.create(this.$refs.mediaContainer,{animation:150,ghostClass:"sortable-ghost",multiDrag:!0,selectedClass:"sortable-selected",filter:"a, button, .add-media-card",preventOnFilter:!1,onSelect:function(){return e.updateSelectedCount()},onDeselect:function(){return e.updateSelectedCount()},onEnd:function(){return e.updateSelectedCount()},onMove:function(e){var t=e.dragged,n=e.related;return!t.classList.contains("add-media-card")&&!n.classList.contains("add-media-card")},onUpdate:function(e){var n=_toConsumableArray(t.mediaItemsNoDuplicates);if(e.oldIndicies&&e.oldIndicies.length>0){for(var i=e.oldIndicies.sort(function(e,t){return e.index-t.index}),a=e.newIndicies.sort(function(e,t){return e.index-t.index}),r=i.map(function(e){return t.mediaItems[e.index]}),o=i.length-1;o>=0;o--)n.splice(i[o].index,1);for(var s=0;s<a.length;s++)n.splice(a[s].index,0,r[s])}else{var l=n.splice(e.oldIndex,1),d=_slicedToArray(l,1)[0];n.splice(e.newIndex,0,d)}t.$emit("updated",n),t.$refs.mediaContainer.querySelectorAll(".sortable-selected").forEach(function(e){Sortable.utils.deselect(e)}),t.multiSelectedItems=[]}})}},selectAndDeleteMedia:function(e){this.$parent.$emit("selectAndDeleteMediaRequested",e)},showMediaTextModal:function(e){var t=this;this.$parent.$emit("selectMediaRequested",e),this.$nextTick(function(){return t.$emit("updatemediatext")})},showAnchorModal:function(e){var t=this;this.$parent.$emit("selectMediaRequested",e),this.$nextTick(function(){return t.$emit("updateanchor")})},updateSelectedCount:function(){this.selectedItemCount=this.$refs.mediaContainer.querySelectorAll(".sortable-selected").length},getfontAwesomeClassNameForFileName:function(e,t){return getClassNameForFilename(e)+" "+t},deselectAll:function(){this.$refs.mediaContainer.querySelectorAll(".sortable-selected").forEach(function(e){Sortable.utils.deselect(e)}),this.multiSelectedItems=[]},showMediaModal:function(){this.$parent.showModal()},removeDuplicates:function(e){return e.filter(function(e,t,n){return t===n.findIndex(function(t){return t.mediaPath===e.mediaPath})})}}};function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,s=[],l=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){d=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(d)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var mediaFieldThumbsContainerComponent={template:'\n    <div :id="idPrefix + \'_mediaContainerMain\'">\n         <div v-if="mediaItems.length < 1" class="card text-center">\n            <div class= "card-body">\n                <span class="hint">{{T.noImages}}</span>\n            </div>\n         </div>\n         <ol ref="multiDragContainer" class="media-items-grid d-flex flex-row align-items-start flex-wrap" >\n            <li v-for="media in mediaItems"\n                :key="media.vuekey"\n                class="media-thumb-item media-container-main-list-item card overflow"\n                :class="{\'media-thumb-item-active\': !allowMultiple && selectedMedia === media}"\n                :style="{width: thumbSize + 2 + \'px\'}"\n                v-on:click="selectMedia(media)"\n                v-if="!media.isRemoved">\n                    <div v-if="media.mediaPath!== \'not-found\'">\n                        <div class="thumb-container" :style="{height: thumbSize + \'px\'}" >\n                            <img v-if="media.mime.startsWith(\'image\')"\n                                :src="buildMediaUrl(media.url, thumbSize)"\n                                :data-mime="media.mime"\n                                width="100%"\n                            />\n                            <i v-else :class="getfontAwesomeClassNameForFileName(media.name, \'fa-4x\')" :data-mime="media.mime"></i>\n                        </div>\n                        <div class="media-container-main-item-title card-body">\n                            <a href="javascript:;" class="btn btn-light btn-sm float-end inline-media-button delete-button"\n                                v-on:click.stop="selectAndDeleteMedia(media)"><i class="fa-solid fa-trash" aria-hidden="true"></i></a>\n                            <a :href="media.url" target="_blank" class="btn btn-light btn-sm float-end inline-media-button view-button""><i class="fa-solid fa-download" aria-hidden="true"></i></a>\n                            <span class="media-filename card-text small" :title="media.mediaPath">{{ media.isNew ? media.name.substr(36) : media.name }}</span>\n                        </div>\n                    </div>\n                    <div v-else>\n                        <div class="thumb-container flex-column" :style="{height: thumbSize + \'px\'}">\n                            <i class="fa-solid fa-ban text-danger d-block" aria-hidden="true"></i>\n                            <span class="text-danger small d-block">{{ T.mediaNotFound }}</span>\n                            <span class="text-danger small d-block text-center">{{ T.discardWarning }}</span>\n                        </div>\n                        <div class="media-container-main-item-title card-body">\n                            <a href="javascript:;" class="btn btn-light btn-sm float-end inline-media-button delete-button"\n                                v-on:click.stop="selectAndDeleteMedia(media)"><i class="fa-solid fa-trash" aria-hidden="true"></i></a>\n                            <span class="media-filename card-text small text-danger" :title="media.name">{{ media.name }}</span>\n                        </div>\n                  </div>\n            </li>\n         </ol>\n    </div>\n    ',data:function(){return{T:{},sortableInstance:null,multiSelectedItems:[]}},model:{prop:"mediaItems",event:"changed"},props:{mediaItems:Array,selectedMedia:Object,thumbSize:Number,idPrefix:String,allowMultiple:Boolean},created:function(){var e=this;e.T.mediaNotFound=$("#t-media-not-found").val(),e.T.discardWarning=$("#t-discard-warning").val(),e.T.noImages=$("#t-no-images").val()},mounted:function(){this.allowMultiple&&this.initSortable()},methods:{initSortable:function(){if(this.$refs.multiDragContainer){var e=this;this.sortableInstance=Sortable.create(this.$refs.multiDragContainer,{animation:150,ghostClass:"sortable-ghost",multiDrag:!0,selectedClass:"sortable-selected",preventOnFilter:!0,forceHelperSize:!0,onUpdate:function(t){var n=_toConsumableArray(e.mediaItems);if(t.oldIndicies&&t.oldIndicies.length>0){for(var i=t.oldIndicies.sort(function(e,t){return e.index-t.index}),a=t.newIndicies.sort(function(e,t){return e.index-t.index}),r=i.map(function(t){return e.mediaItems[t.index]}),o=i.length-1;o>=0;o--)n.splice(i[o].index,1);for(var s=0;s<a.length;s++)n.splice(a[s].index,0,r[s])}else{var l=n.splice(t.oldIndex,1),d=_slicedToArray(l,1)[0];n.splice(t.newIndex,0,d)}e.$emit("changed",n),e.$refs.multiDragContainer.querySelectorAll(".sortable-selected").forEach(function(e){Sortable.utils.deselect(e)}),e.multiSelectedItems=[]}})}},selectAndDeleteMedia:function(e){this.$parent.$emit("selectAndDeleteMediaRequested",e)},selectMedia:function(e){this.$parent.$emit("selectMediaRequested",e)},buildMediaUrl:function(e,t){return e+(-1==e.indexOf("?")?"?":"&")+"width="+t+"&height="+t},getfontAwesomeClassNameForFileName:function(e,t){return getClassNameForFilename(e)+" "+t}}};function initializeMediaField(e,t,n,i,a,r,o){if(null!==e){var s,l=$(document.getElementById($(e).data("for"))).data("init"),d=$(e),c=d.attr("id");t.addEventListener("hidden.bs.modal",function(e){$("#mediaApp").appendTo("body"),document.getElementById("mediaApp").classList.add("d-none")});var u=Vue.createApp({data:function(){return{mediaItems:[],selectedMedia:null,smallThumbs:!1,idPrefix:c,initialized:!1,allowMediaText:a,backupMediaText:"",allowAnchors:r,allowedExtensions:o,backupAnchor:null,mediaTextModal:null,anchoringModal:null}},created:function(){this.currentPrefs=JSON.parse(localStorage.getItem("mediaFieldPrefs"))},computed:{paths:{get:function(){var e=[];return this.initialized?(this.mediaItems.forEach(function(t){"not-found"!==t.mediaPath&&e.push({path:t.mediaPath,mediaText:t.mediaText,anchor:t.anchor})}),JSON.stringify(e)):JSON.stringify(l)},set:function(e){var t=this,a=e||[],r=$.Deferred(),o=[],s=0;a.forEach(function(e,a){o.push({name:" "+e.path,mime:"",mediaPath:""}),promise=$.when(r).done(function(){$.ajax({url:n+"?path="+encodeURIComponent(e.path),method:"GET",success:function(n){n.vuekey=n.name+a.toString(),n.mediaText=e.mediaText,n.anchor=e.anchor,o.splice(a,1,n),o.length===++s&&(o.forEach(function(e){t.mediaItems.push(e)}),t.initialized=!0,i||1!==t.mediaItems.length||t.$nextTick(function(){t.selectedMedia=t.mediaItems[0]}))},error:function(n){console.log(n),o.splice(a,1,{name:e.path,mime:"",mediaPath:"not-found",mediaText:"",anchor:{x:0,y:0}}),o.length===++s&&(o.forEach(function(e){t.mediaItems.push(e)}),t.initialized=!0)}})})}),r.resolve()}},fileSize:function(){return Math.round(this.selectedMedia.size/1024)},canAddMedia:function(){return 0===this.mediaItems.length||this.mediaItems.length>0&&i},thumbSize:function(){return this.smallThumbs?120:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs}},set:function(e){e&&(this.smallThumbs=e.smallThumbs)}}},mounted:function(){this.paths=l},methods:{selectMedia:function(e){this.selectedMedia=e},showModal:function(e){var n=this;if(n.canAddMedia){$("#allowedExtensions").val(this.allowedExtensions),$("#fileupload").attr("accept",this.allowedExtensions),$("#mediaApp").appendTo($(t).find(".modal-body")),mediaApp.refresh();var i=new bootstrap.Modal(t);i.show(),setTimeout(function(){document.getElementById("mediaApp").classList.remove("d-none")},100),$(t).find(".mediaFieldSelectButton").off("click").on("click",function(e){return n.addMediaFiles(mediaApp.selectedMedias),mediaApp.selectedMedias=[],i.hide(),!0})}},showMediaTextModal:function(e){this.mediaTextModal=new bootstrap.Modal(this.$refs.mediaTextModal),this.mediaTextModal.show(),this.backupMediaText=this.selectedMedia.mediaText},cancelMediaTextModal:function(e){this.mediaTextModal.hide(),this.selectedMedia.mediaText=this.backupMediaText},showAnchorModal:function(e){this.anchoringModal=new bootstrap.Modal(this.$refs.anchoringModal),this.anchoringModal.show(),this.selectedMedia.anchor={x:this.selectedMedia.anchor.x,y:this.selectedMedia.anchor.y},this.backupAnchor=this.selectedMedia.anchor},cancelAnchoringModal:function(e){this.anchoringModal.hide(),this.selectedMedia.anchor=this.backupAnchor},resetAnchor:function(e){this.selectedMedia.anchor={x:.5,y:.5}},onAnchorDrop:function(e){var t=this.$refs.anchorImage;this.selectedMedia.anchor={x:e.offsetX/t.clientWidth,y:e.offsetY/t.clientHeight}},anchorLeft:function(){if(this.$refs.anchorImage&&this.$refs.modalBody&&this.selectedMedia){var e=(this.$refs.modalBody.clientWidth-this.$refs.anchorImage.clientWidth)/2,t=this.selectedMedia.anchor.x*this.$refs.anchorImage.clientWidth+e,n=Math.round(this.$refs.modalBody.querySelector(".icon-media-anchor").clientWidth);return Number.isInteger(n)&&(t-=n/2),t+"px"}return"0"},anchorTop:function(){return this.$refs.anchorImage&&this.selectedMedia?this.selectedMedia.anchor.y*this.$refs.anchorImage.clientHeight+"px":"0"},setAnchor:function(e){var t=this.$refs.anchorImage;this.selectedMedia.anchor={x:e.offsetX/t.clientWidth,y:e.offsetY/t.clientHeight}},addMediaFiles:function(e){e.length>1&&!1===i?(alert($("#onlyOneItemMessage").val()),s.mediaItems.push(e[0]),s.initialized=!0,s.$nextTick(function(){s.selectedMedia=s.mediaItems[0]})):(s.mediaItems=s.mediaItems.concat(e),s.initialized=!0,i||1!==s.mediaItems.length||s.$nextTick(function(){s.selectedMedia=s.mediaItems[0]}))},removeSelected:function(e){if(this.selectedMedia){var t=this.mediaItems&&this.mediaItems.indexOf(this.selectedMedia);t>-1&&this.mediaItems.splice(t,1)}else 1===this.mediaItems.length&&this.mediaItems.splice(0,1);this.selectedMedia=null},selectAndDeleteMedia:function(e){var t=this;t.selectedMedia=e,setTimeout(function(){t.removeSelected()},100)}},watch:{mediaItems:{deep:!0,handler:function(){setTimeout(function(){$(document).trigger("contentpreview:render")},100)}},currentPrefs:function(e){localStorage.setItem("mediaFieldPrefs",JSON.stringify(e))}}});u.component("mediaFieldThumbsContainer",mediaFieldThumbsContainerComponent),u.component("mediaFieldGalleryContainer",mediaFieldGalleryContainerComponent),u.component("mediaFieldGalleryListItem",mediaFieldGalleryListItemComponent),u.component("mediaFieldGalleryCardItem",mediaFieldGalleryCardItemComponent),s=u.mount(d.get(0)),mediaFieldApps.push(s)}}var mediaFieldApps=[],uploadComponent={template:'        <div :class="{ \'upload-warning\' : model.errorMessage }" class="upload m-2 p-2 pt-0">             <span v-if="model.errorMessage" v-on:click="dismissWarning()" class="close-warning"><i class="fa-solid fa-xmark" aria-hidden="true"></i> </span>            <p class="upload-name" :title="model.errorMessage">{{ model.name }}</p>             <div>                <span v-show="!model.errorMessage" :style="{ width: model.percentage + \'%\'}" class="progress-bar"> </span>                <span v-if="model.errorMessage" class="error-message" :title="model.errorMessage"> Error: {{ model.errorMessage }} </span>             </div>         </div>         ',props:{model:Object,uploadInputId:String},mounted:function(){var e,t=this,n=document.getElementById(null!==(e=t.uploadInputId)&&void 0!==e?e:"fileupload");$(n).bind("fileuploadprogress",function(e,n){n.files[0].name===t.model.name&&(t.model.percentage=parseInt(n.loaded/n.total*100,10))}),$(n).bind("fileuploaddone",function(e,n){n.files[0].name===t.model.name&&(n.result.files[0].error?t.handleFailure(n.files[0].name,n.result.files[0].error):bus.$emit("removalRequest",t.model))}),$(n).bind("fileuploadfail",function(e,n){n.files[0].name===t.model.name&&t.handleFailure(n.files[0].name,$("#t-error").val())})},methods:{handleFailure:function(e,t){e===this.model.name&&(this.model.errorMessage=t,bus.$emit("ErrorOnUpload",this.model))},dismissWarning:function(){bus.$emit("removalRequest",this.model)}}},uploadListComponent={template:'        <div class="upload-list" v-show="files.length > 0">             <div class="header" @click="expanded = !expanded">                 <span> {{ T.uploads }} </span>                 <span v-show="pendingCount"> (Pending: {{ pendingCount }}) </span>                 <span v-show="errorCount" :class="{ \'text-danger\' : errorCount }"> ( {{ T.errors }}: {{ errorCount }} / <a href="javascript:;" v-on:click.stop="clearErrors" > {{ T.clearErrors }} </a>)</span>                     <div class="toggle-button">                     <div v-show="expanded">                         <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>                     </div>                     <div v-show="!expanded">                         <i class="fa-solid fa-chevron-up" aria-hidden="true"></i>                     </div>                 </div>             </div>             <div class="card-body" v-show="expanded">                 <div class="d-flex flex-wrap">                     <upload :upload-input-id="uploadInputId" v-for="f in files" :key="f.name"  :model="f"></upload>                 </div >             </div>         </div>         ',data:function(){return{files:[],T:{},expanded:!1,pendingCount:0,errorCount:0}},props:{uploadInputId:String},created:function(){var e=this;e.T.uploads=$("#t-uploads").val(),e.T.errors=$("#t-errors").val(),e.T.clearErrors=$("#t-clear-errors").val()},computed:{fileCount:function(){return this.files.length}},mounted:function(){var e,t=this,n=document.getElementById(null!==(e=t.uploadInputId)&&void 0!==e?e:"fileupload");$(n).bind("fileuploadadd",function(e,n){n.files&&n.files.forEach(function(e){t.files.some(function(t){return t.name==e.name})?console.error("A file with the same name is already on the queue:"+e.name):t.files.push({name:e.name,percentage:0,errorMessage:""})})}),bus.$on("removalRequest",function(e){t.files.forEach(function(t,n,i){t.name==e.name&&i.splice(n,1)})}),bus.$on("ErrorOnUpload",function(e){t.updateCount()})},methods:{updateCount:function(){this.errorCount=this.files.filter(function(e){return""!=e.errorMessage}).length,this.pendingCount=this.files.length-this.errorCount,this.files.length<1&&(this.expanded=!1)},clearErrors:function(){this.files=this.files.filter(function(e){return""==e.errorMessage})}},watch:{files:function(){this.updateCount()}}};
