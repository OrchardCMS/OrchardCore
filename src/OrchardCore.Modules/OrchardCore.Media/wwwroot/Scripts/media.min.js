var initialized,mediaApp,root={name:"Media Library",path:"",folder:"",isDirectory:!0},bus=new Vue;function initializeMediaApplication(e,t){initialized||(initialized=!0,t||console.error("mediaApplicationUrl variable is not defined"),$.ajax({url:t,method:"GET",success:function(t){$(".ta-content").append(t),$(document).trigger("mediaapplication:ready"),mediaApp=new Vue({el:"#mediaApp",data:{selectedFolder:root,mediaItems:[],selectedMedias:[],errors:[],dragDropThumbnail:new Image,smallThumbs:!1,gridView:!1,mediaFilter:"",sortBy:"",sortAsc:!0,itemsInPage:[]},created:function(){var e=this;e.dragDropThumbnail.src="/OrchardCore.Media/Images/drag-thumbnail.png",bus.$on("folderSelected",function(t){e.selectedFolder=t}),bus.$on("folderDeleted",function(){e.selectRoot()}),bus.$on("folderAdded",function(t){e.selectedFolder=t,t.selected=!0}),bus.$on("beforeFolderAdded",function(t){e.loadFolder(t)}),bus.$on("mediaListMoved",function(t){e.loadFolder(e.selectedFolder),t&&e.errors.push(t)}),bus.$on("mediaRenamed",function(t,n,o){var s=e.mediaItems.filter(function(e){return e.mediaPath===o})[0];s.mediaPath=n,s.name=t}),bus.$on("createFolderRequested",function(t){e.createFolder()}),bus.$on("deleteFolderRequested",function(t){e.deleteFolder()}),bus.$on("sortChangeRequested",function(t){e.changeSort(t)}),bus.$on("mediaToggleRequested",function(t){e.toggleSelectionOfMedia(t)}),bus.$on("renameMediaRequested",function(t){e.renameMedia(t)}),bus.$on("deleteMediaRequested",function(t){e.deleteMediaItem(t)}),bus.$on("mediaDragStartRequested",function(t,n){e.handleDragStart(t,n)}),bus.$on("pagerEvent",function(t){e.itemsInPage=t,e.selectedMedias=[]}),e.currentPrefs=JSON.parse(localStorage.getItem("mediaApplicationPrefs"))},computed:{isHome:function(){return this.selectedFolder==root},parents:function(){var e=[];for(parentFolder=this.selectedFolder;parentFolder&&""!=parentFolder.path;)e.unshift(parentFolder),parentFolder=parentFolder.parent;return e},root:function(){return root},filteredMediaItems:function(){var e=this;e.selectedMedias=[];var t=e.mediaItems.filter(function(t){return t.name.toLowerCase().indexOf(e.mediaFilter.toLowerCase())>-1});switch(e.sortBy){case"size":t.sort(function(t,n){return e.sortAsc?t.size-n.size:n.size-t.size});break;case"mime":t.sort(function(t,n){return e.sortAsc?t.mime.toLowerCase().localeCompare(n.mime.toLowerCase()):n.mime.toLowerCase().localeCompare(t.mime.toLowerCase())});break;default:t.sort(function(t,n){return e.sortAsc?t.name.toLowerCase().localeCompare(n.name.toLowerCase()):n.name.toLowerCase().localeCompare(t.name.toLowerCase())})}return t},hiddenCount:function(){return this.mediaItems.length-this.filteredMediaItems.length},thumbSize:function(){return this.smallThumbs?160:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs,selectedFolder:this.selectedFolder,gridView:this.gridView}},set:function(e){e&&(this.smallThumbs=e.smallThumbs,this.selectedFolder=e.selectedFolder,this.gridView=e.gridView)}}},watch:{currentPrefs:function(e){localStorage.setItem("mediaApplicationPrefs",JSON.stringify(e))},selectedFolder:function(e){this.mediaFilter="",this.selectedFolder=e,this.loadFolder(e)}},mounted:function(){this.$refs.rootFolder.toggle()},methods:{uploadUrl:function(){return this.selectedFolder?$("#uploadFiles").val()+"?path="+encodeURIComponent(this.selectedFolder.path):null},selectRoot:function(){this.selectedFolder=this.root},loadFolder:function(e){this.errors=[],this.selectedMedias=[];var t=this;$.ajax({url:$("#getMediaItemsUrl").val()+"?path="+encodeURIComponent(e.path),method:"GET",success:function(e){e.forEach(function(e){e.open=!1}),t.mediaItems=e,t.selectedMedias=[],t.sortBy="",t.sortAsc=!0},error:function(n){console.log("error loading folder:"+e.path),t.selectRoot()}})},selectAll:function(){this.selectedMedias=[];for(var e=0;e<this.filteredMediaItems.length;e++)this.selectedMedias.push(this.filteredMediaItems[e])},unSelectAll:function(){this.selectedMedias=[]},invertSelection:function(){for(var e=[],t=0;t<this.filteredMediaItems.length;t++)0==this.isMediaSelected(this.filteredMediaItems[t])&&e.push(this.filteredMediaItems[t]);this.selectedMedias=e},toggleSelectionOfMedia:function(e){1==this.isMediaSelected(e)?this.selectedMedias.splice(this.selectedMedias.indexOf(e),1):this.selectedMedias.push(e)},isMediaSelected:function(e){return this.selectedMedias.some(function(t,n,o){return t.url.toLowerCase()===e.url.toLowerCase()})},deleteFolder:function(){var e=this.selectedFolder;e!=this.root.model&&confirm($("#deleteFolderMessage").val())&&$.ajax({url:$("#deleteFolderUrl").val()+"?path="+encodeURIComponent(e.path),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(t){bus.$emit("deleteFolder",e)},error:function(e){console.error(e.responseText)}})},createFolder:function(){$("#createFolderModal-errors").empty(),$("#createFolderModal").modal("show"),$("#createFolderModal .modal-body input").val("").focus()},renameMedia:function(e){$("#renameMediaModal-errors").empty(),$("#renameMediaModal").modal("show"),$("#old-item-name").val(e.name),$("#renameMediaModal .modal-body input").val(e.name).focus()},selectAndDeleteMedia:function(e){this.deleteMedia()},deleteMediaList:function(){var e=this.selectedMedias,t=this;if(!(e.length<1)&&confirm($("#deleteMediaMessage").val())){for(var n=[],o=0;o<e.length;o++)n.push(e[o].mediaPath);$.ajax({url:$("#deleteMediaListUrl").val(),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),paths:n},success:function(e){for(var n=0;n<t.selectedMedias.length;n++){var o=t.mediaItems&&t.mediaItems.indexOf(t.selectedMedias[n]);o>-1&&(t.mediaItems.splice(o,1),bus.$emit("mediaDeleted",t.selectedMedias[n]))}t.selectedMedias=[]},error:function(e){console.error(e.responseText)}})}},deleteMediaItem:function(e){var t=this;e&&confirm($("#deleteMediaMessage").val())&&$.ajax({url:$("#deleteMediaUrl").val()+"?path="+encodeURIComponent(e.mediaPath),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(n){var o=t.mediaItems&&t.mediaItems.indexOf(e);o>-1&&(t.mediaItems.splice(o,1),bus.$emit("mediaDeleted",e))},error:function(e){console.error(e.responseText)}})},handleDragStart:function(e,t){var n=[];this.selectedMedias.forEach(function(e){n.push(e.name)}),0==this.isMediaSelected(e)&&(n.push(e.name),this.selectedMedias.push(e)),t.dataTransfer.setData("mediaNames",JSON.stringify(n)),t.dataTransfer.setData("sourceFolder",this.selectedFolder.path),t.dataTransfer.setDragImage(this.dragDropThumbnail,10,10),t.dataTransfer.effectAllowed="move"},handleScrollWhileDrag:function(e){e.clientY<150&&window.scrollBy(0,-10),e.clientY>window.innerHeight-100&&window.scrollBy(0,10)},changeSort:function(e){this.sortBy==e?this.sortAsc=!this.sortAsc:(this.sortAsc=!0,this.sortBy=e)}}}),$("#create-folder-name").keypress(function(e){if(13==e.which)return $("#modalFooterOk").click(),!1}),$("#modalFooterOk").on("click",function(e){var t=$("#create-folder-name").val();""!==t&&$.ajax({url:$("#createFolderUrl").val()+"?path="+encodeURIComponent(mediaApp.selectedFolder.path)+"&name="+encodeURIComponent(t),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){bus.$emit("addFolder",mediaApp.selectedFolder,e),$("#createFolderModal").modal("hide")},error:function(e){$("#createFolderModal-errors").empty();var t=JSON.parse(e.responseText).value;$('<div class="alert alert-danger" role="alert"></div>').text(t).appendTo($("#createFolderModal-errors"))}})}),$("#renameMediaModalFooterOk").on("click",function(e){var t=$("#new-item-name").val(),n=$("#old-item-name").val();if(""!==t){var o=mediaApp.selectedFolder.path+"/";"/"===o&&(o="");var s=o+t,r=o+n;s.toLowerCase()!==r.toLowerCase()?$.ajax({url:$("#renameMediaUrl").val()+"?oldPath="+encodeURIComponent(r)+"&newPath="+encodeURIComponent(s),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){$("#renameMediaModal").modal("hide"),bus.$emit("mediaRenamed",t,s,r)},error:function(e){$("#renameMediaModal-errors").empty();var t=JSON.parse(e.responseText).value;$('<div class="alert alert-danger" role="alert"></div>').text(t).appendTo($("#renameMediaModal-errors"))}}):$("#renameMediaModal").modal("hide")}}),e&&(document.getElementById("mediaApp").style.display=""),$(document).trigger("mediaApp:ready")},error:function(e){console.error(e.responseText)}}))}function initializeAttachedMediaField(e,t,n,o,s,r){var i,a=$(document.getElementById($(e).data("for"))).data("init"),d=$(e);mediaFieldApps.push(i=new Vue({el:d.get(0),data:{mediaItems:[],selectedMedia:null,smallThumbs:!1},created:function(){this.currentPrefs=JSON.parse(localStorage.getItem("mediaFieldPrefs"))},computed:{paths:{get:function(){var e=[];return this.mediaItems.forEach(function(t){"not-found"!==t.mediaPath&&e.push({Path:t.mediaPath,IsRemoved:t.isRemoved,IsNew:t.isNew})}),JSON.stringify(e)},set:function(e){var t=this,n=e||[],s=$.Deferred();n.forEach(function(e,n){t.mediaItems.push({name:" "+e.Path,mime:"",mediaPath:""}),promise=$.when(s).done(function(){$.ajax({url:o+"?path="+encodeURIComponent(e.Path),method:"GET",success:function(e){e.vuekey=e.name+n.toString(),t.mediaItems.splice(n,1,e)},error:function(o){console.log(JSON.stringify(o)),t.mediaItems.splice(n,1,{name:e.Path,mime:"",mediaPath:"not-found"})}})})}),s.resolve()}},fileSize:function(){return Math.round(this.selectedMedia.size/1024)},canAddMedia:function(){return 0===this.mediaItems.length||this.mediaItems.length>0&&s},thumbSize:function(){return this.smallThumbs?120:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs}},set:function(e){e&&(this.smallThumbs=e.smallThumbs)}}},mounted:function(){var e=this;e.paths=a,e.$on("selectAndDeleteMediaRequested",function(t){e.selectAndDeleteMedia(t)}),e.$on("selectMediaRequested",function(t){e.selectMedia(t)});var o="#"+t;$(document).bind("drop dragover",function(e){e.preventDefault()});var l=d.attr("id");$(o).fileupload({limitConcurrentUploads:20,dropZone:$("#"+l),dataType:"json",url:n,add:function(t,n){var o,s=n.files.length;for(o=0;o<s;o++)n.files[o].uploadName=e.getUniqueId()+n.files[o].name;n.submit()},formData:function(){var e=$("input[name=__RequestVerificationToken]").val();return[{name:"path",value:r},{name:"__RequestVerificationToken",value:e}]},done:function(e,t){var n=[];if(t.result.files.length>0)for(var o=0;o<t.result.files.length;o++)t.result.files[o].isNew=!0,n.push(t.result.files[o]);n.length>1&&!1===s?(alert($("#onlyOneItemMessage").val()),i.mediaItems.push(n[0])):i.mediaItems=i.mediaItems.concat(n)},error:function(e,t,n){console.log("error on upload!!"),console.log(e),console.log(t),console.log(n)}})},methods:{selectMedia:function(e){this.selectedMedia=e},getUniqueId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},removeSelected:function(e){var t={};if(this.selectedMedia){var n=this.mediaItems&&this.mediaItems.indexOf(this.selectedMedia);n>-1&&((t=this.mediaItems[n]).isRemoved=!0,this.mediaItems.splice([n],1,t))}else 1===this.mediaItems.length&&((t=this.mediaItems[n]).isRemoved=!0,this.mediaItems.splice(0,1,t));this.selectedMedia=null},selectAndDeleteMedia:function(e){var t=this;t.selectedMedia=e,setTimeout(function(){t.removeSelected()},100)}},watch:{mediaItems:function(){setTimeout(function(){$(document).trigger("contentpreview:render")},100)},currentPrefs:function(e){localStorage.setItem("mediaFieldPrefs",JSON.stringify(e))}}}))}function initializeMediaField(e,t,n,o){var s,r=$(document.getElementById($(e).data("for"))).data("init"),i=$(e);mediaFieldApps.push(s=new Vue({el:i.get(0),data:{mediaItems:[],selectedMedia:null,smallThumbs:!1},created:function(){this.currentPrefs=JSON.parse(localStorage.getItem("mediaFieldPrefs"))},computed:{paths:{get:function(){var e=[];return this.mediaItems.forEach(function(t){"not-found"!==t.mediaPath&&e.push({Path:t.mediaPath})}),JSON.stringify(e)},set:function(e){var t=this,o=e||[],s=$.Deferred();o.forEach(function(e,o){t.mediaItems.push({name:" "+e.Path,mime:"",mediaPath:""}),promise=$.when(s).done(function(){$.ajax({url:n+"?path="+encodeURIComponent(e.Path),method:"GET",success:function(e){t.mediaItems.splice(o,1,e)},error:function(n){console.log(n),t.mediaItems.splice(o,1,{name:e.Path,mime:"",mediaPath:"not-found"})}})})}),s.resolve()}},fileSize:function(){return Math.round(this.selectedMedia.size/1024)},canAddMedia:function(){return 0===this.mediaItems.length||this.mediaItems.length>0&&o},thumbSize:function(){return this.smallThumbs?120:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs}},set:function(e){e&&(this.smallThumbs=e.smallThumbs)}}},mounted:function(){var e=this;e.paths=r,e.$on("selectAndDeleteMediaRequested",function(t){e.selectAndDeleteMedia(t)}),e.$on("selectMediaRequested",function(t){e.selectMedia(t)}),e.$on("filesUploaded",function(t){e.addMediaFiles(t)})},methods:{selectMedia:function(e){this.selectedMedia=e},showModal:function(e){var n=this;if(n.canAddMedia){$("#mediaApp").detach().appendTo($(t).find(".modal-body")),$("#mediaApp").show();var o=$(t).modal();$(t).find(".mediaFieldSelectButton").off("click").on("click",function(e){return n.addMediaFiles(mediaApp.selectedMedias),mediaApp.selectedMedias=[],o.modal("hide"),!0})}},addMediaFiles:function(e){e.length>1&&!1===o?(alert($("#onlyOneItemMessage").val()),s.mediaItems.push(e[0])):s.mediaItems=s.mediaItems.concat(e)},removeSelected:function(e){if(this.selectedMedia){var t=this.mediaItems&&this.mediaItems.indexOf(this.selectedMedia);t>-1&&this.mediaItems.splice(t,1)}else 1===this.mediaItems.length&&this.mediaItems.splice(0,1);this.selectedMedia=null},selectAndDeleteMedia:function(e){var t=this;t.selectedMedia=e,setTimeout(function(){t.removeSelected()},100)}},watch:{mediaItems:function(){setTimeout(function(){$(document).trigger("contentpreview:render")},100)},currentPrefs:function(e){localStorage.setItem("mediaFieldPrefs",JSON.stringify(e))}}}))}$(document).on("mediaApp:ready",function(){$("#fileupload").fileupload({dropZone:$("#mediaApp"),limitConcurrentUploads:20,dataType:"json",url:$("#uploadFiles").val(),formData:function(){var e=$("input[name=__RequestVerificationToken]").val();return[{name:"path",value:mediaApp.selectedFolder.path},{name:"__RequestVerificationToken",value:e}]},done:function(e,t){$.each(t.result.files,function(e,t){t.error||mediaApp.mediaItems.push(t)})}})}),$(document).bind("dragover",function(e){var t=e.originalEvent.dataTransfer;if(t.types&&(t.types.indexOf?-1!=t.types.indexOf("Files"):t.types.contains("Files"))){var n=$("#customdropzone"),o=window.dropZoneTimeout;o?clearTimeout(o):n.addClass("in");$(e.target).closest(n);window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,n.removeClass("in")},100)}}),Vue.component("folder",{template:'        <li :class="{selected: isSelected}"                 v-on:dragleave.prevent = "handleDragLeave($event);"                 v-on:dragover.prevent.stop="handleDragOver($event);"                 v-on:drop.prevent.stop = "moveMediaToFolder(model, $event)" >            <div :class="{folderhovered: isHovered , treeroot: level == 1}" >                <a href="javascript:;" :style="{ paddingLeft: padding + \'px\' }" v-on:click="select"  draggable="false" class="folder-menu-item">                  <span v-on:click.stop="toggle" class="expand" :class="{opened: open, closed: !open, empty: empty}"><i class="fas fa-chevron-right"></i></span>                    <div class="folder-name">{{model.name}}</div>                    <div class="btn-group folder-actions" >                            <a v-cloak href="javascript:;" class="btn btn-sm" v-on:click="createFolder" v-show="isSelected || isRoot"> <i class="fa fa-plus"></i></a>                            <a v-cloak href="javascript:;" class="btn btn-sm" v-on:click="deleteFolder" v-show="isSelected && !isRoot"><i class="fa fa-trash"></i></a>                    </div>                </a>            </div>            <ol v-show="open">                <folder v-for="folder in children"                        :key="folder.path"                        :model="folder"                         :selected-in-media-app="selectedInMediaApp"                         :level="level + 1">                </folder>            </ol>        </li>        ',props:{model:Object,selectedInMediaApp:Object,level:Number},data:function(){return{open:!1,children:null,parent:null,isHovered:!1,padding:0}},computed:{empty:function(){return!this.children||0==this.children.length},isSelected:function(){return this.selectedInMediaApp.name==this.model.name&&this.selectedInMediaApp.path==this.model.path},isRoot:function(){return""===this.model.path}},mounted:function(){0==this.isRoot&&this.isAncestorOfSelectedFolder()&&this.toggle(),this.padding=this.level<3?26:26+8*this.level},created:function(){var e=this;bus.$on("deleteFolder",function(t){if(e.children){var n=e.children&&e.children.indexOf(t);n>-1&&(e.children.splice(n,1),bus.$emit("folderDeleted"))}}),bus.$on("addFolder",function(t,n){e.model==t&&(bus.$emit("beforeFolderAdded",e.model),null!==e.children&&e.children.push(n),n.parent=e.model,bus.$emit("folderAdded",n))})},methods:{isAncestorOfSelectedFolder:function(){for(parentFolder=mediaApp.selectedFolder;parentFolder;){if(parentFolder.path==this.model.path)return!0;parentFolder=parentFolder.parent}return!1},toggle:function(){this.open=!this.open,this.open&&!this.children&&this.loadChildren()},select:function(){bus.$emit("folderSelected",this.model),this.loadChildren()},createFolder:function(){bus.$emit("createFolderRequested")},deleteFolder:function(){bus.$emit("deleteFolderRequested")},loadChildren:function(){var e=this;0==this.open&&(this.open=!0),$.ajax({url:$("#getFoldersUrl").val()+"?path="+encodeURIComponent(e.model.path),method:"GET",success:function(t){e.children=t,e.children.forEach(function(t){t.parent=e.model})},error:function(e){emtpy=!1,console.error(e.responseText)}})},handleDragOver:function(e){this.isHovered=!0},handleDragLeave:function(e){this.isHovered=!1},moveMediaToFolder:function(e,t){this.isHovered=!1;var n=JSON.parse(t.dataTransfer.getData("mediaNames"));if(!(n.length<1)){var o=t.dataTransfer.getData("sourceFolder"),s=e.path;""===o&&(o="root"),""===s&&(s="root"),o!==s?confirm($("#moveMediaMessage").val())&&$.ajax({url:$("#moveMediaListUrl").val(),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),mediaNames:n,sourceFolder:o,targetFolder:s},success:function(){bus.$emit("mediaListMoved")},error:function(e){console.error(e.responseText),bus.$emit("mediaListMoved",e.responseText)}}):alert($("#sameFolderMessage").val())}}}}),Vue.component("mediaItemsGrid",{template:'        <ol class="row media-items-grid">                <li v-for="media in filteredMediaItems"                     :key="media.name"                     class="media-item media-container-main-list-item card"                     :style="{width: thumbSize + 2 + \'px\'}"                     :class="{selected: isMediaSelected(media)}"                     v-on:click.stop="toggleSelectionOfMedia(media)"                     draggable="true" v-on:dragstart="dragStart(media, $event)">                     <div class="thumb-container" :style="{height: thumbSize + \'px\'}">                             <img draggable="false" :src="media.url + \'?width=\' + thumbSize + \'&height=\' + thumbSize" :style="{ maxHeight: thumbSize + \'px\' , maxWidth: thumbSize + \'px\' }"/>                     </div>                     <div class="media-container-main-item-title card-body">                         <a href="javascript:;" class="btn btn-light btn-sm float-right inline-media-button edit-button mr-4" v-on:click.stop="renameMedia(media)"><i class="fa fa-edit"></i></a>                         <a href="javascript:;" class="btn btn-light btn-sm float-right inline-media-button delete-button" v-on:click.stop="deleteMedia(media)"><i class="fa fa-trash"></i></a>                         <span class="media-filename card-text small" :title="media.name">{{ media.name }}</span>                     </div>                  </li>         </ol>                ',data:function(){return{T:{}}},props:{filteredMediaItems:Array,selectedMedias:Array,thumbSize:Number},created:function(){this.T.editButton=$("#t-edit-button").val(),this.T.deleteButton=$("#t-delete-button").val()},methods:{isMediaSelected:function(e){return this.selectedMedias.some(function(t,n,o){return t.url.toLowerCase()===e.url.toLowerCase()})},toggleSelectionOfMedia:function(e){bus.$emit("mediaToggleRequested",e)},renameMedia:function(e){bus.$emit("renameMediaRequested",e)},deleteMedia:function(e){bus.$emit("deleteMediaRequested",e)},dragStart:function(e,t){bus.$emit("mediaDragStartRequested",e,t)}}}),Vue.component("mediaItemsTable",{template:'        <table class="table media-items-table">             <thead>                 <tr class="header-row">                     <th scope="col" class="thumbnail-column">{{ T.imageHeader }}</th>                     <th scope="col" v-on:click="changeSort(\'name\')">                        {{ T.nameHeader }}                          <sort-indicator colname="name" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator>                     </th>                     <th scope="col" v-on:click="changeSort(\'size\')">                         <span class="optional-col">                             {{ T.sizeHeader }}                          <sort-indicator colname="size" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator>                         </span>                     </th>                     <th scope="col" v-on:click="changeSort(\'mime\')">                         <span class="optional-col">                            {{ T.typeHeader }}                          <sort-indicator colname="mime" :selectedcolname="sortBy" :asc="sortAsc"></sort-indicator>                         </span>                     </th>                 </tr>            </thead>            <tbody>                     <tr v-for="media in filteredMediaItems"                           class="media-item"                           :class="{selected: isMediaSelected(media)}"                           v-on:click.stop="toggleSelectionOfMedia(media)"                           draggable="true" v-on:dragstart="dragStart(media, $event)"                           :key="media.name">                              <td class="thumbnail-column">                                 <div class="img-wrapper">                                     <img draggable="false" :src="media.url + \'?width=\' + thumbSize + \'&height=\' + thumbSize" />                                 </div>                             </td>                             <td>                                 <div class="media-name-cell">                                    <span class="break-word"> {{ media.name }} </span>                                    <div class="buttons-container">                                         <a href="javascript:;" class="btn btn-link btn-sm mr-1 edit-button" v-on:click.stop="renameMedia(media)"> {{ T.editButton }} </a >                                         <a href="javascript:;" class="btn btn-link btn-sm delete-button" v-on:click.stop="deleteMedia(media)"> {{ T.deleteButton }} </a>                                     </div>                                 </div>                             </td>                             <td>                                 <div class="text-col optional-col"> {{ isNaN(media.size)? 0 : Math.round(media.size / 1024) }} KB</div>                             </td>                             <td>                                 <div class="text-col optional-col">{{ media.mime }}</div>                             </td>                    </tr>            </tbody>        </table>         ',data:function(){return{T:{}}},props:{sortBy:String,sortAsc:Boolean,filteredMediaItems:Array,selectedMedias:Array,thumbSize:Number},created:function(){this.T.imageHeader=$("#t-image-header").val(),this.T.nameHeader=$("#t-name-header").val(),this.T.sizeHeader=$("#t-size-header").val(),this.T.typeHeader=$("#t-type-header").val(),this.T.editButton=$("#t-edit-button").val(),this.T.deleteButton=$("#t-delete-button").val()},methods:{isMediaSelected:function(e){return this.selectedMedias.some(function(t,n,o){return t.url.toLowerCase()===e.url.toLowerCase()})},changeSort:function(e){bus.$emit("sortChangeRequested",e)},toggleSelectionOfMedia:function(e){bus.$emit("mediaToggleRequested",e)},renameMedia:function(e){bus.$emit("renameMediaRequested",e)},deleteMedia:function(e){bus.$emit("deleteMediaRequested",e)},dragStart:function(e,t){bus.$emit("mediaDragStartRequested",e,t)}}}),Vue.component("pager",{template:'        <nav id="media-pager" aria-label="Pagination Navigation" role="navigation" :data-computed-trigger="itemsInCurrentPage.length">            <ul class= "pagination  pagination-sm">                 <li class="page-item media-first-button" :class="{disabled : !canDoFirst}">                     <a class="page-link" href="#" :tabindex="canDoFirst ? 0 : -1" v-on:click="goFirst">{{ T.pagerFirstButton }}</a>                 </li>                 <li class="page-item" :class="{disabled : !canDoPrev}">                     <a class="page-link" href="#" :tabindex="canDoPrev ? 0 : -1" v-on:click="previous">{{ T.pagerPreviousButton }}</a>                 </li>                 <li  v-if="link !== -1" class="page-item page-number"  :class="{active : current == link - 1}" v-for="link in pageLinks">                     <a class="page-link" href="#" v-on:click="goTo(link - 1)" :aria-label="\'Goto Page \' + link">                        {{link}}                         <span v-if="current == link -1" class="sr-only">(current)</span>                    </a>                 </li>                 <li class="page-item" :class="{disabled : !canDoNext}">                     <a class="page-link" href="#" :tabindex="canDoNext ? 0 : -1" v-on:click="next">{{ T.pagerNextButton }}</a>                 </li>                 <li class="page-item media-last-button" :class="{disabled : !canDoLast}">                     <a class="page-link" href="#" :tabindex="canDoLast ? 0 : -1" v-on:click="goLast">{{ T.pagerLastButton }}</a>                 </li>                 <li class="page-item ml-4 page-size-info">                    <div style="display: flex;">                        <span class="page-link disabled text-muted page-size-label">{{ T.pagerPageSizeLabel }}</span>                        <select id="pageSizeSelect" class="page-link" v-model="pageSize">                             <option v-for="option in pageSizeOptions" v-bind:value="option">                                 {{option}}                             </option>                         </select>                     </div>                </li>                 <li class="page-item ml-4 page-info">                     <span class="page-link disabled text-muted ">{{ T.pagerPageLabel }} {{current + 1}}/{{totalPages}}</span>                 </li>                 <li class="page-item ml-4 total-info">                      <span class="page-link disabled text-muted "> {{ T.pagerTotalLabel }} {{total}}</span>                 </li>             </ul>         </nav>        ',props:{sourceItems:Array},data:function(){return{pageSize:5,pageSizeOptions:[5,10,30,50,100],current:0,T:{}}},created:function(){this.T.pagerFirstButton=$("#t-pager-first-button").val(),this.T.pagerPreviousButton=$("#t-pager-previous-button").val(),this.T.pagerNextButton=$("#t-pager-next-button").val(),this.T.pagerLastButton=$("#t-pager-last-button").val(),this.T.pagerPageSizeLabel=$("#t-pager-page-size-label").val(),this.T.pagerPageLabel=$("#t-pager-page-label").val(),this.T.pagerTotalLabel=$("#t-pager-total-label").val()},methods:{next:function(){this.current=this.current+1},previous:function(){this.current=this.current-1},goFirst:function(){this.current=0},goLast:function(){this.current=this.totalPages-1},goTo:function(e){this.current=e}},computed:{total:function(){return this.sourceItems?this.sourceItems.length:0},totalPages:function(){var e=Math.ceil(this.total/this.pageSize);return e>0?e:1},isLastPage:function(){return this.current+1>=this.totalPages},isFirstPage:function(){return 0===this.current},canDoNext:function(){return!this.isLastPage},canDoPrev:function(){return!this.isFirstPage},canDoFirst:function(){return!this.isFirstPage},canDoLast:function(){return!this.isLastPage},itemsInCurrentPage:function(){var e=this.pageSize*this.current,t=e+this.pageSize,n=this.sourceItems.slice(e,t);return bus.$emit("pagerEvent",n),n},pageLinks:function(){var e=[];e.push(this.current+1);var t=this.current>0?this.current:-1;e.unshift(t);var n=this.current>1?this.current-1:-1;e.unshift(n);var o=this.totalPages-this.current>1?this.current+2:-1;e.push(o);var s=this.totalPages-this.current>2?this.current+3:-1;return e.push(s),e}},watch:{sourceItems:function(){this.current=0},pageSize:function(){this.current=0}}}),Vue.component("sortIndicator",{template:'        <div v-show="isActive" class="sort-indicator">             <span v-show="asc"><i class="small fa fa-chevron-up"></i></span>             <span v-show="!asc"><i class="small fa fa-chevron-down"></i></span>         </div>         ',props:{colname:String,selectedcolname:String,asc:Boolean},computed:{isActive:function(){return this.colname.toLowerCase()==this.selectedcolname.toLowerCase()}}});var mediaFieldApps=[];Vue.component("mediaFieldThumbsContainer",{template:'       <div id="mediaContainerMain" v-cloak>         <div v-if="mediaItems.length < 1" class="card text-center">             <div class= "card-body" >                <span class="hint">{{T.noImages}}</span>             </div>         </div>         <draggable :list="mediaItems" element="ol" class="row media-items-grid" >            <li v-for="media in mediaItems"                :key="media.vuekey"                 class="media-container-main-list-item card"                :style="{width: thumbSize + 2 + \'px\'}"                :class="{selected: selectedMedia == media}"                v-on:click="selectMedia(media)" v-if="!media.isRemoved">                    <div v-if="media.mediaPath!== \'not-found\'">                        <div class="thumb-container" :style="{height: thumbSize + \'px\'}" >                            <img v-if="media.mime.startsWith(\'image\')"                             :src="media.url + \'?width=\' + thumbSize + \'&height=\' + thumbSize"                             :data-mime="media.mime"                            :style="{maxHeight: thumbSize + \'px\' , maxWidth: thumbSize + \'px\'}"/>                                <i v-else class="fa fa-file-o" :data-mime="media.mime"></i>                         </div>                         <div class="media-container-main-item-title card-body">                                <a href="javascript:;" class="btn btn-light btn-sm float-right inline-media-button"                                v-on:click.stop="selectAndDeleteMedia(media)"><i class="fa fa-trash"></i></a>                                <span class="media-filename card-text small" :title="media.mediaPath">{{media.vuekey}}</span>                         </div>                    </div>                    <div v-else>                        <div class="thumb-container flex-column" :style="{height: thumbSize + \'px\'}">                            <i class="fa fa-ban text-danger d-block"></i>                            <span class="text-danger small d-block">{{ T.mediaNotFound }}</span>                            <span class="text-danger small d-block text-center">{{ T.discardWarning }}</span>                        </div>                        <div class="media-container-main-item-title card-body">                            <a href="javascript:;" class="btn btn-light btn-sm float-right inline-media-button"                                v-on:click.stop="selectAndDeleteMedia(media)"><i class="fa fa-trash"></i></a>                            <span class="media-filename card-text small text-danger" :title="media.name">{{ media.name }}</span>                        </div>                   </div>            </li>         </draggable>       </div>    ',data:function(){return{T:{}}},props:{mediaItems:Array,selectedMedia:Object,thumbSize:Number},created:function(){this.T.mediaNotFound=$("#t-media-not-found").val(),this.T.discardWarning=$("#t-discard-warning").val(),this.T.noImages=$("#t-no-images").val()},methods:{selectAndDeleteMedia:function(e){this.$parent.$emit("selectAndDeleteMediaRequested",e)},selectMedia:function(e){this.$parent.$emit("selectMediaRequested",e)}}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var n="dragover"===t;return function(o){o.dataTransfer=o.originalEvent&&o.originalEvent.dataTransfer;var s=o.dataTransfer;s&&-1!==e.inArray("Files",s.types)&&!1!==this._trigger(t,e.Event(t,{delegatedEvent:o}))&&(o.preventDefault(),n&&(s.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||!1!==n.autoUpload&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var o=e-this.timestamp;return(!this.bitrate||!n||o>n)&&(this.bitrate=(t-this.loaded)*(1e3/o)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var o,s=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&s-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=s,o=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=o-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(s,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=o,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(s,o,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,o=t.xhr?t.xhr():e.ajaxSettings.xhr();o.upload&&(e(o.upload).bind("progress",function(e){var o=e.originalEvent;e.lengthComputable=o.lengthComputable,e.loaded=o.loaded,e.total=o.total,n._onProgress(e,t)}),t.xhr=function(){return o})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n,o=this,s=t.files[0],r=t.multipart||!e.support.xhrFileUpload,i="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",s)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(s.name)+'"'),r?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:i,value:t.blob}):e.each(t.files,function(o,s){n.push({name:"array"===e.type(t.paramName)&&t.paramName[o]||i,value:s})})):(o._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(i,t.blob,s.name):e.each(t.files,function(s,r){(o._isInstanceOf("File",r)||o._isInstanceOf("Blob",r))&&n.append("array"===e.type(t.paramName)&&t.paramName[s]||i,r,r.uploadName||r.name)})),t.data=n):(t.contentType=s.type||"application/octet-stream",t.data=t.blob||s),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),o=t.paramName;return o?e.isArray(o)||(o=[o]):(o=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",s=(t.prop("files")||[1]).length;s;)o.push(n),s-=1}),o.length||(o=[n.prop("name")||"files[]"])),o},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,o){var s=e.Deferred(),r=s.promise();return n=n||this.options.context||r,!0===t?s.resolveWith(n,o):!1===t&&s.rejectWith(n,o),r.abort=s.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,n){var o=this,s=function(t){return e.Deferred().resolveWith(o,t).promise()};n.process=function(t,r){return(t||r)&&(n._processQueue=this._processQueue=(this._processQueue||s([this])).then(function(){return n.errorThrown?e.Deferred().rejectWith(o,[n]).promise():s(arguments)}).then(t,r)),this._processQueue||s([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=!1!==o._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)&&o._onSend(t,this)),this.jqXHR||o._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",o._trigger("fail",null,this),o._getXHRPromise(!1))},n.state=function(){return this.jqXHR?o._getDeferredState(this.jqXHR):this._processQueue?o._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===o._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),o=n&&n.length>1&&parseInt(n[1],10);return o&&o+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var o,s,r=this,i=t.files[0],a=i.size,d=t.uploadedBytes,l=t.maxChunkSize||a,u=this._blobSlice,c=e.Deferred(),p=c.promise();return!(!(this._isXHRUpload(t)&&u&&(d||l<a))||t.data)&&(!!n||(d>=a?(i.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",i.error])):(s=function(){var n=e.extend({},t),p=n._progress.loaded;n.blob=u.call(i,d,d+l,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+d+"-"+(d+n.chunkSize-1)+"/"+a,r._initXHRData(n),r._initProgressListener(n),o=(!1!==r._trigger("chunksend",null,n)&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(o,i,l){d=r._getUploadedBytes(l)||d+n.chunkSize,p+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:d-n.uploadedBytes,total:d-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=d,n.result=o,n.textStatus=i,n.jqXHR=l,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),d<a?s():c.resolveWith(n.context,[o,i,l])}).fail(function(e,t,o){n.jqXHR=e,n.textStatus=t,n.errorThrown=o,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),c.rejectWith(n.context,[e,t,o])})},this._enhancePromise(p),p.abort=function(){return o.abort()},s(),p)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,o,s){var r=s._progress.total,i=s._response;s._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),s),i.result=s.result=t,i.textStatus=s.textStatus=n,i.jqXHR=s.jqXHR=o,this._trigger("done",null,s)},_onFail:function(e,t,n,o){var s=o._response;o.recalculateProgress&&(this._progress.loaded-=o._progress.loaded,this._progress.total-=o._progress.total),s.jqXHR=o.jqXHR=e,s.textStatus=o.textStatus=t,s.errorThrown=o.errorThrown=n,this._trigger("fail",null,o)},_onAlways:function(e,t,n,o){this._trigger("always",null,o)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var o,s,r,i,a=this,d=a._getAJAXSettings(n),l=function(){return a._sending+=1,d._bitrateTimer=new a._BitrateTimer,o=o||((s||!1===a._trigger("send",e.Event("send",{delegatedEvent:t}),d))&&a._getXHRPromise(!1,d.context,s)||a._chunkedUpload(d)||e.ajax(d)).done(function(e,t,n){a._onDone(e,t,n,d)}).fail(function(e,t,n){a._onFail(e,t,n,d)}).always(function(e,t,n){if(a._onAlways(e,t,n,d),a._sending-=1,a._active-=1,d.limitConcurrentUploads&&d.limitConcurrentUploads>a._sending)for(var o=a._slots.shift();o;){if("pending"===a._getDeferredState(o)){o.resolve();break}o=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(t,d),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),i=r.then(l)):(this._sequence=this._sequence.then(l,l),i=this._sequence),i.abort=function(){return s=[void 0,"abort","abort"],o?o.abort():(r&&r.rejectWith(d.context,s),l())},this._enhancePromise(i)):l()},_onAdd:function(t,n){var o,s,r,i,a=this,d=!0,l=e.extend({},this.options,n),u=n.files,c=u.length,p=l.limitMultiFileUploads,h=l.limitMultiFileUploadSize,f=l.limitMultiFileUploadSizeOverhead,g=0,m=this._getParamName(l),v=0;if(!c)return!1;if(h&&void 0===u[0].size&&(h=void 0),(l.singleFileUploads||p||h)&&this._isXHRUpload(l))if(l.singleFileUploads||h||!p)if(!l.singleFileUploads&&h)for(r=[],o=[],i=0;i<c;i+=1)g+=u[i].size+f,(i+1===c||g+u[i+1].size+f>h||p&&i+1-v>=p)&&(r.push(u.slice(v,i+1)),(s=m.slice(v,i+1)).length||(s=m),o.push(s),v=i+1,g=0);else o=m;else for(r=[],o=[],i=0;i<c;i+=p)r.push(u.slice(i,i+p)),(s=m.slice(i,i+p)).length||(s=m),o.push(s);else r=[u],o=[m];return n.originalFiles=u,e.each(r||u,function(s,i){var l=e.extend({},n);return l.files=r?i:[i],l.paramName=o[s],a._initResponseObject(l),a._initProgressObject(l),a._addConvenienceMethods(t,l),d=a._trigger("add",e.Event("add",{delegatedEvent:t}),l)}),d},_replaceFileInput:function(t){var n=t.fileInput,o=n.clone(!0),s=n.is(document.activeElement);t.fileInputClone=o,e("<form></form>").append(o)[0].reset(),n.after(o).detach(),s&&o.focus(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?o[0]:t}),n[0]===this.element[0]&&(this.element=o)},_handleFileTreeEntry:function(t,n){var o,s=this,r=e.Deferred(),i=[],a=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},d=function(){o.readEntries(function(e){e.length?(i=i.concat(e),d()):function(e){s._handleFileTreeEntries(e,n+t.name+"/").done(function(e){r.resolve(e)}).fail(a)}(i)},a)};return n=n||"",t.isFile?t._file?(t._file.relativePath=n,r.resolve(t._file)):t.file(function(e){e.relativePath=n,r.resolve(e)},a):t.isDirectory?(o=t.createReader(),d()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,n){var o=this;return e.when.apply(e,e.map(t,function(e){return o._handleFileTreeEntry(e,n)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){var n=(t=t||{}).items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){var n,o,s=(t=e(t)).prop("webkitEntries")||t.prop("entries");if(s&&s.length)return this._handleFileTreeEntries(s);if((n=e.makeArray(t.prop("files"))).length)void 0===n[0].name&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(o=t.prop("value")))return e.Deferred().resolve([]).promise();n=[{name:o.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,o={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(o.fileInput).always(function(s){o.files=s,n.options.replaceFileInput&&n._replaceFileInput(o),!1!==n._trigger("change",e.Event("change",{delegatedEvent:t}),o)&&n._onAdd(t,o)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,o={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&o.files.push(n)}),!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:t}),o)&&this._onAdd(t,o))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,o=t.dataTransfer,s={};o&&o.files&&o.files.length&&(t.preventDefault(),this._getDroppedFiles(o).always(function(o){s.files=o,!1!==n._trigger("drop",e.Event("drop",{delegatedEvent:t}),s)&&n._onAdd(t,s)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,n){var o=-1!==e.inArray(t,this._specialOptions);o&&this._destroyEventHandlers(),this._super(t,n),o&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return"url"!==t&&"string"===e.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,o=this.element.data();e.each(this.element[0].attributes,function(e,s){var r,i=s.name.toLowerCase();/^data-/.test(i)&&(i=i.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),r=o[i],t._isRegExpOption(i,r)&&(r=t._getRegExp(r)),n[i]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,o,s=this,r=e.Deferred(),i=r.promise();return i.abort=function(){return o=!0,n?n.abort():(r.reject(null,"abort","abort"),i)},this._getFileInputFiles(t.fileInput).always(function(e){o||(e.length?(t.files=e,(n=s._onSend(null,t)).then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})):r.reject())}),this._enhancePromise(i)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(e){"use strict";var t=0,n=e,o="parseJSON";"JSON"in window&&"parse"in JSON&&(n=JSON,o="parse"),e.ajaxTransport("iframe",function(n){if(n.async){var o,s,r,i=n.initialIframeSrc||"javascript:false;";return{send:function(a,d){(o=e('<form style="display:none;"></form>')).attr("accept-charset",n.formAcceptCharset),r=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+r+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+r+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+r+"_method=PATCH",n.type="POST"),s=e('<iframe src="'+i+'" name="iframe-transport-'+(t+=1)+'"></iframe>').bind("load",function(){var t,r=e.isArray(n.paramName)?n.paramName:[n.paramName];s.unbind("load").bind("load",function(){var t;try{if(!(t=s.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}d(200,"success",{iframe:t}),e('<iframe src="'+i+'"></iframe>').appendTo(o),window.setTimeout(function(){o.remove()},0)}),o.prop("target",s.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(o)}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",r[t]||n.paramName)}),o.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),o.submit(),t&&t.length&&n.fileInput.each(function(n,o){var s=e(t[n]);e(o).prop("name",s.prop("name")).attr("form",s.attr("form")),s.replaceWith(o)})}),o.append(s).appendTo(document.body)},abort:function(){s&&s.unbind("load").prop("src",i),o&&o.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&n[o](e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),Vue.component("upload",{template:'        <div :class="{ \'upload-warning\' : model.errorMessage }" class="upload m-2 p-2 pt-0">             <span v-if="model.errorMessage" v-on:click="dismissWarning()" class="close-warning"><i class="fa fa-times"></i> </span>            <p class="upload-name" :title="model.errorMessage">{{ model.name }}</p>             <div>                <span v-show="!model.errorMessage" :style="{ width: model.percentage + \'%\'}" class="progress-bar"> </span>                <span v-if="model.errorMessage" class="error-message" :title="model.errorMessage"> Error: {{ model.errorMessage }} </span>             </div>         </div>         ',props:{model:Object},mounted:function(){var e=this;$("#fileupload").bind("fileuploadprogress",function(t,n){n.files[0].name===e.model.name&&(e.model.percentage=parseInt(n.loaded/n.total*100,10))}),$("#fileupload").bind("fileuploaddone",function(t,n){n.files[0].name===e.model.name&&(n.result.files[0].error?e.handleFailure(n.files[0].name,n.result.files[0].error):bus.$emit("removalRequest",e.model))}),$("#fileupload").bind("fileuploadfail",function(t,n){n.files[0].name===e.model.name&&e.handleFailure(n.files[0].name,n.textStatus)})},methods:{handleFailure:function(e,t){e===this.model.name&&(this.model.errorMessage=t,bus.$emit("ErrorOnUpload",this.model))},dismissWarning:function(){bus.$emit("removalRequest",this.model)}}}),Vue.component("uploadList",{template:'        <div class="upload-list" v-show="files.length > 0">             <div class="header" @click="expanded = !expanded">                 <span> {{ T.uploads }} </span>                 <span v-show="pendingCount"> (Pending: {{ pendingCount }}) </span>                 <span v-show="errorCount" :class="{ \'text-danger\' : errorCount }"> ( {{ T.errors }}: {{ errorCount }} / <a href="javascript:;" v-on:click.stop="clearErrors" > {{ T.clearErrors }} </a>)</span>                     <div class="toggle-button">                     <div v-show="expanded">                         <i class="fa fa-chevron-down"></i>                     </div>                     <div v-show="!expanded">                         <i class="fa fa-chevron-up"></i>                     </div>                 </div>             </div>             <div class="card-body" v-show="expanded">                 <div class="d-flex flex-wrap">                     <upload v-for="f in files" :key="f.name"  :model="f"></upload>                 </div >             </div>         </div>         ',data:function(){return{files:[],T:{},expanded:!1,pendingCount:0,errorCount:0}},created:function(){this.T.uploads=$("#t-uploads").val(),this.T.errors=$("#t-errors").val(),this.T.clearErrors=$("#t-clear-errors").val()},computed:{fileCount:function(){return this.files.length}},mounted:function(){var e=this;$("#fileupload").bind("fileuploadadd",function(t,n){n.files&&n.files.forEach(function(t){e.files.some(function(e){return e.name==t.name})?console.error("A file with the same name is already on the queue:"+t.name):e.files.push({name:t.name,percentage:0,errorMessage:""})})}),bus.$on("removalRequest",function(t){e.files.forEach(function(e,n,o){e.name==t.name&&o.splice(n,1)})}),bus.$on("ErrorOnUpload",function(t){e.updateCount()})},methods:{updateCount:function(){this.errorCount=this.files.filter(function(e){return""!=e.errorMessage}).length,this.pendingCount=this.files.length-this.errorCount,this.files.length<1&&(this.expanded=!1)},clearErrors:function(){this.files=this.files.filter(function(e){return""==e.errorMessage})}},watch:{files:function(){this.updateCount()}}});
