{"version":3,"sources":["<anon>"],"sourcesContent":["/*\n * jQuery Iframe Transport Plugin\n * https://github.com/blueimp/jQuery-File-Upload\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n */\n\n/* global define, require */\n\n(function (factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // Register as an anonymous AMD module:\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // Node/CommonJS:\n    factory(require('jquery'));\n  } else {\n    // Browser globals:\n    factory(window.jQuery);\n  }\n})(function ($) {\n  'use strict';\n\n  // Helper variable to create unique names for the transport iframes:\n  var counter = 0,\n    jsonAPI = $,\n    jsonParse = 'parseJSON';\n\n  if ('JSON' in window && 'parse' in JSON) {\n    jsonAPI = JSON;\n    jsonParse = 'parse';\n  }\n\n  // The iframe transport accepts four additional options:\n  // options.fileInput: a jQuery collection of file input fields\n  // options.paramName: the parameter name for the file form data,\n  //  overrides the name property of the file input field(s),\n  //  can be a string or an array of strings.\n  // options.formData: an array of objects with name and value properties,\n  //  equivalent to the return data of .serializeArray(), e.g.:\n  //  [{name: 'a', value: 1}, {name: 'b', value: 2}]\n  // options.initialIframeSrc: the URL of the initial iframe src,\n  //  by default set to \"javascript:false;\"\n  $.ajaxTransport('iframe', function (options) {\n    if (options.async) {\n      // javascript:false as initial iframe src\n      // prevents warning popups on HTTPS in IE6:\n      // eslint-disable-next-line no-script-url\n      var initialIframeSrc = options.initialIframeSrc || 'javascript:false;',\n        form,\n        iframe,\n        addParamChar;\n      return {\n        send: function (_, completeCallback) {\n          form = $('<form style=\"display:none;\"></form>');\n          form.attr('accept-charset', options.formAcceptCharset);\n          addParamChar = /\\?/.test(options.url) ? '&' : '?';\n          // XDomainRequest only supports GET and POST:\n          if (options.type === 'DELETE') {\n            options.url = options.url + addParamChar + '_method=DELETE';\n            options.type = 'POST';\n          } else if (options.type === 'PUT') {\n            options.url = options.url + addParamChar + '_method=PUT';\n            options.type = 'POST';\n          } else if (options.type === 'PATCH') {\n            options.url = options.url + addParamChar + '_method=PATCH';\n            options.type = 'POST';\n          }\n          // IE versions below IE8 cannot set the name property of\n          // elements that have already been added to the DOM,\n          // so we set the name along with the iframe HTML markup:\n          counter += 1;\n          iframe = $(\n            '<iframe src=\"' +\n              initialIframeSrc +\n              '\" name=\"iframe-transport-' +\n              counter +\n              '\"></iframe>'\n          ).on('load', function () {\n            var fileInputClones,\n              paramNames = $.isArray(options.paramName)\n                ? options.paramName\n                : [options.paramName];\n            iframe.off('load').on('load', function () {\n              var response;\n              // Wrap in a try/catch block to catch exceptions thrown\n              // when trying to access cross-domain iframe contents:\n              try {\n                response = iframe.contents();\n                // Google Chrome and Firefox do not throw an\n                // exception when calling iframe.contents() on\n                // cross-domain requests, so we unify the response:\n                if (!response.length || !response[0].firstChild) {\n                  throw new Error();\n                }\n              } catch (e) {\n                response = undefined;\n              }\n              // The complete callback returns the\n              // iframe content document as response object:\n              completeCallback(200, 'success', { iframe: response });\n              // Fix for IE endless progress bar activity bug\n              // (happens on form submits to iframe targets):\n              $('<iframe src=\"' + initialIframeSrc + '\"></iframe>').appendTo(\n                form\n              );\n              window.setTimeout(function () {\n                // Removing the form in a setTimeout call\n                // allows Chrome's developer tools to display\n                // the response result\n                form.remove();\n              }, 0);\n            });\n            form\n              .prop('target', iframe.prop('name'))\n              .prop('action', options.url)\n              .prop('method', options.type);\n            if (options.formData) {\n              $.each(options.formData, function (index, field) {\n                $('<input type=\"hidden\"/>')\n                  .prop('name', field.name)\n                  .val(field.value)\n                  .appendTo(form);\n              });\n            }\n            if (\n              options.fileInput &&\n              options.fileInput.length &&\n              options.type === 'POST'\n            ) {\n              fileInputClones = options.fileInput.clone();\n              // Insert a clone for each file input field:\n              options.fileInput.after(function (index) {\n                return fileInputClones[index];\n              });\n              if (options.paramName) {\n                options.fileInput.each(function (index) {\n                  $(this).prop('name', paramNames[index] || options.paramName);\n                });\n              }\n              // Appending the file input fields to the hidden form\n              // removes them from their original location:\n              form\n                .append(options.fileInput)\n                .prop('enctype', 'multipart/form-data')\n                // enctype must be set as encoding for IE:\n                .prop('encoding', 'multipart/form-data');\n              // Remove the HTML5 form attribute from the input(s):\n              options.fileInput.removeAttr('form');\n            }\n            window.setTimeout(function () {\n              // Submitting the form in a setTimeout call fixes an issue with\n              // Safari 13 not triggering the iframe load event after resetting\n              // the load event handler, see also:\n              // https://github.com/blueimp/jQuery-File-Upload/issues/3633\n              form.submit();\n              // Insert the file input fields at their original location\n              // by replacing the clones with the originals:\n              if (fileInputClones && fileInputClones.length) {\n                options.fileInput.each(function (index, input) {\n                  var clone = $(fileInputClones[index]);\n                  // Restore the original name and form properties:\n                  $(input)\n                    .prop('name', clone.prop('name'))\n                    .attr('form', clone.attr('form'));\n                  clone.replaceWith(input);\n                });\n              }\n            }, 0);\n          });\n          form.append(iframe).appendTo(document.body);\n        },\n        abort: function () {\n          if (iframe) {\n            // javascript:false as iframe src aborts the request\n            // and prevents warning popups on HTTPS in IE6.\n            iframe.off('load').prop('src', initialIframeSrc);\n          }\n          if (form) {\n            form.remove();\n          }\n        }\n      };\n    }\n  });\n\n  // The iframe transport returns the iframe content document as response.\n  // The following adds converters from iframe to text, json, html, xml\n  // and script.\n  // Please note that the Content-Type for JSON responses has to be text/plain\n  // or text/html, if the browser doesn't include application/json in the\n  // Accept header, else IE will show a download dialog.\n  // The Content-Type for XML responses on the other hand has to be always\n  // application/xml or text/xml, so IE properly parses the XML response.\n  // See also\n  // https://github.com/blueimp/jQuery-File-Upload/wiki/Setup#content-type-negotiation\n  $.ajaxSetup({\n    converters: {\n      'iframe text': function (iframe) {\n        return iframe && $(iframe[0].body).text();\n      },\n      'iframe json': function (iframe) {\n        return iframe && jsonAPI[jsonParse]($(iframe[0].body).text());\n      },\n      'iframe html': function (iframe) {\n        return iframe && $(iframe[0].body).html();\n      },\n      'iframe xml': function (iframe) {\n        var xmlDoc = iframe && iframe[0];\n        return xmlDoc && $.isXMLDoc(xmlDoc)\n          ? xmlDoc\n          : $.parseXML(\n              (xmlDoc.XMLDocument && xmlDoc.XMLDocument.xml) ||\n                $(xmlDoc.body).html()\n            );\n      },\n      'iframe script': function (iframe) {\n        return iframe && $.globalEval($(iframe[0].body).text());\n      }\n    }\n  });\n});\n\n\n/*\n * jQuery File Upload Plugin\n * https://github.com/blueimp/jQuery-File-Upload\n *\n * Copyright 2010, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n */\n\n/* global define, require */\n/* eslint-disable new-cap */\n\n(function (factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // Register as an anonymous AMD module:\n    define(['jquery', 'jquery-ui/ui/widget'], factory);\n  } else if (typeof exports === 'object') {\n    // Node/CommonJS:\n    factory(require('jquery'), require('./vendor/jquery.ui.widget'));\n  } else {\n    // Browser globals:\n    factory(window.jQuery);\n  }\n})(function ($) {\n  'use strict';\n\n  // Detect file input support, based on\n  // https://viljamis.com/2012/file-upload-support-on-mobile/\n  $.support.fileInput = !(\n    new RegExp(\n      // Handle devices which give false positives for the feature detection:\n      '(Android (1\\\\.[0156]|2\\\\.[01]))' +\n        '|(Windows Phone (OS 7|8\\\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)' +\n        '|(w(eb)?OSBrowser)|(webOS)' +\n        '|(Kindle/(1\\\\.0|2\\\\.[05]|3\\\\.0))'\n    ).test(window.navigator.userAgent) ||\n    // Feature detection for all other devices:\n    $('<input type=\"file\"/>').prop('disabled')\n  );\n\n  // The FileReader API is not actually used, but works as feature detection,\n  // as some Safari versions (5?) support XHR file uploads via the FormData API,\n  // but not non-multipart XHR file uploads.\n  // window.XMLHttpRequestUpload is not available on IE10, so we check for\n  // window.ProgressEvent instead to detect XHR2 file upload capability:\n  $.support.xhrFileUpload = !!(window.ProgressEvent && window.FileReader);\n  $.support.xhrFormDataFileUpload = !!window.FormData;\n\n  // Detect support for Blob slicing (required for chunked uploads):\n  $.support.blobSlice =\n    window.Blob &&\n    (Blob.prototype.slice ||\n      Blob.prototype.webkitSlice ||\n      Blob.prototype.mozSlice);\n\n  /**\n   * Helper function to create drag handlers for dragover/dragenter/dragleave\n   *\n   * @param {string} type Event type\n   * @returns {Function} Drag handler\n   */\n  function getDragHandler(type) {\n    var isDragOver = type === 'dragover';\n    return function (e) {\n      e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;\n      var dataTransfer = e.dataTransfer;\n      if (\n        dataTransfer &&\n        $.inArray('Files', dataTransfer.types) !== -1 &&\n        this._trigger(type, $.Event(type, { delegatedEvent: e })) !== false\n      ) {\n        e.preventDefault();\n        if (isDragOver) {\n          dataTransfer.dropEffect = 'copy';\n        }\n      }\n    };\n  }\n\n  // The fileupload widget listens for change events on file input fields defined\n  // via fileInput setting and paste or drop events of the given dropZone.\n  // In addition to the default jQuery Widget methods, the fileupload widget\n  // exposes the \"add\" and \"send\" methods, to add or directly send files using\n  // the fileupload API.\n  // By default, files added via file input selection, paste, drag & drop or\n  // \"add\" method are uploaded immediately, but it is possible to override\n  // the \"add\" callback option to queue file uploads.\n  $.widget('blueimp.fileupload', {\n    options: {\n      // The drop target element(s), by the default the complete document.\n      // Set to null to disable drag & drop support:\n      dropZone: $(document),\n      // The paste target element(s), by the default undefined.\n      // Set to a DOM node or jQuery object to enable file pasting:\n      pasteZone: undefined,\n      // The file input field(s), that are listened to for change events.\n      // If undefined, it is set to the file input fields inside\n      // of the widget element on plugin initialization.\n      // Set to null to disable the change listener.\n      fileInput: undefined,\n      // By default, the file input field is replaced with a clone after\n      // each input field change event. This is required for iframe transport\n      // queues and allows change events to be fired for the same file\n      // selection, but can be disabled by setting the following option to false:\n      replaceFileInput: true,\n      // The parameter name for the file form data (the request argument name).\n      // If undefined or empty, the name property of the file input field is\n      // used, or \"files[]\" if the file input name property is also empty,\n      // can be a string or an array of strings:\n      paramName: undefined,\n      // By default, each file of a selection is uploaded using an individual\n      // request for XHR type uploads. Set to false to upload file\n      // selections in one request each:\n      singleFileUploads: true,\n      // To limit the number of files uploaded with one XHR request,\n      // set the following option to an integer greater than 0:\n      limitMultiFileUploads: undefined,\n      // The following option limits the number of files uploaded with one\n      // XHR request to keep the request size under or equal to the defined\n      // limit in bytes:\n      limitMultiFileUploadSize: undefined,\n      // Multipart file uploads add a number of bytes to each uploaded file,\n      // therefore the following option adds an overhead for each file used\n      // in the limitMultiFileUploadSize configuration:\n      limitMultiFileUploadSizeOverhead: 512,\n      // Set the following option to true to issue all file upload requests\n      // in a sequential order:\n      sequentialUploads: false,\n      // To limit the number of concurrent uploads,\n      // set the following option to an integer greater than 0:\n      limitConcurrentUploads: undefined,\n      // Set the following option to true to force iframe transport uploads:\n      forceIframeTransport: false,\n      // Set the following option to the location of a redirect url on the\n      // origin server, for cross-domain iframe transport uploads:\n      redirect: undefined,\n      // The parameter name for the redirect url, sent as part of the form\n      // data and set to 'redirect' if this option is empty:\n      redirectParamName: undefined,\n      // Set the following option to the location of a postMessage window,\n      // to enable postMessage transport uploads:\n      postMessage: undefined,\n      // By default, XHR file uploads are sent as multipart/form-data.\n      // The iframe transport is always using multipart/form-data.\n      // Set to false to enable non-multipart XHR uploads:\n      multipart: true,\n      // To upload large files in smaller chunks, set the following option\n      // to a preferred maximum chunk size. If set to 0, null or undefined,\n      // or the browser does not support the required Blob API, files will\n      // be uploaded as a whole.\n      maxChunkSize: undefined,\n      // When a non-multipart upload or a chunked multipart upload has been\n      // aborted, this option can be used to resume the upload by setting\n      // it to the size of the already uploaded bytes. This option is most\n      // useful when modifying the options object inside of the \"add\" or\n      // \"send\" callbacks, as the options are cloned for each file upload.\n      uploadedBytes: undefined,\n      // By default, failed (abort or error) file uploads are removed from the\n      // global progress calculation. Set the following option to false to\n      // prevent recalculating the global progress data:\n      recalculateProgress: true,\n      // Interval in milliseconds to calculate and trigger progress events:\n      progressInterval: 100,\n      // Interval in milliseconds to calculate progress bitrate:\n      bitrateInterval: 500,\n      // By default, uploads are started automatically when adding files:\n      autoUpload: true,\n      // By default, duplicate file names are expected to be handled on\n      // the server-side. If this is not possible (e.g. when uploading\n      // files directly to Amazon S3), the following option can be set to\n      // an empty object or an object mapping existing filenames, e.g.:\n      // { \"image.jpg\": true, \"image (1).jpg\": true }\n      // If it is set, all files will be uploaded with unique filenames,\n      // adding increasing number suffixes if necessary, e.g.:\n      // \"image (2).jpg\"\n      uniqueFilenames: undefined,\n\n      // Error and info messages:\n      messages: {\n        uploadedBytes: 'Uploaded bytes exceed file size'\n      },\n\n      // Translation function, gets the message key to be translated\n      // and an object with context specific data as arguments:\n      i18n: function (message, context) {\n        // eslint-disable-next-line no-param-reassign\n        message = this.messages[message] || message.toString();\n        if (context) {\n          $.each(context, function (key, value) {\n            // eslint-disable-next-line no-param-reassign\n            message = message.replace('{' + key + '}', value);\n          });\n        }\n        return message;\n      },\n\n      // Additional form data to be sent along with the file uploads can be set\n      // using this option, which accepts an array of objects with name and\n      // value properties, a function returning such an array, a FormData\n      // object (for XHR file uploads), or a simple object.\n      // The form of the first fileInput is given as parameter to the function:\n      formData: function (form) {\n        return form.serializeArray();\n      },\n\n      // The add callback is invoked as soon as files are added to the fileupload\n      // widget (via file input selection, drag & drop, paste or add API call).\n      // If the singleFileUploads option is enabled, this callback will be\n      // called once for each file in the selection for XHR file uploads, else\n      // once for each file selection.\n      //\n      // The upload starts when the submit method is invoked on the data parameter.\n      // The data object contains a files property holding the added files\n      // and allows you to override plugin options as well as define ajax settings.\n      //\n      // Listeners for this callback can also be bound the following way:\n      // .on('fileuploadadd', func);\n      //\n      // data.submit() returns a Promise object and allows to attach additional\n      // handlers using jQuery's Deferred callbacks:\n      // data.submit().done(func).fail(func).always(func);\n      add: function (e, data) {\n        if (e.isDefaultPrevented()) {\n          return false;\n        }\n        if (\n          data.autoUpload ||\n          (data.autoUpload !== false &&\n            $(this).fileupload('option', 'autoUpload'))\n        ) {\n          data.process().done(function () {\n            data.submit();\n          });\n        }\n      },\n\n      // Other callbacks:\n\n      // Callback for the submit event of each file upload:\n      // submit: function (e, data) {}, // .on('fileuploadsubmit', func);\n\n      // Callback for the start of each file upload request:\n      // send: function (e, data) {}, // .on('fileuploadsend', func);\n\n      // Callback for successful uploads:\n      // done: function (e, data) {}, // .on('fileuploaddone', func);\n\n      // Callback for failed (abort or error) uploads:\n      // fail: function (e, data) {}, // .on('fileuploadfail', func);\n\n      // Callback for completed (success, abort or error) requests:\n      // always: function (e, data) {}, // .on('fileuploadalways', func);\n\n      // Callback for upload progress events:\n      // progress: function (e, data) {}, // .on('fileuploadprogress', func);\n\n      // Callback for global upload progress events:\n      // progressall: function (e, data) {}, // .on('fileuploadprogressall', func);\n\n      // Callback for uploads start, equivalent to the global ajaxStart event:\n      // start: function (e) {}, // .on('fileuploadstart', func);\n\n      // Callback for uploads stop, equivalent to the global ajaxStop event:\n      // stop: function (e) {}, // .on('fileuploadstop', func);\n\n      // Callback for change events of the fileInput(s):\n      // change: function (e, data) {}, // .on('fileuploadchange', func);\n\n      // Callback for paste events to the pasteZone(s):\n      // paste: function (e, data) {}, // .on('fileuploadpaste', func);\n\n      // Callback for drop events of the dropZone(s):\n      // drop: function (e, data) {}, // .on('fileuploaddrop', func);\n\n      // Callback for dragover events of the dropZone(s):\n      // dragover: function (e) {}, // .on('fileuploaddragover', func);\n\n      // Callback before the start of each chunk upload request (before form data initialization):\n      // chunkbeforesend: function (e, data) {}, // .on('fileuploadchunkbeforesend', func);\n\n      // Callback for the start of each chunk upload request:\n      // chunksend: function (e, data) {}, // .on('fileuploadchunksend', func);\n\n      // Callback for successful chunk uploads:\n      // chunkdone: function (e, data) {}, // .on('fileuploadchunkdone', func);\n\n      // Callback for failed (abort or error) chunk uploads:\n      // chunkfail: function (e, data) {}, // .on('fileuploadchunkfail', func);\n\n      // Callback for completed (success, abort or error) chunk upload requests:\n      // chunkalways: function (e, data) {}, // .on('fileuploadchunkalways', func);\n\n      // The plugin options are used as settings object for the ajax calls.\n      // The following are jQuery ajax settings required for the file uploads:\n      processData: false,\n      contentType: false,\n      cache: false,\n      timeout: 0\n    },\n\n    // jQuery versions before 1.8 require promise.pipe if the return value is\n    // used, as promise.then in older versions has a different behavior, see:\n    // https://blog.jquery.com/2012/08/09/jquery-1-8-released/\n    // https://bugs.jquery.com/ticket/11010\n    // https://github.com/blueimp/jQuery-File-Upload/pull/3435\n    _promisePipe: (function () {\n      var parts = $.fn.jquery.split('.');\n      return Number(parts[0]) > 1 || Number(parts[1]) > 7 ? 'then' : 'pipe';\n    })(),\n\n    // A list of options that require reinitializing event listeners and/or\n    // special initialization code:\n    _specialOptions: [\n      'fileInput',\n      'dropZone',\n      'pasteZone',\n      'multipart',\n      'forceIframeTransport'\n    ],\n\n    _blobSlice:\n      $.support.blobSlice &&\n      function () {\n        var slice = this.slice || this.webkitSlice || this.mozSlice;\n        return slice.apply(this, arguments);\n      },\n\n    _BitrateTimer: function () {\n      this.timestamp = Date.now ? Date.now() : new Date().getTime();\n      this.loaded = 0;\n      this.bitrate = 0;\n      this.getBitrate = function (now, loaded, interval) {\n        var timeDiff = now - this.timestamp;\n        if (!this.bitrate || !interval || timeDiff > interval) {\n          this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;\n          this.loaded = loaded;\n          this.timestamp = now;\n        }\n        return this.bitrate;\n      };\n    },\n\n    _isXHRUpload: function (options) {\n      return (\n        !options.forceIframeTransport &&\n        ((!options.multipart && $.support.xhrFileUpload) ||\n          $.support.xhrFormDataFileUpload)\n      );\n    },\n\n    _getFormData: function (options) {\n      var formData;\n      if ($.type(options.formData) === 'function') {\n        return options.formData(options.form);\n      }\n      if ($.isArray(options.formData)) {\n        return options.formData;\n      }\n      if ($.type(options.formData) === 'object') {\n        formData = [];\n        $.each(options.formData, function (name, value) {\n          formData.push({ name: name, value: value });\n        });\n        return formData;\n      }\n      return [];\n    },\n\n    _getTotal: function (files) {\n      var total = 0;\n      $.each(files, function (index, file) {\n        total += file.size || 1;\n      });\n      return total;\n    },\n\n    _initProgressObject: function (obj) {\n      var progress = {\n        loaded: 0,\n        total: 0,\n        bitrate: 0\n      };\n      if (obj._progress) {\n        $.extend(obj._progress, progress);\n      } else {\n        obj._progress = progress;\n      }\n    },\n\n    _initResponseObject: function (obj) {\n      var prop;\n      if (obj._response) {\n        for (prop in obj._response) {\n          if (Object.prototype.hasOwnProperty.call(obj._response, prop)) {\n            delete obj._response[prop];\n          }\n        }\n      } else {\n        obj._response = {};\n      }\n    },\n\n    _onProgress: function (e, data) {\n      if (e.lengthComputable) {\n        var now = Date.now ? Date.now() : new Date().getTime(),\n          loaded;\n        if (\n          data._time &&\n          data.progressInterval &&\n          now - data._time < data.progressInterval &&\n          e.loaded !== e.total\n        ) {\n          return;\n        }\n        data._time = now;\n        loaded =\n          Math.floor(\n            (e.loaded / e.total) * (data.chunkSize || data._progress.total)\n          ) + (data.uploadedBytes || 0);\n        // Add the difference from the previously loaded state\n        // to the global loaded counter:\n        this._progress.loaded += loaded - data._progress.loaded;\n        this._progress.bitrate = this._bitrateTimer.getBitrate(\n          now,\n          this._progress.loaded,\n          data.bitrateInterval\n        );\n        data._progress.loaded = data.loaded = loaded;\n        data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(\n          now,\n          loaded,\n          data.bitrateInterval\n        );\n        // Trigger a custom progress event with a total data property set\n        // to the file size(s) of the current upload and a loaded data\n        // property calculated accordingly:\n        this._trigger(\n          'progress',\n          $.Event('progress', { delegatedEvent: e }),\n          data\n        );\n        // Trigger a global progress event for all current file uploads,\n        // including ajax calls queued for sequential file uploads:\n        this._trigger(\n          'progressall',\n          $.Event('progressall', { delegatedEvent: e }),\n          this._progress\n        );\n      }\n    },\n\n    _initProgressListener: function (options) {\n      var that = this,\n        xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();\n      // Access to the native XHR object is required to add event listeners\n      // for the upload progress event:\n      if (xhr.upload) {\n        $(xhr.upload).on('progress', function (e) {\n          var oe = e.originalEvent;\n          // Make sure the progress event properties get copied over:\n          e.lengthComputable = oe.lengthComputable;\n          e.loaded = oe.loaded;\n          e.total = oe.total;\n          that._onProgress(e, options);\n        });\n        options.xhr = function () {\n          return xhr;\n        };\n      }\n    },\n\n    _deinitProgressListener: function (options) {\n      var xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();\n      if (xhr.upload) {\n        $(xhr.upload).off('progress');\n      }\n    },\n\n    _isInstanceOf: function (type, obj) {\n      // Cross-frame instanceof check\n      return Object.prototype.toString.call(obj) === '[object ' + type + ']';\n    },\n\n    _getUniqueFilename: function (name, map) {\n      // eslint-disable-next-line no-param-reassign\n      name = String(name);\n      if (map[name]) {\n        // eslint-disable-next-line no-param-reassign\n        name = name.replace(\n          /(?: \\(([\\d]+)\\))?(\\.[^.]+)?$/,\n          function (_, p1, p2) {\n            var index = p1 ? Number(p1) + 1 : 1;\n            var ext = p2 || '';\n            return ' (' + index + ')' + ext;\n          }\n        );\n        return this._getUniqueFilename(name, map);\n      }\n      map[name] = true;\n      return name;\n    },\n\n    _initXHRData: function (options) {\n      var that = this,\n        formData,\n        file = options.files[0],\n        // Ignore non-multipart setting if not supported:\n        multipart = options.multipart || !$.support.xhrFileUpload,\n        paramName =\n          $.type(options.paramName) === 'array'\n            ? options.paramName[0]\n            : options.paramName;\n      options.headers = $.extend({}, options.headers);\n      if (options.contentRange) {\n        options.headers['Content-Range'] = options.contentRange;\n      }\n      if (!multipart || options.blob || !this._isInstanceOf('File', file)) {\n        options.headers['Content-Disposition'] =\n          'attachment; filename=\"' +\n          encodeURI(file.uploadName || file.name) +\n          '\"';\n      }\n      if (!multipart) {\n        options.contentType = file.type || 'application/octet-stream';\n        options.data = options.blob || file;\n      } else if ($.support.xhrFormDataFileUpload) {\n        if (options.postMessage) {\n          // window.postMessage does not allow sending FormData\n          // objects, so we just add the File/Blob objects to\n          // the formData array and let the postMessage window\n          // create the FormData object out of this array:\n          formData = this._getFormData(options);\n          if (options.blob) {\n            formData.push({\n              name: paramName,\n              value: options.blob\n            });\n          } else {\n            $.each(options.files, function (index, file) {\n              formData.push({\n                name:\n                  ($.type(options.paramName) === 'array' &&\n                    options.paramName[index]) ||\n                  paramName,\n                value: file\n              });\n            });\n          }\n        } else {\n          if (that._isInstanceOf('FormData', options.formData)) {\n            formData = options.formData;\n          } else {\n            formData = new FormData();\n            $.each(this._getFormData(options), function (index, field) {\n              formData.append(field.name, field.value);\n            });\n          }\n          if (options.blob) {\n            formData.append(\n              paramName,\n              options.blob,\n              file.uploadName || file.name\n            );\n          } else {\n            $.each(options.files, function (index, file) {\n              // This check allows the tests to run with\n              // dummy objects:\n              if (\n                that._isInstanceOf('File', file) ||\n                that._isInstanceOf('Blob', file)\n              ) {\n                var fileName = file.uploadName || file.name;\n                if (options.uniqueFilenames) {\n                  fileName = that._getUniqueFilename(\n                    fileName,\n                    options.uniqueFilenames\n                  );\n                }\n                formData.append(\n                  ($.type(options.paramName) === 'array' &&\n                    options.paramName[index]) ||\n                    paramName,\n                  file,\n                  fileName\n                );\n              }\n            });\n          }\n        }\n        options.data = formData;\n      }\n      // Blob reference is not needed anymore, free memory:\n      options.blob = null;\n    },\n\n    _initIframeSettings: function (options) {\n      var targetHost = $('<a></a>').prop('href', options.url).prop('host');\n      // Setting the dataType to iframe enables the iframe transport:\n      options.dataType = 'iframe ' + (options.dataType || '');\n      // The iframe transport accepts a serialized array as form data:\n      options.formData = this._getFormData(options);\n      // Add redirect url to form data on cross-domain uploads:\n      if (options.redirect && targetHost && targetHost !== location.host) {\n        options.formData.push({\n          name: options.redirectParamName || 'redirect',\n          value: options.redirect\n        });\n      }\n    },\n\n    _initDataSettings: function (options) {\n      if (this._isXHRUpload(options)) {\n        if (!this._chunkedUpload(options, true)) {\n          if (!options.data) {\n            this._initXHRData(options);\n          }\n          this._initProgressListener(options);\n        }\n        if (options.postMessage) {\n          // Setting the dataType to postmessage enables the\n          // postMessage transport:\n          options.dataType = 'postmessage ' + (options.dataType || '');\n        }\n      } else {\n        this._initIframeSettings(options);\n      }\n    },\n\n    _getParamName: function (options) {\n      var fileInput = $(options.fileInput),\n        paramName = options.paramName;\n      if (!paramName) {\n        paramName = [];\n        fileInput.each(function () {\n          var input = $(this),\n            name = input.prop('name') || 'files[]',\n            i = (input.prop('files') || [1]).length;\n          while (i) {\n            paramName.push(name);\n            i -= 1;\n          }\n        });\n        if (!paramName.length) {\n          paramName = [fileInput.prop('name') || 'files[]'];\n        }\n      } else if (!$.isArray(paramName)) {\n        paramName = [paramName];\n      }\n      return paramName;\n    },\n\n    _initFormSettings: function (options) {\n      // Retrieve missing options from the input field and the\n      // associated form, if available:\n      if (!options.form || !options.form.length) {\n        options.form = $(options.fileInput.prop('form'));\n        // If the given file input doesn't have an associated form,\n        // use the default widget file input's form:\n        if (!options.form.length) {\n          options.form = $(this.options.fileInput.prop('form'));\n        }\n      }\n      options.paramName = this._getParamName(options);\n      if (!options.url) {\n        options.url = options.form.prop('action') || location.href;\n      }\n      // The HTTP request method must be \"POST\" or \"PUT\":\n      options.type = (\n        options.type ||\n        ($.type(options.form.prop('method')) === 'string' &&\n          options.form.prop('method')) ||\n        ''\n      ).toUpperCase();\n      if (\n        options.type !== 'POST' &&\n        options.type !== 'PUT' &&\n        options.type !== 'PATCH'\n      ) {\n        options.type = 'POST';\n      }\n      if (!options.formAcceptCharset) {\n        options.formAcceptCharset = options.form.attr('accept-charset');\n      }\n    },\n\n    _getAJAXSettings: function (data) {\n      var options = $.extend({}, this.options, data);\n      this._initFormSettings(options);\n      this._initDataSettings(options);\n      return options;\n    },\n\n    // jQuery 1.6 doesn't provide .state(),\n    // while jQuery 1.8+ removed .isRejected() and .isResolved():\n    _getDeferredState: function (deferred) {\n      if (deferred.state) {\n        return deferred.state();\n      }\n      if (deferred.isResolved()) {\n        return 'resolved';\n      }\n      if (deferred.isRejected()) {\n        return 'rejected';\n      }\n      return 'pending';\n    },\n\n    // Maps jqXHR callbacks to the equivalent\n    // methods of the given Promise object:\n    _enhancePromise: function (promise) {\n      promise.success = promise.done;\n      promise.error = promise.fail;\n      promise.complete = promise.always;\n      return promise;\n    },\n\n    // Creates and returns a Promise object enhanced with\n    // the jqXHR methods abort, success, error and complete:\n    _getXHRPromise: function (resolveOrReject, context, args) {\n      var dfd = $.Deferred(),\n        promise = dfd.promise();\n      // eslint-disable-next-line no-param-reassign\n      context = context || this.options.context || promise;\n      if (resolveOrReject === true) {\n        dfd.resolveWith(context, args);\n      } else if (resolveOrReject === false) {\n        dfd.rejectWith(context, args);\n      }\n      promise.abort = dfd.promise;\n      return this._enhancePromise(promise);\n    },\n\n    // Adds convenience methods to the data callback argument:\n    _addConvenienceMethods: function (e, data) {\n      var that = this,\n        getPromise = function (args) {\n          return $.Deferred().resolveWith(that, args).promise();\n        };\n      data.process = function (resolveFunc, rejectFunc) {\n        if (resolveFunc || rejectFunc) {\n          data._processQueue = this._processQueue = (this._processQueue ||\n            getPromise([this]))\n            [that._promisePipe](function () {\n              if (data.errorThrown) {\n                return $.Deferred().rejectWith(that, [data]).promise();\n              }\n              return getPromise(arguments);\n            })\n            [that._promisePipe](resolveFunc, rejectFunc);\n        }\n        return this._processQueue || getPromise([this]);\n      };\n      data.submit = function () {\n        if (this.state() !== 'pending') {\n          data.jqXHR = this.jqXHR =\n            that._trigger(\n              'submit',\n              $.Event('submit', { delegatedEvent: e }),\n              this\n            ) !== false && that._onSend(e, this);\n        }\n        return this.jqXHR || that._getXHRPromise();\n      };\n      data.abort = function () {\n        if (this.jqXHR) {\n          return this.jqXHR.abort();\n        }\n        this.errorThrown = 'abort';\n        that._trigger('fail', null, this);\n        return that._getXHRPromise(false);\n      };\n      data.state = function () {\n        if (this.jqXHR) {\n          return that._getDeferredState(this.jqXHR);\n        }\n        if (this._processQueue) {\n          return that._getDeferredState(this._processQueue);\n        }\n      };\n      data.processing = function () {\n        return (\n          !this.jqXHR &&\n          this._processQueue &&\n          that._getDeferredState(this._processQueue) === 'pending'\n        );\n      };\n      data.progress = function () {\n        return this._progress;\n      };\n      data.response = function () {\n        return this._response;\n      };\n    },\n\n    // Parses the Range header from the server response\n    // and returns the uploaded bytes:\n    _getUploadedBytes: function (jqXHR) {\n      var range = jqXHR.getResponseHeader('Range'),\n        parts = range && range.split('-'),\n        upperBytesPos = parts && parts.length > 1 && parseInt(parts[1], 10);\n      return upperBytesPos && upperBytesPos + 1;\n    },\n\n    // Uploads a file in multiple, sequential requests\n    // by splitting the file up in multiple blob chunks.\n    // If the second parameter is true, only tests if the file\n    // should be uploaded in chunks, but does not invoke any\n    // upload requests:\n    _chunkedUpload: function (options, testOnly) {\n      options.uploadedBytes = options.uploadedBytes || 0;\n      var that = this,\n        file = options.files[0],\n        fs = file.size,\n        ub = options.uploadedBytes,\n        mcs = options.maxChunkSize || fs,\n        slice = this._blobSlice,\n        dfd = $.Deferred(),\n        promise = dfd.promise(),\n        jqXHR,\n        upload;\n      if (\n        !(\n          this._isXHRUpload(options) &&\n          slice &&\n          (ub || ($.type(mcs) === 'function' ? mcs(options) : mcs) < fs)\n        ) ||\n        options.data\n      ) {\n        return false;\n      }\n      if (testOnly) {\n        return true;\n      }\n      if (ub >= fs) {\n        file.error = options.i18n('uploadedBytes');\n        return this._getXHRPromise(false, options.context, [\n          null,\n          'error',\n          file.error\n        ]);\n      }\n      // The chunk upload method:\n      upload = function () {\n        // Clone the options object for each chunk upload:\n        var o = $.extend({}, options),\n          currentLoaded = o._progress.loaded;\n        o.blob = slice.call(\n          file,\n          ub,\n          ub + ($.type(mcs) === 'function' ? mcs(o) : mcs),\n          file.type\n        );\n        // Store the current chunk size, as the blob itself\n        // will be dereferenced after data processing:\n        o.chunkSize = o.blob.size;\n        // Expose the chunk bytes position range:\n        o.contentRange =\n          'bytes ' + ub + '-' + (ub + o.chunkSize - 1) + '/' + fs;\n        // Trigger chunkbeforesend to allow form data to be updated for this chunk\n        that._trigger('chunkbeforesend', null, o);\n        // Process the upload data (the blob and potential form data):\n        that._initXHRData(o);\n        // Add progress listeners for this chunk upload:\n        that._initProgressListener(o);\n        jqXHR = (\n          (that._trigger('chunksend', null, o) !== false && $.ajax(o)) ||\n          that._getXHRPromise(false, o.context)\n        )\n          .done(function (result, textStatus, jqXHR) {\n            ub = that._getUploadedBytes(jqXHR) || ub + o.chunkSize;\n            // Create a progress event if no final progress event\n            // with loaded equaling total has been triggered\n            // for this chunk:\n            if (currentLoaded + o.chunkSize - o._progress.loaded) {\n              that._onProgress(\n                $.Event('progress', {\n                  lengthComputable: true,\n                  loaded: ub - o.uploadedBytes,\n                  total: ub - o.uploadedBytes\n                }),\n                o\n              );\n            }\n            options.uploadedBytes = o.uploadedBytes = ub;\n            o.result = result;\n            o.textStatus = textStatus;\n            o.jqXHR = jqXHR;\n            that._trigger('chunkdone', null, o);\n            that._trigger('chunkalways', null, o);\n            if (ub < fs) {\n              // File upload not yet complete,\n              // continue with the next chunk:\n              upload();\n            } else {\n              dfd.resolveWith(o.context, [result, textStatus, jqXHR]);\n            }\n          })\n          .fail(function (jqXHR, textStatus, errorThrown) {\n            o.jqXHR = jqXHR;\n            o.textStatus = textStatus;\n            o.errorThrown = errorThrown;\n            that._trigger('chunkfail', null, o);\n            that._trigger('chunkalways', null, o);\n            dfd.rejectWith(o.context, [jqXHR, textStatus, errorThrown]);\n          })\n          .always(function () {\n            that._deinitProgressListener(o);\n          });\n      };\n      this._enhancePromise(promise);\n      promise.abort = function () {\n        return jqXHR.abort();\n      };\n      upload();\n      return promise;\n    },\n\n    _beforeSend: function (e, data) {\n      if (this._active === 0) {\n        // the start callback is triggered when an upload starts\n        // and no other uploads are currently running,\n        // equivalent to the global ajaxStart event:\n        this._trigger('start');\n        // Set timer for global bitrate progress calculation:\n        this._bitrateTimer = new this._BitrateTimer();\n        // Reset the global progress values:\n        this._progress.loaded = this._progress.total = 0;\n        this._progress.bitrate = 0;\n      }\n      // Make sure the container objects for the .response() and\n      // .progress() methods on the data object are available\n      // and reset to their initial state:\n      this._initResponseObject(data);\n      this._initProgressObject(data);\n      data._progress.loaded = data.loaded = data.uploadedBytes || 0;\n      data._progress.total = data.total = this._getTotal(data.files) || 1;\n      data._progress.bitrate = data.bitrate = 0;\n      this._active += 1;\n      // Initialize the global progress values:\n      this._progress.loaded += data.loaded;\n      this._progress.total += data.total;\n    },\n\n    _onDone: function (result, textStatus, jqXHR, options) {\n      var total = options._progress.total,\n        response = options._response;\n      if (options._progress.loaded < total) {\n        // Create a progress event if no final progress event\n        // with loaded equaling total has been triggered:\n        this._onProgress(\n          $.Event('progress', {\n            lengthComputable: true,\n            loaded: total,\n            total: total\n          }),\n          options\n        );\n      }\n      response.result = options.result = result;\n      response.textStatus = options.textStatus = textStatus;\n      response.jqXHR = options.jqXHR = jqXHR;\n      this._trigger('done', null, options);\n    },\n\n    _onFail: function (jqXHR, textStatus, errorThrown, options) {\n      var response = options._response;\n      if (options.recalculateProgress) {\n        // Remove the failed (error or abort) file upload from\n        // the global progress calculation:\n        this._progress.loaded -= options._progress.loaded;\n        this._progress.total -= options._progress.total;\n      }\n      response.jqXHR = options.jqXHR = jqXHR;\n      response.textStatus = options.textStatus = textStatus;\n      response.errorThrown = options.errorThrown = errorThrown;\n      this._trigger('fail', null, options);\n    },\n\n    _onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {\n      // jqXHRorResult, textStatus and jqXHRorError are added to the\n      // options object via done and fail callbacks\n      this._trigger('always', null, options);\n    },\n\n    _onSend: function (e, data) {\n      if (!data.submit) {\n        this._addConvenienceMethods(e, data);\n      }\n      var that = this,\n        jqXHR,\n        aborted,\n        slot,\n        pipe,\n        options = that._getAJAXSettings(data),\n        send = function () {\n          that._sending += 1;\n          // Set timer for bitrate progress calculation:\n          options._bitrateTimer = new that._BitrateTimer();\n          jqXHR =\n            jqXHR ||\n            (\n              ((aborted ||\n                that._trigger(\n                  'send',\n                  $.Event('send', { delegatedEvent: e }),\n                  options\n                ) === false) &&\n                that._getXHRPromise(false, options.context, aborted)) ||\n              that._chunkedUpload(options) ||\n              $.ajax(options)\n            )\n              .done(function (result, textStatus, jqXHR) {\n                that._onDone(result, textStatus, jqXHR, options);\n              })\n              .fail(function (jqXHR, textStatus, errorThrown) {\n                that._onFail(jqXHR, textStatus, errorThrown, options);\n              })\n              .always(function (jqXHRorResult, textStatus, jqXHRorError) {\n                that._deinitProgressListener(options);\n                that._onAlways(\n                  jqXHRorResult,\n                  textStatus,\n                  jqXHRorError,\n                  options\n                );\n                that._sending -= 1;\n                that._active -= 1;\n                if (\n                  options.limitConcurrentUploads &&\n                  options.limitConcurrentUploads > that._sending\n                ) {\n                  // Start the next queued upload,\n                  // that has not been aborted:\n                  var nextSlot = that._slots.shift();\n                  while (nextSlot) {\n                    if (that._getDeferredState(nextSlot) === 'pending') {\n                      nextSlot.resolve();\n                      break;\n                    }\n                    nextSlot = that._slots.shift();\n                  }\n                }\n                if (that._active === 0) {\n                  // The stop callback is triggered when all uploads have\n                  // been completed, equivalent to the global ajaxStop event:\n                  that._trigger('stop');\n                }\n              });\n          return jqXHR;\n        };\n      this._beforeSend(e, options);\n      if (\n        this.options.sequentialUploads ||\n        (this.options.limitConcurrentUploads &&\n          this.options.limitConcurrentUploads <= this._sending)\n      ) {\n        if (this.options.limitConcurrentUploads > 1) {\n          slot = $.Deferred();\n          this._slots.push(slot);\n          pipe = slot[that._promisePipe](send);\n        } else {\n          this._sequence = this._sequence[that._promisePipe](send, send);\n          pipe = this._sequence;\n        }\n        // Return the piped Promise object, enhanced with an abort method,\n        // which is delegated to the jqXHR object of the current upload,\n        // and jqXHR callbacks mapped to the equivalent Promise methods:\n        pipe.abort = function () {\n          aborted = [undefined, 'abort', 'abort'];\n          if (!jqXHR) {\n            if (slot) {\n              slot.rejectWith(options.context, aborted);\n            }\n            return send();\n          }\n          return jqXHR.abort();\n        };\n        return this._enhancePromise(pipe);\n      }\n      return send();\n    },\n\n    _onAdd: function (e, data) {\n      var that = this,\n        result = true,\n        options = $.extend({}, this.options, data),\n        files = data.files,\n        filesLength = files.length,\n        limit = options.limitMultiFileUploads,\n        limitSize = options.limitMultiFileUploadSize,\n        overhead = options.limitMultiFileUploadSizeOverhead,\n        batchSize = 0,\n        paramName = this._getParamName(options),\n        paramNameSet,\n        paramNameSlice,\n        fileSet,\n        i,\n        j = 0;\n      if (!filesLength) {\n        return false;\n      }\n      if (limitSize && files[0].size === undefined) {\n        limitSize = undefined;\n      }\n      if (\n        !(options.singleFileUploads || limit || limitSize) ||\n        !this._isXHRUpload(options)\n      ) {\n        fileSet = [files];\n        paramNameSet = [paramName];\n      } else if (!(options.singleFileUploads || limitSize) && limit) {\n        fileSet = [];\n        paramNameSet = [];\n        for (i = 0; i < filesLength; i += limit) {\n          fileSet.push(files.slice(i, i + limit));\n          paramNameSlice = paramName.slice(i, i + limit);\n          if (!paramNameSlice.length) {\n            paramNameSlice = paramName;\n          }\n          paramNameSet.push(paramNameSlice);\n        }\n      } else if (!options.singleFileUploads && limitSize) {\n        fileSet = [];\n        paramNameSet = [];\n        for (i = 0; i < filesLength; i = i + 1) {\n          batchSize += files[i].size + overhead;\n          if (\n            i + 1 === filesLength ||\n            batchSize + files[i + 1].size + overhead > limitSize ||\n            (limit && i + 1 - j >= limit)\n          ) {\n            fileSet.push(files.slice(j, i + 1));\n            paramNameSlice = paramName.slice(j, i + 1);\n            if (!paramNameSlice.length) {\n              paramNameSlice = paramName;\n            }\n            paramNameSet.push(paramNameSlice);\n            j = i + 1;\n            batchSize = 0;\n          }\n        }\n      } else {\n        paramNameSet = paramName;\n      }\n      data.originalFiles = files;\n      $.each(fileSet || files, function (index, element) {\n        var newData = $.extend({}, data);\n        newData.files = fileSet ? element : [element];\n        newData.paramName = paramNameSet[index];\n        that._initResponseObject(newData);\n        that._initProgressObject(newData);\n        that._addConvenienceMethods(e, newData);\n        result = that._trigger(\n          'add',\n          $.Event('add', { delegatedEvent: e }),\n          newData\n        );\n        return result;\n      });\n      return result;\n    },\n\n    _replaceFileInput: function (data) {\n      var input = data.fileInput,\n        inputClone = input.clone(true),\n        restoreFocus = input.is(document.activeElement);\n      // Add a reference for the new cloned file input to the data argument:\n      data.fileInputClone = inputClone;\n      $('<form></form>').append(inputClone)[0].reset();\n      // Detaching allows to insert the fileInput on another form\n      // without losing the file input value:\n      input.after(inputClone).detach();\n      // If the fileInput had focus before it was detached,\n      // restore focus to the inputClone.\n      if (restoreFocus) {\n        inputClone.trigger('focus');\n      }\n      // Avoid memory leaks with the detached file input:\n      $.cleanData(input.off('remove'));\n      // Replace the original file input element in the fileInput\n      // elements set with the clone, which has been copied including\n      // event handlers:\n      this.options.fileInput = this.options.fileInput.map(function (i, el) {\n        if (el === input[0]) {\n          return inputClone[0];\n        }\n        return el;\n      });\n      // If the widget has been initialized on the file input itself,\n      // override this.element with the file input clone:\n      if (input[0] === this.element[0]) {\n        this.element = inputClone;\n      }\n    },\n\n    _handleFileTreeEntry: function (entry, path) {\n      var that = this,\n        dfd = $.Deferred(),\n        entries = [],\n        dirReader,\n        errorHandler = function (e) {\n          if (e && !e.entry) {\n            e.entry = entry;\n          }\n          // Since $.when returns immediately if one\n          // Deferred is rejected, we use resolve instead.\n          // This allows valid files and invalid items\n          // to be returned together in one set:\n          dfd.resolve([e]);\n        },\n        successHandler = function (entries) {\n          that\n            ._handleFileTreeEntries(entries, path + entry.name + '/')\n            .done(function (files) {\n              dfd.resolve(files);\n            })\n            .fail(errorHandler);\n        },\n        readEntries = function () {\n          dirReader.readEntries(function (results) {\n            if (!results.length) {\n              successHandler(entries);\n            } else {\n              entries = entries.concat(results);\n              readEntries();\n            }\n          }, errorHandler);\n        };\n      // eslint-disable-next-line no-param-reassign\n      path = path || '';\n      if (entry.isFile) {\n        if (entry._file) {\n          // Workaround for Chrome bug #149735\n          entry._file.relativePath = path;\n          dfd.resolve(entry._file);\n        } else {\n          entry.file(function (file) {\n            file.relativePath = path;\n            dfd.resolve(file);\n          }, errorHandler);\n        }\n      } else if (entry.isDirectory) {\n        dirReader = entry.createReader();\n        readEntries();\n      } else {\n        // Return an empty list for file system items\n        // other than files or directories:\n        dfd.resolve([]);\n      }\n      return dfd.promise();\n    },\n\n    _handleFileTreeEntries: function (entries, path) {\n      var that = this;\n      return $.when\n        .apply(\n          $,\n          $.map(entries, function (entry) {\n            return that._handleFileTreeEntry(entry, path);\n          })\n        )\n        [this._promisePipe](function () {\n          return Array.prototype.concat.apply([], arguments);\n        });\n    },\n\n    _getDroppedFiles: function (dataTransfer) {\n      // eslint-disable-next-line no-param-reassign\n      dataTransfer = dataTransfer || {};\n      var items = dataTransfer.items;\n      if (\n        items &&\n        items.length &&\n        (items[0].webkitGetAsEntry || items[0].getAsEntry)\n      ) {\n        return this._handleFileTreeEntries(\n          $.map(items, function (item) {\n            var entry;\n            if (item.webkitGetAsEntry) {\n              entry = item.webkitGetAsEntry();\n              if (entry) {\n                // Workaround for Chrome bug #149735:\n                entry._file = item.getAsFile();\n              }\n              return entry;\n            }\n            return item.getAsEntry();\n          })\n        );\n      }\n      return $.Deferred().resolve($.makeArray(dataTransfer.files)).promise();\n    },\n\n    _getSingleFileInputFiles: function (fileInput) {\n      // eslint-disable-next-line no-param-reassign\n      fileInput = $(fileInput);\n      var entries = fileInput.prop('entries'),\n        files,\n        value;\n      if (entries && entries.length) {\n        return this._handleFileTreeEntries(entries);\n      }\n      files = $.makeArray(fileInput.prop('files'));\n      if (!files.length) {\n        value = fileInput.prop('value');\n        if (!value) {\n          return $.Deferred().resolve([]).promise();\n        }\n        // If the files property is not available, the browser does not\n        // support the File API and we add a pseudo File object with\n        // the input value as name with path information removed:\n        files = [{ name: value.replace(/^.*\\\\/, '') }];\n      } else if (files[0].name === undefined && files[0].fileName) {\n        // File normalization for Safari 4 and Firefox 3:\n        $.each(files, function (index, file) {\n          file.name = file.fileName;\n          file.size = file.fileSize;\n        });\n      }\n      return $.Deferred().resolve(files).promise();\n    },\n\n    _getFileInputFiles: function (fileInput) {\n      if (!(fileInput instanceof $) || fileInput.length === 1) {\n        return this._getSingleFileInputFiles(fileInput);\n      }\n      return $.when\n        .apply($, $.map(fileInput, this._getSingleFileInputFiles))\n        [this._promisePipe](function () {\n          return Array.prototype.concat.apply([], arguments);\n        });\n    },\n\n    _onChange: function (e) {\n      var that = this,\n        data = {\n          fileInput: $(e.target),\n          form: $(e.target.form)\n        };\n      this._getFileInputFiles(data.fileInput).always(function (files) {\n        data.files = files;\n        if (that.options.replaceFileInput) {\n          that._replaceFileInput(data);\n        }\n        if (\n          that._trigger(\n            'change',\n            $.Event('change', { delegatedEvent: e }),\n            data\n          ) !== false\n        ) {\n          that._onAdd(e, data);\n        }\n      });\n    },\n\n    _onPaste: function (e) {\n      var items =\n          e.originalEvent &&\n          e.originalEvent.clipboardData &&\n          e.originalEvent.clipboardData.items,\n        data = { files: [] };\n      if (items && items.length) {\n        $.each(items, function (index, item) {\n          var file = item.getAsFile && item.getAsFile();\n          if (file) {\n            data.files.push(file);\n          }\n        });\n        if (\n          this._trigger(\n            'paste',\n            $.Event('paste', { delegatedEvent: e }),\n            data\n          ) !== false\n        ) {\n          this._onAdd(e, data);\n        }\n      }\n    },\n\n    _onDrop: function (e) {\n      e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;\n      var that = this,\n        dataTransfer = e.dataTransfer,\n        data = {};\n      if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\n        e.preventDefault();\n        this._getDroppedFiles(dataTransfer).always(function (files) {\n          data.files = files;\n          if (\n            that._trigger(\n              'drop',\n              $.Event('drop', { delegatedEvent: e }),\n              data\n            ) !== false\n          ) {\n            that._onAdd(e, data);\n          }\n        });\n      }\n    },\n\n    _onDragOver: getDragHandler('dragover'),\n\n    _onDragEnter: getDragHandler('dragenter'),\n\n    _onDragLeave: getDragHandler('dragleave'),\n\n    _initEventHandlers: function () {\n      if (this._isXHRUpload(this.options)) {\n        this._on(this.options.dropZone, {\n          dragover: this._onDragOver,\n          drop: this._onDrop,\n          // event.preventDefault() on dragenter is required for IE10+:\n          dragenter: this._onDragEnter,\n          // dragleave is not required, but added for completeness:\n          dragleave: this._onDragLeave\n        });\n        this._on(this.options.pasteZone, {\n          paste: this._onPaste\n        });\n      }\n      if ($.support.fileInput) {\n        this._on(this.options.fileInput, {\n          change: this._onChange\n        });\n      }\n    },\n\n    _destroyEventHandlers: function () {\n      this._off(this.options.dropZone, 'dragenter dragleave dragover drop');\n      this._off(this.options.pasteZone, 'paste');\n      this._off(this.options.fileInput, 'change');\n    },\n\n    _destroy: function () {\n      this._destroyEventHandlers();\n    },\n\n    _setOption: function (key, value) {\n      var reinit = $.inArray(key, this._specialOptions) !== -1;\n      if (reinit) {\n        this._destroyEventHandlers();\n      }\n      this._super(key, value);\n      if (reinit) {\n        this._initSpecialOptions();\n        this._initEventHandlers();\n      }\n    },\n\n    _initSpecialOptions: function () {\n      var options = this.options;\n      if (options.fileInput === undefined) {\n        options.fileInput = this.element.is('input[type=\"file\"]')\n          ? this.element\n          : this.element.find('input[type=\"file\"]');\n      } else if (!(options.fileInput instanceof $)) {\n        options.fileInput = $(options.fileInput);\n      }\n      if (!(options.dropZone instanceof $)) {\n        options.dropZone = $(options.dropZone);\n      }\n      if (!(options.pasteZone instanceof $)) {\n        options.pasteZone = $(options.pasteZone);\n      }\n    },\n\n    _getRegExp: function (str) {\n      var parts = str.split('/'),\n        modifiers = parts.pop();\n      parts.shift();\n      return new RegExp(parts.join('/'), modifiers);\n    },\n\n    _isRegExpOption: function (key, value) {\n      return (\n        key !== 'url' &&\n        $.type(value) === 'string' &&\n        /^\\/.*\\/[igm]{0,3}$/.test(value)\n      );\n    },\n\n    _initDataAttributes: function () {\n      var that = this,\n        options = this.options,\n        data = this.element.data();\n      // Initialize options set via HTML5 data-attributes:\n      $.each(this.element[0].attributes, function (index, attr) {\n        var key = attr.name.toLowerCase(),\n          value;\n        if (/^data-/.test(key)) {\n          // Convert hyphen-ated key to camelCase:\n          key = key.slice(5).replace(/-[a-z]/g, function (str) {\n            return str.charAt(1).toUpperCase();\n          });\n          value = data[key];\n          if (that._isRegExpOption(key, value)) {\n            value = that._getRegExp(value);\n          }\n          options[key] = value;\n        }\n      });\n    },\n\n    _create: function () {\n      this._initDataAttributes();\n      this._initSpecialOptions();\n      this._slots = [];\n      this._sequence = this._getXHRPromise(true);\n      this._sending = this._active = 0;\n      this._initProgressObject(this);\n      this._initEventHandlers();\n    },\n\n    // This method is exposed to the widget API and allows to query\n    // the number of active uploads:\n    active: function () {\n      return this._active;\n    },\n\n    // This method is exposed to the widget API and allows to query\n    // the widget upload progress.\n    // It returns an object with loaded, total and bitrate properties\n    // for the running uploads:\n    progress: function () {\n      return this._progress;\n    },\n\n    // This method is exposed to the widget API and allows adding files\n    // using the fileupload API. The data parameter accepts an object which\n    // must have a files property and can contain additional options:\n    // .fileupload('add', {files: filesList});\n    add: function (data) {\n      var that = this;\n      if (!data || this.options.disabled) {\n        return;\n      }\n      if (data.fileInput && !data.files) {\n        this._getFileInputFiles(data.fileInput).always(function (files) {\n          data.files = files;\n          that._onAdd(null, data);\n        });\n      } else {\n        data.files = $.makeArray(data.files);\n        this._onAdd(null, data);\n      }\n    },\n\n    // This method is exposed to the widget API and allows sending files\n    // using the fileupload API. The data parameter accepts an object which\n    // must have a files or fileInput property and can contain additional options:\n    // .fileupload('send', {files: filesList});\n    // The method returns a Promise object for the file upload call.\n    send: function (data) {\n      if (data && !this.options.disabled) {\n        if (data.fileInput && !data.files) {\n          var that = this,\n            dfd = $.Deferred(),\n            promise = dfd.promise(),\n            jqXHR,\n            aborted;\n          promise.abort = function () {\n            aborted = true;\n            if (jqXHR) {\n              return jqXHR.abort();\n            }\n            dfd.reject(null, 'abort', 'abort');\n            return promise;\n          };\n          this._getFileInputFiles(data.fileInput).always(function (files) {\n            if (aborted) {\n              return;\n            }\n            if (!files.length) {\n              dfd.reject();\n              return;\n            }\n            data.files = files;\n            jqXHR = that._onSend(null, data);\n            jqXHR.then(\n              function (result, textStatus, jqXHR) {\n                dfd.resolve(result, textStatus, jqXHR);\n              },\n              function (jqXHR, textStatus, errorThrown) {\n                dfd.reject(jqXHR, textStatus, errorThrown);\n              }\n            );\n          });\n          return this._enhancePromise(promise);\n        }\n        data.files = $.makeArray(data.files);\n        if (data.files.length) {\n          return this._onSend(null, data);\n        }\n      }\n      return this._getXHRPromise(false, data && data.context);\n    }\n  });\n});\n\n\n// <upload> component\nVue.component('upload', {\n    template: '\\\n        <div :class=\"{ \\'upload-warning\\' : model.errorMessage }\" class=\"upload m-2 p-2 pt-0\"> \\\n            <span v-if=\"model.errorMessage\" v-on:click=\"dismissWarning()\" class=\"close-warning\"><i class=\"fa-solid fa-xmark\" aria-hidden=\"true\"></i> </span>\\\n            <p class=\"upload-name\" :title=\"model.errorMessage\">{{ model.name }}</p> \\\n            <div> \\\n               <span v-show=\"!model.errorMessage\" :style=\"{ width: model.percentage + \\'%\\'}\" class=\"progress-bar\"> </span> \\\n               <span v-if=\"model.errorMessage\" class=\"error-message\" :title=\"model.errorMessage\"> Error: {{ model.errorMessage }} </span> \\\n            </div> \\\n        </div> \\\n        ',\n    props: {\n        model: Object,\n        uploadInputId: String\n    },\n    mounted: function () {\n        var self = this;\n        var uploadInput = document.getElementById(self.uploadInputId ?? 'fileupload');\n        $(uploadInput).bind('fileuploadprogress', function (e, data) {\n            if (data.files[0].name !== self.model.name) {\n                return;\n            }            \n            self.model.percentage = parseInt(data.loaded / data.total * 100, 10);\n        });\n\n        $(uploadInput).bind('fileuploaddone', function (e, data) {\n            if (data.files[0].name !== self.model.name) {\n                return;\n            }\n            if (data.result.files[0].error) {\n                self.handleFailure(data.files[0].name, data.result.files[0].error);\n            } else {  \n                bus.$emit('removalRequest', self.model);\n            }\n        });\n\n        $(uploadInput).bind('fileuploadfail', function (e, data) {\n            if (data.files[0].name !== self.model.name) {\n                return;\n            }\n            self.handleFailure(data.files[0].name, $('#t-error').val());\n        });\n    },\n    methods: {\n        handleFailure: function (fileName, message) {\n            if (fileName !== this.model.name) {\n                return;\n            }\n            this.model.errorMessage = message;\n            bus.$emit('ErrorOnUpload', this.model);\n        },\n        dismissWarning: function () {\n            bus.$emit('removalRequest', this.model);\n        }\n    }\n});\n\n\n// <upload-list> component\nVue.component('uploadList', {\n    template: '\\\n        <div class=\"upload-list\" v-show=\"files.length > 0\"> \\\n            <div class=\"header\" @click=\"expanded = !expanded\"> \\\n                <span> {{ T.uploads }} </span> \\\n                <span v-show=\"pendingCount\"> (Pending: {{ pendingCount }}) </span> \\\n                <span v-show=\"errorCount\" :class=\"{ \\'text-danger\\' : errorCount }\"> ( {{ T.errors }}: {{ errorCount }} / <a href=\"javascript:;\" v-on:click.stop=\"clearErrors\" > {{ T.clearErrors }} </a>)</span> \\\n                    <div class=\"toggle-button\"> \\\n                    <div v-show=\"expanded\"> \\\n                        <i class=\"fa-solid fa-chevron-down\" aria-hidden=\"true\"></i> \\\n                    </div> \\\n                    <div v-show=\"!expanded\"> \\\n                        <i class=\"fa-solid fa-chevron-up\" aria-hidden=\"true\"></i> \\\n                    </div> \\\n                </div> \\\n            </div> \\\n            <div class=\"card-body\" v-show=\"expanded\"> \\\n                <div class=\"d-flex flex-wrap\"> \\\n                    <upload :upload-input-id=\"uploadInputId\" v-for=\"f in files\" :key=\"f.name\"  :model=\"f\"></upload> \\\n                </div > \\\n            </div> \\\n        </div> \\\n        ',\n    data: function () {\n        return {\n            files: [],\n            T: {},\n            expanded: false,\n            pendingCount: 0,\n            errorCount: 0\n        }\n    },\n    props: {\n        uploadInputId: String\n    },\n    created: function () {\n        var self = this;\n        // retrieving localized strings from view\n        self.T.uploads = $('#t-uploads').val();\n        self.T.errors = $('#t-errors').val();\n        self.T.clearErrors = $('#t-clear-errors').val();\n    },\n    computed: {\n        fileCount: function () {\n            return this.files.length;\n        }\n    },\n    mounted: function () {\n        var self = this;\n        var uploadInput = document.getElementById(self.uploadInputId ?? 'fileupload');\n        $(uploadInput).bind('fileuploadadd', function (e, data) {\n            if (!data.files) {\n                return;\n            }\n            data.files.forEach(function (newFile) {\n                var alreadyInList = self.files.some(function (f) {\n                    return f.name == newFile.name;\n                });\n\n                if (!alreadyInList) {\n                    self.files.push({ name: newFile.name, percentage: 0, errorMessage: '' });\n                } else {\n                    console.error('A file with the same name is already on the queue:' + newFile.name);\n                }\n            });\n        });\n\n        bus.$on('removalRequest', function (fileUpload) {\n            self.files.forEach(function (item, index, array) {\n                if (item.name == fileUpload.name) {\n                    array.splice(index, 1);\n                }\n            });\n        });\n\n        bus.$on('ErrorOnUpload', function (fileUpload) {\n            self.updateCount();\n        });\n    },\n    methods: {\n        updateCount: function () {\n            this.errorCount = this.files.filter(function (item) {\n                return item.errorMessage != '';\n            }).length;\n            this.pendingCount = this.files.length - this.errorCount;\n            if (this.files.length < 1) {\n                this.expanded = false;\n            }\n        },\n        clearErrors: function () {\n            this.files = this.files.filter(function (item) {\n                return item.errorMessage == '';\n            });\n        }\n    },\n    watch: {\n        files: function () {\n            this.updateCount();\n        }\n    }\n});\n\n\n// https://github.com/spatie/font-awesome-filetypes\n\nconst faIcons = {\n    image: 'fa-regular fa-image',\n    pdf: 'fa-regular fa-file-pdf',\n    word: 'fa-regular fa-file-word',\n    powerpoint: 'fa-regular fa-file-powerpoint',\n    excel: 'fa-regular fa-file-excel',\n    csv: 'fa-regular fa-file',\n    audio: 'fa-regular fa-file-audio',\n    video: 'fa-regular fa-file-video',\n    archive: 'fa-regular fa-file-zipper',\n    code: 'fa-regular fa-file-code',\n    text: 'fa-regular fa-file-lines',\n    file: 'fa-regular fa-file'\n};\n\nconst faThumbnails = {\n    gif: faIcons.image,\n    jpeg: faIcons.image,\n    jpg: faIcons.image,\n    png: faIcons.image,\n    pdf: faIcons.pdf,\n    doc: faIcons.word,\n    docx: faIcons.word,\n    ppt: faIcons.powerpoint,\n    pptx: faIcons.powerpoint,\n    xls: faIcons.excel,\n    xlsx: faIcons.excel,\n    csv: faIcons.csv,\n    aac: faIcons.audio,\n    mp3: faIcons.audio,\n    ogg: faIcons.audio,\n    avi: faIcons.video,\n    flv: faIcons.video,\n    mkv: faIcons.video,\n    mp4: faIcons.video,\n    webm: faIcons.video,\n    gz: faIcons.archive,\n    zip: faIcons.archive,\n    css: faIcons.code,\n    html: faIcons.code,\n    js: faIcons.code,\n    txt: faIcons.text\n};\n\nfunction getClassNameForExtension(extension) {\n    return faThumbnails[extension.toLowerCase()] || faIcons.file\n}\n\nfunction getExtensionForFilename(filename) {\n    return filename.slice((filename.lastIndexOf('.') - 1 >>> 0) + 2)\n}\n\nfunction getClassNameForFilename(filename) {\n    return getClassNameForExtension(getExtensionForFilename(filename))\n}\n\n\n// This component receives a list of all the items, unpaged.\n// As the user interacts with the pager, it raises events with the items in the current page.\n// It's the parent's responsibility to listen for these events and display the received items\n// <pager> component\nVue.component('pager', {\n    template: `\n    <div>\n        <nav id=\"media-pager\" class=\"d-flex justify-content-center\" aria-label=\"Pagination Navigation\" role=\"navigation\" :data-computed-trigger=\"itemsInCurrentPage.length\">\n            <ul class=\"pagination pagination-sm m-0\">\n                <li class=\"page-item media-first-button\" :class=\"{disabled : !canDoFirst}\">\n                    <a class=\"page-link\" href=\"#\" :tabindex=\"canDoFirst ? 0 : -1\" v-on:click=\"goFirst\">{{ T.pagerFirstButton }}</a>\n                </li>\n                <li class=\"page-item\" :class=\"{disabled : !canDoPrev}\">\n                    <a class=\"page-link\" href=\"#\" :tabindex=\"canDoPrev ? 0 : -1\" v-on:click=\"previous\">{{ T.pagerPreviousButton }}</a>\n                </li>\n                <li v-if=\"link !== -1\" class=\"page-item page-number\"  :class=\"{active : current == link - 1}\" v-for=\"link in pageLinks\">\n                    <a class=\"page-link\" href=\"#\" v-on:click=\"goTo(link - 1)\" :aria-label=\"'Goto Page' + link\">\n                        {{link}}\n                        <span v-if=\"current == link -1\" class=\"visually-hidden\">(current)</span>\n                    </a>\n                </li>\n                <li class=\"page-item\" :class=\"{disabled : !canDoNext}\">\n                    <a class=\"page-link\" href=\"#\" :tabindex=\"canDoNext ? 0 : -1\" v-on:click=\"next\">{{ T.pagerNextButton }}</a>\n                </li>\n                <li class=\"page-item media-last-button\" :class=\"{disabled : !canDoLast}\">\n                    <a class=\"page-link\" href=\"#\" :tabindex=\"canDoLast ? 0 : -1\" v-on:click=\"goLast\">{{ T.pagerLastButton }}</a>\n                </li>\n                <li class=\"page-item ms-4 page-size-info\">\n                    <div style=\"display: flex;\">\n                        <span class=\"page-link disabled text-muted page-size-label\">{{ T.pagerPageSizeLabel }}</span>\n                        <select id=\"pageSizeSelect\" class=\"page-link\" v-model=\"pageSize\">\n                            <option v-for=\"option in pageSizeOptions\" v-bind:value=\"option\">\n                                {{option}}\n                            </option>\n                        </select>\n                    </div>\n                </li>\n            </ul>\n        </nav>\n        <nav class=\"d-flex justify-content-center\">\n            <ul class=\"pagination pagination-sm m-0 mt-2\">\n                <li class=\"page-item ms-4 page-info\">\n                    <span class=\"page-link disabled text-muted \">{{ T.pagerPageLabel }} {{current + 1}}/{{totalPages}}</span>\n                </li>\n                <li class=\"page-item ms-4 total-info\">\n                    <span class=\"page-link disabled text-muted \"> {{ T.pagerTotalLabel }} {{total}}</span>\n                </li>\n            </ul>\n        </nav>\n        </div>\n        `,\n    props: {\n        sourceItems: Array\n    },\n    data: function () {\n        return {\n            pageSize: 10,\n            pageSizeOptions: [10, 30, 50, 100],\n            current: 0,\n            T: {}\n        };\n    },\n    created: function () {\n        var self = this;\n\n        // retrieving localized strings from view\n        self.T.pagerFirstButton = $('#t-pager-first-button').val();\n        self.T.pagerPreviousButton = $('#t-pager-previous-button').val();\n        self.T.pagerNextButton = $('#t-pager-next-button').val();\n        self.T.pagerLastButton = $('#t-pager-last-button').val();\n        self.T.pagerPageSizeLabel = $('#t-pager-page-size-label').val();\n        self.T.pagerPageLabel = $('#t-pager-page-label').val();\n        self.T.pagerTotalLabel = $('#t-pager-total-label').val();        \n    },\n    methods: {\n        next: function () {\n            this.current = this.current + 1;\n        },\n        previous: function () {\n            this.current = this.current - 1;\n        },\n        goFirst: function () {\n            this.current = 0;\n        },\n        goLast: function () {\n            this.current = this.totalPages - 1;\n        },\n        goTo: function (targetPage) {\n            this.current = targetPage;\n        }\n    },\n    computed: {\n        total: function () {\n            return this.sourceItems ? this.sourceItems.length : 0;\n        },\n        totalPages: function () {\n            var pages = Math.ceil(this.total / this.pageSize);\n            return pages > 0 ? pages : 1;\n        },\n        isLastPage: function () {\n            return this.current + 1 >= this.totalPages;\n        },\n        isFirstPage: function () {\n            return this.current === 0;\n        },\n        canDoNext: function () {\n            return !this.isLastPage;\n        },\n        canDoPrev: function () {\n            return !this.isFirstPage;\n        },\n        canDoFirst: function () {\n            return !this.isFirstPage;\n        },\n        canDoLast: function () {\n            return !this.isLastPage;\n        },\n        // this computed is only to have a central place where we detect changes and leverage Vue JS reactivity to raise our event.\n        // That event will be handled by the parent media app to display the items in the page.\n        // this logic will not run if the computed property is not used in the template. We use a dummy \"data-computed-trigger\" attribute for that.\n        itemsInCurrentPage: function () {\n            var start = this.pageSize * this.current;\n            var end = start + this.pageSize;\n            var result = this.sourceItems.slice(start, end);\n            bus.$emit('pagerEvent', result);\n            return result;\n        },\n        pageLinks: function () {\n\n            var links = [];\n\n            links.push(this.current + 1);\n\n            // Add 2 items before current\n            var beforeCurrent = this.current > 0 ? this.current : -1;\n            links.unshift(beforeCurrent);\n\n            var beforeBeforeCurrent = this.current > 1 ? this.current - 1 : -1;\n            links.unshift(beforeBeforeCurrent);\n\n\n            // Add 2 items after current\n            var afterCurrent = this.totalPages - this.current > 1 ? this.current + 2 : -1;\n            links.push(afterCurrent);\n\n            var afterAfterCurrent = this.totalPages - this.current > 2 ? this.current + 3 : -1;\n            links.push(afterAfterCurrent);\n\n            return links;\n        }\n    },\n    watch: {\n        sourceItems: function () {\n            this.current = 0; // resetting current page after receiving a new list of unpaged items\n        },\n        pageSize: function () {\n            this.current = 0;\n        }\n    }\n});\n\n\n// <sort-indicator> component\nVue.component('sortIndicator', {\n    template: `\n        <div v-show=\"isActive\" class=\"sort-indicator\">\n            <span v-show=\"asc\"><i class=\"small fa fa-chevron-up\"></i></span>\n            <span v-show=\"!asc\"><i class=\"small fa fa-chevron-down\"></i></span>\n        </div>\n        `,\n    props: {\n        colname: String,\n        selectedcolname: String,\n        asc: Boolean\n    },\n    computed: {\n        isActive: function () {\n            return this.colname.toLowerCase() == this.selectedcolname.toLowerCase();\n        }\n    }\n});\n\n\n// <folder> component\nVue.component('folder', {\n    template: `\n        <li :class=\"{selected: isSelected}\" \n                v-on:dragleave.prevent = \"handleDragLeave($event);\" \n                v-on:dragover.prevent.stop=\"handleDragOver($event);\" \n                v-on:drop.prevent.stop = \"moveMediaToFolder(model, $event)\" >\n            <div :class=\"{folderhovered: isHovered , treeroot: level == 1}\" >\n                <a href=\"javascript:;\" :style=\"{ padding${document.dir == \"ltr\" ? \"Left\" : \"Right\"}:padding + 'px' }\" v-on:click=\"select\"  draggable=\"false\" class=\"folder-menu-item\">\n                  <span v-on:click.stop=\"toggle\" class=\"expand\" :class=\"{opened: open, closed: !open, empty: empty}\"><i v-if=\"open\" class=\"fa-solid fa-chevron-${document.dir == \"ltr\" ? \"right\" : \"left\"}\"></i></span> \n                  <div class=\"folder-name ms-2\">{{model.name}}</div>\n                    <div class=\"btn-group folder-actions\" >\n                            <a v-cloak href=\"javascript:;\" class=\"btn btn-sm\" v-on:click=\"createFolder\" v-if=\"canCreateFolder && (isSelected || isRoot)\"><i class=\"fa-solid fa-plus\" aria-hidden=\"true\"></i></a>\n                            <a v-cloak href=\"javascript:;\" class=\"btn btn-sm\" v-on:click=\"deleteFolder\" v-if=\"canDeleteFolder && isSelected && !isRoot\"><i class=\"fa-solid fa-trash\" aria-hidden=\"true\"></i></a>\n                    </div>\n                </a>\n            </div>\n            <ol v-show=\"open\">\n                <folder v-for=\"folder in children\"\n                        :key=\"folder.path\"\n                        :model=\"folder\"\n                        :selected-in-media-app=\"selectedInMediaApp\"\n                        :level=\"level + 1\">\n                </folder>\n            </ol>\n        </li>\n        `,\n    props: {\n        model: Object,\n        selectedInMediaApp: Object,\n        level: Number\n    },\n    data: function () {\n        return {\n            open: false,\n            children: null, // not initialized state (for lazy-loading)\n            parent: null,\n            isHovered: false,\n            padding: 0\n        }\n    },\n    computed: {\n        empty: function () {\n            return !this.children || this.children.length == 0;\n        },\n        isSelected: function () {\n            return (this.selectedInMediaApp.name == this.model.name) && (this.selectedInMediaApp.path == this.model.path);\n        },\n        isRoot: function () {\n            return this.model.path === '';\n        },\n        canCreateFolder: function () {\n            return this.model.canCreateFolder !== undefined ? this.model.canCreateFolder : true;\n        },\n        canDeleteFolder: function () {\n            return this.model.canDeleteFolder !== undefined ? this.model.canDeleteFolder : true;\n        }\n    },\n    mounted: function () {\n        if ((this.isRoot == false) && (this.isAncestorOfSelectedFolder())){\n            this.toggle();\n        }\n\n        this.padding = this.level < 3 ?  16 : 16 + (this.level * 8);\n    },\n    created: function () {\n        var self = this;\n        bus.$on('deleteFolder', function (folder) {\n            if (self.children) {\n                var index = self.children && self.children.indexOf(folder)\n                if (index > -1) {\n                    self.children.splice(index, 1)\n                    bus.$emit('folderDeleted');\n                }\n            }\n        });\n\n        bus.$on('addFolder', function (target, folder) {\n            if (self.model == target) {\n                if (self.children !== null) {\n                    self.children.push(folder);\n                }                \n                folder.parent = self.model;\n                bus.$emit('folderAdded', folder);\n            }\n        });\n    },\n    methods: {\n        isAncestorOfSelectedFolder: function () {\n            parentFolder = mediaApp.selectedFolder;\n            while (parentFolder) {\n                if (parentFolder.path == this.model.path) {\n                    return true;\n                }\n            parentFolder = parentFolder.parent;\n            }\n\n            return false;\n        },\n        toggle: function () {\n            this.open = !this.open;\n            if (this.open && !this.children) {\n                this.loadChildren();\n            }\n        },\n        select: function () {\n            bus.$emit('folderSelected', this.model);\n            this.loadChildren();\n        },\n        createFolder: function () {           \n            bus.$emit('createFolderRequested');\n        },\n        deleteFolder: function () {\n            bus.$emit('deleteFolderRequested');\n        },\n        loadChildren: function () {            \n            var self = this;\n            if (this.open == false) {\n                this.open = true;\n            }\n            $.ajax({\n                url: $('#getFoldersUrl').val() + \"?path=\" + encodeURIComponent(self.model.path),\n                method: 'GET',\n                success: function (data) {\n                    self.children = data;\n                    self.children.forEach(function (c) {\n                        c.parent = self.model;\n                    });\n                },\n                error: function (error) {\n                    emtpy = false;\n                    console.error(error.responseText);\n                }\n            });\n        },\n        handleDragOver: function (e) {\n            this.isHovered = true;\n        },\n        handleDragLeave: function (e) {\n            this.isHovered = false;            \n        },\n        moveMediaToFolder: function (folder, e) {\n\n            var self = this;\n            self.isHovered = false;\n\n            var mediaNames = JSON.parse(e.dataTransfer.getData('mediaNames')); \n\n            if (mediaNames.length < 1) {\n                return;\n            }\n\n            var sourceFolder = e.dataTransfer.getData('sourceFolder');\n            var targetFolder = folder.path;\n\n            if (sourceFolder === '') {\n                sourceFolder = 'root';\n            }\n\n            if (targetFolder === '') {\n                targetFolder = 'root';\n            }\n\n            if (sourceFolder === targetFolder) {\n                alert($('#sameFolderMessage').val());\n                return;\n            }\n\n            confirmDialog({...$(\"#moveMedia\").data(), callback: function (resp) {\n                if (resp) {\n                    $.ajax({\n                        url: $('#moveMediaListUrl').val(),\n                        method: 'POST',\n                        data: {\n                            __RequestVerificationToken: $(\"input[name='__RequestVerificationToken']\").val(),\n                            mediaNames: mediaNames,\n                            sourceFolder: sourceFolder,\n                            targetFolder: targetFolder\n                        },\n                        success: function () {\n                            bus.$emit('mediaListMoved'); // MediaApp will listen to this, and then it will reload page so the moved medias won't be there anymore\n                        },\n                        error: function (error) {\n                            console.error(error.responseText);\n                            bus.$emit('mediaListMoved', error.responseText);\n                        }\n                    });\n                }\n            }});\n        }\n\n    }\n});\n\n\n// <media-items-table> component\nVue.component('media-items-table', {\n    template: `\n        <table class=\"table media-items-table m-0\">\n            <thead>\n                <tr class=\"header-row\">\n                    <th scope=\"col\" class=\"thumbnail-column\">{{ T.imageHeader }}</th>\n                    <th scope=\"col\" v-on:click=\"changeSort('name')\">\n                       {{ T.nameHeader }}\n                         <sort-indicator colname=\"name\" :selectedcolname=\"sortBy\" :asc=\"sortAsc\"></sort-indicator>\n                    </th>\n                    <th scope=\"col\" v-on:click=\"changeSort('lastModify')\"> \n                       {{ T.lastModifyHeader }} \n                         <sort-indicator colname=\"lastModify\" :selectedcolname=\"sortBy\" :asc=\"sortAsc\"></sort-indicator> \n                    </th> \n                    <th scope=\"col\" v-on:click=\"changeSort('size')\">\n                        <span class=\"optional-col\">\n                            {{ T.sizeHeader }}\n                         <sort-indicator colname=\"size\" :selectedcolname=\"sortBy\" :asc=\"sortAsc\"></sort-indicator>\n                        </span>\n                    </th>\n                    <th scope=\"col\" v-on:click=\"changeSort('mime')\">\n                        <span class=\"optional-col\">\n                           {{ T.typeHeader }}\n                         <sort-indicator colname=\"mime\" :selectedcolname=\"sortBy\" :asc=\"sortAsc\"></sort-indicator>\n                        </span>\n                    </th>\n                </tr>\n            </thead>\n            <tbody>\n                    <tr v-for=\"media in filteredMediaItems\"\n                          class=\"media-item\"\n                          :class=\"{selected: isMediaSelected(media)}\"\n                          v-on:click.stop=\"toggleSelectionOfMedia(media)\"\n                          draggable=\"true\" v-on:dragstart=\"dragStart(media, $event)\"\n                          :key=\"media.name\">\n                             <td class=\"thumbnail-column\">\n                                <div class=\"img-wrapper\">\n                                    <img v-if=\"media.mime.startsWith('image')\" draggable=\"false\" :src=\"buildMediaUrl(media.url, thumbSize)\" />\n                                    <i v-else :class=\"getfontAwesomeClassNameForFileName(media.name, \\'fa-4x\\')\" :data-mime=\"media.mime\"></i>\n                                </div>\n                            </td>\n                            <td>\n                                <div class=\"media-name-cell\">\n                                   <span class=\"break-word\"> {{ media.name }} </span>\n                                    <div class=\"buttons-container\">\n                                        <a href=\"javascript:;\" class=\"btn btn-link btn-sm me-1 edit-button\" v-on:click.stop=\"renameMedia(media)\"> {{ T.editButton }} </a >\n                                        <a href=\"javascript:;\" class=\"btn btn-link btn-sm delete-button\" v-on:click.stop=\"deleteMedia(media)\"> {{ T.deleteButton }} </a>\n                                        <a :href=\"media.url\" target=\"_blank\" class=\"btn btn-link btn-sm view-button\"> {{ T.viewButton }} </a>\n                                    </div>\n                                </div>\n                            </td>\n                            <td>\n                                <div class=\"text-col\"> {{ printDateTime(media.lastModify) }} </div>\n                            </td>\n                            <td>\n                                <div class=\"text-col optional-col\"> {{ isNaN(media.size)? 0 : Math.round(media.size / 1024) }} KB</div>\n                            </td>\n                            <td>\n                                <div class=\"text-col optional-col\">{{ media.mime }}</div>\n                            </td>\n                   </tr>\n            </tbody>\n        </table>\n        `,\n    data: function () {\n        return {\n            T: {}\n        }\n    },\n    props: {\n        sortBy: String,\n        sortAsc: Boolean,\n        filteredMediaItems: Array,\n        selectedMedias: Array,\n        thumbSize: Number\n    },\n    created: function () {\n        var self = this;\n        self.T.imageHeader = $('#t-image-header').val();\n        self.T.nameHeader = $('#t-name-header').val();\n        self.T.lastModifyHeader = $('#t-lastModify-header').val();\n        self.T.sizeHeader = $('#t-size-header').val();\n        self.T.typeHeader = $('#t-type-header').val();\n        self.T.editButton = $('#t-edit-button').val();\n        self.T.deleteButton = $('#t-delete-button').val();\n        self.T.viewButton = $('#t-view-button').val();\n    },\n    methods: {\n        isMediaSelected: function (media) {\n            var result = this.selectedMedias.some(function (element, index, array) {\n                return element.url.toLowerCase() === media.url.toLowerCase();\n            });\n            return result;\n        },\n        buildMediaUrl: function (url, thumbSize) {\n            return url + (url.indexOf('?') == -1 ? '?' : '&') + 'width=' + thumbSize + '&height=' + thumbSize;\n        },\n        changeSort: function (newSort) {\n            bus.$emit('sortChangeRequested', newSort);\n        },\n        toggleSelectionOfMedia: function (media) {\n            bus.$emit('mediaToggleRequested', media);\n        },\n        renameMedia: function (media) {\n            bus.$emit('renameMediaRequested', media);            \n        },\n        deleteMedia: function (media) {\n            bus.$emit('deleteMediaRequested', media);\n        },\n        dragStart: function (media, e) {\n            bus.$emit('mediaDragStartRequested', media, e);\n        },\n        printDateTime: function (datemillis){\n            var d = new Date(datemillis);\n            return d.toLocaleString();            \n        },\n        getfontAwesomeClassNameForFileName:function getfontAwesomeClassNameForFilename(filename, thumbsize){\n             return   getClassNameForFilename(filename) + ' ' + thumbsize;\n        }\n    }\n});\n\n\n// <media-items-grid> component\nVue.component('media-items-grid', {\n    template: `\n        <ol class=\"row media-items-grid\">\n                <li v-for=\"media in filteredMediaItems\"\n                    :key=\"media.name\" \n                    class=\"media-item media-container-main-list-item card p-0\"\n                    :style=\"{width: thumbSize + 2 + 'px'}\"\n                    :class=\"{selected: isMediaSelected(media)}\"\n                    v-on:click.stop=\"toggleSelectionOfMedia(media)\"\n                    draggable=\"true\" v-on:dragstart=\"dragStart(media, $event)\">\n                    <div class=\"thumb-container\" :style=\"{height: thumbSize +'px'}\">\n                        <img v-if=\"media.mime.startsWith('image')\"\n                                :src=\"buildMediaUrl(media.url, thumbSize)\"\n                                :data-mime=\"media.mime\"\n                                :style=\"{maxHeight: thumbSize +'px', maxWidth: thumbSize +'px'}\" />\n                        <i v-else :class=\"getfontAwesomeClassNameForFileName(media.name, \\'fa-5x\\')\" :data-mime=\"media.mime\"></i>\n                    </div>\n                <div class=\"media-container-main-item-title card-body\">\n                        <a href=\"javascript:;\" class=\"btn btn-light btn-sm float-end inline-media-button edit-button\" v-on:click.stop=\"renameMedia(media)\"><i class=\"fa-solid fa-pen-to-square\" aria-hidden=\"true\"></i></a>\n                        <a href=\"javascript:;\" class=\"btn btn-light btn-sm float-end inline-media-button delete-button\" v-on:click.stop=\"deleteMedia(media)\"><i class=\"fa-solid fa-trash\" aria-hidden=\"true\"></i></a>\n                        <a :href=\"media.url\" target=\"_blank\" class=\"btn btn-light btn-sm float-end inline-media-button view-button\"\"><i class=\"fa-solid fa-download\" aria-hidden=\"true\"></i></a>\n                        <span class=\"media-filename card-text small\" :title=\"media.name\">{{ media.name }}</span>\n                    </div>\n                 </li>\n        </ol>\n        `,\n    data: function () {\n        return {\n            T: {}\n        }\n    },\n    props: {\n        filteredMediaItems: Array,\n        selectedMedias: Array,\n        thumbSize: Number\n    },\n    created: function () {\n        var self = this;\n        // retrieving localized strings from view\n        self.T.editButton = $('#t-edit-button').val();\n        self.T.deleteButton = $('#t-delete-button').val();\n    },\n    methods: {\n        isMediaSelected: function (media) {\n            var result = this.selectedMedias.some(function (element, index, array) {\n                return element.url.toLowerCase() === media.url.toLowerCase();\n            });\n            return result;\n        },\n        buildMediaUrl: function (url, thumbSize) {\n            return url + (url.indexOf('?') == -1 ? '?' : '&') + 'width=' + thumbSize + '&height=' + thumbSize;\n        },\n        toggleSelectionOfMedia: function (media) {\n            bus.$emit('mediaToggleRequested', media);\n        },\n        renameMedia: function (media) {\n            bus.$emit('renameMediaRequested', media);\n        },\n        deleteMedia: function (media) {\n            bus.$emit('deleteMediaRequested', media);\n        },\n        dragStart: function (media, e) {\n            bus.$emit('mediaDragStartRequested', media, e);\n        },\n        getfontAwesomeClassNameForFileName:function getfontAwesomeClassNameForFilename(filename, thumbsize){\n            return getClassNameForFilename(filename) + ' ' + thumbsize;\n        }\n    }\n});\n\n\n$(document).on('mediaApp:ready', function () {\n    var chunkedFileUploadId = randomUUID();\n\n    $('#fileupload')\n        .fileupload({\n            dropZone: $('#mediaApp'),\n            limitConcurrentUploads: 20,\n            dataType: 'json',\n            url: $('#uploadFiles').val(),\n            maxChunkSize: Number($('#maxUploadChunkSize').val() || 0),\n            formData: function () {\n                var antiForgeryToken = $(\"input[name=__RequestVerificationToken]\").val();\n\n                return [\n                    { name: 'path', value: mediaApp.selectedFolder.path },\n                    { name: '__RequestVerificationToken', value: antiForgeryToken },\n                    { name: '__chunkedFileUploadId', value: chunkedFileUploadId },\n                ]\n            },\n            done: function (e, data) {\n                $.each(data.result.files, function (index, file) {\n                    if (!file.error) {\n                        mediaApp.mediaItems.push(file)\n                    }\n                });\n            }\n        })\n        .on('fileuploadchunkbeforesend', (e, options) => {\n            let file = options.files[0];\n            // Here we replace the blob with a File object to ensure the file name and others are preserved for the backend.\n            options.blob = new File(\n                [options.blob],\n                file.name,\n                {\n                    type: file.type,\n                    lastModified: file.lastModified,\n                });\n        });\n});\n\n\n$(document).bind('dragover', function (e) {\n    var dt = e.originalEvent.dataTransfer;\n    if (dt.types && (dt.types.indexOf ? dt.types.indexOf('Files') != -1 : dt.types.contains('Files'))) {\n        var dropZone = $('#customdropzone'),\n            timeout = window.dropZoneTimeout;\n        if (timeout) {\n            clearTimeout(timeout);\n        } else {\n            dropZone.addClass('in');\n        }\n        var hoveredDropZone = $(e.target).closest(dropZone);\n        window.dropZoneTimeout = setTimeout(function () {\n            window.dropZoneTimeout = null;\n            dropZone.removeClass('in');\n        }, 100);\n    }\n});\n\n\nvar initialized;\nvar mediaApp;\n\nvar bus = new Vue();\n\nfunction initializeMediaApplication(displayMediaApplication, mediaApplicationUrl, pathBase) {\n\n    if (initialized) {\n        return;\n    }\n\n    initialized = true;\n\n    if (!mediaApplicationUrl) {\n        console.error('mediaApplicationUrl variable is not defined');\n    }\n\n    $.ajax({\n        url: mediaApplicationUrl,\n        method: 'GET',\n        success: function (content) {\n            $('.ta-content').append(content);\n\n            $(document).trigger('mediaapplication:ready');\n\n            var root = {\n                name: $('#t-mediaLibrary').text(),\n                path: '',\n                folder: '',\n                isDirectory: true,\n                canCreateFolder: $('#allowNewRootFolders').val() === 'true'\n            };\n\n            mediaApp = new Vue({\n                el: '#mediaApp',\n                data: {\n                    selectedFolder: {},\n                    mediaItems: [],\n                    selectedMedias: [],\n                    errors: [],\n                    dragDropThumbnail: new Image(),\n                    smallThumbs: false,\n                    gridView: false,\n                    mediaFilter: '',\n                    sortBy: '',\n                    sortAsc: true,\n                    itemsInPage: []\n                },\n                created: function () {\n                    var self = this;\n\n                    self.dragDropThumbnail.src = (pathBase || '') + '/OrchardCore.Media/Images/drag-thumbnail.png';\n\n                    bus.$on('folderSelected', function (folder) {\n                        self.selectedFolder = folder;\n                    });\n\n                    bus.$on('folderDeleted', function () {\n                        self.selectRoot();\n                    });\n\n                    bus.$on('folderAdded', function (folder) {\n                        self.selectedFolder = folder;\n                        folder.selected = true;\n                    });\n\n                    bus.$on('mediaListMoved', function (errorInfo) {\n                        self.loadFolder(self.selectedFolder);\n                        if (errorInfo) {\n                            self.errors.push(errorInfo);\n                        }\n                    });\n\n                    bus.$on('mediaRenamed', function (newName, newPath, oldPath, newUrl) {\n                        var media = self.mediaItems.filter(function (item) {\n                            return item.mediaPath === oldPath;\n                        })[0];\n\n                        media.mediaPath = newPath;\n                        media.name = newName;\n                        media.url = newUrl;\n                    });\n\n                    bus.$on('createFolderRequested', function (media) {\n                        self.createFolder();\n                    });\n\n                    bus.$on('deleteFolderRequested', function (media) {\n                        self.deleteFolder();\n                    });\n\n                    // common handlers for actions in both grid and table view.\n                    bus.$on('sortChangeRequested', function (newSort) {\n                        self.changeSort(newSort);\n                    });\n\n                    bus.$on('mediaToggleRequested', function (media) {\n                        self.toggleSelectionOfMedia(media);\n                    });\n\n                    bus.$on('renameMediaRequested', function (media) {\n                        self.renameMedia(media);\n                    });\n\n                    bus.$on('deleteMediaRequested', function (media) {\n                        self.deleteMediaItem(media);\n                    });\n\n                    bus.$on('mediaDragStartRequested', function (media, e) {\n                        self.handleDragStart(media, e);\n                    });\n\n\n                    // handler for pager events\n                    bus.$on('pagerEvent', function (itemsInPage) {\n                        self.itemsInPage = itemsInPage;\n                        self.selectedMedias = [];\n                    });\n\n                    if (!localStorage.getItem('mediaApplicationPrefs')) {\n                        self.selectedFolder = root;\n                        return;\n                    }\n\n                    self.currentPrefs = JSON.parse(localStorage.getItem('mediaApplicationPrefs'));\n                },\n                computed: {\n                    isHome: function () {\n                        return this.selectedFolder == root;\n                    },\n                    parents: function () {\n                        var p = [];\n                        parentFolder = this.selectedFolder;\n                        while (parentFolder && parentFolder.path != '') {\n                            p.unshift(parentFolder);\n                            parentFolder = parentFolder.parent;\n                        }\n                        return p;\n                    },\n                    root: function () {\n                        return root;\n                    },\n                    filteredMediaItems: function () {\n                        var self = this;\n\n                        self.selectedMedias = [];\n\n                        var filtered = self.mediaItems.filter(function (item) {\n                            return item.name.toLowerCase().indexOf(self.mediaFilter.toLowerCase()) > - 1;\n                        });\n\n                        switch (self.sortBy) {\n                            case 'size':\n                                filtered.sort(function (a, b) {\n                                    return self.sortAsc ? a.size - b.size : b.size - a.size;\n                                });\n                                break;\n                            case 'mime':\n                                filtered.sort(function (a, b) {\n                                    return self.sortAsc ? a.mime.toLowerCase().localeCompare(b.mime.toLowerCase()) : b.mime.toLowerCase().localeCompare(a.mime.toLowerCase());\n                                });\n                                break;\n                            case 'lastModify':\n                                filtered.sort(function (a, b) {\n                                    return self.sortAsc ? a.lastModify - b.lastModify : b.lastModify - a.lastModify;\n                                });\n                                break;\n                            default:\n                                filtered.sort(function (a, b) {\n                                    return self.sortAsc ? a.name.toLowerCase().localeCompare(b.name.toLowerCase()) : b.name.toLowerCase().localeCompare(a.name.toLowerCase());\n                                });\n                        }\n\n                        return filtered;\n                    },\n                    hiddenCount: function () {\n                        var result = 0;\n                        result = this.mediaItems.length - this.filteredMediaItems.length;\n                        return result;\n                    },\n                    thumbSize: function () {\n                        return this.smallThumbs ? 100 : 240;\n                    },\n                    currentPrefs: {\n                        get: function () {\n                            return {\n                                smallThumbs: this.smallThumbs,\n                                selectedFolder: this.selectedFolder,\n                                gridView: this.gridView\n                            };\n                        },\n                        set: function (newPrefs) {\n                            if (!newPrefs) {\n                                return;\n                            }\n\n                            this.smallThumbs = newPrefs.smallThumbs;\n                            this.selectedFolder = newPrefs.selectedFolder;\n                            this.gridView = newPrefs.gridView;\n                        }\n                    }\n                },\n                watch: {\n                    currentPrefs: function (newPrefs) {\n                        localStorage.setItem('mediaApplicationPrefs', JSON.stringify(newPrefs));\n                    },\n                    selectedFolder: function (newFolder) {\n                        this.mediaFilter = '';\n                        this.selectedFolder = newFolder;\n                        this.loadFolder(newFolder);\n                    }\n\n                },\n                mounted: function () {\n                    this.$refs.rootFolder.toggle();\n                },\n                methods: {\n                    uploadUrl: function () {\n\n                        if (!this.selectedFolder) {\n                            return null;\n                        }\n\n                        var urlValue = $('#uploadFiles').val();\n                        var allowedExtensions = $('#allowedExtensions').val();\n                        if (allowedExtensions && allowedExtensions !== \"\") {\n                            urlValue = urlValue + (urlValue.indexOf('?') == -1 ? '?' : '&') + \"extensions=\" + encodeURIComponent(allowedExtensions);\n                        }\n\n                        return urlValue + (urlValue.indexOf('?') == -1 ? '?' : '&') + \"path=\" + encodeURIComponent(this.selectedFolder.path);\n                    },\n                    selectRoot: function () {\n                        this.selectedFolder = this.root;\n                    },\n                    loadFolder: function (folder) {\n                        this.errors = [];\n                        this.selectedMedias = [];\n                        var self = this;\n                        var mediaUrl = $('#getMediaItemsUrl').val();\n                        var allowedExtensions = $('#allowedExtensions').val();\n                        if (allowedExtensions && allowedExtensions !== \"\") {\n                            mediaUrl = mediaUrl + (mediaUrl.indexOf('?') == -1 ? '?' : '&') + \"extensions=\" + encodeURIComponent(allowedExtensions);\n                        }\n                        console.log(folder.path);\n                        $.ajax({\n                            url: mediaUrl + (mediaUrl.indexOf('?') == -1 ? '?' : '&') + \"path=\" + encodeURIComponent(folder.path),\n                            method: 'GET',\n                            success: function (data) {\n                                data.forEach(function (item) {\n                                    item.open = false;\n                                });\n                                self.mediaItems = data;\n                                self.selectedMedias = [];\n                                self.sortBy = '';\n                                self.sortAsc = true;\n                            },\n                            error: function (error) {\n                                console.log('error loading folder:' + folder.path);\n                                self.selectRoot();\n                            }\n                        });\n                    },\n                    refresh: function () {\n                        var self = this;\n                        if (self.selectedFolder) {\n                            self.loadFolder(self.selectedFolder);\n                        }\n                    },\n                    selectAll: function () {\n                        this.selectedMedias = [];\n                        for (var i = 0; i < this.filteredMediaItems.length; i++) {\n                            this.selectedMedias.push(this.filteredMediaItems[i]);\n                        }\n                    },\n                    unSelectAll: function () {\n                        this.selectedMedias = [];\n                    },\n                    invertSelection: function () {\n                        var temp = [];\n                        for (var i = 0; i < this.filteredMediaItems.length; i++) {\n                            if (this.isMediaSelected(this.filteredMediaItems[i]) == false) {\n                                temp.push(this.filteredMediaItems[i]);\n                            }\n                        }\n                        this.selectedMedias = temp;\n                    },\n                    toggleSelectionOfMedia: function (media) {\n                        if (this.isMediaSelected(media) == true) {\n                            this.selectedMedias.splice(this.selectedMedias.indexOf(media), 1);\n                        } else {\n                            this.selectedMedias.push(media);\n                        }\n                    },\n                    isMediaSelected: function (media) {\n                        var result = this.selectedMedias.some(function (element, index, array) {\n                            return element.url.toLowerCase() === media.url.toLowerCase();\n                        });\n                        return result;\n                    },\n                    deleteFolder: function () {\n                        var folder = this.selectedFolder;\n                        var self = this;\n                        // The root folder can't be deleted\n                        if (folder == this.root.model) {\n                            return;\n                        }\n\n                        confirmDialog({\n                            ...$(\"#deleteFolder\").data(), callback: function (resp) {\n                                if (resp) {\n                                    $.ajax({\n                                        url: $('#deleteFolderUrl').val() + \"?path=\" + encodeURIComponent(folder.path),\n                                        method: 'POST',\n                                        data: {\n                                            __RequestVerificationToken: $(\"input[name='__RequestVerificationToken']\").val()\n                                        },\n                                        success: function (data) {\n                                            bus.$emit('deleteFolder', folder);\n                                        },\n                                        error: function (error) {\n                                            console.error(error.responseText);\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    },\n                    createFolder: function () {\n                        $('#createFolderModal-errors').empty();\n                        var modal = bootstrap.Modal.getOrCreateInstance($('#createFolderModal'));\n                        modal.show();\n                        $('#createFolderModal .modal-body input').val('').focus();\n                    },\n                    renameMedia: function (media) {\n                        $('#renameMediaModal-errors').empty();\n                        var modal = bootstrap.Modal.getOrCreateInstance($('#renameMediaModal'));\n                        modal.show();\n                        $('#old-item-name').val(media.name);\n                        $('#renameMediaModal .modal-body input').val(media.name).focus();\n                    },\n                    selectAndDeleteMedia: function (media) {\n                        this.deleteMedia();\n                    },\n                    deleteMediaList: function () {\n                        var mediaList = this.selectedMedias;\n                        var self = this;\n\n                        if (mediaList.length < 1) {\n                            return;\n                        }\n\n                        confirmDialog({\n                            ...$(\"#deleteMedia\").data(), callback: function (resp) {\n                                if (resp) {\n                                    var paths = [];\n                                    for (var i = 0; i < mediaList.length; i++) {\n                                        paths.push(mediaList[i].mediaPath);\n                                    }\n\n                                    $.ajax({\n                                        url: $('#deleteMediaListUrl').val(),\n                                        method: 'POST',\n                                        data: {\n                                            __RequestVerificationToken: $(\"input[name='__RequestVerificationToken']\").val(),\n                                            paths: paths\n                                        },\n                                        success: function (data) {\n                                            for (var i = 0; i < self.selectedMedias.length; i++) {\n                                                var index = self.mediaItems && self.mediaItems.indexOf(self.selectedMedias[i]);\n                                                if (index > -1) {\n                                                    self.mediaItems.splice(index, 1);\n                                                    bus.$emit('mediaDeleted', self.selectedMedias[i]);\n                                                }\n                                            }\n                                            self.selectedMedias = [];\n                                        },\n                                        error: function (error) {\n                                            console.error(error.responseText);\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    },\n                    deleteMediaItem: function (media) {\n                        var self = this;\n                        if (!media) {\n                            return;\n                        }\n\n                        confirmDialog({\n                            ...$(\"#deleteMedia\").data(), callback: function (resp) {\n                                if (resp) {\n                                    $.ajax({\n                                        url: $('#deleteMediaUrl').val() + \"?path=\" + encodeURIComponent(media.mediaPath),\n                                        method: 'POST',\n                                        data: {\n                                            __RequestVerificationToken: $(\"input[name='__RequestVerificationToken']\").val()\n                                        },\n                                        success: function (data) {\n                                            var index = self.mediaItems && self.mediaItems.indexOf(media)\n                                            if (index > -1) {\n                                                self.mediaItems.splice(index, 1);\n                                                bus.$emit('mediaDeleted', media);\n                                            }\n                                            //self.selectedMedia = null;\n                                        },\n                                        error: function (error) {\n                                            console.error(error.responseText);\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    },\n                    handleDragStart: function (media, e) {\n                        // first part of move media to folder:\n                        // prepare the data that will be handled by the folder component on drop event\n                        var mediaNames = [];\n                        this.selectedMedias.forEach(function (item) {\n                            mediaNames.push(item.name);\n                        });\n\n                        // in case the user drags an unselected item, we select it first\n                        if (this.isMediaSelected(media) == false) {\n                            mediaNames.push(media.name);\n                            this.selectedMedias.push(media);\n                        }\n\n                        e.dataTransfer.setData('mediaNames', JSON.stringify(mediaNames));\n                        e.dataTransfer.setData('sourceFolder', this.selectedFolder.path);\n                        e.dataTransfer.setDragImage(this.dragDropThumbnail, 10, 10);\n                        e.dataTransfer.effectAllowed = 'move';\n                    },\n                    handleScrollWhileDrag: function (e) {\n                        if (e.clientY < 150) {\n                            window.scrollBy(0, -10);\n                        }\n\n                        if (e.clientY > window.innerHeight - 100) {\n                            window.scrollBy(0, 10);\n                        }\n                    },\n                    changeSort: function (newSort) {\n                        if (this.sortBy == newSort) {\n                            this.sortAsc = !this.sortAsc;\n                        } else {\n                            this.sortAsc = true;\n                            this.sortBy = newSort;\n                        }\n                    }\n                }\n            });\n\n            $('#create-folder-name').keydown(function (e) {\n                if (e.key == 'Enter') {\n                    $('#modalFooterOk').click();\n                    return false;\n                }\n            });\n\n            $('#modalFooterOk').on('click', function (e) {\n                var name = $('#create-folder-name').val();\n\n                if (name === \"\") {\n                    return;\n                }\n\n                $.ajax({\n                    url: $('#createFolderUrl').val() + \"?path=\" + encodeURIComponent(mediaApp.selectedFolder.path) + \"&name=\" + encodeURIComponent(name),\n                    method: 'POST',\n                    data: {\n                        __RequestVerificationToken: $(\"input[name='__RequestVerificationToken']\").val()\n                    },\n                    success: function (data) {\n                        bus.$emit('addFolder', mediaApp.selectedFolder, data);\n                        var modal = bootstrap.Modal.getOrCreateInstance($('#createFolderModal'));\n                        modal.hide();\n                    },\n                    error: function (error) {\n                        $('#createFolderModal-errors').empty();\n                        var errorMessage = JSON.parse(error.responseText).value;\n                        $('<div class=\"alert alert-danger\" role=\"alert\"></div>').text(errorMessage).appendTo($('#createFolderModal-errors'));\n                    }\n                });\n            });\n\n            $('#renameMediaModalFooterOk').on('click', function (e) {\n                var newName = $('#new-item-name').val();\n                var oldName = $('#old-item-name').val();\n\n                if (newName === \"\") {\n                    return;\n                }\n\n                var currentFolder = mediaApp.selectedFolder.path + \"/\";\n                if (currentFolder === \"/\") {\n                    currentFolder = \"\";\n                }\n\n                var newPath = currentFolder + newName;\n                var oldPath = currentFolder + oldName;\n\n                if (newPath.toLowerCase() === oldPath.toLowerCase()) {\n                    var modal = bootstrap.Modal.getOrCreateInstance($('#renameMediaModal'));\n                    modal.hide();\n                    return;\n                }\n\n                $.ajax({\n                    url: $('#renameMediaUrl').val() + \"?oldPath=\" + encodeURIComponent(oldPath) + \"&newPath=\" + encodeURIComponent(newPath),\n                    method: 'POST',\n                    data: {\n                        __RequestVerificationToken: $(\"input[name='__RequestVerificationToken']\").val()\n                    },\n                    success: function (data) {\n                        var modal = bootstrap.Modal.getOrCreateInstance($('#renameMediaModal'));\n                        modal.hide();\n                        bus.$emit('mediaRenamed', newName, newPath, oldPath, data.newUrl);\n                    },\n                    error: function (error) {\n                        $('#renameMediaModal-errors').empty();\n                        var errorMessage = JSON.parse(error.responseText).value;\n                        $('<div class=\"alert alert-danger\" role=\"alert\"></div>').text(errorMessage).appendTo($('#renameMediaModal-errors'));\n                    }\n                });\n            });\n\n            $(document).trigger('mediaApp:ready');\n\n            if (displayMediaApplication) {\n                setTimeout(function () {\n                    document.getElementById(\"mediaApp\").classList.remove(\"d-none\");\n                }, 100)              \n            }\n        },\n        error: function (error) {\n            console.error(error.responseText);\n        }\n    });\n}\n\n\n// different media field editors will add themselves to this array\nvar mediaFieldApps = [];\n\n\n// <media-field-thumbs-container> component\n// different media field editors share this component to present the thumbs.\nVue.component('mediaFieldThumbsContainer', {\n    template:\n    /* html */\n    `\n    <div :id=\"idPrefix + '_mediaContainerMain'\">\n         <div v-if=\"mediaItems.length < 1\" class=\"card text-center\">\n            <div class= \"card-body\">\n                <span class=\"hint\">{{T.noImages}}</span>\n            </div>\n         </div>\n         <ol ref=\"multiDragContainer\" class=\"media-items-grid d-flex flex-row align-items-start flex-wrap\" >\n            <li v-for=\"media in mediaItems\"\n                :key=\"media.vuekey\"\n                class=\"media-thumb-item media-container-main-list-item card overflow\"\n                :class=\"{'media-thumb-item-active': !allowMultiple && selectedMedia === media}\"\n                :style=\"{width: thumbSize + 2 + 'px'}\"\n                v-on:click=\"selectMedia(media)\"\n                v-if=\"!media.isRemoved\">\n                    <div v-if=\"media.mediaPath!== 'not-found'\">\n                        <div class=\"thumb-container\" :style=\"{height: thumbSize + 'px'}\" >\n                            <img v-if=\"media.mime.startsWith('image')\"\n                                :src=\"buildMediaUrl(media.url, thumbSize)\"\n                                :data-mime=\"media.mime\"\n                                width=\"100%\"\n                            />\n                            <i v-else :class=\"getfontAwesomeClassNameForFileName(media.name, 'fa-4x')\" :data-mime=\"media.mime\"></i>\n                        </div>\n                        <div class=\"media-container-main-item-title card-body\">\n                            <a href=\"javascript:;\" class=\"btn btn-light btn-sm float-end inline-media-button delete-button\"\n                                v-on:click.stop=\"selectAndDeleteMedia(media)\"><i class=\"fa-solid fa-trash\" aria-hidden=\"true\"></i></a>\n                            <a :href=\"media.url\" target=\"_blank\" class=\"btn btn-light btn-sm float-end inline-media-button view-button\"\"><i class=\"fa-solid fa-download\" aria-hidden=\"true\"></i></a>\n                            <span class=\"media-filename card-text small\" :title=\"media.mediaPath\">{{ media.isNew ? media.name.substr(36) : media.name }}</span>\n                        </div>\n                    </div>\n                    <div v-else>\n                        <div class=\"thumb-container flex-column\" :style=\"{height: thumbSize + 'px'}\">\n                            <i class=\"fa-solid fa-ban text-danger d-block\" aria-hidden=\"true\"></i>\n                            <span class=\"text-danger small d-block\">{{ T.mediaNotFound }}</span>\n                            <span class=\"text-danger small d-block text-center\">{{ T.discardWarning }}</span>\n                        </div>\n                        <div class=\"media-container-main-item-title card-body\">\n                            <a href=\"javascript:;\" class=\"btn btn-light btn-sm float-end inline-media-button delete-button\"\n                                v-on:click.stop=\"selectAndDeleteMedia(media)\"><i class=\"fa-solid fa-trash\" aria-hidden=\"true\"></i></a>\n                            <span class=\"media-filename card-text small text-danger\" :title=\"media.name\">{{ media.name }}</span>\n                        </div>\n                  </div>\n            </li>\n         </ol>\n    </div>\n    `,\n    data: function () {\n        return {\n            T: {},\n            sortableInstance: null,\n            multiSelectedItems: [],\n        };\n    },\n    model: {\n        prop: 'mediaItems',\n        event: 'changed',\n    },\n    props: {\n        mediaItems: Array,\n        selectedMedia: Object,\n        thumbSize: Number,\n        idPrefix: String,\n        allowMultiple: Boolean,\n    },\n    created: function () {\n        var self = this;\n\n        // retrieving localized strings from view\n        self.T.mediaNotFound = $('#t-media-not-found').val();\n        self.T.discardWarning = $('#t-discard-warning').val();\n        self.T.noImages = $('#t-no-images').val();\n    },\n    mounted: function () {\n        if (this.allowMultiple) this.initSortable();\n    },\n    methods: {\n        initSortable: function () {\n            if (this.$refs.multiDragContainer) {\n                var self = this;\n\n                this.sortableInstance = Sortable.create(this.$refs.multiDragContainer, {\n                animation: 150,\n                ghostClass: 'sortable-ghost',\n                multiDrag: true,\n                selectedClass: 'sortable-selected',\n                preventOnFilter: true,\n                forceHelperSize: true,\n                onUpdate: function (evt) {\n                    let newOrder = [...self.mediaItems];\n\n                    if (evt.oldIndicies && evt.oldIndicies.length > 0) {\n                        let oldIndices = evt.oldIndicies.sort((a, b) => a.index - b.index);\n                        let newIndices = evt.newIndicies.sort((a, b) => a.index - b.index);\n\n                        const itemsToMove = oldIndices.map(oldIdx => self.mediaItems[oldIdx.index]);\n\n                        // old out\n                        for (let i = oldIndices.length - 1; i >= 0; i--) {\n                            newOrder.splice(oldIndices[i].index, 1);\n                        }\n\n                        // new in\n                        for (let i = 0; i < newIndices.length; i++) {\n                            newOrder.splice(newIndices[i].index, 0, itemsToMove[i]);\n                        }\n\n                    } else {\n                        // Single item move\n                        const [movedItem] = newOrder.splice(evt.oldIndex, 1);\n                        newOrder.splice(evt.newIndex, 0, movedItem);\n                    }\n\n                    self.$emit('changed', newOrder);\n\n                    const selectedElements = self.$refs.multiDragContainer.querySelectorAll('.sortable-selected');\n                    selectedElements.forEach(el => {\n                        Sortable.utils.deselect(el);\n                    });\n                    self.multiSelectedItems = [];\n                }\n                });\n            }\n        },\n        selectAndDeleteMedia: function (media) {\n            this.$parent.$emit('selectAndDeleteMediaRequested', media);\n        },\n        selectMedia: function (media) {\n            this.$parent.$emit('selectMediaRequested', media);\n        },\n        buildMediaUrl: function (url, thumbSize) {\n            return url + (url.indexOf('?') == -1 ? '?' : '&') + 'width=' + thumbSize + '&height=' + thumbSize;\n        },\n        getfontAwesomeClassNameForFileName:function getfontAwesomeClassNameForFilename(filename, thumbsize){\n            return getClassNameForFilename(filename) + ' ' + thumbsize;\n        }\n    }\n});\n\n\nfunction initializeAttachedMediaField(el, idOfUploadButton, uploadAction, mediaItemUrl, allowMultiple, allowMediaText, allowAnchors, tempUploadFolder, maxUploadChunkSize) {\n\n    var target = $(document.getElementById($(el).data('for')));\n    var initialPaths = target.data(\"init\");\n\n    var mediaFieldEditor = $(el);\n    var idprefix = mediaFieldEditor.attr(\"id\");\n    var mediaFieldApp;\n\n    mediaFieldApps.push(mediaFieldApp = new Vue({\n        el: mediaFieldEditor.get(0),\n        data: {\n            mediaItems: [],\n            selectedMedia: null,\n            smallThumbs: false,\n            idPrefix: idprefix,\n            initialized: false,\n            allowMediaText: allowMediaText,\n            backupMediaText: '',\n            allowAnchors: allowAnchors,\n            backupAnchor: null,\n            mediaTextmodal: null,\n            anchoringModal: null\n        },\n        created: function () {\n            var self = this;\n\n            self.currentPrefs = JSON.parse(localStorage.getItem('mediaFieldPrefs'));\n        },\n        computed: {\n            paths: {\n                get: function () {\n                    var mediaPaths = [];\n                    if (!this.initialized) {\n                        return JSON.stringify(initialPaths);\n                    }\n                    this.mediaItems.forEach(function (x) {\n                        if (x.mediaPath === 'not-found') {\n                            return;\n                        }\n                        mediaPaths.push({ path: x.mediaPath, isRemoved: x.isRemoved, isNew: x.isNew, mediaText: x.mediaText, anchor: x.anchor, attachedFileName: x.attachedFileName });\n                    });\n                    return JSON.stringify(mediaPaths);\n                },\n                set: function (values) {\n                    var self = this;\n                    var mediaPaths = values || [];\n                    var signal = $.Deferred();\n                    var items = [];\n                    var length = 0;\n                    mediaPaths.forEach(function (x, i) {\n                        items.push({ name: ' ' + x.path, mime: '', mediaPath: '', anchor: x.anchor, attachedFileName: x.attachedFileName }); // don't remove the space. Something different is needed or it wont react when the real name arrives.\n                        promise = $.when(signal).done(function () {\n                            $.ajax({\n                                url: mediaItemUrl + \"?path=\" + encodeURIComponent(x.path),\n                                method: 'GET',\n                                success: function (data) {\n                                    data.vuekey = data.name + i.toString(); // Because a unique key is required by Vue on v-for \n                                    data.mediaText = x.mediaText; // This value is not returned from the ajax call.\n                                    data.anchor = x.anchor; // This value is not returned from the ajax call.\n                                    data.attachedFileName = x.attachedFileName;// This value is not returned from the ajax call.\n                                    items.splice(i, 1, data);\n                                    if (items.length === ++length) {\n                                        items.forEach(function (x) {\n                                            self.mediaItems.push(x);\n                                        });\n                                        self.initialized = true;\n                                    }\n                                },\n                                error: function (error) {\n                                    console.log(JSON.stringify(error));\n                                    items.splice(i, 1, { name: x.path, mime: '', mediaPath: 'not-found', mediaText: '', anchor: { x: 0.5, y: 0.5 }, attachedFileName: x.attachedFileName });\n                                    if (items.length === ++length) {\n                                        items.forEach(function (x) {\n                                            self.mediaItems.push(x);\n                                        });\n                                        self.initialized = true;\n                                    }\n                                }\n                            });\n                        });\n                    });\n\n                    signal.resolve();\n                }\n            },\n            fileSize: function () {\n                return Math.round(this.selectedMedia.size / 1024);\n            },\n            canAddMedia: function () {\n                var nonRemovedMediaItems = [];\n                for (var i = 0; i < this.mediaItems.length; i++) {\n                    if (!this.mediaItems[i].isRemoved) {\n                        nonRemovedMediaItems.push(this.mediaItems[i]);\n                    }\n                }\n\n                return nonRemovedMediaItems.length === 0 || nonRemovedMediaItems.length > 0 && allowMultiple;\n            },\n            thumbSize: function () {\n                return this.smallThumbs ? 120 : 240;\n            },\n            currentPrefs: {\n                get: function () {\n                    return {\n                        smallThumbs: this.smallThumbs\n                    };\n                },\n                set: function (newPrefs) {\n                    if (!newPrefs) {\n                        return;\n                    }\n                    this.smallThumbs = newPrefs.smallThumbs;\n                }\n            }\n        },\n        mounted: function () {\n            var self = this;\n\n            self.paths = initialPaths;\n\n            self.$on('selectAndDeleteMediaRequested', function (media) {\n                self.selectAndDeleteMedia(media);\n            });\n\n            self.$on('selectMediaRequested', function (media) {\n                self.selectMedia(media);\n            });\n\n            var selector = '#' + idOfUploadButton;\n            var editorId = mediaFieldEditor.attr('id');\n            var chunkedFileUploadId = randomUUID();\n\n            $(selector)\n                .fileupload({\n                    limitConcurrentUploads: 20,\n                    dropZone: $('#' + editorId),\n                    dataType: 'json',\n                    url: uploadAction,\n                    maxChunkSize: maxUploadChunkSize,\n                    add: function (e, data) {\n                        var count = data.files.length;\n                        var i;\n                        for (i = 0; i < count; i++) {\n                            data.files[i].uploadName =\n                                self.getUniqueId() + data.files[i].name;\n                            data.files[i].attachedFileName = data.files[i].name;\n                        }\n                        data.submit();\n                    },\n                    formData: function () {\n                        var antiForgeryToken = $(\"input[name=__RequestVerificationToken]\").val();\n\n                        return [\n                            { name: 'path', value: tempUploadFolder },\n                            { name: '__RequestVerificationToken', value: antiForgeryToken },\n                            { name: '__chunkedFileUploadId', value: chunkedFileUploadId },\n                        ];\n                    },\n                    done: function (e, data) {\n                        var newMediaItems = [];\n                        var errormsg = \"\";\n\n                        if (data.result.files.length > 0) {\n                            for (var i = 0; i < data.result.files.length; i++) {\n                                data.result.files[i].isNew = true;\n                                //if error is defined probably the file type is not allowed\n                                if (data.result.files[i].error === undefined || data.result.files[i].error === null) {\n                                    data.result.files[i].attachedFileName = data.files[i].attachedFileName;\n                                    newMediaItems.push(data.result.files[i]);\n                                }\n                                else\n                                    errormsg += data.result.files[i].error + \"\\n\";\n                            }\n                        }\n\n                        if (errormsg !== \"\") {\n                            alert(errormsg);\n                            return;\n                        }\n                        console.log(newMediaItems);\n                        if (newMediaItems.length > 1 && allowMultiple === false) {\n                            alert($('#onlyOneItemMessage').val());\n                            mediaFieldApp.mediaItems.push(newMediaItems[0]);\n                            mediaFieldApp.initialized = true;\n                        } else {\n                            mediaFieldApp.mediaItems = mediaFieldApp.mediaItems.concat(newMediaItems);\n                            mediaFieldApp.initialized = true;\n                        }\n                    },\n                    error: function (jqXHR, textStatus, errorThrown) {\n                        console.log('Error on upload.');\n                        console.log(jqXHR);\n                        console.log(textStatus);\n                        console.log(errorThrown);\n                    }\n                })\n                .on('fileuploadchunkbeforesend', (e, options) => {\n                    let file = options.files[0];\n                    // Here we replace the blob with a File object to ensure the file name and others are preserved for the backend.\n                    options.blob = new File(\n                        [options.blob],\n                        file.name,\n                        {\n                            type: file.type,\n                            lastModified: file.lastModified,\n                        });\n                });\n        },\n        methods: {\n            selectMedia: function (media) {\n                this.selectedMedia = media;\n            },\n            getUniqueId: function () {\n                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                    var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n                    return v.toString(16);\n                });\n            },\n            removeSelected: function (event) {\n                var removed = {};\n                if (this.selectedMedia) {\n                    var index = this.mediaItems && this.mediaItems.indexOf(this.selectedMedia);\n                    if (index > -1) {\n                        removed = this.mediaItems[index];\n                        removed.isRemoved = true;\n                        //this.mediaItems.splice([index], 1, removed);\n                        this.mediaItems.splice(index, 1);\n                    }\n                }\n                else {\n                    // The remove button can also remove a unique media item\n                    if (this.mediaItems.length === 1) {\n                        removed = this.mediaItems[index];\n                        removed.isRemoved = true;\n                        //this.mediaItems.splice(0, 1, removed);                        \n                        this.mediaItems.splice(0, 1);\n                    }\n                }\n                this.selectedMedia = null;\n            },\n            showMediaTextModal: function (event) {\n                this.mediaTextModal = new bootstrap.Modal(this.$refs.mediaTextModal);\n                this.mediaTextModal.show();\n                this.backupMediaText = this.selectedMedia.mediaText;\n            },\n            cancelMediaTextModal: function (event) {\n                this.mediaTextModal.hide();\n                this.selectedMedia.mediaText = this.backupMediaText;\n            },\n            showAnchorModal: function (event) {\n                this.anchoringModal = new bootstrap.Modal(this.$refs.anchoringModal);\n                this.anchoringModal.show();\n                // Cause a refresh to recalc heights.\n                this.selectedMedia.anchor = {\n                    x: this.selectedMedia.anchor.x,\n                    y: this.selectedMedia.anchor.y\n                }\n                this.backupAnchor = this.selectedMedia.anchor;\n            },\n            cancelAnchoringModal: function (event) {\n                this.anchoringModal.hide();\n                this.selectedMedia.anchor = this.backupAnchor;\n            },\n            resetAnchor: function (event) {\n                this.selectedMedia.anchor = { x: 0.5, y: 0.5 };\n            },\n            onAnchorDrop: function (event) {\n                var image = this.$refs.anchorImage;\n                this.selectedMedia.anchor = {\n                    x: event.offsetX / image.clientWidth,\n                    y: event.offsetY / image.clientHeight\n                }\n            },\n            anchorLeft: function () {\n                if (this.$refs.anchorImage && this.$refs.modalBody && this.selectedMedia) {\n                    // When image is shrunk compare against the modal body.\n                    var offset = (this.$refs.modalBody.clientWidth - this.$refs.anchorImage.clientWidth) / 2;\n                    var position = (this.selectedMedia.anchor.x * this.$refs.anchorImage.clientWidth) + offset;\n                    if (position < 17) { // Adjust so the target doesn't show outside image.\n                        position = 17;\n                    } else {\n                        position = position - 8; // Adjust to hit the mouse pointer.\n                    }\n                    return position + 'px';\n                } else {\n                    return '0';\n                }\n            },\n            anchorTop: function () {\n                if (this.$refs.anchorImage && this.selectedMedia) {\n                    var position = this.selectedMedia.anchor.y * this.$refs.anchorImage.clientHeight;\n                    if (position < 15) { // Adjustment so the target doesn't show outside image.\n                        position = 15;\n                    } else {\n                        position = position + 5; // Adjust to hit the mouse pointer.\n                    }\n                    return position + 'px';\n                } else {\n                    return '0';\n                }\n            },\n            setAnchor: function (event) {\n                var image = this.$refs.anchorImage;\n                this.selectedMedia.anchor = {\n                    x: event.offsetX / image.clientWidth,\n                    y: event.offsetY / image.clientHeight\n                }\n            },\n            addMediaFiles: function (files) {\n                if ((files.length > 1) && (allowMultiple === false)) {\n                    alert($('#onlyOneItemMessage').val());\n                    mediaFieldApp.mediaItems.push(files[0]);\n                    mediaFieldApp.initialized = true;\n                } else {\n                    mediaFieldApp.mediaItems = mediaFieldApp.mediaItems.concat(files);\n                    mediaFieldApp.initialized = true;\n                }\n            },\n            selectAndDeleteMedia: function (media) {\n                var self = this;\n                self.selectedMedia = media;\n                // setTimeout because sometimes \n                // removeSelected was called even before the media was set.\n                setTimeout(function () {\n                    self.removeSelected();\n                }, 100);\n            }\n        },\n        watch: {\n            mediaItems: {\n                deep: true,\n                handler() {\n                    // Trigger preview rendering\n                    setTimeout(function () { $(document).trigger('contentpreview:render'); }, 100);\n                }\n            },\n            currentPrefs: function (newPrefs) {\n                localStorage.setItem('mediaFieldPrefs', JSON.stringify(newPrefs));\n            }\n        }\n    }));\n}\n\n\nconst MEDIA_FIELD_GALLERY = \"mediaFieldGallery_\";\n\nVue.component(\"mediaFieldGalleryListItem\", {\n    template:\n    /*html*/\n    `\n        <li class=\"list-group-item d-flex p-0 overflow-hidden align-items-center\" v-if=\"!media.isRemoved\" :class=\"media.mediaPath=='not-found' ? 'text-danger' : ''\">\n            <div class=\"media-preview flex-shrink-0\">\n                <img\n                    v-if=\"media.mime.startsWith('image')\"\n                    :src=\"buildMediaUrl(media.url, media.anchor)\"\n                    :data-mime=\"media.mime\"\n                    class=\"w-100 object-fit-scale\"\n                />\n                <i v-else-if=\"media.mediaPath=='not-found'\" :title=\"media.name\" class=\"fa-solid fa-triangle-exclamation\"></i>\n                <i v-else :class=\"$parent.getfontAwesomeClassNameForFileName(media.name, 'fa-4x card-text')\" :data-mime=\"media.mime\"></i>\n            </div>\n            <div class=\"me-auto flex-shrink-1\">\n                <span v-if=\"media.mediaPath=='not-found'\" class=\"media-filename card-text small\">{{ $parent.T.mediaNotFound }} - {{ $parent.T.discardWarning }}</span>\n                <span v-else class=\"media-filename card-text small\" :title=\"media.name\">{{ media.name }}</span>\n            </div>\n            <div class=\"media-field-gallery-list-actions flex-shrink-0\">\n                <a\n                    v-show=\"allowMediaText && media.mediaPath!=='not-found'\"\n                    class=\"btn btn-light btn-sm inline-media-button view-button\"\n                    v-on:click.prevent.stop=\"$parent.showMediaTextModal(media)\"\n                    href=\"javascript:;\"\n                    title=\"Edit media text\"\n                >\n                    <span v-show=\"!media.mediaText\">\n                        <i class=\"far fa-comment\"></i>\n                    </span>\n                    <span v-show=\"media.mediaText\">\n                        <i class=\"fa-solid fa-comment\"></i>\n                    </span>\n                </a>\n                <a\n                    href=\"javascript:;\"\n                    v-show=\"allowAnchors && media.mime.startsWith('image') && media.mediaPath!=='not-found'\"\n                    v-on:click=\"$parent.showAnchorModal(media)\"\n                    class=\"btn btn-light btn-sm inline-media-button view-button\"\n                    title=\"Set anchor\"\n                >\n                    <i class=\"fa-solid fa-crosshairs\" aria-hidden=\"true\"></i>\n                </a>\n                <a\n                    :href=\"media.url\"\n                    target=\"_blank\"\n                    v-show=\"media.mediaPath!=='not-found'\"\n                    class=\"btn btn-light btn-sm inline-media-button view-button\"\n                    title=\"View media\"\n                >\n                    <i class=\"fa-solid fa-download\" aria-hidden=\"true\"></i>\n                </a>\n                <a\n                    href=\"javascript:;\"\n                    class=\"btn btn-light btn-sm inline-media-button view-button\"\n                    v-on:click.stop=\"$parent.selectAndDeleteMedia(media)\"\n                    title=\"Remove media\"\n                >\n                    <i class=\"fa-solid fa-trash\" aria-hidden=\"true\"></i>\n                </a>\n            </div>\n        </li>\n    `,\n    props: {\n        media: Object,\n        canAddMedia: Boolean,\n        allowMediaText: Boolean,\n        allowAnchors: Boolean,\n        cols: Number,\n    },\n    methods: {\n        fileSize: function fileSize(rawSize) {\n            return Math.round(rawSize / 1024);\n        },\n        buildMediaUrl: function buildMediaUrl(url) {\n            return url + (url.indexOf(\"?\") == -1 ? \"?\" : \"&\") + \"width=32&height=32\";\n        },\n    },\n});\n\nVue.component(\"mediaFieldGalleryCardItem\", {\n    template:\n    /*html*/\n    `\n        <li class=\"media-field-gallery-item\" v-if=\"!media.isRemoved\">\n            <div class=\"card ratio ratio-1x1 overflow-hidden\" :class=\"media.mediaPath=='not-found' ? 'text-danger border-danger' : ''\">\n                <div class=\"d-flex flex-column h-100\">\n                    <div class=\"flex-grow-1 media-preview d-flex justify-content-center align-items-center\">\n                        <div class=\"update-media\" v-if=\"!$parent.allowMultiple\" v-on:click=\"$parent.showMediaModal\">\n                            + Media Library\n                        </div>\n                        <div class=\"image-wrapper\" v-if=\"media.mime.startsWith('image')\">\n                            <img\n                                :src=\"buildMediaUrl(media.url)\"\n                                :data-mime=\"media.mime\"\n                                class=\"w-100 h-100 object-fit-scale\"\n                            />\n                        </div>\n                        <div v-else-if=\"media.mediaPath=='not-found'\" class=\"d-flex flex-column justify-content-center align-items-center h-100 bg-body file-icon not-found\" :title=\"media.name\">\n                            <i class=\"fa-solid fa-triangle-exclamation fa-2x card-text'\"></i>\n                            <span class=\"card-text small pt-2\" :title=\"media.name\">{{ $parent.T.mediaNotFound }}</span>\n                            <span class=\"card-text small pt-2 px-2 text-center\" :title=\"media.name\">{{ $parent.T.discardWarning }}</span>\n                        </div>\n                        <div v-else class=\"d-flex flex-column justify-content-center align-items-center h-100 bg-body file-icon\">\n                            <i :class=\"$parent.getfontAwesomeClassNameForFileName(media.name, 'fa-4x card-text')\" :data-mime=\"media.mime\"></i>\n                            <span class=\"media-filename card-text small pt-2\" :title=\"media.name\">{{ media.name }}</span>\n                        </div>\n                    </div>\n\n                    <div class=\"media-field-gallery-card-actions flex-shrink-0\">\n                        <a\n                            v-show=\"allowMediaText && media.mediaPath!=='not-found'\"\n                            class=\"btn btn-light btn-sm inline-media-button view-button\"\n                            v-on:click.prevent.stop=\"$parent.showMediaTextModal(media)\"\n                            href=\"javascript:;\"\n                            title=\"Edit media text\"\n                        >\n                            <span v-show=\"!media.mediaText\">\n                                <i class=\"far fa-comment\"></i>\n                            </span>\n                            <span v-show=\"media.mediaText\">\n                                <i class=\"fa-solid fa-comment\"></i>\n                            </span>\n                        </a>\n                        <a\n                            href=\"javascript:;\"\n                            v-show=\"allowAnchors && media.mime.startsWith('image') && media.mediaPath!=='not-found'\"\n                            v-on:click=\"$parent.showAnchorModal(media)\"\n                            class=\"btn btn-light btn-sm inline-media-button view-button\"\n                            title=\"Set anchor\"\n                        >\n                            <i class=\"fa-solid fa-crosshairs\" aria-hidden=\"true\"></i>\n                        </a>\n                        <a\n                            :href=\"media.url\"\n                            target=\"_blank\"\n                            v-show=\"media.mediaPath!=='not-found'\"\n                            class=\"btn btn-light btn-sm inline-media-button view-button\"\n                            title=\"View media\"\n                        >\n                            <i class=\"fa-solid fa-download\" aria-hidden=\"true\"></i>\n                        </a>\n                        <a\n                            href=\"javascript:;\"\n                            class=\"btn btn-light btn-sm inline-media-button view-button\"\n                            v-on:click.stop=\"$parent.selectAndDeleteMedia(media)\"\n                            title=\"Remove media\"\n                        >\n                            <i class=\"fa-solid fa-trash\" aria-hidden=\"true\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </li>\n    `,\n    props: {\n        media: Object,\n        canAddMedia: Boolean,\n        allowAnchors: Boolean,\n        allowMediaText: Boolean,\n    },\n    methods: {\n        fileSize: function fileSize(rawSize) {\n            return Math.round(rawSize / 1024);\n        },\n        buildMediaUrl: function buildMediaUrl(url) {\n            return (url + (url.indexOf(\"?\") == -1 ? \"?\" : \"&\") + \"width=240&height=240\");\n        },\n    },\n});\n\nVue.component(\"mediaFieldGalleryContainer\", {\n    template:\n    /*html*/\n    `\n        <div class=\"media-field-gallery\" :id=\"idPrefix + '_mediaContainerMain'\" v-cloak>\n            <div v-if=\"allowMultiple\" class=\"pb-2\" v-cloak>\n                <div class=\"me-auto\">\n                    <a\n                        type=\"button\"\n                        class=\"btn btn-sm btn-primary\"\n                        href=\"javascript:;\"\n                        v-show=\"$parent.canAddMedia\"\n                        v-on:click=\"$parent.showModal\"\n                    >\n                        <i class=\"fa-solid fa-plus\" aria-hidden=\"true\"></i>\n                        Media Library\n                    </a>\n                    <a\n                        type=\"button\"\n                        class=\"btn btn-sm btn-secondary draft me-2\"\n                        :class=\"selectedItemCount == 0 ? 'disabled' : ''\"\n                        :disabled=\"selectedItemCount == 0\"\n                        href=\"javascript:;\"\n                        v-on:click=\"deselectAll\"\n                    >\n                        Deselect All\n                    </a>\n\n                    <div class=\"btn-group\">\n                        <button type=\"button\" class=\"btn btn-sm\" :class=\"!gridView ? 'text-primary': ''\" v-on:click=\"gridView = false;\">\n                            <span title=\"Gridview\"></span>\n                            <i class=\"fa-solid fa-th-list\"></i>\n                        </button>\n                        <button type=\"button\" class=\"btn btn-sm\" :class=\"gridView ? 'text-primary': ''\" v-on:click=\"gridView = true;\">\n                            <span title=\"List\"></span>\n                            <i class=\"fa-solid fa-th-large\"></i>\n                        </button>\n                        <button type=\"button\" class=\"btn btn-sm\" :class=\"size == 'sm' ? 'text-primary': ''\" v-on:click=\"size = 'sm';\" v-show=\"gridView\">\n                            <span title=\"Small Thumbs\"></span>\n                            <i class=\"fa-solid fa-compress\"></i>\n                        </button>\n                        <button type=\"button\" class=\"btn btn-sm\" :class=\"size == 'lg' ? 'text-primary': ''\" v-on:click=\"size = 'lg';\" v-show=\"gridView\">\n                            <span title=\"Large Thumbs\"></span>\n                            <i class=\"fa-solid fa-expand\"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <ol ref=\"mediaContainer\" v-if=\"!gridView\" :class=\"'media-field-gallery-list list-group list-unstyled size-' + size\">\n                <media-field-gallery-list-item\n                    v-for= \"media in mediaItemsNoDuplicates\"\n                    :key=\"media.vuekey ?? media.name\"\n                    :media=\"media\"\n                    :canAddMedia=\"$parent.canAddMedia\"\n                    :allowMediaText=\"$parent.allowMediaText\"\n                    :allowAnchors=\"$parent.allowAnchors\"\n                    :size=\"size\"\n                />\n\n                <li v-if=\"!mediaItems || mediaItems.length < 1\" class=\"list-group-item text-center hint media-field-gallery-choose-btn\" v-on:click=\"showMediaModal\">\n                    + Media Library\n                </li>\n            </ol>\n\n            <ol ref=\"mediaContainer\" v-if=\"gridView\" :class=\"'media-field-gallery-cards list-unstyled size-' + size\">\n                <media-field-gallery-card-item\n                    v-for= \"media in mediaItemsNoDuplicates\"\n                    :key=\"media.vuekey ?? media.name\"\n                    :media=\"media\"\n                    :canAddMedia=\"$parent.canAddMedia\"\n                    :allowMediaText=\"$parent.allowMediaText\"\n                    :allowAnchors=\"$parent.allowAnchors\"\n                    :size=\"size\"\n                />\n\n                <li class=\"add-media-card\" v-if=\"allowMultiple || mediaItems.length < 1\" v-on:click=\"showMediaModal\">\n                    <div class=\"card media-field-gallery-choose-btn text-center overflow-hidden\">\n                        <div class=\"ratio ratio-1x1 text-center\">\n                            <div class=\"hint d-flex align-items-center justify-content-center w-100\">+ Media Library</div>\n                        </div>\n                    </div>\n                </li>\n            </ol>\n        </div>\n    `,\n    data: function data() {\n        return {\n            T: {},\n            sortableInstance: null,\n            multiSelectedItems: [],\n            selectedItemCount: 0,\n            gridView: true,\n            size: \"lg\",\n        };\n    },\n    props: {\n        mediaItems: Array,\n        selectedMedia: Object,\n        idPrefix: String,\n        modalId: String,\n        allowMultiple: Boolean\n    },\n    created: function created() {\n        var self = this;\n\n        // retrieving localized strings from view\n        self.T.mediaNotFound = $(\"#t-media-not-found\").val();\n        self.T.discardWarning = $(\"#t-discard-warning\").val();\n        self.T.noImages = $(\"#t-no-images\").val();\n    },\n    mounted: function mounted() {\n        this.getLocalStorageState();\n        this.initSortable();\n    },\n    beforeDestroy: function beforeDestroy() {\n        if (this.sortableInstance) {\n            this.sortableInstance.destroy();\n        }\n    },\n    watch: {\n        mediaItems: {\n            handler() {\n                if (this.sortableInstance) {\n                    this.sortableInstance.destroy();\n                }\n                this.$nextTick(() => {\n                    this.initSortable();\n                    // as this component is now responsible for inforcing one item only when allowMultiple is false, we emit the last item in the list\n                    if (!this.allowMultiple && this.mediaItems.length > 1) {\n                        this.$emit(\"updated\", [this.mediaItems[this.mediaItems.length - 1]]);\n                    }\n                });\n            },\n            deep: true,\n        },\n        size: {\n            handler() {\n                this.setLocalStorageState();\n            },\n        },\n        gridView: {\n            handler() {\n                this.setLocalStorageState();\n            },\n        },\n    },\n    computed: {\n        mediaItemsNoDuplicates: function mediaItemsNoDuplicates() {\n          return this.removeDuplicates(this.mediaItems);\n        }\n    },\n    methods: {\n        getLocalStorageState: function getLocalStorageState() {\n            if (localStorage.getItem(MEDIA_FIELD_GALLERY + this.idPrefix)) {\n                try {\n                    const state = JSON.parse(localStorage.getItem(MEDIA_FIELD_GALLERY + this.idPrefix));\n                    this.size = state.size || \"lg\";\n                    this.gridView = !this.allowMultiple ? true : state.gridView ?? false;\n                } catch (e) {\n                    localStorage.removeItem(MEDIA_FIELD_GALLERY + this.idPrefix);\n                }\n            }\n        },\n        setLocalStorageState: function setLocalStorageState() {\n            const parsed = JSON.stringify({\n                size: this.size,\n                gridView: this.gridView,\n            });\n            localStorage.setItem(MEDIA_FIELD_GALLERY + this.idPrefix, parsed);\n        },\n        initSortable: function initSortable() {\n            if (this.allowMultiple && this.$refs.mediaContainer && this.mediaItemsNoDuplicates.length > 0) {\n                var self = this;\n                this.sortableInstance = Sortable.create(this.$refs.mediaContainer, {\n                    animation: 150,\n                    ghostClass: \"sortable-ghost\",\n                    multiDrag: true,\n                    selectedClass: \"sortable-selected\",\n                    filter: \"a, button, .add-media-card\",\n                    preventOnFilter: false,\n                    onSelect: () => this.updateSelectedCount(),\n                    onDeselect: () => this.updateSelectedCount(),\n                    onEnd: () => this.updateSelectedCount(),\n                    onMove: function (evt) {\n                        // Prevent moving the .add-media-card or placing anything after it\n                        const dragged = evt.dragged;\n                        const related = evt.related;\n\n                        // If trying to move the \"add\" card or drop something after it\n                        if (\n                            dragged.classList.contains(\"add-media-card\") ||\n                            related.classList.contains(\"add-media-card\")\n                        ) {\n                            return false; // Cancel the move\n                        }\n\n                        return true;\n                    },\n                    onUpdate: function (evt) {\n                        let newOrder = [...self.mediaItemsNoDuplicates];\n\n                        if (evt.oldIndicies && evt.oldIndicies.length > 0) {\n                        let oldIndices = evt.oldIndicies.sort(\n                            (a, b) => a.index - b.index\n                        );\n                        let newIndices = evt.newIndicies.sort(\n                            (a, b) => a.index - b.index\n                        );\n\n                        const itemsToMove = oldIndices.map(\n                            (oldIdx) => self.mediaItems[oldIdx.index]\n                        );\n\n                        // old out\n                        for (let i = oldIndices.length - 1; i >= 0; i--) {\n                            newOrder.splice(oldIndices[i].index, 1);\n                        }\n\n                        // new in\n                        for (let i = 0; i < newIndices.length; i++) {\n                            newOrder.splice(newIndices[i].index, 0, itemsToMove[i]);\n                        }\n                        } else {\n                            // Single item move\n                            const [movedItem] = newOrder.splice(evt.oldIndex, 1);\n                            newOrder.splice(evt.newIndex, 0, movedItem);\n                        }\n\n                        self.$emit(\"updated\", newOrder);\n\n                        const selectedElements = self.$refs.mediaContainer.querySelectorAll(\".sortable-selected\");\n                        selectedElements.forEach((el) => {\n                            Sortable.utils.deselect(el);\n                        });\n                        self.multiSelectedItems = [];\n                    },\n                });\n            }\n        },\n        selectAndDeleteMedia: function selectAndDeleteMedia(media) {\n            this.$parent.$emit(\"selectAndDeleteMediaRequested\", media);\n        },\n        showMediaTextModal: function showMediaTextModal(media) {\n            this.$parent.$emit(\"selectMediaRequested\", media);\n            this.$nextTick(() => this.$emit(\"updatemediatext\"));\n        },\n        showAnchorModal: function showAnchorModal(media) {\n            this.$parent.$emit(\"selectMediaRequested\", media);\n            this.$nextTick(() => this.$emit(\"updateanchor\"));\n        },\n        updateSelectedCount() {\n            this.selectedItemCount = this.$refs.mediaContainer.querySelectorAll(\".sortable-selected\").length;\n        },\n        getfontAwesomeClassNameForFileName: function getfontAwesomeClassNameForFilename(filename, thumbsize) {\n            return getClassNameForFilename(filename) + \" \" + thumbsize;\n        },\n        deselectAll: function deselectAll() {\n            this.$refs.mediaContainer\n                .querySelectorAll(\".sortable-selected\")\n                .forEach((el) => {\n                    Sortable.utils.deselect(el);\n                });\n            this.multiSelectedItems = [];\n        },\n        showMediaModal: function () {\n            this.$parent.showModal();\n        },\n        removeDuplicates: function (array) {\n            return array.filter((obj, index, self) =>\n                index === self.findIndex((o) => o.mediaPath === obj.mediaPath)\n            );\n        },\n    }\n});\n\n\nfunction initializeMediaField(el, modalBodyElement, mediaItemUrl, allowMultiple, allowMediaText, allowAnchors, allowedExtensions) {\n    //BagPart create a script section without other DOM elements\n    if (el === null) return;\n\n    var target = $(document.getElementById($(el).data('for')));\n    var initialPaths = target.data(\"init\");\n\n    var mediaFieldEditor = $(el);\n    var idprefix = mediaFieldEditor.attr(\"id\");\n    var mediaFieldApp;\n\n    //when hide modal detach media app to avoid issue on BagPart\n    modalBodyElement.addEventListener('hidden.bs.modal', function (event) {\n        $(\"#mediaApp\").appendTo('body');\n        document.getElementById(\"mediaApp\").classList.add(\"d-none\");\n    });\n\n    mediaFieldApps.push(mediaFieldApp = new Vue({\n        el: mediaFieldEditor.get(0),\n        data: {\n            mediaItems: [],\n            selectedMedia: null,\n            smallThumbs: false,\n            idPrefix: idprefix,\n            initialized: false,\n            allowMediaText: allowMediaText,\n            backupMediaText: '',\n            allowAnchors: allowAnchors,\n            allowedExtensions: allowedExtensions,\n            backupAnchor: null,\n            mediaTextModal: null,\n            anchoringModal: null\n        },\n        created: function () {\n            var self = this;\n\n            self.currentPrefs = JSON.parse(localStorage.getItem('mediaFieldPrefs'));\n        },\n        computed: {\n            paths: {\n                get: function () {\n                    var mediaPaths = [];\n                    if (!this.initialized) {\n                        return JSON.stringify(initialPaths);\n                    }\n                    this.mediaItems.forEach(function (x) {\n                        if (x.mediaPath === 'not-found') {\n                            return;\n                        }\n                        mediaPaths.push({ path: x.mediaPath, mediaText: x.mediaText, anchor: x.anchor });\n                    });\n                    return JSON.stringify(mediaPaths);\n                },\n                set: function (values) {\n                    var self = this;\n                    var mediaPaths = values || [];\n                    var signal = $.Deferred();\n                    var items = [];\n                    var length = 0;\n                    mediaPaths.forEach(function (x, i) {\n                        items.push({ name: ' ' + x.path, mime: '', mediaPath: '' }); // don't remove the space. Something different is needed or it wont react when the real name arrives.\n                        promise = $.when(signal).done(function () {\n                            $.ajax({\n                                url: mediaItemUrl + \"?path=\" + encodeURIComponent(x.path),\n                                method: 'GET',\n                                success: function (data) {\n                                    data.vuekey = data.name + i.toString();\n                                    data.mediaText = x.mediaText; // This value is not returned from the ajax call.\n                                    data.anchor = x.anchor; // This value is not returned from the ajax call.\n                                    items.splice(i, 1, data);\n                                    if (items.length === ++length) {\n                                        items.forEach(function (y) {\n                                            self.mediaItems.push(y);\n                                        });\n                                        self.initialized = true;\n\n                                        // Preselect first thumbnail if only single image is allowed\n                                        if (!allowMultiple && self.mediaItems.length === 1) {\n                                            self.$nextTick(function () {\n                                                self.selectedMedia = self.mediaItems[0];\n                                            });\n                                        }\n                                    }\n                                },\n                                error: function (error) {\n                                    console.log(error);\n                                    items.splice(i, 1, { name: x.path, mime: '', mediaPath: 'not-found', mediaText: '', anchor: { x: 0, y: 0 } });\n                                    if (items.length === ++length) {\n                                        items.forEach(function (x) {\n                                            self.mediaItems.push(x);\n                                        });\n                                        self.initialized = true;\n                                    }\n                                }\n                            });\n                        });\n                    });\n\n\n                    signal.resolve();\n                }\n            },\n            fileSize: function () {\n                return Math.round(this.selectedMedia.size / 1024);\n            },\n            canAddMedia: function () {\n                return this.mediaItems.length === 0 || this.mediaItems.length > 0 && allowMultiple;\n            },\n            thumbSize: function () {\n                return this.smallThumbs ? 120 : 240;\n            },\n            currentPrefs: {\n                get: function () {\n                    return {\n                        smallThumbs: this.smallThumbs\n                    };\n                },\n                set: function (newPrefs) {\n                    if (!newPrefs) {\n                        return;\n                    }\n                    this.smallThumbs = newPrefs.smallThumbs;\n                }\n            }\n        },\n        mounted: function () {\n            var self = this;\n\n            self.paths = initialPaths;\n\n            self.$on('selectAndDeleteMediaRequested', function (media) {\n                self.selectAndDeleteMedia(media);\n            });\n\n            self.$on('selectMediaRequested', function (media) {\n                self.selectMedia(media);\n            });\n\n            self.$on('filesUploaded', function (files) {\n                self.addMediaFiles(files);\n            });\n        },\n        methods: {\n            selectMedia: function (media) {\n                this.selectedMedia = media;\n            },\n            showModal: function (event) {\n                var self = this;\n                if (self.canAddMedia) {\n                    $('#allowedExtensions').val(this.allowedExtensions);\n                    $('#fileupload').attr('accept', this.allowedExtensions);\n                    $(\"#mediaApp\").appendTo($(modalBodyElement).find('.modal-body'));\n\n                    // Reload current folder in case the allowed extensions have changed.\n                    mediaApp.refresh();\n\n                    var modal = new bootstrap.Modal(modalBodyElement);\n                    modal.show();\n\n                    setTimeout(function () {\n                        document.getElementById(\"mediaApp\").classList.remove(\"d-none\");\n                    }, 100)\n\n                    $(modalBodyElement).find('.mediaFieldSelectButton').off('click').on('click', function (v) {\n                        self.addMediaFiles(mediaApp.selectedMedias);\n\n                        // we don't want the included medias to be still selected the next time we open the modal.\n                        mediaApp.selectedMedias = [];\n\n                        modal.hide();\n                        return true;\n                    });\n                }\n            },\n            showMediaTextModal: function (event) {\n                this.mediaTextModal = new bootstrap.Modal(this.$refs.mediaTextModal);\n                this.mediaTextModal.show();\n                this.backupMediaText = this.selectedMedia.mediaText;\n            },\n            cancelMediaTextModal: function (event) {\n                this.mediaTextModal.hide();\n                this.selectedMedia.mediaText = this.backupMediaText;\n            },\n            showAnchorModal: function (event) {\n                this.anchoringModal = new bootstrap.Modal(this.$refs.anchoringModal);\n                this.anchoringModal.show();\n                // Cause a refresh to recalc heights.\n                this.selectedMedia.anchor = {\n                  x: this.selectedMedia.anchor.x,\n                  y: this.selectedMedia.anchor.y\n                }\n                this.backupAnchor = this.selectedMedia.anchor;\n            },            \n            cancelAnchoringModal: function (event) {\n                this.anchoringModal.hide();\n                this.selectedMedia.anchor = this.backupAnchor;\n            },            \n            resetAnchor: function (event) {\n                this.selectedMedia.anchor = { x: 0.5, y: 0.5 };\n            },  \n            onAnchorDrop: function(event) {\n                var image = this.$refs.anchorImage;\n                this.selectedMedia.anchor = {\n                   x: event.offsetX / image.clientWidth,\n                   y: event.offsetY / image.clientHeight\n                }\n            },\n            anchorLeft: function () {\n                if (this.$refs.anchorImage && this.$refs.modalBody && this.selectedMedia) {\n                    // When image is shrunk compare against the modal body.\n                    var offset = (this.$refs.modalBody.clientWidth - this.$refs.anchorImage.clientWidth) / 2;\n                    var position = (this.selectedMedia.anchor.x * this.$refs.anchorImage.clientWidth) + offset;\n                    var anchorIcon = Math.round(this.$refs.modalBody.querySelector('.icon-media-anchor').clientWidth);\n                    if(Number.isInteger(anchorIcon))\n                    {\n                        position = position - anchorIcon/2;\n                    }\n                    return position + 'px';\n                } else {\n                    return '0';\n                }\n            },            \n            anchorTop: function () {\n                if (this.$refs.anchorImage && this.selectedMedia) {\n                    var position = this.selectedMedia.anchor.y * this.$refs.anchorImage.clientHeight;\n                    return position + 'px';\n                } else {\n                    return '0';\n                }\n            },\n            setAnchor: function (event) {\n                var image = this.$refs.anchorImage;\n                this.selectedMedia.anchor = {\n                    x: event.offsetX / image.clientWidth,\n                    y: event.offsetY / image.clientHeight\n                }\n            },         \n            addMediaFiles: function (files) {\n                if ((files.length > 1) && (allowMultiple === false)) {\n                    alert($('#onlyOneItemMessage').val());\n                    mediaFieldApp.mediaItems.push(files[0]);\n                    mediaFieldApp.initialized = true;\n                    // Preselect the newly added media item\n                    mediaFieldApp.$nextTick(function() {\n                        mediaFieldApp.selectedMedia = mediaFieldApp.mediaItems[0];\n                    });\n                } else {\n                    mediaFieldApp.mediaItems = mediaFieldApp.mediaItems.concat(files);\n                    mediaFieldApp.initialized = true;\n                    // Preselect first thumbnail if only single image is allowed\n                    if (!allowMultiple && mediaFieldApp.mediaItems.length === 1) {\n                        mediaFieldApp.$nextTick(function() {\n                            mediaFieldApp.selectedMedia = mediaFieldApp.mediaItems[0];\n                        });\n                    }\n                }\n            },\n            removeSelected: function (event) {\n                if (this.selectedMedia) {\n                    var index = this.mediaItems && this.mediaItems.indexOf(this.selectedMedia);\n                    if (index > -1) {\n                        this.mediaItems.splice(index, 1);\n                    }\n                }\n                else {\n                    // The remove button can also remove a unique media item\n                    if (this.mediaItems.length === 1) {\n                        this.mediaItems.splice(0, 1);\n                    }\n                }\n                this.selectedMedia = null;\n            },\n            selectAndDeleteMedia: function (media) {\n                var self = this;\n                self.selectedMedia = media;\n                // setTimeout because sometimes removeSelected was called even before the media was set.\n                setTimeout(function () {\n                    self.removeSelected();\n                }, 100);\n            }\n        },\n        watch: {\n            mediaItems: {\n                deep: true,\n                handler () {\n                    // Trigger preview rendering\n                    setTimeout(function () { $(document).trigger('contentpreview:render'); }, 100); \n                }\n            },            \n            currentPrefs: function (newPrefs) {\n                localStorage.setItem('mediaFieldPrefs', JSON.stringify(newPrefs));\n            }\n        }\n    }));\n}\n\n\n"],"names":["factory","define","amd","exports","require","window","jQuery","$","counter","jsonAPI","jsonParse","JSON","ajaxTransport","options","async","form","iframe","addParamChar","initialIframeSrc","send","_","completeCallback","attr","formAcceptCharset","test","url","type","on","fileInputClones","paramNames","isArray","paramName","off","response","contents","length","firstChild","Error","e","undefined","appendTo","setTimeout","remove","prop","formData","each","index","field","name","val","value","fileInput","clone","after","append","removeAttr","submit","input","replaceWith","document","body","abort","ajaxSetup","converters","text","html","xmlDoc","isXMLDoc","parseXML","XMLDocument","xml","globalEval","parts","getDragHandler","isDragOver","dataTransfer","originalEvent","inArray","types","_trigger","Event","delegatedEvent","preventDefault","dropEffect","support","RegExp","navigator","userAgent","xhrFileUpload","ProgressEvent","FileReader","xhrFormDataFileUpload","FormData","blobSlice","Blob","prototype","slice","webkitSlice","mozSlice","widget","dropZone","pasteZone","replaceFileInput","singleFileUploads","limitMultiFileUploads","limitMultiFileUploadSize","limitMultiFileUploadSizeOverhead","sequentialUploads","limitConcurrentUploads","forceIframeTransport","redirect","redirectParamName","postMessage","multipart","maxChunkSize","uploadedBytes","recalculateProgress","progressInterval","bitrateInterval","autoUpload","uniqueFilenames","messages","i18n","message","context","toString","key","replace","serializeArray","add","data","isDefaultPrevented","fileupload","process","done","processData","contentType","cache","timeout","_promisePipe","Number","fn","jquery","split","_specialOptions","_blobSlice","apply","arguments","_BitrateTimer","timestamp","Date","now","getTime","loaded","bitrate","getBitrate","interval","timeDiff","_isXHRUpload","_getFormData","push","_getTotal","files","total","file","size","_initProgressObject","obj","progress","_progress","extend","_initResponseObject","_response","Object","hasOwnProperty","call","_onProgress","lengthComputable","_time","Math","floor","chunkSize","_bitrateTimer","_initProgressListener","that","xhr","ajaxSettings","upload","oe","_deinitProgressListener","_isInstanceOf","_getUniqueFilename","map","String","p1","p2","_initXHRData","headers","contentRange","blob","encodeURI","uploadName","fileName","_initIframeSettings","targetHost","dataType","location","host","_initDataSettings","_chunkedUpload","_getParamName","i","_initFormSettings","href","toUpperCase","_getAJAXSettings","_getDeferredState","deferred","state","isResolved","isRejected","_enhancePromise","promise","success","error","fail","complete","always","_getXHRPromise","resolveOrReject","args","dfd","Deferred","resolveWith","rejectWith","_addConvenienceMethods","getPromise","resolveFunc","rejectFunc","_processQueue","errorThrown","jqXHR","_onSend","processing","_getUploadedBytes","range","getResponseHeader","upperBytesPos","parseInt","testOnly","fs","ub","mcs","o","currentLoaded","ajax","result","textStatus","_beforeSend","_active","_onDone","_onFail","_onAlways","jqXHRorResult","jqXHRorError","aborted","slot","pipe","_sending","nextSlot","_slots","shift","resolve","_sequence","_onAdd","paramNameSet","paramNameSlice","fileSet","filesLength","limit","limitSize","overhead","batchSize","j","originalFiles","element","newData","_replaceFileInput","inputClone","restoreFocus","is","activeElement","fileInputClone","reset","detach","trigger","cleanData","el","_handleFileTreeEntry","entry","path","dirReader","entries","errorHandler","successHandler","_handleFileTreeEntries","readEntries","results","concat","isFile","_file","relativePath","isDirectory","createReader","when","Array","_getDroppedFiles","items","webkitGetAsEntry","getAsEntry","item","getAsFile","makeArray","_getSingleFileInputFiles","fileSize","_getFileInputFiles","_onChange","target","_onPaste","clipboardData","_onDrop","_onDragOver","_onDragEnter","_onDragLeave","_initEventHandlers","_on","dragover","drop","dragenter","dragleave","paste","change","_destroyEventHandlers","_off","_destroy","_setOption","reinit","_super","_initSpecialOptions","find","_getRegExp","str","modifiers","pop","join","_isRegExpOption","_initDataAttributes","attributes","toLowerCase","charAt","_create","active","disabled","reject","then","Vue","component","template","props","model","uploadInputId","mounted","self","uploadInput","getElementById","bind","percentage","handleFailure","bus","$emit","methods","errorMessage","dismissWarning","T","expanded","pendingCount","errorCount","created","uploads","errors","clearErrors","computed","fileCount","forEach","newFile","some","f","console","$on","fileUpload","array","splice","updateCount","filter","watch","faIcons","image","pdf","word","powerpoint","excel","csv","audio","video","archive","code","faThumbnails","gif","jpeg","jpg","png","doc","docx","ppt","pptx","xls","xlsx","aac","mp3","ogg","avi","flv","mkv","mp4","webm","gz","zip","css","js","txt","getClassNameForExtension","extension","getExtensionForFilename","filename","lastIndexOf","getClassNameForFilename","sourceItems","pageSize","pageSizeOptions","current","pagerFirstButton","pagerPreviousButton","pagerNextButton","pagerLastButton","pagerPageSizeLabel","pagerPageLabel","pagerTotalLabel","next","previous","goFirst","goLast","totalPages","goTo","targetPage","pages","ceil","isLastPage","isFirstPage","canDoNext","canDoPrev","canDoFirst","canDoLast","itemsInCurrentPage","start","end","pageLinks","links","unshift","colname","selectedcolname","asc","Boolean","isActive","dir","selectedInMediaApp","level","open","children","parent","isHovered","padding","empty","isSelected","isRoot","canCreateFolder","canDeleteFolder","isAncestorOfSelectedFolder","toggle","folder","indexOf","parentFolder","mediaApp","selectedFolder","loadChildren","select","createFolder","deleteFolder","encodeURIComponent","method","c","emtpy","responseText","handleDragOver","handleDragLeave","moveMediaToFolder","mediaNames","parse","getData","sourceFolder","targetFolder","alert","confirmDialog","callback","resp","__RequestVerificationToken","sortBy","sortAsc","filteredMediaItems","selectedMedias","thumbSize","imageHeader","nameHeader","lastModifyHeader","sizeHeader","typeHeader","editButton","deleteButton","viewButton","isMediaSelected","media","buildMediaUrl","changeSort","newSort","toggleSelectionOfMedia","renameMedia","deleteMedia","dragStart","printDateTime","datemillis","d","toLocaleString","getfontAwesomeClassNameForFileName","thumbsize","chunkedFileUploadId","randomUUID","antiForgeryToken","mediaItems","File","lastModified","dt","contains","dropZoneTimeout","clearTimeout","addClass","closest","removeClass","initialized","initializeMediaApplication","displayMediaApplication","mediaApplicationUrl","pathBase","content","root","dragDropThumbnail","Image","smallThumbs","gridView","mediaFilter","itemsInPage","src","selectRoot","selected","errorInfo","loadFolder","newName","newPath","oldPath","newUrl","mediaPath","deleteMediaItem","handleDragStart","localStorage","getItem","currentPrefs","isHome","parents","p","filtered","sort","a","b","mime","localeCompare","lastModify","hiddenCount","get","set","newPrefs","setItem","stringify","newFolder","$refs","rootFolder","uploadUrl","urlValue","allowedExtensions","mediaUrl","log","refresh","selectAll","unSelectAll","invertSelection","temp","modal","bootstrap","Modal","getOrCreateInstance","show","focus","selectAndDeleteMedia","deleteMediaList","mediaList","paths","setData","setDragImage","effectAllowed","handleScrollWhileDrag","clientY","scrollBy","innerHeight","keydown","click","hide","oldName","currentFolder","classList","mediaFieldApps","initializeAttachedMediaField","idOfUploadButton","uploadAction","mediaItemUrl","allowMultiple","allowMediaText","allowAnchors","tempUploadFolder","maxUploadChunkSize","mediaFieldApp","initialPaths","mediaFieldEditor","idprefix","selectedMedia","idPrefix","backupMediaText","backupAnchor","mediaTextmodal","anchoringModal","mediaPaths","x","isRemoved","isNew","mediaText","anchor","attachedFileName","values","signal","vuekey","y","round","canAddMedia","nonRemovedMediaItems","selectMedia","editorId","count","getUniqueId","newMediaItems","errormsg","r","random","v","removeSelected","event","removed","showMediaTextModal","mediaTextModal","cancelMediaTextModal","showAnchorModal","cancelAnchoringModal","resetAnchor","onAnchorDrop","anchorImage","offsetX","clientWidth","offsetY","clientHeight","anchorLeft","modalBody","offset","position","anchorTop","setAnchor","addMediaFiles","deep","handler","sortableInstance","multiSelectedItems","mediaNotFound","discardWarning","noImages","initSortable","multiDragContainer","Sortable","create","animation","ghostClass","multiDrag","selectedClass","preventOnFilter","forceHelperSize","onUpdate","evt","newOrder","oldIndicies","oldIndices","newIndices","newIndicies","itemsToMove","oldIdx","movedItem","oldIndex","newIndex","selectedElements","querySelectorAll","utils","deselect","$parent","MEDIA_FIELD_GALLERY","initializeMediaField","modalBodyElement","addEventListener","$nextTick","showModal","anchorIcon","querySelector","isInteger","cols","rawSize","selectedItemCount","modalId","getLocalStorageState","beforeDestroy","destroy","setLocalStorageState","mediaItemsNoDuplicates","removeDuplicates","removeItem","parsed","mediaContainer","onSelect","updateSelectedCount","onDeselect","onEnd","onMove","dragged","related","deselectAll","showMediaModal","findIndex"],"mappings":"CAaA,AAAC,SAAUA,CAAO,EAChB,YACI,AAAkB,CAAA,YAAlB,OAAOC,QAAyBA,OAAOC,GAAG,CAE5CD,OAAO,CAAC,SAAS,CAAED,GACV,AAAmB,UAAnB,OAAOG,QAEhBH,EAAQI,QAAQ,WAGhBJ,EAAQK,OAAOC,MAAM,CAEzB,EAAG,SAAUC,CAAC,EACZ,aAGA,IAAIC,EAAU,EACZC,EAAUF,EACVG,EAAY,WAEV,CAAA,SAAUL,QAAU,UAAWM,OACjCF,EAAUE,KACVD,EAAY,SAadH,EAAEK,aAAa,CAAC,SAAU,SAAUC,CAAO,EACzC,GAAIA,EAAQC,KAAK,CAAE,CAIjB,IACEC,EACAC,EACAC,EAHEC,EAAmBL,EAAQK,gBAAgB,EAAI,oBAInD,MAAO,CACLC,KAAM,SAAUC,CAAC,CAAEC,CAAgB,EAEjCN,AADAA,CAAAA,EAAOR,EAAE,sCAAqC,EACzCe,IAAI,CAAC,iBAAkBT,EAAQU,iBAAiB,EACrDN,EAAe,KAAKO,IAAI,CAACX,EAAQY,GAAG,EAAI,IAAM,IAE1CZ,AAAiB,WAAjBA,EAAQa,IAAI,EACdb,EAAQY,GAAG,CAAGZ,EAAQY,GAAG,CAAGR,EAAe,iBAC3CJ,EAAQa,IAAI,CAAG,QACNb,AAAiB,QAAjBA,EAAQa,IAAI,EACrBb,EAAQY,GAAG,CAAGZ,EAAQY,GAAG,CAAGR,EAAe,cAC3CJ,EAAQa,IAAI,CAAG,QACW,UAAjBb,EAAQa,IAAI,GACrBb,EAAQY,GAAG,CAAGZ,EAAQY,GAAG,CAAGR,EAAe,gBAC3CJ,EAAQa,IAAI,CAAG,QAKjBlB,GAAW,EACXQ,EAAST,EACP,gBACEW,EACA,4BACAV,EACA,eACFmB,EAAE,CAAC,OAAQ,WACX,IAAIC,EACFC,EAAatB,EAAEuB,OAAO,CAACjB,EAAQkB,SAAS,EACpClB,EAAQkB,SAAS,CACjB,CAAClB,EAAQkB,SAAS,CAAC,CACzBf,EAAOgB,GAAG,CAAC,QAAQL,EAAE,CAAC,OAAQ,WAC5B,IAAIM,EAGJ,GAAI,CAKF,GAAI,CAACA,AAJLA,CAAAA,EAAWjB,EAAOkB,QAAQ,EAAC,EAIbC,MAAM,EAAI,CAACF,CAAQ,CAAC,EAAE,CAACG,UAAU,CAC7C,MAAM,AAAIC,OAEd,CAAE,MAAOC,EAAG,CACVL,EAAWM,KAAAA,CACb,CAGAlB,EAAiB,IAAK,UAAW,CAAEL,OAAQiB,CAAS,GAGpD1B,EAAE,gBAAkBW,EAAmB,eAAesB,QAAQ,CAC5DzB,GAEFV,OAAOoC,UAAU,CAAC,WAIhB1B,EAAK2B,MAAM,EACb,EAAG,EACL,GACA3B,EACG4B,IAAI,CAAC,SAAU3B,EAAO2B,IAAI,CAAC,SAC3BA,IAAI,CAAC,SAAU9B,EAAQY,GAAG,EAC1BkB,IAAI,CAAC,SAAU9B,EAAQa,IAAI,EAC1Bb,EAAQ+B,QAAQ,EAClBrC,EAAEsC,IAAI,CAAChC,EAAQ+B,QAAQ,CAAE,SAAUE,CAAK,CAAEC,CAAK,EAC7CxC,EAAE,0BACCoC,IAAI,CAAC,OAAQI,EAAMC,IAAI,EACvBC,GAAG,CAACF,EAAMG,KAAK,EACfV,QAAQ,CAACzB,EACd,GAGAF,EAAQsC,SAAS,EACjBtC,EAAQsC,SAAS,CAAChB,MAAM,EACxBtB,AAAiB,SAAjBA,EAAQa,IAAI,GAEZE,EAAkBf,EAAQsC,SAAS,CAACC,KAAK,GAEzCvC,EAAQsC,SAAS,CAACE,KAAK,CAAC,SAAUP,CAAK,EACrC,OAAOlB,CAAe,CAACkB,EAAM,AAC/B,GACIjC,EAAQkB,SAAS,EACnBlB,EAAQsC,SAAS,CAACN,IAAI,CAAC,SAAUC,CAAK,EACpCvC,EAAE,IAAI,EAAEoC,IAAI,CAAC,OAAQd,CAAU,CAACiB,EAAM,EAAIjC,EAAQkB,SAAS,CAC7D,GAIFhB,EACGuC,MAAM,CAACzC,EAAQsC,SAAS,EACxBR,IAAI,CAAC,UAAW,uBAEhBA,IAAI,CAAC,WAAY,uBAEpB9B,EAAQsC,SAAS,CAACI,UAAU,CAAC,SAE/BlD,OAAOoC,UAAU,CAAC,WAKhB1B,EAAKyC,MAAM,GAGP5B,GAAmBA,EAAgBO,MAAM,EAC3CtB,EAAQsC,SAAS,CAACN,IAAI,CAAC,SAAUC,CAAK,CAAEW,CAAK,EAC3C,IAAIL,EAAQ7C,EAAEqB,CAAe,CAACkB,EAAM,EAEpCvC,EAAEkD,GACCd,IAAI,CAAC,OAAQS,EAAMT,IAAI,CAAC,SACxBrB,IAAI,CAAC,OAAQ8B,EAAM9B,IAAI,CAAC,SAC3B8B,EAAMM,WAAW,CAACD,EACpB,EAEJ,EAAG,EACL,GACA1C,EAAKuC,MAAM,CAACtC,GAAQwB,QAAQ,CAACmB,SAASC,IAAI,CAC5C,EACAC,MAAO,WACD7C,GAGFA,EAAOgB,GAAG,CAAC,QAAQW,IAAI,CAAC,MAAOzB,GAE7BH,GACFA,EAAK2B,MAAM,EAEf,CACF,CACF,CACF,GAYAnC,EAAEuD,SAAS,CAAC,CACVC,WAAY,CACV,cAAe,SAAU/C,CAAM,EAC7B,OAAOA,GAAUT,EAAES,CAAM,CAAC,EAAE,CAAC4C,IAAI,EAAEI,IAAI,EACzC,EACA,cAAe,SAAUhD,CAAM,EAC7B,OAAOA,GAAUP,CAAO,CAACC,EAAU,CAACH,EAAES,CAAM,CAAC,EAAE,CAAC4C,IAAI,EAAEI,IAAI,GAC5D,EACA,cAAe,SAAUhD,CAAM,EAC7B,OAAOA,GAAUT,EAAES,CAAM,CAAC,EAAE,CAAC4C,IAAI,EAAEK,IAAI,EACzC,EACA,aAAc,SAAUjD,CAAM,EAC5B,IAAIkD,EAASlD,GAAUA,CAAM,CAAC,EAAE,CAChC,OAAOkD,GAAU3D,EAAE4D,QAAQ,CAACD,GACxBA,EACA3D,EAAE6D,QAAQ,CACR,AAACF,EAAOG,WAAW,EAAIH,EAAOG,WAAW,CAACC,GAAG,EAC3C/D,EAAE2D,EAAON,IAAI,EAAEK,IAAI,GAE7B,EACA,gBAAiB,SAAUjD,CAAM,EAC/B,OAAOA,GAAUT,EAAEgE,UAAU,CAAChE,EAAES,CAAM,CAAC,EAAE,CAAC4C,IAAI,EAAEI,IAAI,GACtD,CACF,CACF,EACF,GAiBA,AAAC,SAAUhE,CAAO,EAChB,YACI,AAAkB,CAAA,YAAlB,OAAOC,QAAyBA,OAAOC,GAAG,CAE5CD,OAAO,CAAC,SAAU,sBAAsB,CAAED,GACjC,AAAmB,UAAnB,OAAOG,QAEhBH,EAAQI,QAAQ,UAAWA,QAAQ,8BAGnCJ,EAAQK,OAAOC,MAAM,CAEzB,EAAG,SAAUC,CAAC,EACZ,iBA0RQiE,EArPR,SAASC,EAAe/C,CAAI,EAC1B,IAAIgD,EAAahD,AAAS,aAATA,EACjB,OAAO,SAAUY,CAAC,EAChBA,EAAEqC,YAAY,CAAGrC,EAAEsC,aAAa,EAAItC,EAAEsC,aAAa,CAACD,YAAY,CAChE,IAAIA,EAAerC,EAAEqC,YAAY,CAE/BA,GACApE,AAA2C,KAA3CA,EAAEsE,OAAO,CAAC,QAASF,EAAaG,KAAK,GACrC,AAA8D,CAAA,IAA9D,IAAI,CAACC,QAAQ,CAACrD,EAAMnB,EAAEyE,KAAK,CAACtD,EAAM,CAAEuD,eAAgB3C,CAAE,MAEtDA,EAAE4C,cAAc,GACZR,GACFC,CAAAA,EAAaQ,UAAU,CAAG,MAAK,EAGrC,CACF,CAjDA5E,EAAE6E,OAAO,CAACjC,SAAS,CAAG,CACpB,CAAA,AAAIkC,OAEF,uJAIA7D,IAAI,CAACnB,OAAOiF,SAAS,CAACC,SAAS,GAEjChF,EAAE,wBAAwBoC,IAAI,CAAC,WAAU,EAQ3CpC,EAAE6E,OAAO,CAACI,aAAa,CAAG,CAAC,CAAEnF,CAAAA,OAAOoF,aAAa,EAAIpF,OAAOqF,UAAU,AAAD,EACrEnF,EAAE6E,OAAO,CAACO,qBAAqB,CAAG,CAAC,CAACtF,OAAOuF,QAAQ,CAGnDrF,EAAE6E,OAAO,CAACS,SAAS,CACjBxF,OAAOyF,IAAI,EACVA,CAAAA,KAAKC,SAAS,CAACC,KAAK,EACnBF,KAAKC,SAAS,CAACE,WAAW,EAC1BH,KAAKC,SAAS,CAACG,QAAQ,AAAD,EAkC1B3F,EAAE4F,MAAM,CAAC,qBAAsB,CAC7BtF,QAAS,CAGPuF,SAAU7F,EAAEoD,UAGZ0C,UAAW9D,KAAAA,EAKXY,UAAWZ,KAAAA,EAKX+D,iBAAkB,CAAA,EAKlBvE,UAAWQ,KAAAA,EAIXgE,kBAAmB,CAAA,EAGnBC,sBAAuBjE,KAAAA,EAIvBkE,yBAA0BlE,KAAAA,EAI1BmE,iCAAkC,IAGlCC,kBAAmB,CAAA,EAGnBC,uBAAwBrE,KAAAA,EAExBsE,qBAAsB,CAAA,EAGtBC,SAAUvE,KAAAA,EAGVwE,kBAAmBxE,KAAAA,EAGnByE,YAAazE,KAAAA,EAIb0E,UAAW,CAAA,EAKXC,aAAc3E,KAAAA,EAMd4E,cAAe5E,KAAAA,EAIf6E,oBAAqB,CAAA,EAErBC,iBAAkB,IAElBC,gBAAiB,IAEjBC,WAAY,CAAA,EASZC,gBAAiBjF,KAAAA,EAGjBkF,SAAU,CACRN,cAAe,iCACjB,EAIAO,KAAM,SAAUC,CAAO,CAAEC,CAAO,EAS9B,OAPAD,EAAU,IAAI,CAACF,QAAQ,CAACE,EAAQ,EAAIA,EAAQE,QAAQ,GAChDD,GACFrH,EAAEsC,IAAI,CAAC+E,EAAS,SAAUE,CAAG,CAAE5E,CAAK,EAElCyE,EAAUA,EAAQI,OAAO,CAAC,IAAMD,EAAM,IAAK5E,EAC7C,GAEKyE,CACT,EAOA/E,SAAU,SAAU7B,CAAI,EACtB,OAAOA,EAAKiH,cAAc,EAC5B,EAkBAC,IAAK,SAAU3F,CAAC,CAAE4F,CAAI,EACpB,GAAI5F,EAAE6F,kBAAkB,GACtB,MAAO,CAAA,EAGPD,CAAAA,EAAKX,UAAU,EACdW,AAAoB,CAAA,IAApBA,EAAKX,UAAU,EACdhH,EAAE,IAAI,EAAE6H,UAAU,CAAC,SAAU,aAAa,GAE5CF,EAAKG,OAAO,GAAGC,IAAI,CAAC,WAClBJ,EAAK1E,MAAM,EACb,EAEJ,EA4DA+E,YAAa,CAAA,EACbC,YAAa,CAAA,EACbC,MAAO,CAAA,EACPC,QAAS,CACX,EAOAC,aAESC,OAAOpE,CADVA,EAAQjE,EAAEsI,EAAE,CAACC,MAAM,CAACC,KAAK,CAAC,KACX,CAAC,EAAE,EAAI,GAAKH,OAAOpE,CAAK,CAAC,EAAE,EAAI,EAAI,OAAS,OAKjEwE,gBAAiB,CACf,YACA,WACA,YACA,YACA,uBACD,CAEDC,WACE1I,EAAE6E,OAAO,CAACS,SAAS,EACnB,WAEE,MAAOG,AADK,CAAA,IAAI,CAACA,KAAK,EAAI,IAAI,CAACC,WAAW,EAAI,IAAI,CAACC,QAAQ,AAAD,EAC7CgD,KAAK,CAAC,IAAI,CAAEC,UAC3B,EAEFC,cAAe,WACb,IAAI,CAACC,SAAS,CAAGC,KAAKC,GAAG,CAAGD,KAAKC,GAAG,GAAK,IAAID,OAAOE,OAAO,GAC3D,IAAI,CAACC,MAAM,CAAG,EACd,IAAI,CAACC,OAAO,CAAG,EACf,IAAI,CAACC,UAAU,CAAG,SAAUJ,CAAG,CAAEE,CAAM,CAAEG,CAAQ,EAC/C,IAAIC,EAAWN,EAAM,IAAI,CAACF,SAAS,CAMnC,OALK,IAAI,CAACK,OAAO,EAAKE,IAAYC,CAAAA,EAAWD,CAAO,IAClD,IAAI,CAACF,OAAO,CAAG,AAACD,CAAAA,EAAS,IAAI,CAACA,MAAM,AAAD,EAAM,CAAA,IAAOI,CAAO,EAAK,EAC5D,IAAI,CAACJ,MAAM,CAAGA,EACd,IAAI,CAACJ,SAAS,CAAGE,GAEZ,IAAI,CAACG,OAAO,AACrB,CACF,EAEAI,aAAc,SAAUjJ,CAAO,EAC7B,MACE,CAACA,EAAQgG,oBAAoB,EAC5B,CAAA,AAAC,CAAChG,EAAQoG,SAAS,EAAI1G,EAAE6E,OAAO,CAACI,aAAa,EAC7CjF,EAAE6E,OAAO,CAACO,qBAAqB,AAAD,CAEpC,EAEAoE,aAAc,SAAUlJ,CAAO,EAC7B,IAAI+B,QACJ,AAAIrC,AAA6B,aAA7BA,EAAEmB,IAAI,CAACb,EAAQ+B,QAAQ,EAClB/B,EAAQ+B,QAAQ,CAAC/B,EAAQE,IAAI,EAElCR,EAAEuB,OAAO,CAACjB,EAAQ+B,QAAQ,EACrB/B,EAAQ+B,QAAQ,CAErBrC,AAA6B,WAA7BA,EAAEmB,IAAI,CAACb,EAAQ+B,QAAQ,GACzBA,EAAW,EAAE,CACbrC,EAAEsC,IAAI,CAAChC,EAAQ+B,QAAQ,CAAE,SAAUI,CAAI,CAAEE,CAAK,EAC5CN,EAASoH,IAAI,CAAC,CAAEhH,KAAMA,EAAME,MAAOA,CAAM,EAC3C,GACON,GAEF,EAAE,AACX,EAEAqH,UAAW,SAAUC,CAAK,EACxB,IAAIC,EAAQ,EAIZ,OAHA5J,EAAEsC,IAAI,CAACqH,EAAO,SAAUpH,CAAK,CAAEsH,CAAI,EACjCD,GAASC,EAAKC,IAAI,EAAI,CACxB,GACOF,CACT,EAEAG,oBAAqB,SAAUC,CAAG,EAChC,IAAIC,EAAW,CACbf,OAAQ,EACRU,MAAO,EACPT,QAAS,CACX,CACIa,CAAAA,EAAIE,SAAS,CACflK,EAAEmK,MAAM,CAACH,EAAIE,SAAS,CAAED,GAExBD,EAAIE,SAAS,CAAGD,CAEpB,EAEAG,oBAAqB,SAAUJ,CAAG,EAChC,IAAI5H,EACJ,GAAI4H,EAAIK,SAAS,CACf,IAAKjI,KAAQ4H,EAAIK,SAAS,CACpBC,OAAO9E,SAAS,CAAC+E,cAAc,CAACC,IAAI,CAACR,EAAIK,SAAS,CAAEjI,IACtD,OAAO4H,EAAIK,SAAS,CAACjI,EAAK,MAI9B4H,EAAIK,SAAS,CAAG,CAAC,CAErB,EAEAI,YAAa,SAAU1I,CAAC,CAAE4F,CAAI,EAC5B,GAAI5F,EAAE2I,gBAAgB,CAAE,CACtB,IACExB,EADEF,EAAMD,KAAKC,GAAG,CAAGD,KAAKC,GAAG,GAAK,IAAID,OAAOE,OAAO,GAGlDtB,CAAAA,CAAAA,EAAKgD,KAAK,GACVhD,EAAKb,gBAAgB,GACrBkC,CAAAA,EAAMrB,EAAKgD,KAAK,CAAGhD,EAAKb,gBAAgB,AAAD,GACvC/E,EAAEmH,MAAM,GAAKnH,EAAE6H,KAAK,AAAD,IAIrBjC,EAAKgD,KAAK,CAAG3B,EACbE,EACE0B,KAAKC,KAAK,CACR,AAAC9I,EAAEmH,MAAM,CAAGnH,EAAE6H,KAAK,CAAKjC,CAAAA,EAAKmD,SAAS,EAAInD,EAAKuC,SAAS,CAACN,KAAK,AAAD,GAC1DjC,CAAAA,EAAKf,aAAa,EAAI,CAAA,EAG7B,IAAI,CAACsD,SAAS,CAAChB,MAAM,EAAIA,EAASvB,EAAKuC,SAAS,CAAChB,MAAM,CACvD,IAAI,CAACgB,SAAS,CAACf,OAAO,CAAG,IAAI,CAAC4B,aAAa,CAAC3B,UAAU,CACpDJ,EACA,IAAI,CAACkB,SAAS,CAAChB,MAAM,CACrBvB,EAAKZ,eAAe,EAEtBY,EAAKuC,SAAS,CAAChB,MAAM,CAAGvB,EAAKuB,MAAM,CAAGA,EACtCvB,EAAKuC,SAAS,CAACf,OAAO,CAAGxB,EAAKwB,OAAO,CAAGxB,EAAKoD,aAAa,CAAC3B,UAAU,CACnEJ,EACAE,EACAvB,EAAKZ,eAAe,EAKtB,IAAI,CAACvC,QAAQ,CACX,WACAxE,EAAEyE,KAAK,CAAC,WAAY,CAAEC,eAAgB3C,CAAE,GACxC4F,GAIF,IAAI,CAACnD,QAAQ,CACX,cACAxE,EAAEyE,KAAK,CAAC,cAAe,CAAEC,eAAgB3C,CAAE,GAC3C,IAAI,CAACmI,SAAS,EAElB,CACF,EAEAc,sBAAuB,SAAU1K,CAAO,EACtC,IAAI2K,EAAO,IAAI,CACbC,EAAM5K,EAAQ4K,GAAG,CAAG5K,EAAQ4K,GAAG,GAAKlL,EAAEmL,YAAY,CAACD,GAAG,EAGpDA,CAAAA,EAAIE,MAAM,GACZpL,EAAEkL,EAAIE,MAAM,EAAEhK,EAAE,CAAC,WAAY,SAAUW,CAAC,EACtC,IAAIsJ,EAAKtJ,EAAEsC,aAAa,AAExBtC,CAAAA,EAAE2I,gBAAgB,CAAGW,EAAGX,gBAAgB,CACxC3I,EAAEmH,MAAM,CAAGmC,EAAGnC,MAAM,CACpBnH,EAAE6H,KAAK,CAAGyB,EAAGzB,KAAK,CAClBqB,EAAKR,WAAW,CAAC1I,EAAGzB,EACtB,GACAA,EAAQ4K,GAAG,CAAG,WACZ,OAAOA,CACT,EAEJ,EAEAI,wBAAyB,SAAUhL,CAAO,EACxC,IAAI4K,EAAM5K,EAAQ4K,GAAG,CAAG5K,EAAQ4K,GAAG,GAAKlL,EAAEmL,YAAY,CAACD,GAAG,EACtDA,CAAAA,EAAIE,MAAM,EACZpL,EAAEkL,EAAIE,MAAM,EAAE3J,GAAG,CAAC,WAEtB,EAEA8J,cAAe,SAAUpK,CAAI,CAAE6I,CAAG,EAEhC,OAAOM,OAAO9E,SAAS,CAAC8B,QAAQ,CAACkD,IAAI,CAACR,KAAS,WAAa7I,EAAO,GACrE,EAEAqK,mBAAoB,SAAU/I,CAAI,CAAEgJ,CAAG,SAGrC,AAAIA,CAAG,CADPhJ,EAAOiJ,OAAOjJ,GACD,EAEXA,EAAOA,EAAK+E,OAAO,CACjB,+BACA,SAAU3G,CAAC,CAAE8K,CAAE,CAAEC,CAAE,EAGjB,MAAO,KAFKD,CAAAA,EAAKtD,OAAOsD,GAAM,EAAI,CAAA,EAEZ,IADZC,CAAAA,GAAM,EAAC,CAEnB,GAEK,IAAI,CAACJ,kBAAkB,CAAC/I,EAAMgJ,KAEvCA,CAAG,CAAChJ,EAAK,CAAG,CAAA,EACLA,EACT,EAEAoJ,aAAc,SAAUvL,CAAO,EAC7B,IACE+B,EADE4I,EAAO,IAAI,CAEbpB,EAAOvJ,EAAQqJ,KAAK,CAAC,EAAE,CAEvBjD,EAAYpG,EAAQoG,SAAS,EAAI,CAAC1G,EAAE6E,OAAO,CAACI,aAAa,CACzDzD,EACExB,AAA8B,UAA9BA,EAAEmB,IAAI,CAACb,EAAQkB,SAAS,EACpBlB,EAAQkB,SAAS,CAAC,EAAE,CACpBlB,EAAQkB,SAAS,AACzBlB,CAAAA,EAAQwL,OAAO,CAAG9L,EAAEmK,MAAM,CAAC,CAAC,EAAG7J,EAAQwL,OAAO,EAC1CxL,EAAQyL,YAAY,EACtBzL,CAAAA,EAAQwL,OAAO,CAAC,gBAAgB,CAAGxL,EAAQyL,YAAY,AAAD,EAEnDrF,IAAapG,EAAQ0L,IAAI,EAAK,IAAI,CAACT,aAAa,CAAC,OAAQ1B,IAC5DvJ,CAAAA,EAAQwL,OAAO,CAAC,sBAAsB,CACpC,yBACAG,UAAUpC,EAAKqC,UAAU,EAAIrC,EAAKpH,IAAI,EACtC,GAAE,EAEDiE,EAGM1G,EAAE6E,OAAO,CAACO,qBAAqB,GACpC9E,EAAQmG,WAAW,EAKrBpE,EAAW,IAAI,CAACmH,YAAY,CAAClJ,GACzBA,EAAQ0L,IAAI,CACd3J,EAASoH,IAAI,CAAC,CACZhH,KAAMjB,EACNmB,MAAOrC,EAAQ0L,IAAI,AACrB,GAEAhM,EAAEsC,IAAI,CAAChC,EAAQqJ,KAAK,CAAE,SAAUpH,CAAK,CAAEsH,CAAI,EACzCxH,EAASoH,IAAI,CAAC,CACZhH,KACE,AAA+B,UAA9BzC,EAAEmB,IAAI,CAACb,EAAQkB,SAAS,GACvBlB,EAAQkB,SAAS,CAACe,EAAM,EAC1Bf,EACFmB,MAAOkH,CACT,EACF,KAGEoB,EAAKM,aAAa,CAAC,WAAYjL,EAAQ+B,QAAQ,EACjDA,EAAW/B,EAAQ+B,QAAQ,EAE3BA,EAAW,IAAIgD,SACfrF,EAAEsC,IAAI,CAAC,IAAI,CAACkH,YAAY,CAAClJ,GAAU,SAAUiC,CAAK,CAAEC,CAAK,EACvDH,EAASU,MAAM,CAACP,EAAMC,IAAI,CAAED,EAAMG,KAAK,CACzC,IAEErC,EAAQ0L,IAAI,CACd3J,EAASU,MAAM,CACbvB,EACAlB,EAAQ0L,IAAI,CACZnC,EAAKqC,UAAU,EAAIrC,EAAKpH,IAAI,EAG9BzC,EAAEsC,IAAI,CAAChC,EAAQqJ,KAAK,CAAE,SAAUpH,CAAK,CAAEsH,CAAI,EAGzC,GACEoB,EAAKM,aAAa,CAAC,OAAQ1B,IAC3BoB,EAAKM,aAAa,CAAC,OAAQ1B,GAC3B,CACA,IAAIsC,EAAWtC,EAAKqC,UAAU,EAAIrC,EAAKpH,IAAI,AACvCnC,CAAAA,EAAQ2G,eAAe,EACzBkF,CAAAA,EAAWlB,EAAKO,kBAAkB,CAChCW,EACA7L,EAAQ2G,eAAe,CACzB,EAEF5E,EAASU,MAAM,CACb,AAA+B,UAA9B/C,EAAEmB,IAAI,CAACb,EAAQkB,SAAS,GACvBlB,EAAQkB,SAAS,CAACe,EAAM,EACxBf,EACFqI,EACAsC,EAEJ,CACF,IAGJ7L,EAAQqH,IAAI,CAAGtF,IAlEf/B,EAAQ2H,WAAW,CAAG4B,EAAK1I,IAAI,EAAI,2BACnCb,EAAQqH,IAAI,CAAGrH,EAAQ0L,IAAI,EAAInC,GAoEjCvJ,EAAQ0L,IAAI,CAAG,IACjB,EAEAI,oBAAqB,SAAU9L,CAAO,EACpC,IAAI+L,EAAarM,EAAE,WAAWoC,IAAI,CAAC,OAAQ9B,EAAQY,GAAG,EAAEkB,IAAI,CAAC,OAE7D9B,CAAAA,EAAQgM,QAAQ,CAAG,UAAahM,CAAAA,EAAQgM,QAAQ,EAAI,EAAC,EAErDhM,EAAQ+B,QAAQ,CAAG,IAAI,CAACmH,YAAY,CAAClJ,GAEjCA,EAAQiG,QAAQ,EAAI8F,GAAcA,IAAeE,SAASC,IAAI,EAChElM,EAAQ+B,QAAQ,CAACoH,IAAI,CAAC,CACpBhH,KAAMnC,EAAQkG,iBAAiB,EAAI,WACnC7D,MAAOrC,EAAQiG,QAAQ,AACzB,EAEJ,EAEAkG,kBAAmB,SAAUnM,CAAO,EAC9B,IAAI,CAACiJ,YAAY,CAACjJ,IACf,IAAI,CAACoM,cAAc,CAACpM,EAAS,CAAA,KAC3BA,EAAQqH,IAAI,EACf,IAAI,CAACkE,YAAY,CAACvL,GAEpB,IAAI,CAAC0K,qBAAqB,CAAC1K,IAEzBA,EAAQmG,WAAW,EAGrBnG,CAAAA,EAAQgM,QAAQ,CAAG,eAAkBhM,CAAAA,EAAQgM,QAAQ,EAAI,EAAC,CAAC,GAG7D,IAAI,CAACF,mBAAmB,CAAC9L,EAE7B,EAEAqM,cAAe,SAAUrM,CAAO,EAC9B,IAAIsC,EAAY5C,EAAEM,EAAQsC,SAAS,EACjCpB,EAAYlB,EAAQkB,SAAS,CAkB/B,OAjBKA,EAcOxB,EAAEuB,OAAO,CAACC,IACpBA,CAAAA,EAAY,CAACA,EAAU,AAAD,GAdtBA,EAAY,EAAE,CACdoB,EAAUN,IAAI,CAAC,WAIb,IAHA,IAAIY,EAAQlD,EAAE,IAAI,EAChByC,EAAOS,EAAMd,IAAI,CAAC,SAAW,UAC7BwK,EAAI,AAAC1J,CAAAA,EAAMd,IAAI,CAAC,UAAY,CAAC,EAAE,AAAD,EAAGR,MAAM,CAClCgL,GACLpL,EAAUiI,IAAI,CAAChH,GACfmK,GAAK,CAET,GACKpL,EAAUI,MAAM,EACnBJ,CAAAA,EAAY,CAACoB,EAAUR,IAAI,CAAC,SAAW,UAAU,AAAD,GAK7CZ,CACT,EAEAqL,kBAAmB,SAAUvM,CAAO,EAG7BA,EAAQE,IAAI,EAAKF,EAAQE,IAAI,CAACoB,MAAM,GACvCtB,EAAQE,IAAI,CAAGR,EAAEM,EAAQsC,SAAS,CAACR,IAAI,CAAC,SAGnC9B,EAAQE,IAAI,CAACoB,MAAM,EACtBtB,CAAAA,EAAQE,IAAI,CAAGR,EAAE,IAAI,CAACM,OAAO,CAACsC,SAAS,CAACR,IAAI,CAAC,QAAO,GAGxD9B,EAAQkB,SAAS,CAAG,IAAI,CAACmL,aAAa,CAACrM,GAClCA,EAAQY,GAAG,EACdZ,CAAAA,EAAQY,GAAG,CAAGZ,EAAQE,IAAI,CAAC4B,IAAI,CAAC,WAAamK,SAASO,IAAI,AAAD,EAG3DxM,EAAQa,IAAI,CAAG,AACbb,CAAAA,EAAQa,IAAI,EACXnB,AAAwC,WAAxCA,EAAEmB,IAAI,CAACb,EAAQE,IAAI,CAAC4B,IAAI,CAAC,YACxB9B,EAAQE,IAAI,CAAC4B,IAAI,CAAC,WACpB,EAAC,EACD2K,WAAW,GAEM,SAAjBzM,EAAQa,IAAI,EACZb,AAAiB,QAAjBA,EAAQa,IAAI,EACZb,AAAiB,UAAjBA,EAAQa,IAAI,EAEZb,CAAAA,EAAQa,IAAI,CAAG,MAAK,EAEjBb,EAAQU,iBAAiB,EAC5BV,CAAAA,EAAQU,iBAAiB,CAAGV,EAAQE,IAAI,CAACO,IAAI,CAAC,iBAAgB,CAElE,EAEAiM,iBAAkB,SAAUrF,CAAI,EAC9B,IAAIrH,EAAUN,EAAEmK,MAAM,CAAC,CAAC,EAAG,IAAI,CAAC7J,OAAO,CAAEqH,GAGzC,OAFA,IAAI,CAACkF,iBAAiB,CAACvM,GACvB,IAAI,CAACmM,iBAAiB,CAACnM,GAChBA,CACT,EAIA2M,kBAAmB,SAAUC,CAAQ,SACnC,AAAIA,EAASC,KAAK,CACTD,EAASC,KAAK,GAEnBD,EAASE,UAAU,GACd,WAELF,EAASG,UAAU,GACd,WAEF,SACT,EAIAC,gBAAiB,SAAUC,CAAO,EAIhC,OAHAA,EAAQC,OAAO,CAAGD,EAAQxF,IAAI,CAC9BwF,EAAQE,KAAK,CAAGF,EAAQG,IAAI,CAC5BH,EAAQI,QAAQ,CAAGJ,EAAQK,MAAM,CAC1BL,CACT,EAIAM,eAAgB,SAAUC,CAAe,CAAEzG,CAAO,CAAE0G,CAAI,EACtD,IAAIC,EAAMhO,EAAEiO,QAAQ,GAClBV,EAAUS,EAAIT,OAAO,GASvB,OAPAlG,EAAUA,GAAW,IAAI,CAAC/G,OAAO,CAAC+G,OAAO,EAAIkG,EACzCO,AAAoB,CAAA,IAApBA,EACFE,EAAIE,WAAW,CAAC7G,EAAS0G,GACI,CAAA,IAApBD,GACTE,EAAIG,UAAU,CAAC9G,EAAS0G,GAE1BR,EAAQjK,KAAK,CAAG0K,EAAIT,OAAO,CACpB,IAAI,CAACD,eAAe,CAACC,EAC9B,EAGAa,uBAAwB,SAAUrM,CAAC,CAAE4F,CAAI,EACvC,IAAIsD,EAAO,IAAI,CACboD,EAAa,SAAUN,CAAI,EACzB,OAAO/N,EAAEiO,QAAQ,GAAGC,WAAW,CAACjD,EAAM8C,GAAMR,OAAO,EACrD,CACF5F,CAAAA,EAAKG,OAAO,CAAG,SAAUwG,CAAW,CAAEC,CAAU,EAY9C,MAXID,CAAAA,GAAeC,CAAS,GAC1B5G,CAAAA,EAAK6G,aAAa,CAAG,IAAI,CAACA,aAAa,CAAG,AAAC,CAAA,IAAI,CAACA,aAAa,EAC3DH,EAAW,CAAC,IAAI,CAAC,CAAA,CACjB,CAACpD,EAAK7C,YAAY,CAAC,CAAC,kBAClB,AAAIT,EAAK8G,WAAW,CACXzO,EAAEiO,QAAQ,GAAGE,UAAU,CAAClD,EAAM,CAACtD,EAAK,EAAE4F,OAAO,GAE/Cc,EAAWzF,UACpB,EACA,CAACqC,EAAK7C,YAAY,CAAC,CAACkG,EAAaC,EAAU,EAExC,IAAI,CAACC,aAAa,EAAIH,EAAW,CAAC,IAAI,CAAC,CAChD,EACA1G,EAAK1E,MAAM,CAAG,WASZ,MARqB,YAAjB,IAAI,CAACkK,KAAK,IACZxF,CAAAA,EAAK+G,KAAK,CAAG,IAAI,CAACA,KAAK,CACrBzD,AAIM,CAAA,IAJNA,EAAKzG,QAAQ,CACX,SACAxE,EAAEyE,KAAK,CAAC,SAAU,CAAEC,eAAgB3C,CAAE,GACtC,IAAI,GACSkJ,EAAK0D,OAAO,CAAC5M,EAAG,IAAI,CAAA,EAEhC,IAAI,CAAC2M,KAAK,EAAIzD,EAAK4C,cAAc,EAC1C,EACAlG,EAAKrE,KAAK,CAAG,kBACX,AAAI,IAAI,CAACoL,KAAK,CACL,IAAI,CAACA,KAAK,CAACpL,KAAK,IAEzB,IAAI,CAACmL,WAAW,CAAG,QACnBxD,EAAKzG,QAAQ,CAAC,OAAQ,KAAM,IAAI,EACzByG,EAAK4C,cAAc,CAAC,CAAA,GAC7B,EACAlG,EAAKwF,KAAK,CAAG,kBACX,AAAI,IAAI,CAACuB,KAAK,CACLzD,EAAKgC,iBAAiB,CAAC,IAAI,CAACyB,KAAK,EAEtC,IAAI,CAACF,aAAa,CACbvD,EAAKgC,iBAAiB,CAAC,IAAI,CAACuB,aAAa,QAEpD,EACA7G,EAAKiH,UAAU,CAAG,WAChB,MACE,CAAC,IAAI,CAACF,KAAK,EACX,IAAI,CAACF,aAAa,EAClBvD,AAA+C,YAA/CA,EAAKgC,iBAAiB,CAAC,IAAI,CAACuB,aAAa,CAE7C,EACA7G,EAAKsC,QAAQ,CAAG,WACd,OAAO,IAAI,CAACC,SAAS,AACvB,EACAvC,EAAKjG,QAAQ,CAAG,WACd,OAAO,IAAI,CAAC2I,SAAS,AACvB,CACF,EAIAwE,kBAAmB,SAAUH,CAAK,EAChC,IAAII,EAAQJ,EAAMK,iBAAiB,CAAC,SAClC9K,EAAQ6K,GAASA,EAAMtG,KAAK,CAAC,KAC7BwG,EAAgB/K,GAASA,EAAMrC,MAAM,CAAG,GAAKqN,SAAShL,CAAK,CAAC,EAAE,CAAE,IAClE,OAAO+K,GAAiBA,EAAgB,CAC1C,EAOAtC,eAAgB,SAAUpM,CAAO,CAAE4O,CAAQ,EACzC5O,EAAQsG,aAAa,CAAGtG,EAAQsG,aAAa,EAAI,EACjD,IAQE8H,EACAtD,EATEH,EAAO,IAAI,CACbpB,EAAOvJ,EAAQqJ,KAAK,CAAC,EAAE,CACvBwF,EAAKtF,EAAKC,IAAI,CACdsF,EAAK9O,EAAQsG,aAAa,CAC1ByI,EAAM/O,EAAQqG,YAAY,EAAIwI,EAC9B1J,EAAQ,IAAI,CAACiD,UAAU,CACvBsF,EAAMhO,EAAEiO,QAAQ,GAChBV,EAAUS,EAAIT,OAAO,SAGvB,CACE,CACE,CAAA,IAAI,CAAChE,YAAY,CAACjJ,IAClBmF,GACC2J,CAAAA,GAAM,AAACpP,CAAAA,AAAgB,aAAhBA,EAAEmB,IAAI,CAACkO,GAAsBA,EAAI/O,GAAW+O,CAAE,EAAKF,CAAC,CAAC,IAE/D7O,EAAQqH,IAAI,KAIVuH,IAGAE,GAAMD,GACRtF,EAAK4D,KAAK,CAAGnN,EAAQ6G,IAAI,CAAC,iBACnB,IAAI,CAAC0G,cAAc,CAAC,CAAA,EAAOvN,EAAQ+G,OAAO,CAAE,CACjD,KACA,QACAwC,EAAK4D,KAAK,CACX,IAGHrC,EAAS,WAEP,IAAIkE,EAAItP,EAAEmK,MAAM,CAAC,CAAC,EAAG7J,GACnBiP,EAAgBD,EAAEpF,SAAS,CAAChB,MAAM,AACpCoG,CAAAA,EAAEtD,IAAI,CAAGvG,EAAM+E,IAAI,CACjBX,EACAuF,EACAA,EAAMpP,CAAAA,AAAgB,aAAhBA,EAAEmB,IAAI,CAACkO,GAAsBA,EAAIC,GAAKD,CAAE,EAC9CxF,EAAK1I,IAAI,EAIXmO,EAAExE,SAAS,CAAGwE,EAAEtD,IAAI,CAAClC,IAAI,CAEzBwF,EAAEvD,YAAY,CACZ,SAAWqD,EAAK,IAAOA,CAAAA,EAAKE,EAAExE,SAAS,CAAG,CAAA,EAAK,IAAMqE,EAEvDlE,EAAKzG,QAAQ,CAAC,kBAAmB,KAAM8K,GAEvCrE,EAAKY,YAAY,CAACyD,GAElBrE,EAAKD,qBAAqB,CAACsE,GAC3BZ,EAAQ,AACN,CAAA,AAAyC,CAAA,IAAxCzD,EAAKzG,QAAQ,CAAC,YAAa,KAAM8K,IAAgBtP,EAAEwP,IAAI,CAACF,IACzDrE,EAAK4C,cAAc,CAAC,CAAA,EAAOyB,EAAEjI,OAAO,CAAA,EAEnCU,IAAI,CAAC,SAAU0H,CAAM,CAAEC,CAAU,CAAEhB,CAAK,EACvCU,EAAKnE,EAAK4D,iBAAiB,CAACH,IAAUU,EAAKE,EAAExE,SAAS,CAIlDyE,EAAgBD,EAAExE,SAAS,CAAGwE,EAAEpF,SAAS,CAAChB,MAAM,EAClD+B,EAAKR,WAAW,CACdzK,EAAEyE,KAAK,CAAC,WAAY,CAClBiG,iBAAkB,CAAA,EAClBxB,OAAQkG,EAAKE,EAAE1I,aAAa,CAC5BgD,MAAOwF,EAAKE,EAAE1I,aAAa,AAC7B,GACA0I,GAGJhP,EAAQsG,aAAa,CAAG0I,EAAE1I,aAAa,CAAGwI,EAC1CE,EAAEG,MAAM,CAAGA,EACXH,EAAEI,UAAU,CAAGA,EACfJ,EAAEZ,KAAK,CAAGA,EACVzD,EAAKzG,QAAQ,CAAC,YAAa,KAAM8K,GACjCrE,EAAKzG,QAAQ,CAAC,cAAe,KAAM8K,GAC/BF,EAAKD,EAGP/D,IAEA4C,EAAIE,WAAW,CAACoB,EAAEjI,OAAO,CAAE,CAACoI,EAAQC,EAAYhB,EAAM,CAE1D,GACChB,IAAI,CAAC,SAAUgB,CAAK,CAAEgB,CAAU,CAAEjB,CAAW,EAC5Ca,EAAEZ,KAAK,CAAGA,EACVY,EAAEI,UAAU,CAAGA,EACfJ,EAAEb,WAAW,CAAGA,EAChBxD,EAAKzG,QAAQ,CAAC,YAAa,KAAM8K,GACjCrE,EAAKzG,QAAQ,CAAC,cAAe,KAAM8K,GACnCtB,EAAIG,UAAU,CAACmB,EAAEjI,OAAO,CAAE,CAACqH,EAAOgB,EAAYjB,EAAY,CAC5D,GACCb,MAAM,CAAC,WACN3C,EAAKK,uBAAuB,CAACgE,EAC/B,EACJ,EACA,IAAI,CAAChC,eAAe,CAACC,GACrBA,EAAQjK,KAAK,CAAG,WACd,OAAOoL,EAAMpL,KAAK,EACpB,EACA8H,IACOmC,IACT,EAEAoC,YAAa,SAAU5N,CAAC,CAAE4F,CAAI,EACP,IAAjB,IAAI,CAACiI,OAAO,GAId,IAAI,CAACpL,QAAQ,CAAC,SAEd,IAAI,CAACuG,aAAa,CAAG,IAAI,IAAI,CAAClC,aAAa,CAE3C,IAAI,CAACqB,SAAS,CAAChB,MAAM,CAAG,IAAI,CAACgB,SAAS,CAACN,KAAK,CAAG,EAC/C,IAAI,CAACM,SAAS,CAACf,OAAO,CAAG,GAK3B,IAAI,CAACiB,mBAAmB,CAACzC,GACzB,IAAI,CAACoC,mBAAmB,CAACpC,GACzBA,EAAKuC,SAAS,CAAChB,MAAM,CAAGvB,EAAKuB,MAAM,CAAGvB,EAAKf,aAAa,EAAI,EAC5De,EAAKuC,SAAS,CAACN,KAAK,CAAGjC,EAAKiC,KAAK,CAAG,IAAI,CAACF,SAAS,CAAC/B,EAAKgC,KAAK,GAAK,EAClEhC,EAAKuC,SAAS,CAACf,OAAO,CAAGxB,EAAKwB,OAAO,CAAG,EACxC,IAAI,CAACyG,OAAO,EAAI,EAEhB,IAAI,CAAC1F,SAAS,CAAChB,MAAM,EAAIvB,EAAKuB,MAAM,CACpC,IAAI,CAACgB,SAAS,CAACN,KAAK,EAAIjC,EAAKiC,KAAK,AACpC,EAEAiG,QAAS,SAAUJ,CAAM,CAAEC,CAAU,CAAEhB,CAAK,CAAEpO,CAAO,EACnD,IAAIsJ,EAAQtJ,EAAQ4J,SAAS,CAACN,KAAK,CACjClI,EAAWpB,EAAQ+J,SAAS,AAC1B/J,CAAAA,EAAQ4J,SAAS,CAAChB,MAAM,CAAGU,GAG7B,IAAI,CAACa,WAAW,CACdzK,EAAEyE,KAAK,CAAC,WAAY,CAClBiG,iBAAkB,CAAA,EAClBxB,OAAQU,EACRA,MAAOA,CACT,GACAtJ,GAGJoB,EAAS+N,MAAM,CAAGnP,EAAQmP,MAAM,CAAGA,EACnC/N,EAASgO,UAAU,CAAGpP,EAAQoP,UAAU,CAAGA,EAC3ChO,EAASgN,KAAK,CAAGpO,EAAQoO,KAAK,CAAGA,EACjC,IAAI,CAAClK,QAAQ,CAAC,OAAQ,KAAMlE,EAC9B,EAEAwP,QAAS,SAAUpB,CAAK,CAAEgB,CAAU,CAAEjB,CAAW,CAAEnO,CAAO,EACxD,IAAIoB,EAAWpB,EAAQ+J,SAAS,AAC5B/J,CAAAA,EAAQuG,mBAAmB,GAG7B,IAAI,CAACqD,SAAS,CAAChB,MAAM,EAAI5I,EAAQ4J,SAAS,CAAChB,MAAM,CACjD,IAAI,CAACgB,SAAS,CAACN,KAAK,EAAItJ,EAAQ4J,SAAS,CAACN,KAAK,EAEjDlI,EAASgN,KAAK,CAAGpO,EAAQoO,KAAK,CAAGA,EACjChN,EAASgO,UAAU,CAAGpP,EAAQoP,UAAU,CAAGA,EAC3ChO,EAAS+M,WAAW,CAAGnO,EAAQmO,WAAW,CAAGA,EAC7C,IAAI,CAACjK,QAAQ,CAAC,OAAQ,KAAMlE,EAC9B,EAEAyP,UAAW,SAAUC,CAAa,CAAEN,CAAU,CAAEO,CAAY,CAAE3P,CAAO,EAGnE,IAAI,CAACkE,QAAQ,CAAC,SAAU,KAAMlE,EAChC,EAEAqO,QAAS,SAAU5M,CAAC,CAAE4F,CAAI,EACnBA,EAAK1E,MAAM,EACd,IAAI,CAACmL,sBAAsB,CAACrM,EAAG4F,GAEjC,IACE+G,EACAwB,EACAC,EACAC,EAJEnF,EAAO,IAAI,CAKb3K,EAAU2K,EAAK+B,gBAAgB,CAACrF,GAChC/G,EAAO,WAsDL,OArDAqK,EAAKoF,QAAQ,EAAI,EAEjB/P,EAAQyK,aAAa,CAAG,IAAIE,EAAKpC,aAAa,CAC9C6F,EACEA,GACA,AACE,CAAA,AAAEwB,CAAAA,GACAjF,AAIM,CAAA,IAJNA,EAAKzG,QAAQ,CACX,OACAxE,EAAEyE,KAAK,CAAC,OAAQ,CAAEC,eAAgB3C,CAAE,GACpCzB,EACQ,GACV2K,EAAK4C,cAAc,CAAC,CAAA,EAAOvN,EAAQ+G,OAAO,CAAE6I,IAC9CjF,EAAKyB,cAAc,CAACpM,IACpBN,EAAEwP,IAAI,CAAClP,EAAO,EAEbyH,IAAI,CAAC,SAAU0H,CAAM,CAAEC,CAAU,CAAEhB,CAAK,EACvCzD,EAAK4E,OAAO,CAACJ,EAAQC,EAAYhB,EAAOpO,EAC1C,GACCoN,IAAI,CAAC,SAAUgB,CAAK,CAAEgB,CAAU,CAAEjB,CAAW,EAC5CxD,EAAK6E,OAAO,CAACpB,EAAOgB,EAAYjB,EAAanO,EAC/C,GACCsN,MAAM,CAAC,SAAUoC,CAAa,CAAEN,CAAU,CAAEO,CAAY,EAUvD,GATAhF,EAAKK,uBAAuB,CAAChL,GAC7B2K,EAAK8E,SAAS,CACZC,EACAN,EACAO,EACA3P,GAEF2K,EAAKoF,QAAQ,EAAI,EACjBpF,EAAK2E,OAAO,EAAI,EAEdtP,EAAQ+F,sBAAsB,EAC9B/F,EAAQ+F,sBAAsB,CAAG4E,EAAKoF,QAAQ,CAK9C,IADA,IAAIC,EAAWrF,EAAKsF,MAAM,CAACC,KAAK,GACzBF,GAAU,CACf,GAAIrF,AAAqC,YAArCA,EAAKgC,iBAAiB,CAACqD,GAAyB,CAClDA,EAASG,OAAO,GAChB,KACF,CACAH,EAAWrF,EAAKsF,MAAM,CAACC,KAAK,EAC9B,CAEmB,IAAjBvF,EAAK2E,OAAO,EAGd3E,EAAKzG,QAAQ,CAAC,OAElB,EAEN,QAEF,CADA,IAAI,CAACmL,WAAW,CAAC5N,EAAGzB,GAElB,IAAI,CAACA,OAAO,CAAC8F,iBAAiB,EAC7B,IAAI,CAAC9F,OAAO,CAAC+F,sBAAsB,EAClC,IAAI,CAAC/F,OAAO,CAAC+F,sBAAsB,EAAI,IAAI,CAACgK,QAAQ,GAElD,IAAI,CAAC/P,OAAO,CAAC+F,sBAAsB,CAAG,GACxC8J,EAAOnQ,EAAEiO,QAAQ,GACjB,IAAI,CAACsC,MAAM,CAAC9G,IAAI,CAAC0G,GACjBC,EAAOD,CAAI,CAAClF,EAAK7C,YAAY,CAAC,CAACxH,KAE/B,IAAI,CAAC8P,SAAS,CAAG,IAAI,CAACA,SAAS,CAACzF,EAAK7C,YAAY,CAAC,CAACxH,EAAMA,GACzDwP,EAAO,IAAI,CAACM,SAAS,EAKvBN,EAAK9M,KAAK,CAAG,iBAEX,CADA4M,EAAU,CAAClO,KAAAA,EAAW,QAAS,QAAQ,CAClC0M,GAMEA,EAAMpL,KAAK,IALZ6M,GACFA,EAAKhC,UAAU,CAAC7N,EAAQ+G,OAAO,CAAE6I,GAE5BtP,IAGX,EACO,IAAI,CAAC0M,eAAe,CAAC8C,IAEvBxP,GACT,EAEA+P,OAAQ,SAAU5O,CAAC,CAAE4F,CAAI,EACvB,IAUEiJ,EACAC,EACAC,EACAlE,EAbE3B,EAAO,IAAI,CACbwE,EAAS,CAAA,EACTnP,EAAUN,EAAEmK,MAAM,CAAC,CAAC,EAAG,IAAI,CAAC7J,OAAO,CAAEqH,GACrCgC,EAAQhC,EAAKgC,KAAK,CAClBoH,EAAcpH,EAAM/H,MAAM,CAC1BoP,EAAQ1Q,EAAQ2F,qBAAqB,CACrCgL,EAAY3Q,EAAQ4F,wBAAwB,CAC5CgL,EAAW5Q,EAAQ6F,gCAAgC,CACnDgL,EAAY,EACZ3P,EAAY,IAAI,CAACmL,aAAa,CAACrM,GAK/B8Q,EAAI,EACN,GAAI,CAACL,EACH,MAAO,CAAA,EAKT,GAHIE,GAAatH,AAAkB3H,KAAAA,IAAlB2H,CAAK,CAAC,EAAE,CAACG,IAAI,EAC5BmH,CAAAA,EAAYjP,KAAAA,CAAQ,EAGpB,AAAE1B,CAAAA,EAAQ0F,iBAAiB,EAAIgL,GAASC,CAAQ,GAC/C,IAAI,CAAC1H,YAAY,CAACjJ,IAId,GAAI,CAAEA,CAAAA,EAAQ0F,iBAAiB,EAAIiL,CAAQ,GAAMD,EAGtD,IAAKpE,EAAI,EAFTkE,EAAU,EAAE,CACZF,EAAe,EAAE,CACLhE,EAAImE,EAAanE,GAAKoE,EAChCF,EAAQrH,IAAI,CAACE,EAAMlE,KAAK,CAACmH,EAAGA,EAAIoE,IAE3BH,AADLA,CAAAA,EAAiBrP,EAAUiE,KAAK,CAACmH,EAAGA,EAAIoE,EAAK,EACzBpP,MAAM,EACxBiP,CAAAA,EAAiBrP,CAAQ,EAE3BoP,EAAanH,IAAI,CAACoH,QAEf,GAAI,CAACvQ,EAAQ0F,iBAAiB,EAAIiL,EAGvC,IAAKrE,EAAI,EAFTkE,EAAU,EAAE,CACZF,EAAe,EAAE,CACLhE,EAAImE,EAAanE,GAAQ,EACnCuE,GAAaxH,CAAK,CAACiD,EAAE,CAAC9C,IAAI,CAAGoH,EAE3BtE,CAAAA,EAAI,IAAMmE,GACVI,EAAYxH,CAAK,CAACiD,EAAI,EAAE,CAAC9C,IAAI,CAAGoH,EAAWD,GAC1CD,GAASpE,EAAI,EAAIwE,GAAKJ,CAAK,IAE5BF,EAAQrH,IAAI,CAACE,EAAMlE,KAAK,CAAC2L,EAAGxE,EAAI,IAE3BiE,AADLA,CAAAA,EAAiBrP,EAAUiE,KAAK,CAAC2L,EAAGxE,EAAI,EAAC,EACrBhL,MAAM,EACxBiP,CAAAA,EAAiBrP,CAAQ,EAE3BoP,EAAanH,IAAI,CAACoH,GAClBO,EAAIxE,EAAI,EACRuE,EAAY,QAIhBP,EAAepP,OAlCfsP,EAAU,CAACnH,EAAM,CACjBiH,EAAe,CAACpP,EAAU,CAkD5B,OAfAmG,EAAK0J,aAAa,CAAG1H,EACrB3J,EAAEsC,IAAI,CAACwO,GAAWnH,EAAO,SAAUpH,CAAK,CAAE+O,CAAO,EAC/C,IAAIC,EAAUvR,EAAEmK,MAAM,CAAC,CAAC,EAAGxC,GAW3B,OAVA4J,EAAQ5H,KAAK,CAAGmH,EAAUQ,EAAU,CAACA,EAAQ,CAC7CC,EAAQ/P,SAAS,CAAGoP,CAAY,CAACrO,EAAM,CACvC0I,EAAKb,mBAAmB,CAACmH,GACzBtG,EAAKlB,mBAAmB,CAACwH,GACzBtG,EAAKmD,sBAAsB,CAACrM,EAAGwP,GAC/B9B,EAASxE,EAAKzG,QAAQ,CACpB,MACAxE,EAAEyE,KAAK,CAAC,MAAO,CAAEC,eAAgB3C,CAAE,GACnCwP,EAGJ,GACO9B,CACT,EAEA+B,kBAAmB,SAAU7J,CAAI,EAC/B,IAAIzE,EAAQyE,EAAK/E,SAAS,CACxB6O,EAAavO,EAAML,KAAK,CAAC,CAAA,GACzB6O,EAAexO,EAAMyO,EAAE,CAACvO,SAASwO,aAAa,CAEhDjK,CAAAA,EAAKkK,cAAc,CAAGJ,EACtBzR,EAAE,iBAAiB+C,MAAM,CAAC0O,EAAW,CAAC,EAAE,CAACK,KAAK,GAG9C5O,EAAMJ,KAAK,CAAC2O,GAAYM,MAAM,GAG1BL,GACFD,EAAWO,OAAO,CAAC,SAGrBhS,EAAEiS,SAAS,CAAC/O,EAAMzB,GAAG,CAAC,WAItB,IAAI,CAACnB,OAAO,CAACsC,SAAS,CAAG,IAAI,CAACtC,OAAO,CAACsC,SAAS,CAAC6I,GAAG,CAAC,SAAUmB,CAAC,CAAEsF,CAAE,SACjE,AAAIA,IAAOhP,CAAK,CAAC,EAAE,CACVuO,CAAU,CAAC,EAAE,CAEfS,CACT,GAGIhP,CAAK,CAAC,EAAE,GAAK,IAAI,CAACoO,OAAO,CAAC,EAAE,EAC9B,CAAA,IAAI,CAACA,OAAO,CAAGG,CAAS,CAE5B,EAEAU,qBAAsB,SAAUC,CAAK,CAAEC,CAAI,EACzC,IAGEC,EAHErH,EAAO,IAAI,CACb+C,EAAMhO,EAAEiO,QAAQ,GAChBsE,EAAU,EAAE,CAEZC,EAAe,SAAUzQ,CAAC,EACpBA,GAAK,CAACA,EAAEqQ,KAAK,EACfrQ,CAAAA,EAAEqQ,KAAK,CAAGA,CAAI,EAMhBpE,EAAIyC,OAAO,CAAC,CAAC1O,EAAE,CACjB,EACA0Q,EAAiB,SAAUF,CAAO,EAChCtH,EACGyH,sBAAsB,CAACH,EAASF,EAAOD,EAAM3P,IAAI,CAAG,KACpDsF,IAAI,CAAC,SAAU4B,CAAK,EACnBqE,EAAIyC,OAAO,CAAC9G,EACd,GACC+D,IAAI,CAAC8E,EACV,EACAG,EAAc,WACZL,EAAUK,WAAW,CAAC,SAAUC,CAAO,EAChCA,EAAQhR,MAAM,EAGjB2Q,EAAUA,EAAQM,MAAM,CAACD,GACzBD,KAHAF,EAAeF,EAKnB,EAAGC,EACL,EAsBF,OApBAH,EAAOA,GAAQ,GACXD,EAAMU,MAAM,CACVV,EAAMW,KAAK,EAEbX,EAAMW,KAAK,CAACC,YAAY,CAAGX,EAC3BrE,EAAIyC,OAAO,CAAC2B,EAAMW,KAAK,GAEvBX,EAAMvI,IAAI,CAAC,SAAUA,CAAI,EACvBA,EAAKmJ,YAAY,CAAGX,EACpBrE,EAAIyC,OAAO,CAAC5G,EACd,EAAG2I,GAEIJ,EAAMa,WAAW,EAC1BX,EAAYF,EAAMc,YAAY,GAC9BP,KAIA3E,EAAIyC,OAAO,CAAC,EAAE,EAETzC,EAAIT,OAAO,EACpB,EAEAmF,uBAAwB,SAAUH,CAAO,CAAEF,CAAI,EAC7C,IAAIpH,EAAO,IAAI,CACf,OAAOjL,EAAEmT,IAAI,CACVxK,KAAK,CACJ3I,EACAA,EAAEyL,GAAG,CAAC8G,EAAS,SAAUH,CAAK,EAC5B,OAAOnH,EAAKkH,oBAAoB,CAACC,EAAOC,EAC1C,GAEF,CAAC,IAAI,CAACjK,YAAY,CAAC,CAAC,WAClB,OAAOgL,MAAM5N,SAAS,CAACqN,MAAM,CAAClK,KAAK,CAAC,EAAE,CAAEC,UAC1C,EACJ,EAEAyK,iBAAkB,SAAUjP,CAAY,EAGtC,IAAIkP,EAAQlP,AADZA,CAAAA,EAAeA,GAAgB,CAAC,CAAA,EACPkP,KAAK,QAC9B,AACEA,GACAA,EAAM1R,MAAM,EACX0R,CAAAA,CAAK,CAAC,EAAE,CAACC,gBAAgB,EAAID,CAAK,CAAC,EAAE,CAACE,UAAU,AAAD,EAEzC,IAAI,CAACd,sBAAsB,CAChC1S,EAAEyL,GAAG,CAAC6H,EAAO,SAAUG,CAAI,EACzB,IAAIrB,SACJ,AAAIqB,EAAKF,gBAAgB,EACvBnB,CAAAA,EAAQqB,EAAKF,gBAAgB,EAAC,GAG5BnB,CAAAA,EAAMW,KAAK,CAAGU,EAAKC,SAAS,EAAC,EAExBtB,GAEFqB,EAAKD,UAAU,EACxB,IAGGxT,EAAEiO,QAAQ,GAAGwC,OAAO,CAACzQ,EAAE2T,SAAS,CAACvP,EAAauF,KAAK,GAAG4D,OAAO,EACtE,EAEAqG,yBAA0B,SAAUhR,CAAS,EAG3C,IACE+G,EACAhH,EAFE4P,EAAU3P,AADdA,CAAAA,EAAY5C,EAAE4C,EAAS,EACCR,IAAI,CAAC,WAG7B,GAAImQ,GAAWA,EAAQ3Q,MAAM,CAC3B,OAAO,IAAI,CAAC8Q,sBAAsB,CAACH,GAGrC,GAAK5I,AADLA,CAAAA,EAAQ3J,EAAE2T,SAAS,CAAC/Q,EAAUR,IAAI,CAAC,SAAQ,EAChCR,MAAM,CASYI,KAAAA,IAAlB2H,CAAK,CAAC,EAAE,CAAClH,IAAI,EAAkBkH,CAAK,CAAC,EAAE,CAACwC,QAAQ,EAEzDnM,EAAEsC,IAAI,CAACqH,EAAO,SAAUpH,CAAK,CAAEsH,CAAI,EACjCA,EAAKpH,IAAI,CAAGoH,EAAKsC,QAAQ,CACzBtC,EAAKC,IAAI,CAAGD,EAAKgK,QAAQ,AAC3B,OAdiB,CAEjB,GAAI,CADJlR,CAAAA,EAAQC,EAAUR,IAAI,CAAC,QAAO,EAE5B,OAAOpC,EAAEiO,QAAQ,GAAGwC,OAAO,CAAC,EAAE,EAAElD,OAAO,GAKzC5D,EAAQ,CAAC,CAAElH,KAAME,EAAM6E,OAAO,CAAC,QAAS,GAAI,EAAE,AAChD,CAOA,OAAOxH,EAAEiO,QAAQ,GAAGwC,OAAO,CAAC9G,GAAO4D,OAAO,EAC5C,EAEAuG,mBAAoB,SAAUlR,CAAS,SACrC,AAAI,AAAEA,aAAqB5C,GAAM4C,AAAqB,IAArBA,EAAUhB,MAAM,CAG1C5B,EAAEmT,IAAI,CACVxK,KAAK,CAAC3I,EAAGA,EAAEyL,GAAG,CAAC7I,EAAW,IAAI,CAACgR,wBAAwB,EACxD,CAAC,IAAI,CAACxL,YAAY,CAAC,CAAC,WAClB,OAAOgL,MAAM5N,SAAS,CAACqN,MAAM,CAAClK,KAAK,CAAC,EAAE,CAAEC,UAC1C,GANO,IAAI,CAACgL,wBAAwB,CAAChR,EAOzC,EAEAmR,UAAW,SAAUhS,CAAC,EACpB,IAAIkJ,EAAO,IAAI,CACbtD,EAAO,CACL/E,UAAW5C,EAAE+B,EAAEiS,MAAM,EACrBxT,KAAMR,EAAE+B,EAAEiS,MAAM,CAACxT,IAAI,CACvB,EACF,IAAI,CAACsT,kBAAkB,CAACnM,EAAK/E,SAAS,EAAEgL,MAAM,CAAC,SAAUjE,CAAK,EAC5DhC,EAAKgC,KAAK,CAAGA,EACTsB,EAAK3K,OAAO,CAACyF,gBAAgB,EAC/BkF,EAAKuG,iBAAiB,CAAC7J,GAOjB,CAAA,IAJNsD,EAAKzG,QAAQ,CACX,SACAxE,EAAEyE,KAAK,CAAC,SAAU,CAAEC,eAAgB3C,CAAE,GACtC4F,IAGFsD,EAAK0F,MAAM,CAAC5O,EAAG4F,EAEnB,EACF,EAEAsM,SAAU,SAAUlS,CAAC,EACnB,IAAIuR,EACAvR,EAAEsC,aAAa,EACftC,EAAEsC,aAAa,CAAC6P,aAAa,EAC7BnS,EAAEsC,aAAa,CAAC6P,aAAa,CAACZ,KAAK,CACrC3L,EAAO,CAAEgC,MAAO,EAAE,AAAC,EACjB2J,GAASA,EAAM1R,MAAM,GACvB5B,EAAEsC,IAAI,CAACgR,EAAO,SAAU/Q,CAAK,CAAEkR,CAAI,EACjC,IAAI5J,EAAO4J,EAAKC,SAAS,EAAID,EAAKC,SAAS,GACvC7J,GACFlC,EAAKgC,KAAK,CAACF,IAAI,CAACI,EAEpB,GAMQ,CAAA,IAJN,IAAI,CAACrF,QAAQ,CACX,QACAxE,EAAEyE,KAAK,CAAC,QAAS,CAAEC,eAAgB3C,CAAE,GACrC4F,IAGF,IAAI,CAACgJ,MAAM,CAAC5O,EAAG4F,GAGrB,EAEAwM,QAAS,SAAUpS,CAAC,EAClBA,EAAEqC,YAAY,CAAGrC,EAAEsC,aAAa,EAAItC,EAAEsC,aAAa,CAACD,YAAY,CAChE,IAAI6G,EAAO,IAAI,CACb7G,EAAerC,EAAEqC,YAAY,CAC7BuD,EAAO,CAAC,EACNvD,GAAgBA,EAAauF,KAAK,EAAIvF,EAAauF,KAAK,CAAC/H,MAAM,GACjEG,EAAE4C,cAAc,GAChB,IAAI,CAAC0O,gBAAgB,CAACjP,GAAcwJ,MAAM,CAAC,SAAUjE,CAAK,EACxDhC,EAAKgC,KAAK,CAAGA,EAML,CAAA,IAJNsB,EAAKzG,QAAQ,CACX,OACAxE,EAAEyE,KAAK,CAAC,OAAQ,CAAEC,eAAgB3C,CAAE,GACpC4F,IAGFsD,EAAK0F,MAAM,CAAC5O,EAAG4F,EAEnB,GAEJ,EAEAyM,YAAalQ,EAAe,YAE5BmQ,aAAcnQ,EAAe,aAE7BoQ,aAAcpQ,EAAe,aAE7BqQ,mBAAoB,WACd,IAAI,CAAChL,YAAY,CAAC,IAAI,CAACjJ,OAAO,IAChC,IAAI,CAACkU,GAAG,CAAC,IAAI,CAAClU,OAAO,CAACuF,QAAQ,CAAE,CAC9B4O,SAAU,IAAI,CAACL,WAAW,CAC1BM,KAAM,IAAI,CAACP,OAAO,CAElBQ,UAAW,IAAI,CAACN,YAAY,CAE5BO,UAAW,IAAI,CAACN,YAAY,AAC9B,GACA,IAAI,CAACE,GAAG,CAAC,IAAI,CAAClU,OAAO,CAACwF,SAAS,CAAE,CAC/B+O,MAAO,IAAI,CAACZ,QAAQ,AACtB,IAEEjU,EAAE6E,OAAO,CAACjC,SAAS,EACrB,IAAI,CAAC4R,GAAG,CAAC,IAAI,CAAClU,OAAO,CAACsC,SAAS,CAAE,CAC/BkS,OAAQ,IAAI,CAACf,SAAS,AACxB,EAEJ,EAEAgB,sBAAuB,WACrB,IAAI,CAACC,IAAI,CAAC,IAAI,CAAC1U,OAAO,CAACuF,QAAQ,CAAE,qCACjC,IAAI,CAACmP,IAAI,CAAC,IAAI,CAAC1U,OAAO,CAACwF,SAAS,CAAE,SAClC,IAAI,CAACkP,IAAI,CAAC,IAAI,CAAC1U,OAAO,CAACsC,SAAS,CAAE,SACpC,EAEAqS,SAAU,WACR,IAAI,CAACF,qBAAqB,EAC5B,EAEAG,WAAY,SAAU3N,CAAG,CAAE5E,CAAK,EAC9B,IAAIwS,EAASnV,AAAyC,KAAzCA,EAAEsE,OAAO,CAACiD,EAAK,IAAI,CAACkB,eAAe,EAC5C0M,GACF,IAAI,CAACJ,qBAAqB,GAE5B,IAAI,CAACK,MAAM,CAAC7N,EAAK5E,GACbwS,IACF,IAAI,CAACE,mBAAmB,GACxB,IAAI,CAACd,kBAAkB,GAE3B,EAEAc,oBAAqB,WACnB,IAAI/U,EAAU,IAAI,CAACA,OAAO,AACtBA,AAAsB0B,MAAAA,IAAtB1B,EAAQsC,SAAS,CACnBtC,EAAQsC,SAAS,CAAG,IAAI,CAAC0O,OAAO,CAACK,EAAE,CAAC,sBAChC,IAAI,CAACL,OAAO,CACZ,IAAI,CAACA,OAAO,CAACgE,IAAI,CAAC,sBACXhV,EAAQsC,SAAS,YAAY5C,GACxCM,CAAAA,EAAQsC,SAAS,CAAG5C,EAAEM,EAAQsC,SAAS,CAAA,EAEnCtC,EAAQuF,QAAQ,YAAY7F,GAChCM,CAAAA,EAAQuF,QAAQ,CAAG7F,EAAEM,EAAQuF,QAAQ,CAAA,EAEjCvF,EAAQwF,SAAS,YAAY9F,GACjCM,CAAAA,EAAQwF,SAAS,CAAG9F,EAAEM,EAAQwF,SAAS,CAAA,CAE3C,EAEAyP,WAAY,SAAUC,CAAG,EACvB,IAAIvR,EAAQuR,EAAIhN,KAAK,CAAC,KACpBiN,EAAYxR,EAAMyR,GAAG,GAEvB,OADAzR,EAAMuM,KAAK,GACJ,IAAI1L,OAAOb,EAAM0R,IAAI,CAAC,KAAMF,EACrC,EAEAG,gBAAiB,SAAUrO,CAAG,CAAE5E,CAAK,EACnC,MACE4E,AAAQ,QAARA,GACAvH,AAAkB,WAAlBA,EAAEmB,IAAI,CAACwB,IACP,qBAAqB1B,IAAI,CAAC0B,EAE9B,EAEAkT,oBAAqB,WACnB,IAAI5K,EAAO,IAAI,CACb3K,EAAU,IAAI,CAACA,OAAO,CACtBqH,EAAO,IAAI,CAAC2J,OAAO,CAAC3J,IAAI,GAE1B3H,EAAEsC,IAAI,CAAC,IAAI,CAACgP,OAAO,CAAC,EAAE,CAACwE,UAAU,CAAE,SAAUvT,CAAK,CAAExB,CAAI,EACtD,IACE4B,EADE4E,EAAMxG,EAAK0B,IAAI,CAACsT,WAAW,GAE3B,SAAS9U,IAAI,CAACsG,KAKhB5E,EAAQgF,CAAI,CAHZJ,EAAMA,EAAI9B,KAAK,CAAC,GAAG+B,OAAO,CAAC,UAAW,SAAUgO,CAAG,EACjD,OAAOA,EAAIQ,MAAM,CAAC,GAAGjJ,WAAW,EAClC,GACiB,CACb9B,EAAK2K,eAAe,CAACrO,EAAK5E,IAC5BA,CAAAA,EAAQsI,EAAKsK,UAAU,CAAC5S,EAAK,EAE/BrC,CAAO,CAACiH,EAAI,CAAG5E,EAEnB,EACF,EAEAsT,QAAS,WACP,IAAI,CAACJ,mBAAmB,GACxB,IAAI,CAACR,mBAAmB,GACxB,IAAI,CAAC9E,MAAM,CAAG,EAAE,CAChB,IAAI,CAACG,SAAS,CAAG,IAAI,CAAC7C,cAAc,CAAC,CAAA,GACrC,IAAI,CAACwC,QAAQ,CAAG,IAAI,CAACT,OAAO,CAAG,EAC/B,IAAI,CAAC7F,mBAAmB,CAAC,IAAI,EAC7B,IAAI,CAACwK,kBAAkB,EACzB,EAIA2B,OAAQ,WACN,OAAO,IAAI,CAACtG,OAAO,AACrB,EAMA3F,SAAU,WACR,OAAO,IAAI,CAACC,SAAS,AACvB,EAMAxC,IAAK,SAAUC,CAAI,EACjB,IAAIsD,EAAO,IAAI,CACVtD,IAAQ,IAAI,CAACrH,OAAO,CAAC6V,QAAQ,GAG9BxO,EAAK/E,SAAS,EAAI,CAAC+E,EAAKgC,KAAK,CAC/B,IAAI,CAACmK,kBAAkB,CAACnM,EAAK/E,SAAS,EAAEgL,MAAM,CAAC,SAAUjE,CAAK,EAC5DhC,EAAKgC,KAAK,CAAGA,EACbsB,EAAK0F,MAAM,CAAC,KAAMhJ,EACpB,IAEAA,EAAKgC,KAAK,CAAG3J,EAAE2T,SAAS,CAAChM,EAAKgC,KAAK,EACnC,IAAI,CAACgH,MAAM,CAAC,KAAMhJ,IAEtB,EAOA/G,KAAM,SAAU+G,CAAI,EAClB,GAAIA,GAAQ,CAAC,IAAI,CAACrH,OAAO,CAAC6V,QAAQ,CAAE,CAClC,GAAIxO,EAAK/E,SAAS,EAAI,CAAC+E,EAAKgC,KAAK,CAAE,CACjC,IAGE+E,EACAwB,EAJEjF,EAAO,IAAI,CACb+C,EAAMhO,EAAEiO,QAAQ,GAChBV,EAAUS,EAAIT,OAAO,GA8BvB,OA3BAA,EAAQjK,KAAK,CAAG,iBAEd,CADA4M,EAAU,CAAA,EACNxB,GACKA,EAAMpL,KAAK,IAEpB0K,EAAIoI,MAAM,CAAC,KAAM,QAAS,SACnB7I,EACT,EACA,IAAI,CAACuG,kBAAkB,CAACnM,EAAK/E,SAAS,EAAEgL,MAAM,CAAC,SAAUjE,CAAK,EAC5D,IAAIuG,GAGJ,GAAI,CAACvG,EAAM/H,MAAM,CAAE,CACjBoM,EAAIoI,MAAM,GACV,MACF,CACAzO,EAAKgC,KAAK,CAAGA,EAEb+E,AADAA,CAAAA,EAAQzD,EAAK0D,OAAO,CAAC,KAAMhH,EAAI,EACzB0O,IAAI,CACR,SAAU5G,CAAM,CAAEC,CAAU,CAAEhB,CAAK,EACjCV,EAAIyC,OAAO,CAAChB,EAAQC,EAAYhB,EAClC,EACA,SAAUA,CAAK,CAAEgB,CAAU,CAAEjB,CAAW,EACtCT,EAAIoI,MAAM,CAAC1H,EAAOgB,EAAYjB,EAChC,GAEJ,GACO,IAAI,CAACnB,eAAe,CAACC,EAC9B,CAEA,GADA5F,EAAKgC,KAAK,CAAG3J,EAAE2T,SAAS,CAAChM,EAAKgC,KAAK,EAC/BhC,EAAKgC,KAAK,CAAC/H,MAAM,CACnB,OAAO,IAAI,CAAC+M,OAAO,CAAC,KAAMhH,EAE9B,CACA,OAAO,IAAI,CAACkG,cAAc,CAAC,CAAA,EAAOlG,GAAQA,EAAKN,OAAO,CACxD,CACF,EACF,GAIAiP,IAAIC,SAAS,CAAC,SAAU,CACpBC,SAAU,opBAUVC,MAAO,CACHC,MAAOpM,OACPqM,cAAejL,MACnB,EACAkL,QAAS,WACL,IAAIC,EAAO,IAAI,CACXC,EAAc1T,SAAS2T,cAAc,CAACF,EAAKF,aAAa,EAAI,cAChE3W,EAAE8W,GAAaE,IAAI,CAAC,qBAAsB,SAAUjV,CAAC,CAAE4F,CAAI,EACnDA,EAAKgC,KAAK,CAAC,EAAE,CAAClH,IAAI,GAAKoU,EAAKH,KAAK,CAACjU,IAAI,EAG1CoU,CAAAA,EAAKH,KAAK,CAACO,UAAU,CAAGhI,SAAStH,EAAKuB,MAAM,CAAGvB,EAAKiC,KAAK,CAAG,IAAK,GAAE,CACvE,GAEA5J,EAAE8W,GAAaE,IAAI,CAAC,iBAAkB,SAAUjV,CAAC,CAAE4F,CAAI,EAC/CA,EAAKgC,KAAK,CAAC,EAAE,CAAClH,IAAI,GAAKoU,EAAKH,KAAK,CAACjU,IAAI,GAGtCkF,EAAK8H,MAAM,CAAC9F,KAAK,CAAC,EAAE,CAAC8D,KAAK,CAC1BoJ,EAAKK,aAAa,CAACvP,EAAKgC,KAAK,CAAC,EAAE,CAAClH,IAAI,CAAEkF,EAAK8H,MAAM,CAAC9F,KAAK,CAAC,EAAE,CAAC8D,KAAK,EAEjE0J,IAAIC,KAAK,CAAC,iBAAkBP,EAAKH,KAAK,EAE9C,GAEA1W,EAAE8W,GAAaE,IAAI,CAAC,iBAAkB,SAAUjV,CAAC,CAAE4F,CAAI,EAC/CA,EAAKgC,KAAK,CAAC,EAAE,CAAClH,IAAI,GAAKoU,EAAKH,KAAK,CAACjU,IAAI,EAG1CoU,EAAKK,aAAa,CAACvP,EAAKgC,KAAK,CAAC,EAAE,CAAClH,IAAI,CAAEzC,EAAE,YAAY0C,GAAG,GAC5D,EACJ,EACA2U,QAAS,CACLH,cAAe,SAAU/K,CAAQ,CAAE/E,CAAO,EAClC+E,IAAa,IAAI,CAACuK,KAAK,CAACjU,IAAI,GAGhC,IAAI,CAACiU,KAAK,CAACY,YAAY,CAAGlQ,EAC1B+P,IAAIC,KAAK,CAAC,gBAAiB,IAAI,CAACV,KAAK,EACzC,EACAa,eAAgB,WACZJ,IAAIC,KAAK,CAAC,iBAAkB,IAAI,CAACV,KAAK,CAC1C,CACJ,CACJ,GAIAJ,IAAIC,SAAS,CAAC,aAAc,CACxBC,SAAU,4nCAsBV7O,KAAM,WACF,MAAO,CACHgC,MAAO,EAAE,CACT6N,EAAG,CAAC,EACJC,SAAU,CAAA,EACVC,aAAc,EACdC,WAAY,CAChB,CACJ,EACAlB,MAAO,CACHE,cAAejL,MACnB,EACAkM,QAAS,WAGLf,AAFW,IAAI,CAEVW,CAAC,CAACK,OAAO,CAAG7X,EAAE,cAAc0C,GAAG,GACpCmU,AAHW,IAAI,CAGVW,CAAC,CAACM,MAAM,CAAG9X,EAAE,aAAa0C,GAAG,GAClCmU,AAJW,IAAI,CAIVW,CAAC,CAACO,WAAW,CAAG/X,EAAE,mBAAmB0C,GAAG,EACjD,EACAsV,SAAU,CACNC,UAAW,WACP,OAAO,IAAI,CAACtO,KAAK,CAAC/H,MAAM,AAC5B,CACJ,EACAgV,QAAS,WACL,IAAIC,EAAO,IAAI,CAEf7W,EADkBoD,SAAS2T,cAAc,CAACF,EAAKF,aAAa,EAAI,eACjDK,IAAI,CAAC,gBAAiB,SAAUjV,CAAC,CAAE4F,CAAI,EAC7CA,EAAKgC,KAAK,EAGfhC,EAAKgC,KAAK,CAACuO,OAAO,CAAC,SAAUC,CAAO,EACZtB,EAAKlN,KAAK,CAACyO,IAAI,CAAC,SAAUC,CAAC,EAC3C,OAAOA,EAAE5V,IAAI,EAAI0V,EAAQ1V,IAAI,AACjC,GAKI6V,QAAQ7K,KAAK,CAAC,qDAAuD0K,EAAQ1V,IAAI,EAFjFoU,EAAKlN,KAAK,CAACF,IAAI,CAAC,CAAEhH,KAAM0V,EAAQ1V,IAAI,CAAEwU,WAAY,EAAGK,aAAc,EAAG,EAI9E,EACJ,GAEAH,IAAIoB,GAAG,CAAC,iBAAkB,SAAUC,CAAU,EAC1C3B,EAAKlN,KAAK,CAACuO,OAAO,CAAC,SAAUzE,CAAI,CAAElR,CAAK,CAAEkW,CAAK,EACvChF,EAAKhR,IAAI,EAAI+V,EAAW/V,IAAI,EAC5BgW,EAAMC,MAAM,CAACnW,EAAO,EAE5B,EACJ,GAEA4U,IAAIoB,GAAG,CAAC,gBAAiB,SAAUC,CAAU,EACzC3B,EAAK8B,WAAW,EACpB,EACJ,EACAtB,QAAS,CACLsB,YAAa,WACT,IAAI,CAAChB,UAAU,CAAG,IAAI,CAAChO,KAAK,CAACiP,MAAM,CAAC,SAAUnF,CAAI,EAC9C,MAAOA,AAAqB,IAArBA,EAAK6D,YAAY,AAC5B,GAAG1V,MAAM,CACT,IAAI,CAAC8V,YAAY,CAAG,IAAI,CAAC/N,KAAK,CAAC/H,MAAM,CAAG,IAAI,CAAC+V,UAAU,CACnD,IAAI,CAAChO,KAAK,CAAC/H,MAAM,CAAG,GACpB,CAAA,IAAI,CAAC6V,QAAQ,CAAG,CAAA,CAAI,CAE5B,EACAM,YAAa,WACT,IAAI,CAACpO,KAAK,CAAG,IAAI,CAACA,KAAK,CAACiP,MAAM,CAAC,SAAUnF,CAAI,EACzC,MAAOA,AAAqB,IAArBA,EAAK6D,YAAY,AAC5B,EACJ,CACJ,EACAuB,MAAO,CACHlP,MAAO,WACH,IAAI,CAACgP,WAAW,EACpB,CACJ,CACJ,GAKA,IAAMG,QAAU,CACZC,MAAO,sBACPC,IAAK,yBACLC,KAAM,0BACNC,WAAY,gCACZC,MAAO,2BACPC,IAAK,qBACLC,MAAO,2BACPC,MAAO,2BACPC,QAAS,4BACTC,KAAM,0BACN/V,KAAM,2BACNoG,KAAM,oBACV,EAEM4P,aAAe,CACjBC,IAAKZ,QAAQC,KAAK,CAClBY,KAAMb,QAAQC,KAAK,CACnBa,IAAKd,QAAQC,KAAK,CAClBc,IAAKf,QAAQC,KAAK,CAClBC,IAAKF,QAAQE,GAAG,CAChBc,IAAKhB,QAAQG,IAAI,CACjBc,KAAMjB,QAAQG,IAAI,CAClBe,IAAKlB,QAAQI,UAAU,CACvBe,KAAMnB,QAAQI,UAAU,CACxBgB,IAAKpB,QAAQK,KAAK,CAClBgB,KAAMrB,QAAQK,KAAK,CACnBC,IAAKN,QAAQM,GAAG,CAChBgB,IAAKtB,QAAQO,KAAK,CAClBgB,IAAKvB,QAAQO,KAAK,CAClBiB,IAAKxB,QAAQO,KAAK,CAClBkB,IAAKzB,QAAQQ,KAAK,CAClBkB,IAAK1B,QAAQQ,KAAK,CAClBmB,IAAK3B,QAAQQ,KAAK,CAClBoB,IAAK5B,QAAQQ,KAAK,CAClBqB,KAAM7B,QAAQQ,KAAK,CACnBsB,GAAI9B,QAAQS,OAAO,CACnBsB,IAAK/B,QAAQS,OAAO,CACpBuB,IAAKhC,QAAQU,IAAI,CACjB9V,KAAMoV,QAAQU,IAAI,CAClBuB,GAAIjC,QAAQU,IAAI,CAChBwB,IAAKlC,QAAQrV,IAAI,AACrB,EAEA,SAASwX,yBAAyBC,CAAS,EACvC,OAAOzB,YAAY,CAACyB,EAAUnF,WAAW,GAAG,EAAI+C,QAAQjP,IAAI,AAChE,CAEA,SAASsR,wBAAwBC,CAAQ,EACrC,OAAOA,EAAS3V,KAAK,CAAC,AAAC2V,CAAAA,EAASC,WAAW,CAAC,KAAO,IAAM,CAAA,EAAK,EAClE,CAEA,SAASC,wBAAwBF,CAAQ,EACrC,OAAOH,yBAAyBE,wBAAwBC,GAC5D,CAOA9E,IAAIC,SAAS,CAAC,QAAS,CACnBC,SAAU;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,CAAC,CACLC,MAAO,CACH8E,YAAanI,KACjB,EACAzL,KAAM,WACF,MAAO,CACH6T,SAAU,GACVC,gBAAiB,CAAC,GAAI,GAAI,GAAI,IAAI,CAClCC,QAAS,EACTlE,EAAG,CAAC,CACR,CACJ,EACAI,QAAS,WAILf,AAHW,IAAI,CAGVW,CAAC,CAACmE,gBAAgB,CAAG3b,EAAE,yBAAyB0C,GAAG,GACxDmU,AAJW,IAAI,CAIVW,CAAC,CAACoE,mBAAmB,CAAG5b,EAAE,4BAA4B0C,GAAG,GAC9DmU,AALW,IAAI,CAKVW,CAAC,CAACqE,eAAe,CAAG7b,EAAE,wBAAwB0C,GAAG,GACtDmU,AANW,IAAI,CAMVW,CAAC,CAACsE,eAAe,CAAG9b,EAAE,wBAAwB0C,GAAG,GACtDmU,AAPW,IAAI,CAOVW,CAAC,CAACuE,kBAAkB,CAAG/b,EAAE,4BAA4B0C,GAAG,GAC7DmU,AARW,IAAI,CAQVW,CAAC,CAACwE,cAAc,CAAGhc,EAAE,uBAAuB0C,GAAG,GACpDmU,AATW,IAAI,CASVW,CAAC,CAACyE,eAAe,CAAGjc,EAAE,wBAAwB0C,GAAG,EAC1D,EACA2U,QAAS,CACL6E,KAAM,WACF,IAAI,CAACR,OAAO,CAAG,IAAI,CAACA,OAAO,CAAG,CAClC,EACAS,SAAU,WACN,IAAI,CAACT,OAAO,CAAG,IAAI,CAACA,OAAO,CAAG,CAClC,EACAU,QAAS,WACL,IAAI,CAACV,OAAO,CAAG,CACnB,EACAW,OAAQ,WACJ,IAAI,CAACX,OAAO,CAAG,IAAI,CAACY,UAAU,CAAG,CACrC,EACAC,KAAM,SAAUC,CAAU,EACtB,IAAI,CAACd,OAAO,CAAGc,CACnB,CACJ,EACAxE,SAAU,CACNpO,MAAO,WACH,OAAO,IAAI,CAAC2R,WAAW,CAAG,IAAI,CAACA,WAAW,CAAC3Z,MAAM,CAAG,CACxD,EACA0a,WAAY,WACR,IAAIG,EAAQ7R,KAAK8R,IAAI,CAAC,IAAI,CAAC9S,KAAK,CAAG,IAAI,CAAC4R,QAAQ,EAChD,OAAOiB,EAAQ,EAAIA,EAAQ,CAC/B,EACAE,WAAY,WACR,OAAO,IAAI,CAACjB,OAAO,CAAG,GAAK,IAAI,CAACY,UAAU,AAC9C,EACAM,YAAa,WACT,OAAO,AAAiB,IAAjB,IAAI,CAAClB,OAAO,AACvB,EACAmB,UAAW,WACP,MAAO,CAAC,IAAI,CAACF,UAAU,AAC3B,EACAG,UAAW,WACP,MAAO,CAAC,IAAI,CAACF,WAAW,AAC5B,EACAG,WAAY,WACR,MAAO,CAAC,IAAI,CAACH,WAAW,AAC5B,EACAI,UAAW,WACP,MAAO,CAAC,IAAI,CAACL,UAAU,AAC3B,EAIAM,mBAAoB,WAChB,IAAIC,EAAQ,IAAI,CAAC1B,QAAQ,CAAG,IAAI,CAACE,OAAO,CACpCyB,EAAMD,EAAQ,IAAI,CAAC1B,QAAQ,CAC3B/L,EAAS,IAAI,CAAC8L,WAAW,CAAC9V,KAAK,CAACyX,EAAOC,GAE3C,OADAhG,IAAIC,KAAK,CAAC,aAAc3H,GACjBA,CACX,EACA2N,UAAW,WAEP,IAAIC,EAAQ,EAAE,CAmBd,OAjBAA,EAAM5T,IAAI,CAAC,IAAI,CAACiS,OAAO,CAAG,GAI1B2B,EAAMC,OAAO,CADO,IAAI,CAAC5B,OAAO,CAAG,EAAI,IAAI,CAACA,OAAO,CAAG,IAItD2B,EAAMC,OAAO,CADa,IAAI,CAAC5B,OAAO,CAAG,EAAI,IAAI,CAACA,OAAO,CAAG,EAAI,IAMhE2B,EAAM5T,IAAI,CADS,IAAI,CAAC6S,UAAU,CAAG,IAAI,CAACZ,OAAO,CAAG,EAAI,IAAI,CAACA,OAAO,CAAG,EAAI,IAI3E2B,EAAM5T,IAAI,CADc,IAAI,CAAC6S,UAAU,CAAG,IAAI,CAACZ,OAAO,CAAG,EAAI,IAAI,CAACA,OAAO,CAAG,EAAI,IAGzE2B,CACX,CACJ,EACAxE,MAAO,CACH0C,YAAa,WACT,IAAI,CAACG,OAAO,CAAG,CACnB,EACAF,SAAU,WACN,IAAI,CAACE,OAAO,CAAG,CACnB,CACJ,CACJ,GAIApF,IAAIC,SAAS,CAAC,gBAAiB,CAC3BC,SAAU;AACd;AACA;AACA;AACA;AACA,QAAQ,CAAC,CACLC,MAAO,CACH8G,QAAS7R,OACT8R,gBAAiB9R,OACjB+R,IAAKC,OACT,EACA1F,SAAU,CACN2F,SAAU,WACN,OAAO,IAAI,CAACJ,OAAO,CAACxH,WAAW,IAAM,IAAI,CAACyH,eAAe,CAACzH,WAAW,EACzE,CACJ,CACJ,GAIAO,IAAIC,SAAS,CAAC,SAAU,CACpBC,SAAU;AACd;AACA;AACA;AACA;AACA;AACA,wDAAwD,EAAEpT,AAAgB,OAAhBA,SAASwa,GAAG,CAAY,OAAS,QAAQ;AACnG,+JAA+J,EAAExa,AAAgB,OAAhBA,SAASwa,GAAG,CAAY,QAAU,OAAO;AAC1M;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,CAAC,CACLnH,MAAO,CACHC,MAAOpM,OACPuT,mBAAoBvT,OACpBwT,MAAOzV,MACX,EACAV,KAAM,WACF,MAAO,CACHoW,KAAM,CAAA,EACNC,SAAU,KACVC,OAAQ,KACRC,UAAW,CAAA,EACXC,QAAS,CACb,CACJ,EACAnG,SAAU,CACNoG,MAAO,WACH,MAAO,CAAC,IAAI,CAACJ,QAAQ,EAAI,AAAwB,GAAxB,IAAI,CAACA,QAAQ,CAACpc,MAAM,AACjD,EACAyc,WAAY,WACR,OAAO,AAAC,IAAI,CAACR,kBAAkB,CAACpb,IAAI,EAAI,IAAI,CAACiU,KAAK,CAACjU,IAAI,EAAM,IAAI,CAACob,kBAAkB,CAACxL,IAAI,EAAI,IAAI,CAACqE,KAAK,CAACrE,IAAI,AAChH,EACAiM,OAAQ,WACJ,MAAO,AAAoB,KAApB,IAAI,CAAC5H,KAAK,CAACrE,IAAI,AAC1B,EACAkM,gBAAiB,WACb,OAAO,AAA+Bvc,KAAAA,IAA/B,IAAI,CAAC0U,KAAK,CAAC6H,eAAe,EAAiB,IAAI,CAAC7H,KAAK,CAAC6H,eAAe,AAChF,EACAC,gBAAiB,WACb,OAAO,AAA+Bxc,KAAAA,IAA/B,IAAI,CAAC0U,KAAK,CAAC8H,eAAe,EAAiB,IAAI,CAAC9H,KAAK,CAAC8H,eAAe,AAChF,CACJ,EACA5H,QAAS,WACe,CAAA,GAAf,IAAI,CAAC0H,MAAM,EAAe,IAAI,CAACG,0BAA0B,IAC1D,IAAI,CAACC,MAAM,GAGf,IAAI,CAACP,OAAO,CAAG,IAAI,CAACL,KAAK,CAAG,EAAK,GAAK,GAAM,AAAa,EAAb,IAAI,CAACA,KAAK,AAC1D,EACAlG,QAAS,WACL,IAAIf,EAAO,IAAI,CACfM,IAAIoB,GAAG,CAAC,eAAgB,SAAUoG,CAAM,EACpC,GAAI9H,EAAKmH,QAAQ,CAAE,CACf,IAAIzb,EAAQsU,EAAKmH,QAAQ,EAAInH,EAAKmH,QAAQ,CAACY,OAAO,CAACD,GAC/Cpc,EAAQ,KACRsU,EAAKmH,QAAQ,CAACtF,MAAM,CAACnW,EAAO,GAC5B4U,IAAIC,KAAK,CAAC,iBAElB,CACJ,GAEAD,IAAIoB,GAAG,CAAC,YAAa,SAAUvE,CAAM,CAAE2K,CAAM,EACrC9H,EAAKH,KAAK,EAAI1C,IACQ,OAAlB6C,EAAKmH,QAAQ,EACbnH,EAAKmH,QAAQ,CAACvU,IAAI,CAACkV,GAEvBA,EAAOV,MAAM,CAAGpH,EAAKH,KAAK,CAC1BS,IAAIC,KAAK,CAAC,cAAeuH,GAEjC,EACJ,EACAtH,QAAS,CACLoH,2BAA4B,WAExB,IADAI,aAAeC,SAASC,cAAc,CAC/BF,cAAc,CACjB,GAAIA,aAAaxM,IAAI,EAAI,IAAI,CAACqE,KAAK,CAACrE,IAAI,CACpC,MAAO,CAAA,EAEfwM,aAAeA,aAAaZ,MAAM,AAClC,CAEA,MAAO,CAAA,CACX,EACAS,OAAQ,WACJ,IAAI,CAACX,IAAI,CAAG,CAAC,IAAI,CAACA,IAAI,CAClB,IAAI,CAACA,IAAI,EAAI,CAAC,IAAI,CAACC,QAAQ,EAC3B,IAAI,CAACgB,YAAY,EAEzB,EACAC,OAAQ,WACJ9H,IAAIC,KAAK,CAAC,iBAAkB,IAAI,CAACV,KAAK,EACtC,IAAI,CAACsI,YAAY,EACrB,EACAE,aAAc,WACV/H,IAAIC,KAAK,CAAC,wBACd,EACA+H,aAAc,WACVhI,IAAIC,KAAK,CAAC,wBACd,EACA4H,aAAc,WACV,IAAInI,EAAO,IAAI,AACE,EAAA,GAAb,IAAI,CAACkH,IAAI,EACT,CAAA,IAAI,CAACA,IAAI,CAAG,CAAA,CAAG,EAEnB/d,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,kBAAkB0C,GAAG,GAAK,SAAW0c,mBAAmBvI,EAAKH,KAAK,CAACrE,IAAI,EAC9EgN,OAAQ,MACR7R,QAAS,SAAU7F,CAAI,EACnBkP,EAAKmH,QAAQ,CAAGrW,EAChBkP,EAAKmH,QAAQ,CAAC9F,OAAO,CAAC,SAAUoH,CAAC,EAC7BA,EAAErB,MAAM,CAAGpH,EAAKH,KAAK,AACzB,EACJ,EACAjJ,MAAO,SAAUA,CAAK,EAClB8R,MAAQ,CAAA,EACRjH,QAAQ7K,KAAK,CAACA,EAAM+R,YAAY,CACpC,CACJ,EACJ,EACAC,eAAgB,SAAU1d,CAAC,EACvB,IAAI,CAACmc,SAAS,CAAG,CAAA,CACrB,EACAwB,gBAAiB,SAAU3d,CAAC,EACxB,IAAI,CAACmc,SAAS,CAAG,CAAA,CACrB,EACAyB,kBAAmB,SAAUhB,CAAM,CAAE5c,CAAC,EAGlC8U,AADW,IAAI,CACVqH,SAAS,CAAG,CAAA,EAEjB,IAAI0B,EAAaxf,KAAKyf,KAAK,CAAC9d,EAAEqC,YAAY,CAAC0b,OAAO,CAAC,eAEnD,IAAIF,CAAAA,EAAWhe,MAAM,CAAG,CAAA,GAIxB,IAAIme,EAAehe,EAAEqC,YAAY,CAAC0b,OAAO,CAAC,gBACtCE,EAAerB,EAAOtM,IAAI,CAU9B,GARqB,KAAjB0N,GACAA,CAAAA,EAAe,MAAK,EAGH,KAAjBC,GACAA,CAAAA,EAAe,MAAK,EAGpBD,IAAiBC,EAAc,CAC/BC,MAAMjgB,EAAE,sBAAsB0C,GAAG,IACjC,MACJ,CAEAwd,cAAc,CAAC,GAAGlgB,EAAE,cAAc2H,IAAI,EAAE,CAAEwY,SAAU,SAAUC,CAAI,EAC1DA,GACApgB,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,qBAAqB0C,GAAG,GAC/B2c,OAAQ,OACR1X,KAAM,CACF0Y,2BAA4BrgB,EAAE,4CAA4C0C,GAAG,GAC7Ekd,WAAYA,EACZG,aAAcA,EACdC,aAAcA,CAClB,EACAxS,QAAS,WACL2J,IAAIC,KAAK,CAAC,iBACd,EACA3J,MAAO,SAAUA,CAAK,EAClB6K,QAAQ7K,KAAK,CAACA,EAAM+R,YAAY,EAChCrI,IAAIC,KAAK,CAAC,iBAAkB3J,EAAM+R,YAAY,CAClD,CACJ,EAER,CAAC,GACL,CAEJ,CACJ,GAIAlJ,IAAIC,SAAS,CAAC,oBAAqB,CAC/BC,SAAU;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,CAAC,CACL7O,KAAM,WACF,MAAO,CACH6P,EAAG,CAAC,CACR,CACJ,EACAf,MAAO,CACH6J,OAAQ5U,OACR6U,QAAS7C,QACT8C,mBAAoBpN,MACpBqN,eAAgBrN,MAChBsN,UAAWrY,MACf,EACAuP,QAAS,WAELf,AADW,IAAI,CACVW,CAAC,CAACmJ,WAAW,CAAG3gB,EAAE,mBAAmB0C,GAAG,GAC7CmU,AAFW,IAAI,CAEVW,CAAC,CAACoJ,UAAU,CAAG5gB,EAAE,kBAAkB0C,GAAG,GAC3CmU,AAHW,IAAI,CAGVW,CAAC,CAACqJ,gBAAgB,CAAG7gB,EAAE,wBAAwB0C,GAAG,GACvDmU,AAJW,IAAI,CAIVW,CAAC,CAACsJ,UAAU,CAAG9gB,EAAE,kBAAkB0C,GAAG,GAC3CmU,AALW,IAAI,CAKVW,CAAC,CAACuJ,UAAU,CAAG/gB,EAAE,kBAAkB0C,GAAG,GAC3CmU,AANW,IAAI,CAMVW,CAAC,CAACwJ,UAAU,CAAGhhB,EAAE,kBAAkB0C,GAAG,GAC3CmU,AAPW,IAAI,CAOVW,CAAC,CAACyJ,YAAY,CAAGjhB,EAAE,oBAAoB0C,GAAG,GAC/CmU,AARW,IAAI,CAQVW,CAAC,CAAC0J,UAAU,CAAGlhB,EAAE,kBAAkB0C,GAAG,EAC/C,EACA2U,QAAS,CACL8J,gBAAiB,SAAUC,CAAK,EAI5B,OAHa,IAAI,CAACX,cAAc,CAACrI,IAAI,CAAC,SAAU9G,CAAO,CAAE/O,CAAK,CAAEkW,CAAK,EACjE,OAAOnH,EAAQpQ,GAAG,CAAC6U,WAAW,KAAOqL,EAAMlgB,GAAG,CAAC6U,WAAW,EAC9D,EAEJ,EACAsL,cAAe,SAAUngB,CAAG,CAAEwf,CAAS,EACnC,OAAOxf,EAAOA,CAAAA,AAAoB,IAApBA,EAAI0d,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,SAAW8B,EAAY,WAAaA,CAC5F,EACAY,WAAY,SAAUC,CAAO,EACzBpK,IAAIC,KAAK,CAAC,sBAAuBmK,EACrC,EACAC,uBAAwB,SAAUJ,CAAK,EACnCjK,IAAIC,KAAK,CAAC,uBAAwBgK,EACtC,EACAK,YAAa,SAAUL,CAAK,EACxBjK,IAAIC,KAAK,CAAC,uBAAwBgK,EACtC,EACAM,YAAa,SAAUN,CAAK,EACxBjK,IAAIC,KAAK,CAAC,uBAAwBgK,EACtC,EACAO,UAAW,SAAUP,CAAK,CAAErf,CAAC,EACzBoV,IAAIC,KAAK,CAAC,0BAA2BgK,EAAOrf,EAChD,EACA6f,cAAe,SAAUC,CAAU,EAE/B,OAAOC,AADC,IAAI/Y,KAAK8Y,GACRE,cAAc,EAC3B,EACAC,mCAAmC,SAA4C5G,CAAQ,CAAE6G,CAAS,EAC7F,OAAS3G,wBAAwBF,GAAY,IAAM6G,CACxD,CACJ,CACJ,GAIA3L,IAAIC,SAAS,CAAC,mBAAoB,CAC9BC,SAAU;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,CAAC,CACL7O,KAAM,WACF,MAAO,CACH6P,EAAG,CAAC,CACR,CACJ,EACAf,MAAO,CACH+J,mBAAoBpN,MACpBqN,eAAgBrN,MAChBsN,UAAWrY,MACf,EACAuP,QAAS,WAGLf,AAFW,IAAI,CAEVW,CAAC,CAACwJ,UAAU,CAAGhhB,EAAE,kBAAkB0C,GAAG,GAC3CmU,AAHW,IAAI,CAGVW,CAAC,CAACyJ,YAAY,CAAGjhB,EAAE,oBAAoB0C,GAAG,EACnD,EACA2U,QAAS,CACL8J,gBAAiB,SAAUC,CAAK,EAI5B,OAHa,IAAI,CAACX,cAAc,CAACrI,IAAI,CAAC,SAAU9G,CAAO,CAAE/O,CAAK,CAAEkW,CAAK,EACjE,OAAOnH,EAAQpQ,GAAG,CAAC6U,WAAW,KAAOqL,EAAMlgB,GAAG,CAAC6U,WAAW,EAC9D,EAEJ,EACAsL,cAAe,SAAUngB,CAAG,CAAEwf,CAAS,EACnC,OAAOxf,EAAOA,CAAAA,AAAoB,IAApBA,EAAI0d,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,SAAW8B,EAAY,WAAaA,CAC5F,EACAc,uBAAwB,SAAUJ,CAAK,EACnCjK,IAAIC,KAAK,CAAC,uBAAwBgK,EACtC,EACAK,YAAa,SAAUL,CAAK,EACxBjK,IAAIC,KAAK,CAAC,uBAAwBgK,EACtC,EACAM,YAAa,SAAUN,CAAK,EACxBjK,IAAIC,KAAK,CAAC,uBAAwBgK,EACtC,EACAO,UAAW,SAAUP,CAAK,CAAErf,CAAC,EACzBoV,IAAIC,KAAK,CAAC,0BAA2BgK,EAAOrf,EAChD,EACAigB,mCAAmC,SAA4C5G,CAAQ,CAAE6G,CAAS,EAC9F,OAAO3G,wBAAwBF,GAAY,IAAM6G,CACrD,CACJ,CACJ,GAGAjiB,EAAEoD,UAAUhC,EAAE,CAAC,iBAAkB,WAC7B,IAAI8gB,EAAsBC,aAE1BniB,EAAE,eACG6H,UAAU,CAAC,CACRhC,SAAU7F,EAAE,aACZqG,uBAAwB,GACxBiG,SAAU,OACVpL,IAAKlB,EAAE,gBAAgB0C,GAAG,GAC1BiE,aAAc0B,OAAOrI,EAAE,uBAAuB0C,GAAG,IAAM,GACvDL,SAAU,WACN,IAAI+f,EAAmBpiB,EAAE,0CAA0C0C,GAAG,GAEtE,MAAO,CACH,CAAED,KAAM,OAAQE,MAAOmc,SAASC,cAAc,CAAC1M,IAAI,AAAC,EACpD,CAAE5P,KAAM,6BAA8BE,MAAOyf,CAAiB,EAC9D,CAAE3f,KAAM,wBAAyBE,MAAOuf,CAAoB,EAC/D,AACL,EACAna,KAAM,SAAUhG,CAAC,CAAE4F,CAAI,EACnB3H,EAAEsC,IAAI,CAACqF,EAAK8H,MAAM,CAAC9F,KAAK,CAAE,SAAUpH,CAAK,CAAEsH,CAAI,EACtCA,EAAK4D,KAAK,EACXqR,SAASuD,UAAU,CAAC5Y,IAAI,CAACI,EAEjC,EACJ,CACJ,GACCzI,EAAE,CAAC,4BAA6B,CAACW,EAAGzB,KACjC,IAAIuJ,EAAOvJ,EAAQqJ,KAAK,CAAC,EAAE,AAE3BrJ,CAAAA,EAAQ0L,IAAI,CAAG,IAAIsW,KACf,CAAChiB,EAAQ0L,IAAI,CAAC,CACdnC,EAAKpH,IAAI,CACT,CACItB,KAAM0I,EAAK1I,IAAI,CACfohB,aAAc1Y,EAAK0Y,YAAY,AACnC,EACR,EACR,GAGAviB,EAAEoD,UAAU4T,IAAI,CAAC,WAAY,SAAUjV,CAAC,EACpC,IAAIygB,EAAKzgB,EAAEsC,aAAa,CAACD,YAAY,CACrC,GAAIoe,EAAGje,KAAK,EAAKie,CAAAA,EAAGje,KAAK,CAACqa,OAAO,CAAG4D,AAA6B,IAA7BA,EAAGje,KAAK,CAACqa,OAAO,CAAC,SAAiB4D,EAAGje,KAAK,CAACke,QAAQ,CAAC,QAAO,EAAI,CAC/F,IAAI5c,EAAW7F,EAAE,mBACbmI,EAAUrI,OAAO4iB,eAAe,CAChCva,EACAwa,aAAaxa,GAEbtC,EAAS+c,QAAQ,CAAC,MAEA5iB,EAAE+B,EAAEiS,MAAM,EAAE6O,OAAO,CAAChd,GAC1C/F,OAAO4iB,eAAe,CAAGxgB,WAAW,WAChCpC,OAAO4iB,eAAe,CAAG,KACzB7c,EAASid,WAAW,CAAC,KACzB,EAAG,IACP,CACJ,GAMA,IAHIC,YACAjE,SAEA3H,IAAM,IAAIb,IAEd,SAAS0M,2BAA2BC,CAAuB,CAAEC,CAAmB,CAAEC,CAAQ,GAElFJ,cAIJA,YAAc,CAAA,EAETG,GACD5K,QAAQ7K,KAAK,CAAC,+CAGlBzN,EAAEwP,IAAI,CAAC,CACHtO,IAAKgiB,EACL7D,OAAQ,MACR7R,QAAS,SAAU4V,CAAO,EACtBpjB,EAAE,eAAe+C,MAAM,CAACqgB,GAExBpjB,EAAEoD,UAAU4O,OAAO,CAAC,0BAEpB,IAAIqR,EAAO,CACP5gB,KAAMzC,EAAE,mBAAmByD,IAAI,GAC/B4O,KAAM,GACNsM,OAAQ,GACR1L,YAAa,CAAA,EACbsL,gBAAiBve,AAAoC,SAApCA,EAAE,wBAAwB0C,GAAG,EAClD,EAEAoc,SAAW,IAAIxI,IAAI,CACfpE,GAAI,YACJvK,KAAM,CACFoX,eAAgB,CAAC,EACjBsD,WAAY,EAAE,CACd5B,eAAgB,EAAE,CAClB3I,OAAQ,EAAE,CACVwL,kBAAmB,IAAIC,MACvBC,YAAa,CAAA,EACbC,SAAU,CAAA,EACVC,YAAa,GACbpD,OAAQ,GACRC,QAAS,CAAA,EACToD,YAAa,EAAE,AACnB,EACA/L,QAAS,WACL,IAAIf,EAAO,IAAI,CAsEf,GApEAA,EAAKyM,iBAAiB,CAACM,GAAG,CAAG,AAACT,CAAAA,GAAY,EAAC,EAAK,+CAEhDhM,IAAIoB,GAAG,CAAC,iBAAkB,SAAUoG,CAAM,EACtC9H,EAAKkI,cAAc,CAAGJ,CAC1B,GAEAxH,IAAIoB,GAAG,CAAC,gBAAiB,WACrB1B,EAAKgN,UAAU,EACnB,GAEA1M,IAAIoB,GAAG,CAAC,cAAe,SAAUoG,CAAM,EACnC9H,EAAKkI,cAAc,CAAGJ,EACtBA,EAAOmF,QAAQ,CAAG,CAAA,CACtB,GAEA3M,IAAIoB,GAAG,CAAC,iBAAkB,SAAUwL,CAAS,EACzClN,EAAKmN,UAAU,CAACnN,EAAKkI,cAAc,EAC/BgF,GACAlN,EAAKiB,MAAM,CAACrO,IAAI,CAACsa,EAEzB,GAEA5M,IAAIoB,GAAG,CAAC,eAAgB,SAAU0L,CAAO,CAAEC,CAAO,CAAEC,CAAO,CAAEC,CAAM,EAC/D,IAAIhD,EAAQvK,EAAKwL,UAAU,CAACzJ,MAAM,CAAC,SAAUnF,CAAI,EAC7C,OAAOA,EAAK4Q,SAAS,GAAKF,CAC9B,EAAE,CAAC,EAAE,AAEL/C,CAAAA,EAAMiD,SAAS,CAAGH,EAClB9C,EAAM3e,IAAI,CAAGwhB,EACb7C,EAAMlgB,GAAG,CAAGkjB,CAChB,GAEAjN,IAAIoB,GAAG,CAAC,wBAAyB,SAAU6I,CAAK,EAC5CvK,EAAKqI,YAAY,EACrB,GAEA/H,IAAIoB,GAAG,CAAC,wBAAyB,SAAU6I,CAAK,EAC5CvK,EAAKsI,YAAY,EACrB,GAGAhI,IAAIoB,GAAG,CAAC,sBAAuB,SAAUgJ,CAAO,EAC5C1K,EAAKyK,UAAU,CAACC,EACpB,GAEApK,IAAIoB,GAAG,CAAC,uBAAwB,SAAU6I,CAAK,EAC3CvK,EAAK2K,sBAAsB,CAACJ,EAChC,GAEAjK,IAAIoB,GAAG,CAAC,uBAAwB,SAAU6I,CAAK,EAC3CvK,EAAK4K,WAAW,CAACL,EACrB,GAEAjK,IAAIoB,GAAG,CAAC,uBAAwB,SAAU6I,CAAK,EAC3CvK,EAAKyN,eAAe,CAAClD,EACzB,GAEAjK,IAAIoB,GAAG,CAAC,0BAA2B,SAAU6I,CAAK,CAAErf,CAAC,EACjD8U,EAAK0N,eAAe,CAACnD,EAAOrf,EAChC,GAIAoV,IAAIoB,GAAG,CAAC,aAAc,SAAUoL,CAAW,EACvC9M,EAAK8M,WAAW,CAAGA,EACnB9M,EAAK4J,cAAc,CAAG,EAAE,AAC5B,GAEI,CAAC+D,aAAaC,OAAO,CAAC,yBAA0B,CAChD5N,EAAKkI,cAAc,CAAGsE,EACtB,MACJ,CAEAxM,EAAK6N,YAAY,CAAGtkB,KAAKyf,KAAK,CAAC2E,aAAaC,OAAO,CAAC,yBACxD,EACAzM,SAAU,CACN2M,OAAQ,WACJ,OAAO,IAAI,CAAC5F,cAAc,EAAIsE,CAClC,EACAuB,QAAS,WACL,IAAIC,EAAI,EAAE,CAEV,IADAhG,aAAe,IAAI,CAACE,cAAc,CAC3BF,cAAgBA,AAAqB,IAArBA,aAAaxM,IAAI,EACpCwS,EAAEvH,OAAO,CAACuB,cACVA,aAAeA,aAAaZ,MAAM,CAEtC,OAAO4G,CACX,EACAxB,KAAM,WACF,OAAOA,CACX,EACA7C,mBAAoB,WAChB,IAAI3J,EAAO,IAAI,AAEfA,CAAAA,EAAK4J,cAAc,CAAG,EAAE,CAExB,IAAIqE,EAAWjO,EAAKwL,UAAU,CAACzJ,MAAM,CAAC,SAAUnF,CAAI,EAChD,OAAOA,EAAKhR,IAAI,CAACsT,WAAW,GAAG6I,OAAO,CAAC/H,EAAK6M,WAAW,CAAC3N,WAAW,IAAM,EAC7E,GAEA,OAAQc,EAAKyJ,MAAM,EACf,IAAK,OACDwE,EAASC,IAAI,CAAC,SAAUC,CAAC,CAAEC,CAAC,EACxB,OAAOpO,EAAK0J,OAAO,CAAGyE,EAAElb,IAAI,CAAGmb,EAAEnb,IAAI,CAAGmb,EAAEnb,IAAI,CAAGkb,EAAElb,IAAI,AAC3D,GACA,KACJ,KAAK,OACDgb,EAASC,IAAI,CAAC,SAAUC,CAAC,CAAEC,CAAC,EACxB,OAAOpO,EAAK0J,OAAO,CAAGyE,EAAEE,IAAI,CAACnP,WAAW,GAAGoP,aAAa,CAACF,EAAEC,IAAI,CAACnP,WAAW,IAAMkP,EAAEC,IAAI,CAACnP,WAAW,GAAGoP,aAAa,CAACH,EAAEE,IAAI,CAACnP,WAAW,GAC1I,GACA,KACJ,KAAK,aACD+O,EAASC,IAAI,CAAC,SAAUC,CAAC,CAAEC,CAAC,EACxB,OAAOpO,EAAK0J,OAAO,CAAGyE,EAAEI,UAAU,CAAGH,EAAEG,UAAU,CAAGH,EAAEG,UAAU,CAAGJ,EAAEI,UAAU,AACnF,GACA,KACJ,SACIN,EAASC,IAAI,CAAC,SAAUC,CAAC,CAAEC,CAAC,EACxB,OAAOpO,EAAK0J,OAAO,CAAGyE,EAAEviB,IAAI,CAACsT,WAAW,GAAGoP,aAAa,CAACF,EAAExiB,IAAI,CAACsT,WAAW,IAAMkP,EAAExiB,IAAI,CAACsT,WAAW,GAAGoP,aAAa,CAACH,EAAEviB,IAAI,CAACsT,WAAW,GAC1I,EACR,CAEA,OAAO+O,CACX,EACAO,YAAa,WACT,IAAI5V,EAAS,EAEb,OADS,IAAI,CAAC4S,UAAU,CAACzgB,MAAM,CAAG,IAAI,CAAC4e,kBAAkB,CAAC5e,MAAM,AAEpE,EACA8e,UAAW,WACP,OAAO,IAAI,CAAC8C,WAAW,CAAG,IAAM,GACpC,EACAkB,aAAc,CACVY,IAAK,WACD,MAAO,CACH9B,YAAa,IAAI,CAACA,WAAW,CAC7BzE,eAAgB,IAAI,CAACA,cAAc,CACnC0E,SAAU,IAAI,CAACA,QAAQ,AAC3B,CACJ,EACA8B,IAAK,SAAUC,CAAQ,EACdA,IAIL,IAAI,CAAChC,WAAW,CAAGgC,EAAShC,WAAW,CACvC,IAAI,CAACzE,cAAc,CAAGyG,EAASzG,cAAc,CAC7C,IAAI,CAAC0E,QAAQ,CAAG+B,EAAS/B,QAAQ,CACrC,CACJ,CACJ,EACA5K,MAAO,CACH6L,aAAc,SAAUc,CAAQ,EAC5BhB,aAAaiB,OAAO,CAAC,wBAAyBrlB,KAAKslB,SAAS,CAACF,GACjE,EACAzG,eAAgB,SAAU4G,CAAS,EAC/B,IAAI,CAACjC,WAAW,CAAG,GACnB,IAAI,CAAC3E,cAAc,CAAG4G,EACtB,IAAI,CAAC3B,UAAU,CAAC2B,EACpB,CAEJ,EACA/O,QAAS,WACL,IAAI,CAACgP,KAAK,CAACC,UAAU,CAACnH,MAAM,EAChC,EACArH,QAAS,CACLyO,UAAW,WAEP,GAAI,CAAC,IAAI,CAAC/G,cAAc,CACpB,OAAO,KAGX,IAAIgH,EAAW/lB,EAAE,gBAAgB0C,GAAG,GAChCsjB,EAAoBhmB,EAAE,sBAAsB0C,GAAG,GAKnD,OAJIsjB,GAAqBA,AAAsB,KAAtBA,GACrBD,CAAAA,EAAWA,EAAYA,CAAAA,AAAyB,IAAzBA,EAASnH,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,cAAgBQ,mBAAmB4G,EAAiB,EAGnHD,EAAYA,CAAAA,AAAyB,IAAzBA,EAASnH,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,QAAUQ,mBAAmB,IAAI,CAACL,cAAc,CAAC1M,IAAI,CACvH,EACAwR,WAAY,WACR,IAAI,CAAC9E,cAAc,CAAG,IAAI,CAACsE,IAAI,AACnC,EACAW,WAAY,SAAUrF,CAAM,EACxB,IAAI,CAAC7G,MAAM,CAAG,EAAE,CAChB,IAAI,CAAC2I,cAAc,CAAG,EAAE,CACxB,IAAI5J,EAAO,IAAI,CACXoP,EAAWjmB,EAAE,qBAAqB0C,GAAG,GACrCsjB,EAAoBhmB,EAAE,sBAAsB0C,GAAG,GAC/CsjB,GAAqBA,AAAsB,KAAtBA,GACrBC,CAAAA,EAAWA,EAAYA,CAAAA,AAAyB,IAAzBA,EAASrH,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,cAAgBQ,mBAAmB4G,EAAiB,EAE1H1N,QAAQ4N,GAAG,CAACvH,EAAOtM,IAAI,EACvBrS,EAAEwP,IAAI,CAAC,CACHtO,IAAK+kB,EAAYA,CAAAA,AAAyB,IAAzBA,EAASrH,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,QAAUQ,mBAAmBT,EAAOtM,IAAI,EACpGgN,OAAQ,MACR7R,QAAS,SAAU7F,CAAI,EACnBA,EAAKuQ,OAAO,CAAC,SAAUzE,CAAI,EACvBA,EAAKsK,IAAI,CAAG,CAAA,CAChB,GACAlH,EAAKwL,UAAU,CAAG1a,EAClBkP,EAAK4J,cAAc,CAAG,EAAE,CACxB5J,EAAKyJ,MAAM,CAAG,GACdzJ,EAAK0J,OAAO,CAAG,CAAA,CACnB,EACA9S,MAAO,SAAUA,CAAK,EAClB6K,QAAQ4N,GAAG,CAAC,wBAA0BvH,EAAOtM,IAAI,EACjDwE,EAAKgN,UAAU,EACnB,CACJ,EACJ,EACAsC,QAAS,WAEDtP,AADO,IAAI,CACNkI,cAAc,EACnBlI,AAFO,IAAI,CAENmN,UAAU,CAACnN,AAFT,IAAI,CAEUkI,cAAc,CAE3C,EACAqH,UAAW,WACP,IAAI,CAAC3F,cAAc,CAAG,EAAE,CACxB,IAAK,IAAI7T,EAAI,EAAGA,EAAI,IAAI,CAAC4T,kBAAkB,CAAC5e,MAAM,CAAEgL,IAChD,IAAI,CAAC6T,cAAc,CAAChX,IAAI,CAAC,IAAI,CAAC+W,kBAAkB,CAAC5T,EAAE,CAE3D,EACAyZ,YAAa,WACT,IAAI,CAAC5F,cAAc,CAAG,EAAE,AAC5B,EACA6F,gBAAiB,WAEb,IAAK,IADDC,EAAO,EAAE,CACJ3Z,EAAI,EAAGA,EAAI,IAAI,CAAC4T,kBAAkB,CAAC5e,MAAM,CAAEgL,IACQ,CAAA,GAApD,IAAI,CAACuU,eAAe,CAAC,IAAI,CAACX,kBAAkB,CAAC5T,EAAE,GAC/C2Z,EAAK9c,IAAI,CAAC,IAAI,CAAC+W,kBAAkB,CAAC5T,EAAE,CAG5C,CAAA,IAAI,CAAC6T,cAAc,CAAG8F,CAC1B,EACA/E,uBAAwB,SAAUJ,CAAK,EAC/B,AAA+B,CAAA,GAA/B,IAAI,CAACD,eAAe,CAACC,GACrB,IAAI,CAACX,cAAc,CAAC/H,MAAM,CAAC,IAAI,CAAC+H,cAAc,CAAC7B,OAAO,CAACwC,GAAQ,GAE/D,IAAI,CAACX,cAAc,CAAChX,IAAI,CAAC2X,EAEjC,EACAD,gBAAiB,SAAUC,CAAK,EAI5B,OAHa,IAAI,CAACX,cAAc,CAACrI,IAAI,CAAC,SAAU9G,CAAO,CAAE/O,CAAK,CAAEkW,CAAK,EACjE,OAAOnH,EAAQpQ,GAAG,CAAC6U,WAAW,KAAOqL,EAAMlgB,GAAG,CAAC6U,WAAW,EAC9D,EAEJ,EACAoJ,aAAc,WACV,IAAIR,EAAS,IAAI,CAACI,cAAc,CAG5BJ,GAAU,IAAI,CAAC0E,IAAI,CAAC3M,KAAK,EAI7BwJ,cAAc,CACV,GAAGlgB,EAAE,iBAAiB2H,IAAI,EAAE,CAAEwY,SAAU,SAAUC,CAAI,EAC9CA,GACApgB,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,oBAAoB0C,GAAG,GAAK,SAAW0c,mBAAmBT,EAAOtM,IAAI,EAC5EgN,OAAQ,OACR1X,KAAM,CACF0Y,2BAA4BrgB,EAAE,4CAA4C0C,GAAG,EACjF,EACA8K,QAAS,SAAU7F,CAAI,EACnBwP,IAAIC,KAAK,CAAC,eAAgBuH,EAC9B,EACAlR,MAAO,SAAUA,CAAK,EAClB6K,QAAQ7K,KAAK,CAACA,EAAM+R,YAAY,CACpC,CACJ,EAER,CACJ,EACJ,EACAN,aAAc,WACVlf,EAAE,6BAA6Boe,KAAK,GAEpCoI,AADYC,UAAUC,KAAK,CAACC,mBAAmB,CAAC3mB,EAAE,uBAC5C4mB,IAAI,GACV5mB,EAAE,wCAAwC0C,GAAG,CAAC,IAAImkB,KAAK,EAC3D,EACApF,YAAa,SAAUL,CAAK,EACxBphB,EAAE,4BAA4Boe,KAAK,GAEnCoI,AADYC,UAAUC,KAAK,CAACC,mBAAmB,CAAC3mB,EAAE,sBAC5C4mB,IAAI,GACV5mB,EAAE,kBAAkB0C,GAAG,CAAC0e,EAAM3e,IAAI,EAClCzC,EAAE,uCAAuC0C,GAAG,CAAC0e,EAAM3e,IAAI,EAAEokB,KAAK,EAClE,EACAC,qBAAsB,SAAU1F,CAAK,EACjC,IAAI,CAACM,WAAW,EACpB,EACAqF,gBAAiB,WACb,IAAIC,EAAY,IAAI,CAACvG,cAAc,CAC/B5J,EAAO,IAAI,EAEXmQ,CAAAA,EAAUplB,MAAM,CAAG,CAAA,GAIvBse,cAAc,CACV,GAAGlgB,EAAE,gBAAgB2H,IAAI,EAAE,CAAEwY,SAAU,SAAUC,CAAI,EACjD,GAAIA,EAAM,CAEN,IAAK,IADD6G,EAAQ,EAAE,CACLra,EAAI,EAAGA,EAAIoa,EAAUplB,MAAM,CAAEgL,IAClCqa,EAAMxd,IAAI,CAACud,CAAS,CAACpa,EAAE,CAACyX,SAAS,EAGrCrkB,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,uBAAuB0C,GAAG,GACjC2c,OAAQ,OACR1X,KAAM,CACF0Y,2BAA4BrgB,EAAE,4CAA4C0C,GAAG,GAC7EukB,MAAOA,CACX,EACAzZ,QAAS,SAAU7F,CAAI,EACnB,IAAK,IAAIiF,EAAI,EAAGA,EAAIiK,EAAK4J,cAAc,CAAC7e,MAAM,CAAEgL,IAAK,CACjD,IAAIrK,EAAQsU,EAAKwL,UAAU,EAAIxL,EAAKwL,UAAU,CAACzD,OAAO,CAAC/H,EAAK4J,cAAc,CAAC7T,EAAE,EACzErK,EAAQ,KACRsU,EAAKwL,UAAU,CAAC3J,MAAM,CAACnW,EAAO,GAC9B4U,IAAIC,KAAK,CAAC,eAAgBP,EAAK4J,cAAc,CAAC7T,EAAE,EAExD,CACAiK,EAAK4J,cAAc,CAAG,EAAE,AAC5B,EACAhT,MAAO,SAAUA,CAAK,EAClB6K,QAAQ7K,KAAK,CAACA,EAAM+R,YAAY,CACpC,CACJ,EACJ,CACJ,CACJ,EACJ,EACA8E,gBAAiB,SAAUlD,CAAK,EAC5B,IAAIvK,EAAO,IAAI,CACVuK,GAILlB,cAAc,CACV,GAAGlgB,EAAE,gBAAgB2H,IAAI,EAAE,CAAEwY,SAAU,SAAUC,CAAI,EAC7CA,GACApgB,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,mBAAmB0C,GAAG,GAAK,SAAW0c,mBAAmBgC,EAAMiD,SAAS,EAC/EhF,OAAQ,OACR1X,KAAM,CACF0Y,2BAA4BrgB,EAAE,4CAA4C0C,GAAG,EACjF,EACA8K,QAAS,SAAU7F,CAAI,EACnB,IAAIpF,EAAQsU,EAAKwL,UAAU,EAAIxL,EAAKwL,UAAU,CAACzD,OAAO,CAACwC,GACnD7e,EAAQ,KACRsU,EAAKwL,UAAU,CAAC3J,MAAM,CAACnW,EAAO,GAC9B4U,IAAIC,KAAK,CAAC,eAAgBgK,GAGlC,EACA3T,MAAO,SAAUA,CAAK,EAClB6K,QAAQ7K,KAAK,CAACA,EAAM+R,YAAY,CACpC,CACJ,EAER,CACJ,EACJ,EACA+E,gBAAiB,SAAUnD,CAAK,CAAErf,CAAC,EAG/B,IAAI6d,EAAa,EAAE,CACnB,IAAI,CAACa,cAAc,CAACvI,OAAO,CAAC,SAAUzE,CAAI,EACtCmM,EAAWnW,IAAI,CAACgK,EAAKhR,IAAI,CAC7B,GAGmC,CAAA,GAA/B,IAAI,CAAC0e,eAAe,CAACC,KACrBxB,EAAWnW,IAAI,CAAC2X,EAAM3e,IAAI,EAC1B,IAAI,CAACge,cAAc,CAAChX,IAAI,CAAC2X,IAG7Brf,EAAEqC,YAAY,CAAC8iB,OAAO,CAAC,aAAc9mB,KAAKslB,SAAS,CAAC9F,IACpD7d,EAAEqC,YAAY,CAAC8iB,OAAO,CAAC,eAAgB,IAAI,CAACnI,cAAc,CAAC1M,IAAI,EAC/DtQ,EAAEqC,YAAY,CAAC+iB,YAAY,CAAC,IAAI,CAAC7D,iBAAiB,CAAE,GAAI,IACxDvhB,EAAEqC,YAAY,CAACgjB,aAAa,CAAG,MACnC,EACAC,sBAAuB,SAAUtlB,CAAC,EAC1BA,EAAEulB,OAAO,CAAG,KACZxnB,OAAOynB,QAAQ,CAAC,EAAG,KAGnBxlB,EAAEulB,OAAO,CAAGxnB,OAAO0nB,WAAW,CAAG,KACjC1nB,OAAOynB,QAAQ,CAAC,EAAG,GAE3B,EACAjG,WAAY,SAAUC,CAAO,EACrB,IAAI,CAACjB,MAAM,EAAIiB,EACf,IAAI,CAAChB,OAAO,CAAG,CAAC,IAAI,CAACA,OAAO,EAE5B,IAAI,CAACA,OAAO,CAAG,CAAA,EACf,IAAI,CAACD,MAAM,CAAGiB,EAEtB,CACJ,CACJ,GAEAvhB,EAAE,uBAAuBynB,OAAO,CAAC,SAAU1lB,CAAC,EACxC,GAAIA,AAAS,SAATA,EAAEwF,GAAG,CAEL,OADAvH,EAAE,kBAAkB0nB,KAAK,GAClB,CAAA,CAEf,GAEA1nB,EAAE,kBAAkBoB,EAAE,CAAC,QAAS,SAAUW,CAAC,EACvC,IAAIU,EAAOzC,EAAE,uBAAuB0C,GAAG,EAE1B,CAAA,KAATD,GAIJzC,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,oBAAoB0C,GAAG,GAAK,SAAW0c,mBAAmBN,SAASC,cAAc,CAAC1M,IAAI,EAAI,SAAW+M,mBAAmB3c,GAC/H4c,OAAQ,OACR1X,KAAM,CACF0Y,2BAA4BrgB,EAAE,4CAA4C0C,GAAG,EACjF,EACA8K,QAAS,SAAU7F,CAAI,EACnBwP,IAAIC,KAAK,CAAC,YAAa0H,SAASC,cAAc,CAAEpX,GAEhD6e,AADYC,UAAUC,KAAK,CAACC,mBAAmB,CAAC3mB,EAAE,uBAC5C2nB,IAAI,EACd,EACAla,MAAO,SAAUA,CAAK,EAClBzN,EAAE,6BAA6Boe,KAAK,GACpC,IAAI9G,EAAelX,KAAKyf,KAAK,CAACpS,EAAM+R,YAAY,EAAE7c,KAAK,CACvD3C,EAAE,uDAAuDyD,IAAI,CAAC6T,GAAcrV,QAAQ,CAACjC,EAAE,6BAC3F,CACJ,EACJ,GAEAA,EAAE,6BAA6BoB,EAAE,CAAC,QAAS,SAAUW,CAAC,EAClD,IAAIkiB,EAAUjkB,EAAE,kBAAkB0C,GAAG,GACjCklB,EAAU5nB,EAAE,kBAAkB0C,GAAG,GAErC,GAAIuhB,AAAY,KAAZA,GAIJ,IAAI4D,EAAgB/I,SAASC,cAAc,CAAC1M,IAAI,CAAG,GAC7B,CAAA,MAAlBwV,GACAA,CAAAA,EAAgB,EAAC,EAGrB,IAAI3D,EAAU2D,EAAgB5D,EAC1BE,EAAU0D,EAAgBD,EAE9B,GAAI1D,EAAQnO,WAAW,KAAOoO,EAAQpO,WAAW,GAAI,CAEjDyQ,AADYC,UAAUC,KAAK,CAACC,mBAAmB,CAAC3mB,EAAE,sBAC5C2nB,IAAI,GACV,MACJ,CAEA3nB,EAAEwP,IAAI,CAAC,CACHtO,IAAKlB,EAAE,mBAAmB0C,GAAG,GAAK,YAAc0c,mBAAmB+E,GAAW,YAAc/E,mBAAmB8E,GAC/G7E,OAAQ,OACR1X,KAAM,CACF0Y,2BAA4BrgB,EAAE,4CAA4C0C,GAAG,EACjF,EACA8K,QAAS,SAAU7F,CAAI,EAEnB6e,AADYC,UAAUC,KAAK,CAACC,mBAAmB,CAAC3mB,EAAE,sBAC5C2nB,IAAI,GACVxQ,IAAIC,KAAK,CAAC,eAAgB6M,EAASC,EAASC,EAASxc,EAAKyc,MAAM,CACpE,EACA3W,MAAO,SAAUA,CAAK,EAClBzN,EAAE,4BAA4Boe,KAAK,GACnC,IAAI9G,EAAelX,KAAKyf,KAAK,CAACpS,EAAM+R,YAAY,EAAE7c,KAAK,CACvD3C,EAAE,uDAAuDyD,IAAI,CAAC6T,GAAcrV,QAAQ,CAACjC,EAAE,4BAC3F,CACJ,GACJ,GAEAA,EAAEoD,UAAU4O,OAAO,CAAC,kBAEhBiR,GACA/gB,WAAW,WACPkB,SAAS2T,cAAc,CAAC,YAAY+Q,SAAS,CAAC3lB,MAAM,CAAC,SACzD,EAAG,IAEX,EACAsL,MAAO,SAAUA,CAAK,EAClB6K,QAAQ7K,KAAK,CAACA,EAAM+R,YAAY,CACpC,CACJ,GACJ,CAIA,IAAIuI,eAAiB,EAAE,CAoJvB,SAASC,6BAA6B9V,CAAE,CAAE+V,CAAgB,CAAEC,CAAY,CAAEC,CAAY,CAAEC,CAAa,CAAEC,CAAc,CAAEC,CAAY,CAAEC,CAAgB,CAAEC,CAAkB,EAGrK,IAIIC,EAJAC,EAAe1U,AADNhU,EAAEoD,SAAS2T,cAAc,CAAC/W,EAAEkS,GAAIvK,IAAI,CAAC,SACxBA,IAAI,CAAC,QAE3BghB,EAAmB3oB,EAAEkS,GACrB0W,EAAWD,EAAiB5nB,IAAI,CAAC,MAGrCgnB,eAAete,IAAI,CAACgf,EAAgB,IAAInS,IAAI,CACxCpE,GAAIyW,EAAiBrD,GAAG,CAAC,GACzB3d,KAAM,CACF0a,WAAY,EAAE,CACdwG,cAAe,KACfrF,YAAa,CAAA,EACbsF,SAAUF,EACV7F,YAAa,CAAA,EACbsF,eAAgBA,EAChBU,gBAAiB,GACjBT,aAAcA,EACdU,aAAc,KACdC,eAAgB,KAChBC,eAAgB,IACpB,EACAtR,QAAS,WAGLf,AAFW,IAAI,CAEV6N,YAAY,CAAGtkB,KAAKyf,KAAK,CAAC2E,aAAaC,OAAO,CAAC,mBACxD,EACAzM,SAAU,CACNiP,MAAO,CACH3B,IAAK,WACD,IAAI6D,EAAa,EAAE,QACnB,AAAK,IAAI,CAACpG,WAAW,EAGrB,IAAI,CAACV,UAAU,CAACnK,OAAO,CAAC,SAAUkR,CAAC,EACX,cAAhBA,EAAE/E,SAAS,EAGf8E,EAAW1f,IAAI,CAAC,CAAE4I,KAAM+W,EAAE/E,SAAS,CAAEgF,UAAWD,EAAEC,SAAS,CAAEC,MAAOF,EAAEE,KAAK,CAAEC,UAAWH,EAAEG,SAAS,CAAEC,OAAQJ,EAAEI,MAAM,CAAEC,iBAAkBL,EAAEK,gBAAgB,AAAC,EAChK,GACOrpB,KAAKslB,SAAS,CAACyD,IARX/oB,KAAKslB,SAAS,CAACgD,EAS9B,EACAnD,IAAK,SAAUmE,CAAM,EACjB,IAAI7S,EAAO,IAAI,CAEX8S,EAAS3pB,EAAEiO,QAAQ,GACnBqF,EAAQ,EAAE,CACV1R,EAAS,EACbunB,AAJiBO,CAAAA,GAAU,EAAE,AAAD,EAIjBxR,OAAO,CAAC,SAAUkR,CAAC,CAAExc,CAAC,EAC7B0G,EAAM7J,IAAI,CAAC,CAAEhH,KAAM,IAAM2mB,EAAE/W,IAAI,CAAE6S,KAAM,GAAIb,UAAW,GAAImF,OAAQJ,EAAEI,MAAM,CAAEC,iBAAkBL,EAAEK,gBAAgB,AAAC,GACjHlc,QAAUvN,EAAEmT,IAAI,CAACwW,GAAQ5hB,IAAI,CAAC,WAC1B/H,EAAEwP,IAAI,CAAC,CACHtO,IAAKinB,EAAe,SAAW/I,mBAAmBgK,EAAE/W,IAAI,EACxDgN,OAAQ,MACR7R,QAAS,SAAU7F,CAAI,EACnBA,EAAKiiB,MAAM,CAAGjiB,EAAKlF,IAAI,CAAGmK,EAAEtF,QAAQ,GACpCK,EAAK4hB,SAAS,CAAGH,EAAEG,SAAS,CAC5B5hB,EAAK6hB,MAAM,CAAGJ,EAAEI,MAAM,CACtB7hB,EAAK8hB,gBAAgB,CAAGL,EAAEK,gBAAgB,CAC1CnW,EAAMoF,MAAM,CAAC9L,EAAG,EAAGjF,GACf2L,EAAM1R,MAAM,GAAK,EAAEA,IACnB0R,EAAM4E,OAAO,CAAC,SAAUkR,CAAC,EACrBvS,EAAKwL,UAAU,CAAC5Y,IAAI,CAAC2f,EACzB,GACAvS,EAAKkM,WAAW,CAAG,CAAA,EAE3B,EACAtV,MAAO,SAAUA,CAAK,EAClB6K,QAAQ4N,GAAG,CAAC9lB,KAAKslB,SAAS,CAACjY,IAC3B6F,EAAMoF,MAAM,CAAC9L,EAAG,EAAG,CAAEnK,KAAM2mB,EAAE/W,IAAI,CAAE6S,KAAM,GAAIb,UAAW,YAAakF,UAAW,GAAIC,OAAQ,CAAEJ,EAAG,GAAKS,EAAG,EAAI,EAAGJ,iBAAkBL,EAAEK,gBAAgB,AAAC,GACjJnW,EAAM1R,MAAM,GAAK,EAAEA,IACnB0R,EAAM4E,OAAO,CAAC,SAAUkR,CAAC,EACrBvS,EAAKwL,UAAU,CAAC5Y,IAAI,CAAC2f,EACzB,GACAvS,EAAKkM,WAAW,CAAG,CAAA,EAE3B,CACJ,EACJ,EACJ,GAEA4G,EAAOlZ,OAAO,EAClB,CACJ,EACAoD,SAAU,WACN,OAAOjJ,KAAKkf,KAAK,CAAC,IAAI,CAACjB,aAAa,CAAC/e,IAAI,CAAG,KAChD,EACAigB,YAAa,WAET,IAAK,IADDC,EAAuB,EAAE,CACpBpd,EAAI,EAAGA,EAAI,IAAI,CAACyV,UAAU,CAACzgB,MAAM,CAAEgL,IACnC,IAAI,CAACyV,UAAU,CAACzV,EAAE,CAACyc,SAAS,EAC7BW,EAAqBvgB,IAAI,CAAC,IAAI,CAAC4Y,UAAU,CAACzV,EAAE,EAIpD,OAAOod,AAAgC,IAAhCA,EAAqBpoB,MAAM,EAAUooB,EAAqBpoB,MAAM,CAAG,GAAKwmB,CACnF,EACA1H,UAAW,WACP,OAAO,IAAI,CAAC8C,WAAW,CAAG,IAAM,GACpC,EACAkB,aAAc,CACVY,IAAK,WACD,MAAO,CACH9B,YAAa,IAAI,CAACA,WAAW,AACjC,CACJ,EACA+B,IAAK,SAAUC,CAAQ,EACdA,GAGL,CAAA,IAAI,CAAChC,WAAW,CAAGgC,EAAShC,WAAW,AAAD,CAC1C,CACJ,CACJ,EACA5M,QAAS,WACL,IAAIC,EAAO,IAAI,AAEfA,CAAAA,EAAKoQ,KAAK,CAAGyB,EAEb7R,EAAK0B,GAAG,CAAC,gCAAiC,SAAU6I,CAAK,EACrDvK,EAAKiQ,oBAAoB,CAAC1F,EAC9B,GAEAvK,EAAK0B,GAAG,CAAC,uBAAwB,SAAU6I,CAAK,EAC5CvK,EAAKoT,WAAW,CAAC7I,EACrB,GAGA,IAAI8I,EAAWvB,EAAiB5nB,IAAI,CAAC,MACjCmhB,EAAsBC,aAE1BniB,EAJe,IAAMioB,GAKhBpgB,UAAU,CAAC,CACRxB,uBAAwB,GACxBR,SAAU7F,EAAE,IAAMkqB,GAClB5d,SAAU,OACVpL,IAAKgnB,EACLvhB,aAAc6hB,EACd9gB,IAAK,SAAU3F,CAAC,CAAE4F,CAAI,EAClB,IACIiF,EADAud,EAAQxiB,EAAKgC,KAAK,CAAC/H,MAAM,CAE7B,IAAKgL,EAAI,EAAGA,EAAIud,EAAOvd,IACnBjF,EAAKgC,KAAK,CAACiD,EAAE,CAACV,UAAU,CACpB2K,EAAKuT,WAAW,GAAKziB,EAAKgC,KAAK,CAACiD,EAAE,CAACnK,IAAI,CAC3CkF,EAAKgC,KAAK,CAACiD,EAAE,CAAC6c,gBAAgB,CAAG9hB,EAAKgC,KAAK,CAACiD,EAAE,CAACnK,IAAI,CAEvDkF,EAAK1E,MAAM,EACf,EACAZ,SAAU,WAGN,MAAO,CACH,CAAEI,KAAM,OAAQE,MAAO4lB,CAAiB,EACxC,CAAE9lB,KAAM,6BAA8BE,MAJnB3C,EAAE,0CAA0C0C,GAAG,EAIJ,EAC9D,CAAED,KAAM,wBAAyBE,MAAOuf,CAAoB,EAC/D,AACL,EACAna,KAAM,SAAUhG,CAAC,CAAE4F,CAAI,EACnB,IAAI0iB,EAAgB,EAAE,CAClBC,EAAW,GAEf,GAAI3iB,EAAK8H,MAAM,CAAC9F,KAAK,CAAC/H,MAAM,CAAG,EAC3B,IAAK,IAAIgL,EAAI,EAAGA,EAAIjF,EAAK8H,MAAM,CAAC9F,KAAK,CAAC/H,MAAM,CAAEgL,IAC1CjF,EAAK8H,MAAM,CAAC9F,KAAK,CAACiD,EAAE,CAAC0c,KAAK,CAAG,CAAA,EAEzB3hB,AAA+B3F,KAAAA,IAA/B2F,EAAK8H,MAAM,CAAC9F,KAAK,CAACiD,EAAE,CAACa,KAAK,EAAkB9F,AAA+B,OAA/BA,EAAK8H,MAAM,CAAC9F,KAAK,CAACiD,EAAE,CAACa,KAAK,EACtE9F,EAAK8H,MAAM,CAAC9F,KAAK,CAACiD,EAAE,CAAC6c,gBAAgB,CAAG9hB,EAAKgC,KAAK,CAACiD,EAAE,CAAC6c,gBAAgB,CACtEY,EAAc5gB,IAAI,CAAC9B,EAAK8H,MAAM,CAAC9F,KAAK,CAACiD,EAAE,GAGvC0d,GAAY3iB,EAAK8H,MAAM,CAAC9F,KAAK,CAACiD,EAAE,CAACa,KAAK,CAAG,KAIrD,GAAI6c,AAAa,KAAbA,EAAiB,CACjBrK,MAAMqK,GACN,MACJ,CACAhS,QAAQ4N,GAAG,CAACmE,GACRA,EAAczoB,MAAM,CAAG,GAAKwmB,AAAkB,CAAA,IAAlBA,GAC5BnI,MAAMjgB,EAAE,uBAAuB0C,GAAG,IAClC+lB,EAAcpG,UAAU,CAAC5Y,IAAI,CAAC4gB,CAAa,CAAC,EAAE,GAG9C5B,EAAcpG,UAAU,CAAGoG,EAAcpG,UAAU,CAACxP,MAAM,CAACwX,GAC3D5B,EAAc1F,WAAW,CAAG,CAAA,CAEpC,EACAtV,MAAO,SAAUiB,CAAK,CAAEgB,CAAU,CAAEjB,CAAW,EAC3C6J,QAAQ4N,GAAG,CAAC,oBACZ5N,QAAQ4N,GAAG,CAACxX,GACZ4J,QAAQ4N,GAAG,CAACxW,GACZ4I,QAAQ4N,GAAG,CAACzX,EAChB,CACJ,GACCrN,EAAE,CAAC,4BAA6B,CAACW,EAAGzB,KACjC,IAAIuJ,EAAOvJ,EAAQqJ,KAAK,CAAC,EAAE,AAE3BrJ,CAAAA,EAAQ0L,IAAI,CAAG,IAAIsW,KACf,CAAChiB,EAAQ0L,IAAI,CAAC,CACdnC,EAAKpH,IAAI,CACT,CACItB,KAAM0I,EAAK1I,IAAI,CACfohB,aAAc1Y,EAAK0Y,YAAY,AACnC,EACR,EACR,EACAlL,QAAS,CACL4S,YAAa,SAAU7I,CAAK,EACxB,IAAI,CAACyH,aAAa,CAAGzH,CACzB,EACAgJ,YAAa,WACT,MAAO,uCAAuC5iB,OAAO,CAAC,QAAS,SAAU8X,CAAC,EACtE,IAAIiL,EAAI3f,AAAgB,GAAhBA,KAAK4f,MAAM,GAAU,EAC7B,MAAOC,AAD6BnL,CAAAA,AAAM,MAANA,EAAYiL,EAAKA,AAAI,EAAJA,EAAU,CAAG,EACzDjjB,QAAQ,CAAC,GACtB,EACJ,EACAojB,eAAgB,SAAUC,CAAK,EAC3B,IAAIC,EAAU,CAAC,EACf,GAAI,IAAI,CAAC/B,aAAa,CAAE,CACpB,IAAItmB,EAAQ,IAAI,CAAC8f,UAAU,EAAI,IAAI,CAACA,UAAU,CAACzD,OAAO,CAAC,IAAI,CAACiK,aAAa,EACrEtmB,EAAQ,KAERqoB,AADU,IAAI,CAACvI,UAAU,CAAC9f,EAAM,CACxB8mB,SAAS,CAAG,CAAA,EAEpB,IAAI,CAAChH,UAAU,CAAC3J,MAAM,CAACnW,EAAO,GAEtC,MAGmC,IAA3B,IAAI,CAAC8f,UAAU,CAACzgB,MAAM,GAEtBgpB,AADU,IAAI,CAACvI,UAAU,CAAC9f,EAAM,CACxB8mB,SAAS,CAAG,CAAA,EAEpB,IAAI,CAAChH,UAAU,CAAC3J,MAAM,CAAC,EAAG,GAGlC,CAAA,IAAI,CAACmQ,aAAa,CAAG,IACzB,EACAgC,mBAAoB,SAAUF,CAAK,EAC/B,IAAI,CAACG,cAAc,CAAG,IAAIrE,UAAUC,KAAK,CAAC,IAAI,CAACd,KAAK,CAACkF,cAAc,EACnE,IAAI,CAACA,cAAc,CAAClE,IAAI,GACxB,IAAI,CAACmC,eAAe,CAAG,IAAI,CAACF,aAAa,CAACU,SAAS,AACvD,EACAwB,qBAAsB,SAAUJ,CAAK,EACjC,IAAI,CAACG,cAAc,CAACnD,IAAI,GACxB,IAAI,CAACkB,aAAa,CAACU,SAAS,CAAG,IAAI,CAACR,eAAe,AACvD,EACAiC,gBAAiB,SAAUL,CAAK,EAC5B,IAAI,CAACzB,cAAc,CAAG,IAAIzC,UAAUC,KAAK,CAAC,IAAI,CAACd,KAAK,CAACsD,cAAc,EACnE,IAAI,CAACA,cAAc,CAACtC,IAAI,GAExB,IAAI,CAACiC,aAAa,CAACW,MAAM,CAAG,CACxBJ,EAAG,IAAI,CAACP,aAAa,CAACW,MAAM,CAACJ,CAAC,CAC9BS,EAAG,IAAI,CAAChB,aAAa,CAACW,MAAM,CAACK,CAAC,AAClC,EACA,IAAI,CAACb,YAAY,CAAG,IAAI,CAACH,aAAa,CAACW,MAAM,AACjD,EACAyB,qBAAsB,SAAUN,CAAK,EACjC,IAAI,CAACzB,cAAc,CAACvB,IAAI,GACxB,IAAI,CAACkB,aAAa,CAACW,MAAM,CAAG,IAAI,CAACR,YAAY,AACjD,EACAkC,YAAa,SAAUP,CAAK,EACxB,IAAI,CAAC9B,aAAa,CAACW,MAAM,CAAG,CAAEJ,EAAG,GAAKS,EAAG,EAAI,CACjD,EACAsB,aAAc,SAAUR,CAAK,EACzB,IAAI5R,EAAQ,IAAI,CAAC6M,KAAK,CAACwF,WAAW,AAClC,CAAA,IAAI,CAACvC,aAAa,CAACW,MAAM,CAAG,CACxBJ,EAAGuB,EAAMU,OAAO,CAAGtS,EAAMuS,WAAW,CACpCzB,EAAGc,EAAMY,OAAO,CAAGxS,EAAMyS,YAAY,AACzC,CACJ,EACAC,WAAY,WACR,GAAI,CAAA,IAAI,CAAC7F,KAAK,CAACwF,WAAW,GAAI,IAAI,CAACxF,KAAK,CAAC8F,SAAS,GAAI,IAAI,CAAC7C,aAAa,CAWpE,MAAO,IATP,IAAI8C,EAAS,AAAC,CAAA,IAAI,CAAC/F,KAAK,CAAC8F,SAAS,CAACJ,WAAW,CAAG,IAAI,CAAC1F,KAAK,CAACwF,WAAW,CAACE,WAAW,AAAD,EAAK,EACnFM,EAAW,AAAC,IAAI,CAAC/C,aAAa,CAACW,MAAM,CAACJ,CAAC,CAAG,IAAI,CAACxD,KAAK,CAACwF,WAAW,CAACE,WAAW,CAAIK,EAMpF,OALIC,EAAW,GACXA,EAAW,GAEXA,GAAsB,EAEnBA,EAAW,IAI1B,EACAC,UAAW,WACP,GAAI,CAAA,IAAI,CAACjG,KAAK,CAACwF,WAAW,GAAI,IAAI,CAACvC,aAAa,CAS5C,MAAO,IARP,IAAI+C,EAAW,IAAI,CAAC/C,aAAa,CAACW,MAAM,CAACK,CAAC,CAAG,IAAI,CAACjE,KAAK,CAACwF,WAAW,CAACI,YAAY,CAMhF,OALII,EAAW,GACXA,EAAW,GAEXA,GAAsB,EAEnBA,EAAW,IAI1B,EACAE,UAAW,SAAUnB,CAAK,EACtB,IAAI5R,EAAQ,IAAI,CAAC6M,KAAK,CAACwF,WAAW,AAClC,CAAA,IAAI,CAACvC,aAAa,CAACW,MAAM,CAAG,CACxBJ,EAAGuB,EAAMU,OAAO,CAAGtS,EAAMuS,WAAW,CACpCzB,EAAGc,EAAMY,OAAO,CAAGxS,EAAMyS,YAAY,AACzC,CACJ,EACAO,cAAe,SAAUpiB,CAAK,EACtB,AAACA,EAAM/H,MAAM,CAAG,GAAOwmB,AAAkB,CAAA,IAAlBA,GACvBnI,MAAMjgB,EAAE,uBAAuB0C,GAAG,IAClC+lB,EAAcpG,UAAU,CAAC5Y,IAAI,CAACE,CAAK,CAAC,EAAE,GAGtC8e,EAAcpG,UAAU,CAAGoG,EAAcpG,UAAU,CAACxP,MAAM,CAAClJ,GAC3D8e,EAAc1F,WAAW,CAAG,CAAA,CAEpC,EACA+D,qBAAsB,SAAU1F,CAAK,EACjC,IAAIvK,EAAO,IAAI,AACfA,CAAAA,EAAKgS,aAAa,CAAGzH,EAGrBlf,WAAW,WACP2U,EAAK6T,cAAc,EACvB,EAAG,IACP,CACJ,EACA7R,MAAO,CACHwJ,WAAY,CACR2J,KAAM,CAAA,EACNC,UAEI/pB,WAAW,WAAclC,EAAEoD,UAAU4O,OAAO,CAAC,wBAA0B,EAAG,IAC9E,CACJ,EACA0S,aAAc,SAAUc,CAAQ,EAC5BhB,aAAaiB,OAAO,CAAC,kBAAmBrlB,KAAKslB,SAAS,CAACF,GAC3D,CACJ,CACJ,GACJ,CAreAlP,IAAIC,SAAS,CAAC,4BAA6B,CACvCC,SAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC,CACD7O,KAAM,WACF,MAAO,CACH6P,EAAG,CAAC,EACJ0U,iBAAkB,KAClBC,mBAAoB,EAAE,AAC1B,CACJ,EACAzV,MAAO,CACHtU,KAAM,aACNuoB,MAAO,SACX,EACAlU,MAAO,CACH4L,WAAYjP,MACZyV,cAAeve,OACfoW,UAAWrY,OACXygB,SAAUpd,OACV0c,cAAe1K,OACnB,EACA9F,QAAS,WAILf,AAHW,IAAI,CAGVW,CAAC,CAAC4U,aAAa,CAAGpsB,EAAE,sBAAsB0C,GAAG,GAClDmU,AAJW,IAAI,CAIVW,CAAC,CAAC6U,cAAc,CAAGrsB,EAAE,sBAAsB0C,GAAG,GACnDmU,AALW,IAAI,CAKVW,CAAC,CAAC8U,QAAQ,CAAGtsB,EAAE,gBAAgB0C,GAAG,EAC3C,EACAkU,QAAS,WACD,IAAI,CAACwR,aAAa,EAAE,IAAI,CAACmE,YAAY,EAC7C,EACAlV,QAAS,CACLkV,aAAc,WACV,GAAI,IAAI,CAAC3G,KAAK,CAAC4G,kBAAkB,CAAE,CAC/B,IAAI3V,EAAO,IAAI,AAEf,CAAA,IAAI,CAACqV,gBAAgB,CAAGO,SAASC,MAAM,CAAC,IAAI,CAAC9G,KAAK,CAAC4G,kBAAkB,CAAE,CACvEG,UAAW,IACXC,WAAY,iBACZC,UAAW,CAAA,EACXC,cAAe,oBACfC,gBAAiB,CAAA,EACjBC,gBAAiB,CAAA,EACjBC,SAAU,SAAUC,CAAG,EACnB,IAAIC,EAAW,IAAItW,EAAKwL,UAAU,CAAC,CAEnC,GAAI6K,EAAIE,WAAW,EAAIF,EAAIE,WAAW,CAACxrB,MAAM,CAAG,EAAG,CAC/C,IAAIyrB,EAAaH,EAAIE,WAAW,CAACrI,IAAI,CAAC,CAACC,EAAGC,IAAMD,EAAEziB,KAAK,CAAG0iB,EAAE1iB,KAAK,EAC7D+qB,EAAaJ,EAAIK,WAAW,CAACxI,IAAI,CAAC,CAACC,EAAGC,IAAMD,EAAEziB,KAAK,CAAG0iB,EAAE1iB,KAAK,EAE3DirB,EAAcH,EAAW5hB,GAAG,CAACgiB,GAAU5W,EAAKwL,UAAU,CAACoL,EAAOlrB,KAAK,CAAC,EAG1E,IAAK,IAAIqK,EAAIygB,EAAWzrB,MAAM,CAAG,EAAGgL,GAAK,EAAGA,IACxCugB,EAASzU,MAAM,CAAC2U,CAAU,CAACzgB,EAAE,CAACrK,KAAK,CAAE,GAIzC,IAAK,IAAIqK,EAAI,EAAGA,EAAI0gB,EAAW1rB,MAAM,CAAEgL,IACnCugB,EAASzU,MAAM,CAAC4U,CAAU,CAAC1gB,EAAE,CAACrK,KAAK,CAAE,EAAGirB,CAAW,CAAC5gB,EAAE,CAG9D,KAAO,CAEH,GAAM,CAAC8gB,EAAU,CAAGP,EAASzU,MAAM,CAACwU,EAAIS,QAAQ,CAAE,GAClDR,EAASzU,MAAM,CAACwU,EAAIU,QAAQ,CAAE,EAAGF,EACrC,CAEA7W,EAAKO,KAAK,CAAC,UAAW+V,GAGtBU,AADyBhX,EAAK+O,KAAK,CAAC4G,kBAAkB,CAACsB,gBAAgB,CAAC,sBACvD5V,OAAO,CAAChG,IACrBua,SAASsB,KAAK,CAACC,QAAQ,CAAC9b,EAC5B,GACA2E,EAAKsV,kBAAkB,CAAG,EAAE,AAChC,CACA,EACJ,CACJ,EACArF,qBAAsB,SAAU1F,CAAK,EACjC,IAAI,CAAC6M,OAAO,CAAC7W,KAAK,CAAC,gCAAiCgK,EACxD,EACA6I,YAAa,SAAU7I,CAAK,EACxB,IAAI,CAAC6M,OAAO,CAAC7W,KAAK,CAAC,uBAAwBgK,EAC/C,EACAC,cAAe,SAAUngB,CAAG,CAAEwf,CAAS,EACnC,OAAOxf,EAAOA,CAAAA,AAAoB,IAApBA,EAAI0d,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,SAAW8B,EAAY,WAAaA,CAC5F,EACAsB,mCAAmC,SAA4C5G,CAAQ,CAAE6G,CAAS,EAC9F,OAAO3G,wBAAwBF,GAAY,IAAM6G,CACrD,CACJ,CACJ,GA4VA,IAAMiM,oBAAsB,qBAkc5B,SAASC,qBAAqBjc,CAAE,CAAEkc,CAAgB,CAAEjG,CAAY,CAAEC,CAAa,CAAEC,CAAc,CAAEC,CAAY,CAAEtC,CAAiB,EAE5H,GAAI9T,AAAO,OAAPA,GAGJ,IAIIuW,EAJAC,EAAe1U,AADNhU,EAAEoD,SAAS2T,cAAc,CAAC/W,EAAEkS,GAAIvK,IAAI,CAAC,SACxBA,IAAI,CAAC,QAE3BghB,EAAmB3oB,EAAEkS,GACrB0W,EAAWD,EAAiB5nB,IAAI,CAAC,MAIrCqtB,EAAiBC,gBAAgB,CAAC,kBAAmB,SAAU1D,CAAK,EAChE3qB,EAAE,aAAaiC,QAAQ,CAAC,QACxBmB,SAAS2T,cAAc,CAAC,YAAY+Q,SAAS,CAACpgB,GAAG,CAAC,SACtD,GAEAqgB,eAAete,IAAI,CAACgf,EAAgB,IAAInS,IAAI,CACxCpE,GAAIyW,EAAiBrD,GAAG,CAAC,GACzB3d,KAAM,CACF0a,WAAY,EAAE,CACdwG,cAAe,KACfrF,YAAa,CAAA,EACbsF,SAAUF,EACV7F,YAAa,CAAA,EACbsF,eAAgBA,EAChBU,gBAAiB,GACjBT,aAAcA,EACdtC,kBAAmBA,EACnBgD,aAAc,KACd8B,eAAgB,KAChB5B,eAAgB,IACpB,EACAtR,QAAS,WAGLf,AAFW,IAAI,CAEV6N,YAAY,CAAGtkB,KAAKyf,KAAK,CAAC2E,aAAaC,OAAO,CAAC,mBACxD,EACAzM,SAAU,CACNiP,MAAO,CACH3B,IAAK,WACD,IAAI6D,EAAa,EAAE,QACnB,AAAK,IAAI,CAACpG,WAAW,EAGrB,IAAI,CAACV,UAAU,CAACnK,OAAO,CAAC,SAAUkR,CAAC,EACX,cAAhBA,EAAE/E,SAAS,EAGf8E,EAAW1f,IAAI,CAAC,CAAE4I,KAAM+W,EAAE/E,SAAS,CAAEkF,UAAWH,EAAEG,SAAS,CAAEC,OAAQJ,EAAEI,MAAM,AAAC,EAClF,GACOppB,KAAKslB,SAAS,CAACyD,IARX/oB,KAAKslB,SAAS,CAACgD,EAS9B,EACAnD,IAAK,SAAUmE,CAAM,EACjB,IAAI7S,EAAO,IAAI,CAEX8S,EAAS3pB,EAAEiO,QAAQ,GACnBqF,EAAQ,EAAE,CACV1R,EAAS,EACbunB,AAJiBO,CAAAA,GAAU,EAAE,AAAD,EAIjBxR,OAAO,CAAC,SAAUkR,CAAC,CAAExc,CAAC,EAC7B0G,EAAM7J,IAAI,CAAC,CAAEhH,KAAM,IAAM2mB,EAAE/W,IAAI,CAAE6S,KAAM,GAAIb,UAAW,EAAG,GACzD9W,QAAUvN,EAAEmT,IAAI,CAACwW,GAAQ5hB,IAAI,CAAC,WAC1B/H,EAAEwP,IAAI,CAAC,CACHtO,IAAKinB,EAAe,SAAW/I,mBAAmBgK,EAAE/W,IAAI,EACxDgN,OAAQ,MACR7R,QAAS,SAAU7F,CAAI,EACnBA,EAAKiiB,MAAM,CAAGjiB,EAAKlF,IAAI,CAAGmK,EAAEtF,QAAQ,GACpCK,EAAK4hB,SAAS,CAAGH,EAAEG,SAAS,CAC5B5hB,EAAK6hB,MAAM,CAAGJ,EAAEI,MAAM,CACtBlW,EAAMoF,MAAM,CAAC9L,EAAG,EAAGjF,GACf2L,EAAM1R,MAAM,GAAK,EAAEA,IACnB0R,EAAM4E,OAAO,CAAC,SAAU2R,CAAC,EACrBhT,EAAKwL,UAAU,CAAC5Y,IAAI,CAACogB,EACzB,GACAhT,EAAKkM,WAAW,CAAG,CAAA,EAGdqF,GAAiBvR,AAA2B,IAA3BA,EAAKwL,UAAU,CAACzgB,MAAM,EACxCiV,EAAKyX,SAAS,CAAC,WACXzX,EAAKgS,aAAa,CAAGhS,EAAKwL,UAAU,CAAC,EAAE,AAC3C,GAGZ,EACA5U,MAAO,SAAUA,CAAK,EAClB6K,QAAQ4N,GAAG,CAACzY,GACZ6F,EAAMoF,MAAM,CAAC9L,EAAG,EAAG,CAAEnK,KAAM2mB,EAAE/W,IAAI,CAAE6S,KAAM,GAAIb,UAAW,YAAakF,UAAW,GAAIC,OAAQ,CAAEJ,EAAG,EAAGS,EAAG,CAAE,CAAE,GACvGvW,EAAM1R,MAAM,GAAK,EAAEA,IACnB0R,EAAM4E,OAAO,CAAC,SAAUkR,CAAC,EACrBvS,EAAKwL,UAAU,CAAC5Y,IAAI,CAAC2f,EACzB,GACAvS,EAAKkM,WAAW,CAAG,CAAA,EAE3B,CACJ,EACJ,EACJ,GAGA4G,EAAOlZ,OAAO,EAClB,CACJ,EACAoD,SAAU,WACN,OAAOjJ,KAAKkf,KAAK,CAAC,IAAI,CAACjB,aAAa,CAAC/e,IAAI,CAAG,KAChD,EACAigB,YAAa,WACT,OAAO,AAA2B,IAA3B,IAAI,CAAC1H,UAAU,CAACzgB,MAAM,EAAU,IAAI,CAACygB,UAAU,CAACzgB,MAAM,CAAG,GAAKwmB,CACzE,EACA1H,UAAW,WACP,OAAO,IAAI,CAAC8C,WAAW,CAAG,IAAM,GACpC,EACAkB,aAAc,CACVY,IAAK,WACD,MAAO,CACH9B,YAAa,IAAI,CAACA,WAAW,AACjC,CACJ,EACA+B,IAAK,SAAUC,CAAQ,EACdA,GAGL,CAAA,IAAI,CAAChC,WAAW,CAAGgC,EAAShC,WAAW,AAAD,CAC1C,CACJ,CACJ,EACA5M,QAAS,WACL,IAAIC,EAAO,IAAI,AAEfA,CAAAA,EAAKoQ,KAAK,CAAGyB,EAEb7R,EAAK0B,GAAG,CAAC,gCAAiC,SAAU6I,CAAK,EACrDvK,EAAKiQ,oBAAoB,CAAC1F,EAC9B,GAEAvK,EAAK0B,GAAG,CAAC,uBAAwB,SAAU6I,CAAK,EAC5CvK,EAAKoT,WAAW,CAAC7I,EACrB,GAEAvK,EAAK0B,GAAG,CAAC,gBAAiB,SAAU5O,CAAK,EACrCkN,EAAKkV,aAAa,CAACpiB,EACvB,EACJ,EACA0N,QAAS,CACL4S,YAAa,SAAU7I,CAAK,EACxB,IAAI,CAACyH,aAAa,CAAGzH,CACzB,EACAmN,UAAW,SAAU5D,CAAK,EACtB,IAAI9T,EAAO,IAAI,CACf,GAAIA,EAAKkT,WAAW,CAAE,CAClB/pB,EAAE,sBAAsB0C,GAAG,CAAC,IAAI,CAACsjB,iBAAiB,EAClDhmB,EAAE,eAAee,IAAI,CAAC,SAAU,IAAI,CAACilB,iBAAiB,EACtDhmB,EAAE,aAAaiC,QAAQ,CAACjC,EAAEouB,GAAkB9Y,IAAI,CAAC,gBAGjDwJ,SAASqH,OAAO,GAEhB,IAAIK,EAAQ,IAAIC,UAAUC,KAAK,CAAC0H,GAChC5H,EAAMI,IAAI,GAEV1kB,WAAW,WACPkB,SAAS2T,cAAc,CAAC,YAAY+Q,SAAS,CAAC3lB,MAAM,CAAC,SACzD,EAAG,KAEHnC,EAAEouB,GAAkB9Y,IAAI,CAAC,2BAA2B7T,GAAG,CAAC,SAASL,EAAE,CAAC,QAAS,SAAUqpB,CAAC,EAOpF,OANA5T,EAAKkV,aAAa,CAACjN,SAAS2B,cAAc,EAG1C3B,SAAS2B,cAAc,CAAG,EAAE,CAE5B+F,EAAMmB,IAAI,GACH,CAAA,CACX,EACJ,CACJ,EACAkD,mBAAoB,SAAUF,CAAK,EAC/B,IAAI,CAACG,cAAc,CAAG,IAAIrE,UAAUC,KAAK,CAAC,IAAI,CAACd,KAAK,CAACkF,cAAc,EACnE,IAAI,CAACA,cAAc,CAAClE,IAAI,GACxB,IAAI,CAACmC,eAAe,CAAG,IAAI,CAACF,aAAa,CAACU,SAAS,AACvD,EACAwB,qBAAsB,SAAUJ,CAAK,EACjC,IAAI,CAACG,cAAc,CAACnD,IAAI,GACxB,IAAI,CAACkB,aAAa,CAACU,SAAS,CAAG,IAAI,CAACR,eAAe,AACvD,EACAiC,gBAAiB,SAAUL,CAAK,EAC5B,IAAI,CAACzB,cAAc,CAAG,IAAIzC,UAAUC,KAAK,CAAC,IAAI,CAACd,KAAK,CAACsD,cAAc,EACnE,IAAI,CAACA,cAAc,CAACtC,IAAI,GAExB,IAAI,CAACiC,aAAa,CAACW,MAAM,CAAG,CAC1BJ,EAAG,IAAI,CAACP,aAAa,CAACW,MAAM,CAACJ,CAAC,CAC9BS,EAAG,IAAI,CAAChB,aAAa,CAACW,MAAM,CAACK,CAAC,AAChC,EACA,IAAI,CAACb,YAAY,CAAG,IAAI,CAACH,aAAa,CAACW,MAAM,AACjD,EACAyB,qBAAsB,SAAUN,CAAK,EACjC,IAAI,CAACzB,cAAc,CAACvB,IAAI,GACxB,IAAI,CAACkB,aAAa,CAACW,MAAM,CAAG,IAAI,CAACR,YAAY,AACjD,EACAkC,YAAa,SAAUP,CAAK,EACxB,IAAI,CAAC9B,aAAa,CAACW,MAAM,CAAG,CAAEJ,EAAG,GAAKS,EAAG,EAAI,CACjD,EACAsB,aAAc,SAASR,CAAK,EACxB,IAAI5R,EAAQ,IAAI,CAAC6M,KAAK,CAACwF,WAAW,AAClC,CAAA,IAAI,CAACvC,aAAa,CAACW,MAAM,CAAG,CACzBJ,EAAGuB,EAAMU,OAAO,CAAGtS,EAAMuS,WAAW,CACpCzB,EAAGc,EAAMY,OAAO,CAAGxS,EAAMyS,YAAY,AACxC,CACJ,EACAC,WAAY,WACR,GAAI,CAAA,IAAI,CAAC7F,KAAK,CAACwF,WAAW,GAAI,IAAI,CAACxF,KAAK,CAAC8F,SAAS,GAAI,IAAI,CAAC7C,aAAa,CAWpE,MAAO,IATP,IAAI8C,EAAS,AAAC,CAAA,IAAI,CAAC/F,KAAK,CAAC8F,SAAS,CAACJ,WAAW,CAAG,IAAI,CAAC1F,KAAK,CAACwF,WAAW,CAACE,WAAW,AAAD,EAAK,EACnFM,EAAW,AAAC,IAAI,CAAC/C,aAAa,CAACW,MAAM,CAACJ,CAAC,CAAG,IAAI,CAACxD,KAAK,CAACwF,WAAW,CAACE,WAAW,CAAIK,EAChF6C,EAAa5jB,KAAKkf,KAAK,CAAC,IAAI,CAAClE,KAAK,CAAC8F,SAAS,CAAC+C,aAAa,CAAC,sBAAsBnD,WAAW,EAKhG,OAJGjjB,OAAOqmB,SAAS,CAACF,IAEhB5C,CAAAA,GAAsB4C,EAAW,CAAA,EAE9B5C,EAAW,IAI1B,EACAC,UAAW,kBACP,AAAI,IAAI,CAACjG,KAAK,CAACwF,WAAW,EAAI,IAAI,CAACvC,aAAa,CAErC+C,AADQ,IAAI,CAAC/C,aAAa,CAACW,MAAM,CAACK,CAAC,CAAG,IAAI,CAACjE,KAAK,CAACwF,WAAW,CAACI,YAAY,CAC9D,KAEX,GAEf,EACAM,UAAW,SAAUnB,CAAK,EACtB,IAAI5R,EAAQ,IAAI,CAAC6M,KAAK,CAACwF,WAAW,AAClC,CAAA,IAAI,CAACvC,aAAa,CAACW,MAAM,CAAG,CACxBJ,EAAGuB,EAAMU,OAAO,CAAGtS,EAAMuS,WAAW,CACpCzB,EAAGc,EAAMY,OAAO,CAAGxS,EAAMyS,YAAY,AACzC,CACJ,EACAO,cAAe,SAAUpiB,CAAK,EACtB,AAACA,EAAM/H,MAAM,CAAG,GAAOwmB,AAAkB,CAAA,IAAlBA,GACvBnI,MAAMjgB,EAAE,uBAAuB0C,GAAG,IAClC+lB,EAAcpG,UAAU,CAAC5Y,IAAI,CAACE,CAAK,CAAC,EAAE,EACtC8e,EAAc1F,WAAW,CAAG,CAAA,EAE5B0F,EAAc6F,SAAS,CAAC,WACpB7F,EAAcI,aAAa,CAAGJ,EAAcpG,UAAU,CAAC,EAAE,AAC7D,KAEAoG,EAAcpG,UAAU,CAAGoG,EAAcpG,UAAU,CAACxP,MAAM,CAAClJ,GAC3D8e,EAAc1F,WAAW,CAAG,CAAA,EAEvBqF,GAAiBK,AAAoC,IAApCA,EAAcpG,UAAU,CAACzgB,MAAM,EACjD6mB,EAAc6F,SAAS,CAAC,WACpB7F,EAAcI,aAAa,CAAGJ,EAAcpG,UAAU,CAAC,EAAE,AAC7D,GAGZ,EACAqI,eAAgB,SAAUC,CAAK,EAC3B,GAAI,IAAI,CAAC9B,aAAa,CAAE,CACpB,IAAItmB,EAAQ,IAAI,CAAC8f,UAAU,EAAI,IAAI,CAACA,UAAU,CAACzD,OAAO,CAAC,IAAI,CAACiK,aAAa,EACrEtmB,EAAQ,IACR,IAAI,CAAC8f,UAAU,CAAC3J,MAAM,CAACnW,EAAO,EAEtC,MAGmC,IAA3B,IAAI,CAAC8f,UAAU,CAACzgB,MAAM,EACtB,IAAI,CAACygB,UAAU,CAAC3J,MAAM,CAAC,EAAG,EAGlC,CAAA,IAAI,CAACmQ,aAAa,CAAG,IACzB,EACA/B,qBAAsB,SAAU1F,CAAK,EACjC,IAAIvK,EAAO,IAAI,AACfA,CAAAA,EAAKgS,aAAa,CAAGzH,EAErBlf,WAAW,WACP2U,EAAK6T,cAAc,EACvB,EAAG,IACP,CACJ,EACA7R,MAAO,CACHwJ,WAAY,CACR2J,KAAM,CAAA,EACNC,UAEI/pB,WAAW,WAAclC,EAAEoD,UAAU4O,OAAO,CAAC,wBAA0B,EAAG,IAC9E,CACJ,EACA0S,aAAc,SAAUc,CAAQ,EAC5BhB,aAAaiB,OAAO,CAAC,kBAAmBrlB,KAAKslB,SAAS,CAACF,GAC3D,CACJ,CACJ,IACJ,CAtuBAlP,IAAIC,SAAS,CAAC,4BAA6B,CACvCC,SAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC,CACDC,MAAO,CACH2K,MAAO9W,OACPyf,YAAarM,QACb2K,eAAgB3K,QAChB4K,aAAc5K,QACdiR,KAAMtmB,MACV,EACAgP,QAAS,CACLxD,SAAU,SAAkB+a,CAAO,EAC/B,OAAOhkB,KAAKkf,KAAK,CAAC8E,EAAU,KAChC,EACAvN,cAAe,SAAuBngB,CAAG,EACrC,OAAOA,EAAOA,CAAAA,AAAoB,IAApBA,EAAI0d,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,oBACxD,CACJ,CACJ,GAEAtI,IAAIC,SAAS,CAAC,4BAA6B,CACvCC,SAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC,CACDC,MAAO,CACH2K,MAAO9W,OACPyf,YAAarM,QACb4K,aAAc5K,QACd2K,eAAgB3K,OACpB,EACArG,QAAS,CACLxD,SAAU,SAAkB+a,CAAO,EAC/B,OAAOhkB,KAAKkf,KAAK,CAAC8E,EAAU,KAChC,EACAvN,cAAe,SAAuBngB,CAAG,EACrC,OAAQA,EAAOA,CAAAA,AAAoB,IAApBA,EAAI0d,OAAO,CAAC,KAAa,IAAM,GAAE,EAAK,sBACzD,CACJ,CACJ,GAEAtI,IAAIC,SAAS,CAAC,6BAA8B,CACxCC,SAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC,CACD7O,KAAM,WACF,MAAO,CACH6P,EAAG,CAAC,EACJ0U,iBAAkB,KAClBC,mBAAoB,EAAE,CACtB0C,kBAAmB,EACnBpL,SAAU,CAAA,EACV3Z,KAAM,IACV,CACJ,EACA2M,MAAO,CACH4L,WAAYjP,MACZyV,cAAeve,OACfwe,SAAUpd,OACVojB,QAASpjB,OACT0c,cAAe1K,OACnB,EACA9F,QAAS,WAILf,AAHW,IAAI,CAGVW,CAAC,CAAC4U,aAAa,CAAGpsB,EAAE,sBAAsB0C,GAAG,GAClDmU,AAJW,IAAI,CAIVW,CAAC,CAAC6U,cAAc,CAAGrsB,EAAE,sBAAsB0C,GAAG,GACnDmU,AALW,IAAI,CAKVW,CAAC,CAAC8U,QAAQ,CAAGtsB,EAAE,gBAAgB0C,GAAG,EAC3C,EACAkU,QAAS,WACL,IAAI,CAACmY,oBAAoB,GACzB,IAAI,CAACxC,YAAY,EACrB,EACAyC,cAAe,WACP,IAAI,CAAC9C,gBAAgB,EACrB,IAAI,CAACA,gBAAgB,CAAC+C,OAAO,EAErC,EACApW,MAAO,CACHwJ,WAAY,CACR4J,UACQ,IAAI,CAACC,gBAAgB,EACrB,IAAI,CAACA,gBAAgB,CAAC+C,OAAO,GAEjC,IAAI,CAACX,SAAS,CAAC,KACX,IAAI,CAAC/B,YAAY,GAEb,CAAC,IAAI,CAACnE,aAAa,EAAI,IAAI,CAA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"}
