{"mappings":"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","sources":["src/OrchardCore.Modules/OrchardCore.Workflows/Assets/Scripts/workflow-viewer.ts","src/OrchardCore.Modules/OrchardCore.Workflows/Assets/Scripts/workflow-canvas.ts","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["///<reference path='../Lib/jquery/typings.d.ts' />\r\n///<reference path='../Lib/jsplumb/typings.d.ts' />\r\n\r\nimport './workflow-models';\r\nimport WorkflowCanvas from './workflow-canvas';\r\n\r\nclass WorkflowViewer extends WorkflowCanvas {\r\n    private jsPlumbInstance: jsPlumbInstance;\r\n\r\n    constructor(protected container: HTMLElement, protected workflowType: Workflows.WorkflowType) {\r\n        super(container, workflowType);\r\n        const self = this;\r\n\r\n        jsPlumb.ready(() => {\r\n            jsPlumb.importDefaults(this.getDefaults());\r\n\r\n            const plumber = this.createJsPlumbInstance();\r\n\r\n            // Listen for new connections.\r\n            plumber.bind('connection', function (connInfo, originalEvent) {\r\n                const connection: Connection = connInfo.connection;\r\n                const outcome: Workflows.Outcome = connection.getParameters().outcome;\r\n\r\n                const label: any = connection.getOverlay('label');\r\n                label.setLabel(outcome.displayName);\r\n            });\r\n\r\n            let activityElements = this.getActivityElements();\r\n\r\n            var areEqualOutcomes = function (outcomes1: Workflows.Outcome[], outcomes2: Workflows.Outcome[]): boolean {\r\n                if (outcomes1.length != outcomes2.length) {\r\n                    return false;\r\n                }\r\n\r\n                for (let i = 0; i < outcomes1.length; i++) {\r\n                    const outcome1 = outcomes1[i];\r\n                    const outcome2 = outcomes2[i];\r\n\r\n                    if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {\r\n                        return false;\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            // Suspend drawing and initialize.\r\n            plumber.batch(() => {\r\n                var workflowId: number = this.workflowType.id;\r\n\r\n                activityElements.each((_, activityElement) => {\r\n                    const $activityElement = $(activityElement);\r\n                    const activityId = $activityElement.data('activity-id');\r\n                    const activity = this.getActivity(activityId);\r\n\r\n                    // Configure the activity as a target.\r\n                    plumber.makeTarget(activityElement, {\r\n                        dropOptions: { hoverClass: 'hover' },\r\n                        anchor: 'Continuous',\r\n                        endpoint: ['Blank', { radius: 8 }]\r\n                    });\r\n\r\n                    // Add source endpoints.\r\n                    for (let outcome of activity.outcomes) {\r\n                        const sourceEndpointOptions = this.getSourceEndpointOptions(activity, outcome);\r\n                        plumber.addEndpoint(activityElement, { connectorOverlays: [['Label', { label: outcome.displayName, cssClass: 'connection-label' }]] }, sourceEndpointOptions);\r\n                    }\r\n                });\r\n\r\n                // Connect activities.\r\n                this.updateConnections(plumber);\r\n\r\n                // Re-query the activity elements.\r\n                activityElements = this.getActivityElements();\r\n\r\n                // Make all activity elements visible.\r\n                activityElements.show();\r\n\r\n                this.updateCanvasHeight();\r\n            });\r\n\r\n            this.jsPlumbInstance = plumber;\r\n        });\r\n    }\r\n\r\n    protected getEndpointColor = (activity: Workflows.Activity) => {\r\n        return activity.isBlocking ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';\r\n    }\r\n}\r\n\r\n$.fn.workflowViewer = function (this: JQuery): JQuery {\r\n    this.each((index, element) => {\r\n        var $element = $(element);\r\n        var workflowType: Workflows.WorkflowType = $element.data('workflow-type');\r\n\r\n        $element.data('workflowViewer', new WorkflowViewer(element, workflowType));\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\n$(document).ready(function () {\r\n    const workflowViewer: WorkflowViewer = $('.workflow-canvas').workflowViewer().data('workflowViewer');\r\n});\r\n","///<reference path='../Lib/jquery/typings.d.ts' />\r\n///<reference path='../Lib/jsplumb/typings.d.ts' />\r\n\r\nimport './workflow-models';\r\n\r\nabstract class WorkflowCanvas {\r\n    private minCanvasHeight: number = 400;\r\n\r\n    constructor(protected container: HTMLElement, protected workflowType: Workflows.WorkflowType) {\r\n    }\r\n\r\n    protected getActivityElements = (): JQuery => {\r\n        return $(this.container).find('.activity');\r\n    }\r\n\r\n    protected getDefaults = () => {\r\n        return {\r\n            Anchor: \"Continuous\",\r\n            DragOptions: { cursor: 'pointer', zIndex: 2000 },\r\n            EndpointStyles: [{ fillStyle: '#225588' }],\r\n            Endpoints: [[\"Dot\", { radius: 7 }], [\"Blank\"]],\r\n            ConnectionOverlays: [\r\n                [\"Arrow\", { width: 12, length: 12, location: -5 }],\r\n            ],\r\n            ConnectorZIndex: 5\r\n        }\r\n    };\r\n\r\n    protected createJsPlumbInstance = () => {\r\n        return jsPlumb.getInstance({\r\n            DragOptions: { cursor: 'pointer', zIndex: 2000 },\r\n            ConnectionOverlays: [\r\n                ['Arrow', {\r\n                    location: 1,\r\n                    visible: true,\r\n                    width: 11,\r\n                    length: 11\r\n                }],\r\n                ['Label', {\r\n                    location: 0.5,\r\n                    id: 'label',\r\n                    cssClass: 'connection-label'\r\n                }]\r\n            ],\r\n            Container: this.container\r\n        });\r\n    };\r\n\r\n    protected getEndpointColor = (activity: Workflows.Activity) => {\r\n        return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';\r\n    }\r\n\r\n    protected getSourceEndpointOptions = (activity: Workflows.Activity, outcome: Workflows.Outcome): EndpointOptions => {\r\n        // The definition of source endpoints.\r\n        const paintColor = this.getEndpointColor(activity);\r\n        return {\r\n            endpoint: 'Dot',\r\n            anchor: 'Continuous',\r\n            paintStyle: {\r\n                stroke: paintColor,\r\n                fill: paintColor,\r\n                radius: 7,\r\n                strokeWidth: 1\r\n            },\r\n            isSource: true,\r\n            connector: ['Flowchart', { stub: [40, 60], gap: 0, cornerRadius: 5, alwaysRespectStubs: true }],\r\n            connectorStyle: {\r\n                strokeWidth: 2,\r\n                stroke: '#999999',\r\n                joinstyle: 'round',\r\n                outlineStroke: 'white',\r\n                outlineWidth: 2\r\n            },\r\n            hoverPaintStyle: {\r\n                fill: '#216477',\r\n                stroke: '#216477'\r\n            },\r\n            connectorHoverStyle: {\r\n                strokeWidth: 3,\r\n                stroke: '#216477',\r\n                outlineWidth: 5,\r\n                outlineStroke: 'white'\r\n            },\r\n            connectorOverlays: [['Label', { location: [3, -1.5], cssClass: 'endpointSourceLabel' }]],\r\n            dragOptions: {},\r\n            uuid: `${activity.id}-${outcome.name}`,\r\n            parameters: {\r\n                outcome: outcome\r\n            }\r\n        };\r\n    };\r\n\r\n    protected getActivity = function (id: string, activities: Array<Workflows.Activity> = null): Workflows.Activity {\r\n        if (!activities) {\r\n            activities = this.workflowType.activities;\r\n        }\r\n        return $.grep(activities, (x: Workflows.Activity) => x.id === id)[0];\r\n    }\r\n\r\n    protected updateConnections = (plumber: jsPlumbInstance) => {\r\n        var workflowId: number = this.workflowType.id;\r\n\r\n        // Connect activities.\r\n        for (let transitionModel of this.workflowType.transitions) {\r\n            const sourceEndpointUuid: string = `${transitionModel.sourceActivityId}-${transitionModel.sourceOutcomeName}`;\r\n            const sourceEndpoint: Endpoint = plumber.getEndpoint(sourceEndpointUuid);\r\n            const destinationElementId: string = `activity-${workflowId}-${transitionModel.destinationActivityId}`;\r\n\r\n            plumber.connect({\r\n                source: sourceEndpoint,\r\n                target: destinationElementId\r\n            });\r\n        }\r\n    }\r\n\r\n    protected updateCanvasHeight = function () {\r\n        const $container = $(this.container);\r\n\r\n        // Get the activity element with the highest Y coordinate.\r\n        const $activityElements = $container.find(\".activity\");\r\n        let currentElementTop = 0;\r\n        let currentActivityHeight = 0;\r\n\r\n        for (let activityElement of $activityElements.toArray()) {\r\n            const $activityElement = $(activityElement);\r\n            const top = $activityElement.position().top;\r\n\r\n            if (top > currentElementTop) {\r\n                currentElementTop = top;\r\n                currentActivityHeight = $activityElement.height();\r\n            }\r\n        }\r\n\r\n        let newCanvasHeight = currentElementTop + currentActivityHeight;\r\n        const elementBottom = currentElementTop + currentActivityHeight;\r\n        const stretchValue = 100;\r\n\r\n        if (newCanvasHeight - elementBottom <= stretchValue) {\r\n            newCanvasHeight += stretchValue;\r\n        }\r\n\r\n        $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));\r\n    };\r\n}\r\n\r\nexport default WorkflowCanvas;","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":["_workflowCanvas","require","WorkflowViewer","_workflowCanvasDefault","default","constructor","container","workflowType","super","this","getEndpointColor","activity","isBlocking","isEvent","jsPlumb","ready","importDefaults","getDefaults","plumber","createJsPlumbInstance","bind","connInfo","originalEvent","connection","outcome","getParameters","getOverlay","setLabel","displayName","activityElements","getActivityElements","batch","id","each","_","activityElement","activityId","$","data","getActivity","makeTarget","dropOptions","hoverClass","anchor","endpoint","radius","outcomes","sourceEndpointOptions","getSourceEndpointOptions","addEndpoint","connectorOverlays","label","cssClass","updateConnections","show","updateCanvasHeight","jsPlumbInstance","fn","workflowViewer","index","element","$element","document","minCanvasHeight","find","Anchor","DragOptions","cursor","zIndex","EndpointStyles","fillStyle","Endpoints","ConnectionOverlays","width","length","location","ConnectorZIndex","getInstance","visible","Container","isStart","paintColor","paintStyle","stroke","fill","strokeWidth","isSource","connector","stub","gap","cornerRadius","alwaysRespectStubs","connectorStyle","joinstyle","outlineStroke","outlineWidth","hoverPaintStyle","connectorHoverStyle","dragOptions","uuid","name","parameters","activities","grep","x","workflowId","transitionModel","transitions","sourceEndpointUuid","sourceActivityId","sourceOutcomeName","sourceEndpoint","getEndpoint","destinationElementId","destinationActivityId","connect","source","target","$container","$activityElements","currentElementTop","currentActivityHeight","toArray","$activityElement","top","position","height","newCanvasHeight","Math","max","exports","interopDefault","a","__esModule","defineInteropFlag","Object","defineProperty","value","exportAll","dest","keys","forEach","key","prototype","hasOwnProperty","call","enumerable","get","export","destName"],"version":3,"file":"workflow-viewer.js.map"}