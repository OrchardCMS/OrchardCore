{"mappings":"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","sources":["src/OrchardCore.Modules/OrchardCore.Workflows/Assets/Scripts/workflow-editor.ts","src/OrchardCore.Modules/OrchardCore.Workflows/Assets/Scripts/activity-picker.ts","src/OrchardCore.Modules/OrchardCore.Workflows/Assets/Scripts/workflow-url-generator.ts","src/OrchardCore.Modules/OrchardCore.Workflows/Assets/Scripts/workflow-canvas.ts","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["///<reference path='../Lib/jquery/typings.d.ts' />\r\n///<reference path='../Lib/jsplumb/typings.d.ts' />\r\n\r\nimport './workflow-models';\r\nimport './activity-picker';\r\nimport './workflow-url-generator';\r\nimport WorkflowCanvas from './workflow-canvas';\r\n\r\n// TODO: Re-implement this using a MVVM approach.\r\nclass WorkflowEditor extends WorkflowCanvas {\r\n    private jsPlumbInstance: jsPlumbInstance;\r\n    private isPopoverVisible: boolean;\r\n    private hasDragged: boolean;\r\n    private dragStart: JQuery.Coordinates;\r\n\r\n    constructor(protected container: HTMLElement, protected workflowType: Workflows.WorkflowType, private deleteActivityPrompt: string, private localId: string, loadLocalState: boolean) {\r\n        super(container, workflowType);\r\n        const self = this;\r\n\r\n        jsPlumb.ready(() => {\r\n            jsPlumb.importDefaults(this.getDefaults());\r\n\r\n            const plumber = this.createJsPlumbInstance();\r\n\r\n            // Listen for new connections.\r\n            plumber.bind('connection', function (connInfo, originalEvent) {\r\n                const connection: Connection = connInfo.connection;\r\n                const outcome: Workflows.Outcome = connection.getParameters().outcome;\r\n\r\n                const label: any = connection.getOverlay('label');\r\n                label.setLabel(outcome.displayName);\r\n            });\r\n\r\n            let activityElements = this.getActivityElements();\r\n\r\n            var areEqualOutcomes = function (outcomes1: Workflows.Outcome[], outcomes2: Workflows.Outcome[]): boolean {\r\n                if (outcomes1.length != outcomes2.length) {\r\n                    return false;\r\n                }\r\n\r\n                for (let i = 0; i < outcomes1.length; i++) {\r\n                    const outcome1 = outcomes1[i];\r\n                    const outcome2 = outcomes2[i];\r\n\r\n                    if (outcome1.name != outcome2.name || outcome1.displayName != outcome2.displayName) {\r\n                        return false;\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            // Suspend drawing and initialize.\r\n            plumber.batch(() => {\r\n                var serverworkflowType: Workflows.WorkflowType = this.workflowType;\r\n                var workflowId: number = this.workflowType.id;\r\n\r\n                if (loadLocalState) {\r\n                    const localState: Workflows.WorkflowType = this.loadLocalState();\r\n\r\n                    if (localState) {\r\n                        this.workflowType = localState;\r\n                    }\r\n                }\r\n\r\n                activityElements.each((_, activityElement) => {\r\n                    const $activityElement = $(activityElement);\r\n                    const activityId = $activityElement.data('activity-id');\r\n                    const isDeleted = this.workflowType.removedActivities.indexOf(activityId) > -1;\r\n\r\n                    if (isDeleted) {\r\n                        $activityElement.remove();\r\n                        return;\r\n                    }\r\n\r\n                    let activity = this.getActivity(activityId);\r\n                    const serverActivity = this.getActivity(activityId, serverworkflowType.activities);\r\n\r\n                    // Update the activity's visual state.\r\n                    if (loadLocalState) {\r\n                        if (activity == null) {\r\n                            // This is a newly added activity not yet added to local state.\r\n                            activity = serverActivity;\r\n                            this.workflowType.activities.push(activity);\r\n\r\n                            activity.x = 50;\r\n                            activity.y = 50;\r\n                        }\r\n                        else {\r\n                            // The available outcomes might have changed when editing an activity,\r\n                            // so we need to check for that and update the client's activity outcomes if so.\r\n                            const sameOutcomes = areEqualOutcomes(activity.outcomes, serverActivity.outcomes);\r\n\r\n                            if (!sameOutcomes) {\r\n                                activity.outcomes = serverActivity.outcomes;\r\n                            }\r\n\r\n                            $activityElement\r\n                                .css({ left: activity.x, top: activity.y })\r\n                                .toggleClass('activity-start', activity.isStart)\r\n                                .data('activity-start', activity.isStart);\r\n                        }\r\n                    }\r\n\r\n                    // Make the activity draggable.\r\n                    plumber.draggable(activityElement, {\r\n                        grid: [10, 10],\r\n                        containment: true,\r\n                        start: (args: any) => {\r\n                            this.dragStart = { left: args.e.screenX, top: args.e.screenY };\r\n                        },\r\n                        stop: (args: any) => {\r\n                            this.hasDragged = this.dragStart.left != args.e.screenX || this.dragStart.top != args.e.screenY;\r\n                            this.updateCanvasHeight();\r\n                        }\r\n                    });\r\n\r\n                    // Configure the activity as a target.\r\n                    plumber.makeTarget(activityElement, {\r\n                        dropOptions: { hoverClass: 'hover' },\r\n                        anchor: 'Continuous',\r\n                        endpoint: ['Blank', { radius: 8 }]\r\n                    });\r\n\r\n                    // Add source endpoints.\r\n                    for (let outcome of activity.outcomes) {\r\n                        const sourceEndpointOptions = this.getSourceEndpointOptions(activity, outcome);\r\n                        plumber.addEndpoint(activityElement, { connectorOverlays: [['Label', { label: outcome.displayName, cssClass: 'connection-label' }]] }, sourceEndpointOptions);\r\n                    }\r\n                });\r\n\r\n                // Connect activities.\r\n                this.updateConnections(plumber);\r\n\r\n                // Re-query the activity elements.\r\n                activityElements = this.getActivityElements();\r\n\r\n                // Make all activity elements visible.\r\n                activityElements.show();\r\n\r\n                this.updateCanvasHeight();\r\n            });\r\n\r\n            // Initialize popovers.\r\n            activityElements.each((_, item) => {\r\n                var activityElement = $(item);\r\n                activityElement.popover({\r\n                    trigger: 'manual',\r\n                    html: true,\r\n                    content: () => {\r\n                        const $content: JQuery<Element> = activityElement.find('.activity-commands').clone();\r\n                        const startButton = $content.find('.activity-start-action');\r\n                        const isStart = activityElement.data('activity-start') === true;\r\n                        const activityId: number = activityElement.data('activity-id');\r\n                        startButton.attr('aria-pressed', activityElement.data('activity-start'));\r\n                        startButton.toggleClass('active', isStart);\r\n\r\n                        $content.on('click', '.activity-start-action', e => {\r\n                            e.preventDefault();\r\n                            const button = $(e.currentTarget);\r\n\r\n                            const isStart = button.is('.active');\r\n                            activityElement.data('activity-start', isStart);\r\n                            activityElement.toggleClass('activity-start', isStart);\r\n                        });\r\n\r\n                        $content.on('click', '.activity-delete-action', e => {\r\n                            e.preventDefault();\r\n\r\n                            // TODO: The prompts are really annoying. Consider showing some sort of small message balloon somewhere to undo the action instead.\r\n                            //if (!confirm(self.deleteActivityPrompt)) {\r\n                            //    return;\r\n                            //}\r\n\r\n                            self.workflowType.removedActivities.push(activityId);\r\n                            plumber.remove(activityElement);\r\n                            activityElement.popover('dispose');\r\n                        });\r\n\r\n                        $content.on('click', '[data-persist-workflow]', e => {\r\n                            self.saveLocalState();\r\n                        });\r\n\r\n                        return $content.get(0);\r\n                    }\r\n                });\r\n            });\r\n           \r\n            $(container).on('click', '.activity', e => {\r\n                if (this.hasDragged) {\r\n                    this.hasDragged = false;\r\n                    return;\r\n                }\r\n\r\n                // if any other popovers are visible, hide them\r\n                if (this.isPopoverVisible) {\r\n                    activityElements.popover('hide');\r\n                }\r\n\r\n                const sender = $(e.currentTarget);\r\n                sender.popover('show');\r\n\r\n                // handle clicking on the popover itself.\r\n                $('.popover').off('click').on('click', e2 => {\r\n                    e2.stopPropagation();\r\n                })\r\n\r\n                e.stopPropagation();\r\n                this.isPopoverVisible = true;\r\n            });\r\n\r\n            $(container).on('dblclick', '.activity', e => {\r\n                const sender = $(e.currentTarget);\r\n                const hasEditor = sender.data('activity-has-editor');\r\n\r\n                if (hasEditor) {\r\n                    this.saveLocalState();\r\n                    sender.find('.activity-edit-action').get(0).click();\r\n                }\r\n            });\r\n\r\n            // Hide all popovers when clicking anywhere but on an activity.\r\n            $('body').on('click', e => {\r\n                activityElements.popover('hide');\r\n                this.isPopoverVisible = false;\r\n            });\r\n\r\n            // Save local changes if the event target has the 'data-persist-workflow' attribute.\r\n            $('body').on('click', '[data-persist-workflow]', e => {\r\n                this.saveLocalState();\r\n            });\r\n\r\n            this.jsPlumbInstance = plumber;\r\n        });\r\n    }\r\n\r\n    private getState = (): Workflows.WorkflowType => {\r\n        const $allActivityElements = $(this.container).find('.activity');\r\n        const workflow: Workflows.WorkflowType = {\r\n            id: this.workflowType.id,\r\n            activities: [],\r\n            transitions: [],\r\n            removedActivities: this.workflowType.removedActivities\r\n        };\r\n\r\n        // Collect activities.\r\n        for (let i = 0; i < $allActivityElements.length; i++) {\r\n            const $activityElement: JQuery = $($allActivityElements[i]);\r\n            const activityId: string = $activityElement.data('activity-id');\r\n            const activityIsStart: boolean = $activityElement.data('activity-start');\r\n            const activityIsEvent: boolean = $activityElement.data('activity-type') === 'Event';\r\n            const activityPosition: JQuery.Coordinates = $activityElement.position();\r\n            const activity: Workflows.Activity = this.getActivity(activityId);\r\n\r\n            workflow.activities.push({\r\n                id: activityId,\r\n                isStart: activityIsStart,\r\n                isEvent: activityIsEvent,\r\n                outcomes: activity.outcomes,\r\n                x: activityPosition.left,\r\n                y: activityPosition.top\r\n            });\r\n        }\r\n\r\n        // Collect connections.\r\n        const allConnections = this.jsPlumbInstance.getConnections();\r\n\r\n        for (let i = 0; i < allConnections.length; i++) {\r\n            var connection = allConnections[i];\r\n            var sourceEndpoint: Endpoint = connection.endpoints[0];\r\n            var sourceOutcomeName = sourceEndpoint.getParameters().outcome.name;\r\n            var sourceActivityId: string = $(connection.source).data('activity-id');\r\n            var destinationActivityId: string = $(connection.target).data('activity-id');\r\n\r\n            workflow.transitions.push({\r\n                sourceActivityId: sourceActivityId,\r\n                destinationActivityId: destinationActivityId,\r\n                sourceOutcomeName: sourceOutcomeName\r\n            });\r\n        }\r\n\r\n        return workflow;\r\n    }\r\n\r\n    public serialize = (): string => {\r\n        const workflow: Workflows.WorkflowType = this.getState();\r\n        return JSON.stringify(workflow);\r\n    }\r\n\r\n    private saveLocalState = (): void => {\r\n        sessionStorage[this.localId] = this.serialize();\r\n    }\r\n\r\n    private loadLocalState = (): Workflows.WorkflowType => {\r\n        return JSON.parse(sessionStorage[this.localId]);\r\n    }\r\n}\r\n\r\n$.fn.workflowEditor = function (this: JQuery): JQuery {\r\n    this.each((index, element) => {\r\n        var $element = $(element);\r\n        var workflowType: Workflows.WorkflowType = $element.data('workflow-type');\r\n        var deleteActivityPrompt: string = $element.data('workflow-delete-activity-prompt');\r\n        var localId: string = $element.data('workflow-local-id');\r\n        var loadLocalState: boolean = $element.data('workflow-load-local-state');\r\n\r\n        workflowType.removedActivities = workflowType.removedActivities || [];\r\n        $element.data('workflowEditor', new WorkflowEditor(element, workflowType, deleteActivityPrompt, localId, loadLocalState));\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\n$(document).ready(function () {\r\n    const workflowEditor: WorkflowEditor = $('.workflow-canvas').workflowEditor().data('workflowEditor');\r\n\r\n    $('#workflowEditorForm').on('submit', (s, e) => {\r\n        const state = workflowEditor.serialize();\r\n        $('#workflowStateInput').val(state);\r\n    });\r\n});\r\n","///<reference path='../Lib/jquery/typings.d.ts' />\r\n\r\nvar applyFilter = function (category: string, q: string) {\r\n    const type = $('.modal-activities').data('activity-type');\r\n    category = category || $('.activity-picker-categories .nav-link.active').attr('href').substr(1);\r\n    q = q || <string>$('.modal-activities input[type=search]').val();\r\n\r\n    const $cards = $('.activity.col').show();\r\n\r\n    // Remove activities whoes type doesn't match the configured activity type.\r\n    $cards.filter((i, el) => {\r\n        return $(el).data('activity-type') != type;\r\n    }).hide();\r\n\r\n    if (q.length > 0) {\r\n        // Remove activities whose title doesn't match the query.\r\n        $cards.filter((i, el) => {\r\n            return $(el).find('.card-title').text().toLowerCase().indexOf(q.toLowerCase()) < 0 && q && q.length > 0;\r\n        }).hide();\r\n    }\r\n    else {\r\n        // Remove activities whose category doesn't match the selected one.\r\n        $cards.filter((i, el) => {\r\n            return $(el).data('category').toLowerCase() != category.toLowerCase() && category.toLowerCase() != 'all';\r\n        }).hide();\r\n    }\r\n\r\n    // Show or hide categories based on whether there are any available activities.\r\n    $('.activity-picker-categories [data-category]').each((i, el) => {\r\n        const categoryListItem = $(el);\r\n        const category = categoryListItem.data('category');\r\n\r\n        // Count number of activities within this category and for the specified activity type (Event or Task).\r\n        const activityCount = $(`.activity.col[data-category='${category}'][data-activity-type='${type}']`).length;\r\n        activityCount == 0 ? categoryListItem.hide() : categoryListItem.show();\r\n    });\r\n};\r\n\r\n$(() => {\r\n    $('.activity-picker-categories').on('click', '.nav-link', e => {\r\n        applyFilter($(e.target).attr('href').substr(1), null);\r\n    });\r\n\r\n    $('.modal-activities input[type=search]').on('keyup', e => {\r\n        applyFilter(null, <string>$(e.target).val());\r\n    });\r\n\r\n    $('#activity-picker').on('show.bs.modal', function (event) {\r\n        var modalEvent = event as any;\r\n        var button = $(modalEvent.relatedTarget); // Button that triggered the modal.\r\n        var title = button.data('picker-title');\r\n        var type = button.data('activity-type');\r\n        var modal = $(this);\r\n        modal.find('[href=\"#all\"]').click();\r\n        modal.find('.modal-title').text(title);\r\n        modal.data('activity-type', type);\r\n        applyFilter(null, null);\r\n    })\r\n});\r\n","///<reference path=\"../Lib/jquery/typings.d.ts\" />\r\n\r\n$(() => {\r\n    const generateWorkflowUrl = function () {\r\n        const workflowTypeId: string = $('[data-workflow-type-id]').data('workflow-type-id');\r\n        const activityId: string = $('[data-activity-id]').data('activity-id');\r\n        var tokenLifeSpan = $('#token-lifespan').val();\r\n        const generateUrl: string = $('[data-generate-url]').data('generate-url') + `?workflowTypeId=${workflowTypeId}&activityId=${activityId}&tokenLifeSpan=${tokenLifeSpan}`;\r\n        const antiforgeryHeaderName: string = $('[data-antiforgery-header-name]').data('antiforgery-header-name');\r\n        const antiforgeryToken: string = $('[data-antiforgery-token]').data('antiforgery-token');\r\n        const headers: any = {};\r\n\r\n        headers[antiforgeryHeaderName] = antiforgeryToken;\r\n\r\n        $.post({\r\n            url: generateUrl,\r\n            headers: headers\r\n        }).done(url => {\r\n            $('#workflow-url-text').val(url);\r\n        });\r\n    };\r\n\r\n    $('#generate-url-button').on('click', e => {\r\n        generateWorkflowUrl();\r\n    });\r\n\r\n    if ($('#workflow-url-text').val() == '') {\r\n        generateWorkflowUrl();\r\n    }\r\n});\r\n","///<reference path='../Lib/jquery/typings.d.ts' />\r\n///<reference path='../Lib/jsplumb/typings.d.ts' />\r\n\r\nimport './workflow-models';\r\n\r\nabstract class WorkflowCanvas {\r\n    private minCanvasHeight: number = 400;\r\n\r\n    constructor(protected container: HTMLElement, protected workflowType: Workflows.WorkflowType) {\r\n    }\r\n\r\n    protected getActivityElements = (): JQuery => {\r\n        return $(this.container).find('.activity');\r\n    }\r\n\r\n    protected getDefaults = () => {\r\n        return {\r\n            Anchor: \"Continuous\",\r\n            DragOptions: { cursor: 'pointer', zIndex: 2000 },\r\n            EndpointStyles: [{ fillStyle: '#225588' }],\r\n            Endpoints: [[\"Dot\", { radius: 7 }], [\"Blank\"]],\r\n            ConnectionOverlays: [\r\n                [\"Arrow\", { width: 12, length: 12, location: -5 }],\r\n            ],\r\n            ConnectorZIndex: 5\r\n        }\r\n    };\r\n\r\n    protected createJsPlumbInstance = () => {\r\n        return jsPlumb.getInstance({\r\n            DragOptions: { cursor: 'pointer', zIndex: 2000 },\r\n            ConnectionOverlays: [\r\n                ['Arrow', {\r\n                    location: 1,\r\n                    visible: true,\r\n                    width: 11,\r\n                    length: 11\r\n                }],\r\n                ['Label', {\r\n                    location: 0.5,\r\n                    id: 'label',\r\n                    cssClass: 'connection-label'\r\n                }]\r\n            ],\r\n            Container: this.container\r\n        });\r\n    };\r\n\r\n    protected getEndpointColor = (activity: Workflows.Activity) => {\r\n        return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';\r\n    }\r\n\r\n    protected getSourceEndpointOptions = (activity: Workflows.Activity, outcome: Workflows.Outcome): EndpointOptions => {\r\n        // The definition of source endpoints.\r\n        const paintColor = this.getEndpointColor(activity);\r\n        return {\r\n            endpoint: 'Dot',\r\n            anchor: 'Continuous',\r\n            paintStyle: {\r\n                stroke: paintColor,\r\n                fill: paintColor,\r\n                radius: 7,\r\n                strokeWidth: 1\r\n            },\r\n            isSource: true,\r\n            connector: ['Flowchart', { stub: [40, 60], gap: 0, cornerRadius: 5, alwaysRespectStubs: true }],\r\n            connectorStyle: {\r\n                strokeWidth: 2,\r\n                stroke: '#999999',\r\n                joinstyle: 'round',\r\n                outlineStroke: 'white',\r\n                outlineWidth: 2\r\n            },\r\n            hoverPaintStyle: {\r\n                fill: '#216477',\r\n                stroke: '#216477'\r\n            },\r\n            connectorHoverStyle: {\r\n                strokeWidth: 3,\r\n                stroke: '#216477',\r\n                outlineWidth: 5,\r\n                outlineStroke: 'white'\r\n            },\r\n            connectorOverlays: [['Label', { location: [3, -1.5], cssClass: 'endpointSourceLabel' }]],\r\n            dragOptions: {},\r\n            uuid: `${activity.id}-${outcome.name}`,\r\n            parameters: {\r\n                outcome: outcome\r\n            }\r\n        };\r\n    };\r\n\r\n    protected getActivity = function (id: string, activities: Array<Workflows.Activity> = null): Workflows.Activity {\r\n        if (!activities) {\r\n            activities = this.workflowType.activities;\r\n        }\r\n        return $.grep(activities, (x: Workflows.Activity) => x.id === id)[0];\r\n    }\r\n\r\n    protected updateConnections = (plumber: jsPlumbInstance) => {\r\n        var workflowId: number = this.workflowType.id;\r\n\r\n        // Connect activities.\r\n        for (let transitionModel of this.workflowType.transitions) {\r\n            const sourceEndpointUuid: string = `${transitionModel.sourceActivityId}-${transitionModel.sourceOutcomeName}`;\r\n            const sourceEndpoint: Endpoint = plumber.getEndpoint(sourceEndpointUuid);\r\n            const destinationElementId: string = `activity-${workflowId}-${transitionModel.destinationActivityId}`;\r\n\r\n            plumber.connect({\r\n                source: sourceEndpoint,\r\n                target: destinationElementId\r\n            });\r\n        }\r\n    }\r\n\r\n    protected updateCanvasHeight = function () {\r\n        const $container = $(this.container);\r\n\r\n        // Get the activity element with the highest Y coordinate.\r\n        const $activityElements = $container.find(\".activity\");\r\n        let currentElementTop = 0;\r\n        let currentActivityHeight = 0;\r\n\r\n        for (let activityElement of $activityElements.toArray()) {\r\n            const $activityElement = $(activityElement);\r\n            const top = $activityElement.position().top;\r\n\r\n            if (top > currentElementTop) {\r\n                currentElementTop = top;\r\n                currentActivityHeight = $activityElement.height();\r\n            }\r\n        }\r\n\r\n        let newCanvasHeight = currentElementTop + currentActivityHeight;\r\n        const elementBottom = currentElementTop + currentActivityHeight;\r\n        const stretchValue = 100;\r\n\r\n        if (newCanvasHeight - elementBottom <= stretchValue) {\r\n            newCanvasHeight += stretchValue;\r\n        }\r\n\r\n        $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));\r\n    };\r\n}\r\n\r\nexport default WorkflowCanvas;","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":["_workflowCanvas","require","WorkflowEditor","_workflowCanvasDefault","default","constructor","container","workflowType","deleteActivityPrompt","localId","loadLocalState","super","this","getState","$allActivityElements","$","find","workflow","id","activities","transitions","removedActivities","i","length","$activityElement","activityId","data","activityIsStart","activityIsEvent","activityPosition","position","activity","getActivity","push","isStart","isEvent","outcomes","x","left","y","top","allConnections","jsPlumbInstance","getConnections","connection","sourceOutcomeName","endpoints","getParameters","outcome","name","sourceActivityId","source","destinationActivityId","target","serialize","JSON","stringify","saveLocalState","sessionStorage","parse","self","jsPlumb","ready","importDefaults","getDefaults","plumber","createJsPlumbInstance","bind","connInfo","originalEvent","getOverlay","setLabel","displayName","activityElements","getActivityElements","batch","serverworkflowType","localState","each","_","activityElement","indexOf","remove","serverActivity","outcomes1","outcomes2","outcome1","outcome2","areEqualOutcomes","css","toggleClass","draggable","grid","containment","start","args","dragStart","e","screenX","screenY","stop","hasDragged","updateCanvasHeight","makeTarget","dropOptions","hoverClass","anchor","endpoint","radius","sourceEndpointOptions","getSourceEndpointOptions","addEndpoint","connectorOverlays","label","cssClass","updateConnections","show","item","popover","trigger","html","content","$content","clone","startButton","attr","on","preventDefault","currentTarget","is","get","isPopoverVisible","off","e2","stopPropagation","sender","click","fn","workflowEditor","index","element","$element","document","s","state","val","applyFilter","category","q","type","substr","$cards","filter","el","hide","text","toLowerCase","categoryListItem","event","button","relatedTarget","title","modal","generateWorkflowUrl","workflowTypeId","tokenLifeSpan","generateUrl","antiforgeryHeaderName","antiforgeryToken","headers","post","url","done","minCanvasHeight","Anchor","DragOptions","cursor","zIndex","EndpointStyles","fillStyle","Endpoints","ConnectionOverlays","width","location","ConnectorZIndex","getInstance","visible","Container","getEndpointColor","isBlocking","paintColor","paintStyle","stroke","fill","strokeWidth","isSource","connector","stub","gap","cornerRadius","alwaysRespectStubs","connectorStyle","joinstyle","outlineStroke","outlineWidth","hoverPaintStyle","connectorHoverStyle","dragOptions","uuid","parameters","grep","workflowId","transitionModel","sourceEndpointUuid","sourceEndpoint","getEndpoint","destinationElementId","connect","$container","$activityElements","currentElementTop","currentActivityHeight","toArray","height","newCanvasHeight","Math","max","exports","interopDefault","a","__esModule","defineInteropFlag","Object","defineProperty","value","exportAll","dest","keys","forEach","key","prototype","hasOwnProperty","call","enumerable","export","destName"],"version":3,"file":"workflow-editor.js.map"}