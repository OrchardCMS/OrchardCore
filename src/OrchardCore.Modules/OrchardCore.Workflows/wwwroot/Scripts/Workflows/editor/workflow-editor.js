!function(t,e,i,o){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n="function"==typeof a[o]&&a[o],r=n.cache||{},s="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,i){if(!r[e]){if(!t[e]){var l="function"==typeof a[o]&&a[o];if(!i&&l)return l(e,!0);if(n)return n(e,!0);if(s&&"string"==typeof e)return s(e);var d=new Error("Cannot find module '"+e+"'");throw d.code="MODULE_NOT_FOUND",d}f.resolve=function(i){var o=t[e][1][i];return null!=o?o:i},f.cache={};var u=r[e]=new c.Module(e);t[e][0].call(u.exports,f,u,u.exports,a)}return r[e].exports;function f(t){var e=f.resolve(t);return!1===e?{}:c(e)}}c.isParcelRequire=!0,c.Module=function(t){this.id=t,this.bundle=c,this.exports={}},c.modules=t,c.cache=r,c.parent=n,c.register=function(e,i){t[e]=[function(t,e){e.exports=i},{}]},Object.defineProperty(c,"root",{get:function(){return a[o]}}),a[o]=c;for(var l=0;l<e.length;l++)c(e[l]);if(i){var d=c(i);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof define&&define.amd&&define((function(){return d}))}}({"1cTtB":[function(t,e,i,o){var a=t("@parcel/transformer-js/src/esmodule-helpers.js"),n=(t("./workflow-models"),t("./activity-picker"),t("./workflow-url-generator"),t("./workflow-canvas")),r=a.interopDefault(n);class s extends r.default{constructor(t,e,i,o,a){super(t,e),this.container=t,this.workflowType=e,this.deleteActivityPrompt=i,this.localId=o,this.getState=()=>{const t=$(this.container).find(".activity"),e={id:this.workflowType.id,activities:[],transitions:[],removedActivities:this.workflowType.removedActivities};for(let i=0;i<t.length;i++){const o=$(t[i]),a=o.data("activity-id"),n=o.data("activity-start"),r="Event"===o.data("activity-type"),s=o.position(),c=this.getActivity(a);e.activities.push({id:a,isStart:n,isEvent:r,outcomes:c.outcomes,x:s.left,y:s.top})}const i=this.jsPlumbInstance.getConnections();for(let t=0;t<i.length;t++){var o=i[t],a=o.endpoints[0].getParameters().outcome.name,n=$(o.source).data("activity-id"),r=$(o.target).data("activity-id");e.transitions.push({sourceActivityId:n,destinationActivityId:r,sourceOutcomeName:a})}return e},this.serialize=()=>{const t=this.getState();return JSON.stringify(t)},this.saveLocalState=()=>{sessionStorage[this.localId]=this.serialize()},this.loadLocalState=()=>JSON.parse(sessionStorage[this.localId]);const n=this;jsPlumb.ready((()=>{jsPlumb.importDefaults(this.getDefaults());const e=this.createJsPlumbInstance();e.bind("connection",(function(t,e){const i=t.connection,o=i.getParameters().outcome;i.getOverlay("label").setLabel(o.displayName)}));let i=this.getActivityElements();e.batch((()=>{var t=this.workflowType;this.workflowType.id;if(a){const t=this.loadLocalState();t&&(this.workflowType=t)}i.each(((i,o)=>{const n=$(o),r=n.data("activity-id");if(this.workflowType.removedActivities.indexOf(r)>-1)return void n.remove();let s=this.getActivity(r);const c=this.getActivity(r,t.activities);if(a)if(null==s)s=c,this.workflowType.activities.push(s),s.x=50,s.y=50;else{(function(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){const o=t[i],a=e[i];if(o.name!=a.name||o.displayName!=a.displayName)return!1}return!0})(s.outcomes,c.outcomes)||(s.outcomes=c.outcomes),n.css({left:s.x,top:s.y}).toggleClass("activity-start",s.isStart).data("activity-start",s.isStart)}e.draggable(o,{grid:[10,10],containment:!0,start:t=>{this.dragStart={left:t.e.screenX,top:t.e.screenY}},stop:t=>{this.hasDragged=this.dragStart.left!=t.e.screenX||this.dragStart.top!=t.e.screenY,this.updateCanvasHeight()}}),e.makeTarget(o,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:8}]});for(let t of s.outcomes){const i=this.getSourceEndpointOptions(s,t);e.addEndpoint(o,{connectorOverlays:[["Label",{label:t.displayName,cssClass:"connection-label"}]]},i)}})),this.updateConnections(e),i=this.getActivityElements(),i.show(),this.updateCanvasHeight()})),i.each(((t,i)=>{var o=$(i);o.popover({trigger:"manual",html:!0,content:()=>{const t=o.find(".activity-commands").clone(),i=t.find(".activity-start-action"),a=!0===o.data("activity-start"),r=o.data("activity-id");return i.attr("aria-pressed",o.data("activity-start")),i.toggleClass("active",a),t.on("click",".activity-start-action",(t=>{t.preventDefault();const e=$(t.currentTarget).is(".active");o.data("activity-start",e),o.toggleClass("activity-start",e)})),t.on("click",".activity-delete-action",(t=>{t.preventDefault(),n.workflowType.removedActivities.push(r),e.remove(o),o.popover("dispose")})),t.on("click","[data-persist-workflow]",(t=>{n.saveLocalState()})),t.get(0)}})})),$(t).on("click",".activity",(t=>{if(this.hasDragged)return void(this.hasDragged=!1);this.isPopoverVisible&&i.popover("hide");$(t.currentTarget).popover("show"),$(".popover").off("click").on("click",(t=>{t.stopPropagation()})),t.stopPropagation(),this.isPopoverVisible=!0})),$(t).on("dblclick",".activity",(t=>{const e=$(t.currentTarget);e.data("activity-has-editor")&&(this.saveLocalState(),e.find(".activity-edit-action").get(0).click())})),$("body").on("click",(t=>{i.popover("hide"),this.isPopoverVisible=!1})),$("body").on("click","[data-persist-workflow]",(t=>{this.saveLocalState()})),this.jsPlumbInstance=e}))}}$.fn.workflowEditor=function(){return this.each(((t,e)=>{var i=$(e),o=i.data("workflow-type"),a=i.data("workflow-delete-activity-prompt"),n=i.data("workflow-local-id"),r=i.data("workflow-load-local-state");o.removedActivities=o.removedActivities||[],i.data("workflowEditor",new s(e,o,a,n,r))})),this},$(document).ready((function(){const t=$(".workflow-canvas").workflowEditor().data("workflowEditor");$("#workflowEditorForm").on("submit",((e,i)=>{const o=t.serialize();$("#workflowStateInput").val(o)}))}))},{"./workflow-models":"aM2tG","./activity-picker":"40nzd","./workflow-url-generator":"f5jsY","./workflow-canvas":"cHBDw","@parcel/transformer-js/src/esmodule-helpers.js":"dGByK"}],aM2tG:[function(t,e,i,o){},{}],"40nzd":[function(t,e,i,o){var a=function(t,e){const i=$(".modal-activities").data("activity-type");t=t||$(".activity-picker-categories .nav-link.active").attr("href").substr(1),e=e||$(".modal-activities input[type=search]").val();const o=$(".activity.col").show();o.filter(((t,e)=>$(e).data("activity-type")!=i)).hide(),e.length>0?o.filter(((t,i)=>$(i).find(".card-title").text().toLowerCase().indexOf(e.toLowerCase())<0&&e&&e.length>0)).hide():o.filter(((e,i)=>$(i).data("category").toLowerCase()!=t.toLowerCase()&&"all"!=t.toLowerCase())).hide(),$(".activity-picker-categories [data-category]").each(((t,e)=>{const o=$(e),a=o.data("category");0==$(`.activity.col[data-category='${a}'][data-activity-type='${i}']`).length?o.hide():o.show()}))};$((()=>{$(".activity-picker-categories").on("click",".nav-link",(t=>{a($(t.target).attr("href").substr(1),null)})),$(".modal-activities input[type=search]").on("keyup",(t=>{a(null,$(t.target).val())})),$("#activity-picker").on("show.bs.modal",(function(t){var e=$(t.relatedTarget),i=e.data("picker-title"),o=e.data("activity-type"),n=$(this);n.find('[href="#all"]').click(),n.find(".modal-title").text(i),n.data("activity-type",o),a(null,null)}))}))},{}],f5jsY:[function(t,e,i,o){$((()=>{const t=function(){const t=$("[data-workflow-type-id]").data("workflow-type-id"),e=$("[data-activity-id]").data("activity-id");var i=$("#token-lifespan").val();const o=$("[data-generate-url]").data("generate-url")+`?workflowTypeId=${t}&activityId=${e}&tokenLifeSpan=${i}`,a=$("[data-antiforgery-header-name]").data("antiforgery-header-name"),n=$("[data-antiforgery-token]").data("antiforgery-token"),r={};r[a]=n,$.post({url:o,headers:r}).done((t=>{$("#workflow-url-text").val(t)}))};$("#generate-url-button").on("click",(e=>{t()})),""==$("#workflow-url-text").val()&&t()}))},{}],cHBDw:[function(t,e,i,o){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);t("./workflow-models");i.default=class{constructor(t,e){this.container=t,this.workflowType=e,this.minCanvasHeight=400,this.getActivityElements=()=>$(this.container).find(".activity"),this.getDefaults=()=>({Anchor:"Continuous",DragOptions:{cursor:"pointer",zIndex:2e3},EndpointStyles:[{fillStyle:"#225588"}],Endpoints:[["Dot",{radius:7}],["Blank"]],ConnectionOverlays:[["Arrow",{width:12,length:12,location:-5}]],ConnectorZIndex:5}),this.createJsPlumbInstance=()=>jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:this.container}),this.getEndpointColor=t=>t.isBlocking||t.isStart?"#7ab02c":t.isEvent?"#3a8acd":"#7ab02c",this.getSourceEndpointOptions=(t,e)=>{const i=this.getEndpointColor(t);return{endpoint:"Dot",anchor:"Continuous",paintStyle:{stroke:i,fill:i,radius:7,strokeWidth:1},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:"#999999",joinstyle:"round",outlineStroke:"white",outlineWidth:2},hoverPaintStyle:{fill:"#216477",stroke:"#216477"},connectorHoverStyle:{strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],dragOptions:{},uuid:`${t.id}-${e.name}`,parameters:{outcome:e}}},this.getActivity=function(t,e=null){return e||(e=this.workflowType.activities),$.grep(e,(e=>e.id===t))[0]},this.updateConnections=t=>{var e=this.workflowType.id;for(let i of this.workflowType.transitions){const o=`${i.sourceActivityId}-${i.sourceOutcomeName}`,a=t.getEndpoint(o),n=`activity-${e}-${i.destinationActivityId}`;t.connect({source:a,target:n})}},this.updateCanvasHeight=function(){const t=$(this.container),e=t.find(".activity");let i=0,o=0;for(let t of e.toArray()){const e=$(t),a=e.position().top;a>i&&(i=a,o=e.height())}let a=i+o;a-(i+o)<=100&&(a+=100),t.height(Math.max(this.minCanvasHeight,a))}}}},{"./workflow-models":"aM2tG","@parcel/transformer-js/src/esmodule-helpers.js":"dGByK"}],dGByK:[function(t,e,i,o){i.interopDefault=function(t){return t&&t.__esModule?t:{default:t}},i.defineInteropFlag=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.exportAll=function(t,e){return Object.keys(t).forEach((function(i){"default"===i||"__esModule"===i||Object.prototype.hasOwnProperty.call(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[i]}})})),e},i.export=function(t,e,i){Object.defineProperty(t,e,{enumerable:!0,get:i})}},{}]},["1cTtB"],"1cTtB","parcelRequire94c2");
//# sourceMappingURL=workflow-editor.js.map
