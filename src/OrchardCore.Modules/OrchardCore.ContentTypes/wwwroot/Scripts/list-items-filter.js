/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

document.addEventListener('DOMContentLoaded', function () {
  var searchBox = document.getElementById('search-box');
  var allRows = Array.from(document.querySelectorAll("#list-items > li[data-filter-value]"));
  var listAlert = document.getElementById('list-alert');
  var createButton = document.getElementById("btnCreate");
  var visibleRows = allRows;

  // On each keypress filter the list of types
  searchBox.addEventListener('keyup', function (e) {
    visibleRows = [];
    var search = e.target.value.toLowerCase().trim();

    // On ESC, clear the search box and display all types
    if (e.key === "Escape" || search == '') {
      searchBox.value = '';
      allRows.forEach(function (row) {
        row.classList.remove("d-none");
        row.classList.remove("first-child-visible");
        row.classList.remove("last-child-visible");
        visibleRows.push(row);
      });
    } else {
      allRows.forEach(function (row) {
        var text = row.getAttribute('data-filter-value').toLowerCase();
        var found = text.indexOf(search) > -1;
        if (found) {
          row.classList.remove("d-none");
          row.classList.remove("first-child-visible");
          row.classList.remove("last-child-visible");
          row.classList.remove("border-top");
          row.classList.remove("rounded-top");
          visibleRows.push(row);
        } else {
          row.classList.add("d-none");
        }
      });
      if (visibleRows.length > 0) {
        visibleRows[0].classList.add('first-child-visible');
        visibleRows[0].classList.add('border-top');
        visibleRows[0].classList.add("rounded-top");
        visibleRows[visibleRows.length - 1].classList.add('last-child-visible');
      }
    }
    if (visibleRows.length == 0) {
      listAlert.classList.remove("d-none");
    } else {
      listAlert.classList.add("d-none");
    }

    // On Enter, redirect to the edit page if the type exists or the create page with a suggestion
    if (e.key === "Enter" && search != '') {
      if (visibleRows.length > 0) {
        var link = visibleRows[0].querySelector('a.edit-button');
        var hrefValue = link.getAttribute("href");
        if (hrefValue) {
          location.href = hrefValue;
        }
      } else {
        location.href = createButton.getAttribute("href") + "?suggestion=" + search;
      }
      return;
    }
  });
});